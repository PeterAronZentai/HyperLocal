(function(n,t){var ee,ou,l,du,tf,rf,at,vs,ys,wt,fh,sh,cf;n.datajs||(n.datajs={}),n.OData||(n.OData={});var fi=n.datajs,i=n.OData,wr="b",wi="c",ei="entry",bi="f",br="p",lf="s",hh="u",af="n",ki="c",ch="d",kr="i",dr="p",vf="n",b=function(n){return n!==null&&n!==t},yf=function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return!0;return!1},st=function(n,i){return n!==t?n:i},u=function(t){if(arguments.length===1){n.setTimeout(t,0);return}var i=Array.prototype.slice.call(arguments,1);n.setTimeout(function(){t.apply(this,i)},0)},gr=function(n,t){if(!n)return null;if(k(n)){for(var r,i=0,u=n.length;i<u;i++)if(r=gr(n[i],t),r)return r;return null}return n.dataServices?gr(n.dataServices.schema,t):t(n)},pf=function(n){return n.__edmType==="Edm.DateTimeOffset"||!n.__edmType&&n.__offset},wf=function(n,t){return n=n===0?"":"."+f(n.toString(),3),t>0&&(n===""&&(n=".000"),n+=f(t.toString(),4)),n},nu=function(n){var u,t,o;if(typeof n=="string")return n;if(u=pf(n),t=kf(n.__offset),u&&t!=="Z"){n=new Date(n.valueOf());var i=te(t),s=n.getUTCHours()+i.d*i.h,h=n.getMinutes()+i.d*i.m;n.setUTCHours(s,h)}else u||(t="");var r=n.getUTCFullYear(),c=n.getUTCMonth()+1,e="";return r<=0&&(r=-(r-1),e="-"),o=wf(n.getUTCMilliseconds(),n.__ns),e+f(r,4)+"-"+f(c,2)+"-"+f(n.getUTCDate(),2)+"T"+f(n.getUTCHours(),2)+":"+f(n.getUTCMinutes(),2)+":"+f(n.getUTCSeconds(),2)+o+t},bf=function(n){var t=n.ms,o="",i,r,u,e;return t<0&&(o="-",t=-t),i=Math.floor(t/864e5),t-=864e5*i,r=Math.floor(t/36e5),t-=36e5*r,u=Math.floor(t/6e4),t-=6e4*u,e=Math.floor(t/1e3),t-=e*1e3,o+"P"+f(i,2)+"DT"+f(r,2)+"H"+f(u,2)+"M"+f(e,2)+wf(t,n.ns)+"S"},f=function(n,t,i){for(var r=n.toString(10);r.length<t;)i?r+="0":r="0"+r;return r},kf=function(n){return!n||n==="Z"||n==="+00:00"||n==="-00:00"?"Z":n},lh=function(n,i,r,u,f,e){return f.request(n,function(f){try{f.headers&&di(f.headers),f.data===t&&u.read(f,e)}catch(o){o.request===t&&(o.request=n),o.response===t&&(o.response=f),r(o);return}i(f.data,f)},r)},k=function(n){return Object.prototype.toString.call(n)==="[object Array]"},df=function(n){return Object.prototype.toString.call(n)==="[object Date]"},tu=function(n,t){if(n)for(var i=0,r=n.length;i<r;i++)if(n[i].name===t)return n[i];return null},gf=function(n,t,i){return n?gr(t,function(t){return vh(n,t,i)}):null},iu=function(n,t){return gf(n,t,"complexType")},gt=function(n,t){return gf(n,t,"entityType")},ah=function(n,t){return t.indexOf(n)===0&&t.charAt(n.length)==="."?t.substr(n.length+1):null},vh=function(n,t,i){var f,r,u,e;if(t&&(f=ah(t.namespace,n),r=t[i],f&&r))for(u=0,e=r.length;u<e;u++)if(r[u].name===f)return r[u];return null},yh={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},di=function(n){var t,r,i,u;for(t in n)r=t.toLowerCase(),i=yh[r],i&&t!==i&&(u=n[t],delete n[t],n[i]=u)},ru=function(n,i){return n!==t?n:i},r=function(n){return parseInt(n,10)},ph=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,ne=function(n){var i=ph.exec(n),t,u,e;if(i===null)throw{message:"Invalid duration value."};var o=i[2]||"0",s=i[3]||"0",h=r(i[4]||0),c=r(i[5]||0),l=r(i[6]||0),a=parseFloat(i[7]||0);if(o!=="0"||s!=="0")throw{message:"Unsupported duration value."};if(t=i[8],u=0,t){if(t.length>7)throw{message:"Cannot parse duration value to given precision."};u=f(t.substring(3),4,!0),t=f(t.substring(0,3),3,!0),t=r(t),u=r(u)}else t=0;return t+=a*1e3+l*6e4+c*36e5+h*864e5,i[1]==="-"&&(t=-t),e={ms:t,__edmType:"Edm.Time"},u&&(e.ns=u),e},te=function(n){var t=n.substring(0,1),i,u;return t=t==="+"?1:-1,i=r(n.substring(1)),u=r(n.substring(n.indexOf(":")+1)),{d:t,h:i,m:u}},yt=function(n){switch(typeof n){case"object":return n?k(n)||k(n.results)?bi:n.__metadata&&n.__metadata.uri!==t?ei:k(n.EntitySets)?lf:k(n.__batchRequests)?wr:df(n)?br:wi:af;case"string":case"number":case"boolean":return br}return hh},ie=function(n,i,r){n.method||(n.method="GET"),n.headers?di(n.headers):n.headers={},n.headers.Accept===t&&(n.headers.Accept=i.accept),b(n.data)&&n.body===t&&i.write(n,r),b(n.headers.MaxDataServiceVersion)||(n.headers.MaxDataServiceVersion=i.maxDataServiceVersion||"1.0")},wh=function(n){switch(yt(n)){case wi:return n.__deferred&&n.__deferred.uri?ch:ki;case bi:case ei:return kr;case br:return dr}return vf},gi=function(n){throw n;},re=function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},bh=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,ue=["scheme","authority","path","query","fragment"],uu=function(n){var i={isAbsolute:!1},r,t,u;if(n){if(r=bh.exec(n),r)for(t=0,u=ue.length;t<u;t++)r[t+1]&&(i[ue[t]]=r[t+1]);i.scheme&&(i.isAbsolute=!0)}return i},fe=function(n){return"".concat(n.scheme||"",n.authority||"",n.path||"",n.query||"",n.fragment||"")},kh=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/,dh=/%[0-9A-F]{2}/ig,gh=function(n){var i=uu(n),r=i.scheme,u=i.authority,t;return r&&(i.scheme=r.toLowerCase(),u&&(t=kh.exec(u),t&&(i.authority="//"+(t[1]?t[1]+"@":"")+t[2].toLowerCase()+(t[3]?":"+t[3]:"")))),n=fe(i),n.replace(dh,function(n){return n.toLowerCase()})},d=function(n,t){var i,u,r,f;return t?(i=uu(n),i.isAbsolute)?n:(u=uu(t),r={},i.authority?(r.authority=i.authority,f=i.path,r.query=i.query):(i.path?(f=i.path.charAt(0)==="/"?i.path:nc(i.path,u.path),r.query=i.query):(f=u.path,r.query=i.query||u.query),r.authority=u.authority),r.path=tc(f),r.scheme=u.scheme,r.fragment=i.fragment,fe(r)):n},nc=function(n,t){var i="/",r;return t&&(r=t.lastIndexOf("/"),i=t.substring(0,r),i.charAt(i.length-1)!=="/"&&(i=i+"/")),i+n},tc=function(n){for(var t="",r="",i;n;)n.indexOf("..")===0||n.indexOf(".")===0?n=n.replace(/^\.\.?\/?/g,""):n.indexOf("/..")===0?(n=n.replace(/^\/\..\/?/g,"/"),i=t.lastIndexOf("/"),t=i===-1?"":t.substring(0,i)):n.indexOf("/.")===0?n=n.replace(/^\/\.\/?/g,"/"):(r=n,i=n.indexOf("/",1),i!==-1&&(r=n.substring(0,i)),t=t+r,n=n.replace(r,""));return t},nr=0,ic=function(n){return n.method&&n.method!=="GET"?!1:!0},rc=function(t){var i=n.document.createElement("IFRAME");i.style.display="none";var r=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;"),u='<html><head><script type="text/javascript" src="'+r+'"><\/script><\/head><body><\/body><\/html>',f=n.document.getElementsByTagName("BODY")[0];return f.appendChild(i),ou(i,u),i},uc=function(){if(n.XMLHttpRequest)return new n.XMLHttpRequest;var t;if(n.ActiveXObject)try{return new n.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(r){try{return new n.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(i){t=i}}else t={message:"XMLHttpRequest not supported"};throw t;},fc=function(n){return n.indexOf("http://")===0||n.indexOf("https://")===0||n.indexOf("file://")===0},ec=function(t){if(!fc(t))return!0;var i=n.location,r=i.protocol+"//"+i.host+"/";return t.indexOf(r)===0},oc=function(i,r){try{delete n[i]}catch(u){n[i]=t,r===nr-1&&(nr-=1)}},fu=function(n){return n&&(ou(n,""),n.parentNode.removeChild(n)),null},eu=["Content-Length","Connection","Content-Type","Accept","DataServiceVersion","MaxDataServiceVersion","Etag","Location","Content-Id","If-Match","Authorization"];i.headerKeysForRead=eu,ee=function(n,t){var r=n.getAllResponseHeaders().split(/\r?\n/),u,f,i,o,e;if(r.length===1&&r[0]==="")for(i=0;i<eu.length;i++)u=eu[i],f=n.getResponseHeader(u),f&&r.push(u+": "+f);for(i=0,o=r.length;i<o;i++)r[i]&&(e=r[i].split(": "),t[e[0]]=e[1])},ou=function(n,t){var i=n.contentWindow?n.contentWindow.document:n.contentDocument.document;i.open(),i.write(t),i.close()},i.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(t,i,r){var v={},f=null,o=!1,s,l,p,w,b,k,c,a;v.abort=function(){(s=fu(s),o)||(o=!0,f&&(f.abort(),f=null),r({message:"Request aborted"}))};var y=function(){s=fu(s),o||(o=!0,f=null,r({message:"Request timed out"}))},h,e=t.requestUri,d=st(t.enableJsonpCallback,this.enableJsonpCallback),g=st(t.callbackParameterName,this.callbackParameterName),nt=st(t.formatQueryString,this.formatQueryString);if(!d||ec(e)){if(f=uc(),f.onreadystatechange=function(){var u,n,s,h;o||f===null||f.readyState!==4||(u=f.statusText,n=f.status,n===1223&&(n=204,u="No Content"),s=[],ee(f,s),h={requestUri:e,statusCode:n,statusText:u,headers:s,body:f.responseText},o=!0,f=null,n>=200&&n<=299?i(h):r({message:"HTTP request failed",request:t,response:h}))},f.open(t.method||"GET",e,!0,t.user,t.password),t.headers)for(h in t.headers)f.setRequestHeader(h,t.headers[h]);t.withCredentials&&(f.withCredentials=!0),t.timeoutMS&&(f.timeout=t.timeoutMS,f.ontimeout=y),f.send(t.body)}else{if(!ic(t))throw{message:"Request is not local and cannot be done through JSONP."};l=nr,nr+=1,p=l.toString(),w=!1,h="handleJSONP_"+p,n[h]=function(t){s=fu(s),o||(w=!0,n.clearTimeout(b),oc(h,l),n.ActiveXObject&&!n.DOMParser&&(t=n.JSON.parse(n.JSON.stringify(t))),u(i,{body:t,statusCode:200,headers:{"Content-Type":"application/json"}}))},k=t.timeoutMS?t.timeoutMS:12e4,b=n.setTimeout(y,k),c=g+"=parent."+h,this.formatQueryString&&(c+="&"+nt),a=e.indexOf("?"),e=a===-1?e+"?"+c:a===e.length-1?e+c:e+"&"+c,s=rc(e)}return v}};var g="2.0",it=function(n){var t,r,i,f,u;if(!n)return null;for(t=n.split(";"),r={},i=1,f=t.length;i<f;i++)u=t[i].split("="),r[re(u[0])]=u[1];return{mediaType:re(t[0]),properties:r}},sc=function(n){if(!n)return t;var r=n.mediaType,i;for(i in n.properties)r+=";"+i+"="+n.properties[i];return r},oe=function(n,t,i,r){return{contentType:n,dataServiceVersion:t,metadata:i?i.metadata:null,context:i,handler:r}},su=function(n,t,i){if(n){var r=n.headers;r[t]||(r[t]=i)}},gy=function(n,t){n.dataServiceVersion||(n.dataServiceVersion=t)},se=function(n,i){var r=n.headers;return r&&r[i]||r&&r[i.toLowerCase()]||t},hu=function(n){return it(se(n,"Content-Type"))},hc=/^\s?(\d+\.\d+);?.*$/,he=function(n){var i=se(n,"DataServiceVersion"),t;if(i&&(t=hc.exec(i),t&&t.length))return t[1]},cu=function(n,t){return t&&n.accept.indexOf(t.mediaType)>=0},cc=function(n,i,r,u){var f;if(!r||!r.headers)return!1;var e=hu(r),s=he(r)||"",o=r.body;return b(o)?cu(n,e)?(f=oe(e,s,u,n),f.response=r,r.data=i(n,o,f),r.data!==t):!1:!1},lc=function(n,i,r,u){var e,o,f;return!r||!r.headers?!1:(e=hu(r),o=he(r),(!e||cu(n,e))&&(f=oe(e,o,u,n),f.request=r,r.body=i(n,r.data,f),r.body!==t))?(su(r,"DataServiceVersion",f.dataServiceVersion||"1.0"),su(r,"Content-Type",sc(f.contentType)),su(r,"MaxDataServiceVersion",n.maxDataServiceVersion),!0):!1},rt=function(n,t,i,r){return{accept:i,maxDataServiceVersion:r,read:function(t,i){return cc(this,n,t,i)},write:function(n,i){return lc(this,t,n,i)}}},ac=function(n,t){return t},ce=function(n,i){return b(i)?i.toString():t};i.textHandler=rt(ac,ce,"text/plain",g);var tr="application/xml",le="http://",ir=le+"www.w3.org/",ni=le+"schemas.microsoft.com/ado/",rr=ni+"2007/08/dataservices",ti=ir+"2000/xmlns/",ur=ir+"XML/1998/namespace",ae=ni+"2007/06/edmx",vc=ni+"2008/09/edm",yc=ni+"2006/04/edm",pc=ni+"2007/05/edm",wc=ni+"2009/11/edm",e=ir+"2005/Atom",oi=ir+"2007/app",ut=rr,s=rr+"/metadata",lu=rr+"/related/",ve=rr+"/scheme",bc=function(n){return/(^\s)|(\s$)/.test(n)},kc=function(n,t){var e="<c>"+t+"<\/c>",r=er(e,null),u=n.ownerDocument,f=r.domNode,i;for(("importNode"in u)&&(f=u.importNode(r.domNode,!0)),i=f.firstChild;i;)n.appendChild(i),i=i.nextSibling},fr=function(n,t,i){try{n.setProperty(t,i)}catch(r){}},ye=function(){var i,t;if(n.ActiveXObject)try{return t=new ActiveXObject("Msxml2.DOMDocument.6.0"),t.async=!1,t}catch(u){try{return t=new ActiveXObject("Msxml2.DOMDocument.3.0"),t.async=!1,fr(t,"ProhibitDTD",!0),fr(t,"MaxElementDepth",256),fr(t,"AllowDocumentFunction",!1),fr(t,"AllowXsltScript",!1),t}catch(r){i=r}}else{if(n.DOMParser)return new n.DOMParser;i={message:"XML DOM parser not supported"}}throw i;},pe=function(n){return{name:n.localName,namespace:n.nsURI,value:n.domNode.value}},we=function(n){var t={name:n.localName,namespace:n.nsURI,value:be(n.domNode),attributes:[],children:[]};return ii(n,function(n){n.nsURI!==ti&&t.attributes.push(pe(n))}),a(n,function(n){t.children.push(we(n))}),t},dc=function(n){return n===null||/^\s*$/.test(n)},gc=function(n){while(n!==null&&n.nodeType===1){var t=or(n,"space",ur);if(t==="preserve")return!0;if(t==="default")break;else n=n.parentNode}return!1},be=function(n){for(var r=null,i=n.firstChild,o=n.ownerDocument.preserveWhiteSpace===!1,e,u,f;i;)(i.nodeType===3||i.nodeType===4)&&(u=i.nodeValue,f=o||!dc(u),f||(e===t&&(e=gc(n)),f=e),f&&(r?r+=u:r=u)),i=i.nextSibling;return r},ft=function(n,t,i){var u,r;if(n.getElementsByTagNameNS){if(u=n.getElementsByTagNameNS(t,i),u.length!==0)return u[0]}else for(r=n.firstChild;r;){if(r.nodeType===1&&ge(r)===i&&r.namespaceURI===t)return r;r=r.nextSibling}return null},nl=function(n,t){var u="http://www.mozilla.org/newlayout/xml/parsererror.xml",i=ot(n,""),r;if(i.localName==="parsererror"&&i.nsURI===u){var e=be(n),f=ft(i,u,"sourcetext"),o=f?f.nodeValue:"";throw{message:e,errorXmlText:t,srcText:o};}if(r="http://www.w3.org/1999/xhtml",i.localName==="h3"&&i.nsURI==r||ft(n,r,"h3"))throw{message:v(n),errorXmlText:t,srcText:""};},ke=function(n,t,i){var r=n.ownerDocument,u;u=r.createAttributeNS?r.createAttributeNS(ti,t):r.createNode(2,t,ti),u.nodeValue=i,n.setAttributeNode(u)},au=function(n,t){var i,r;bc(t)&&(i=to(n,"space",ur,"xml"),i.value="preserve"),r=n.ownerDocument.createTextNode(t),n.appendChild(r)},ii=function(n,t){for(var r,u=n.domNode,i=0,f=u.attributes.length;i<f;i++)r=u.attributes.item(i),t(ot(r))},ri=function(n,t,i){return or(n.domNode,t,i)},tl=function(n,t,i){var r=n.attributes;return r.getNamedItemNS?r.getNamedItemNS(i,t):r.getQualifiedItem(t,i)},a=function(n,t){for(var i=n.domNode.firstChild,r;i!==null;)i.nodeType===1&&(r=d(vu(i),n.baseURI),t(ot(i,r))),i=i.nextSibling},de=function(n){for(var t=n.domNode.firstChild,i;t!==null;){if(t.nodeType===1)return i=d(vu(t),n.baseURI),ot(t,i);t=t.nextSibling}return null},v=function(n){var u=n.text,i,r;if(u!==t)return u;if(u="",i=n.firstChild,i)do if((i.nodeType===3||i.nodeType===4)&&(u+=i.nodeValue),r=i.firstChild,r)i=r;else while(i!==n)if(r=i.nextSibling,r){i=r;break}else i=i.parentNode;while(i!==n);return u},ge=function(n){return n.localName?n.localName:n.baseName},no=function(t,i){var r;return n.ActiveXObject?(r=ye(),r.documentElement=r.createNode(1,t,i)):n.document.implementation&&n.document.implementation.createDocument&&(r=n.document.implementation.createDocument(i,t,null)),ot(r.documentElement)},to=function(n,i,r,u){var e=n.ownerDocument,f;return i=u?u+":"+i:i,e.createAttributeNS?(f=e.createAttributeNS(r,i),n.setAttributeNodeNS(f)):(f=e.createNode(2,i,r||t),n.setAttributeNode(f)),f},il=function(n,i,r,u){var f=n.ownerDocument,e;return i=u?u+":"+i:i,e=f.createElementNS?f.createElementNS(r,i):f.createNode(1,i,r||t),n.appendChild(e),e},c=function(n,i,r,u){var e=n.domNode.ownerDocument,f;return f=e.createElementNS?e.createElementNS(r,i):e.createNode(1,i,r||t),u&&au(f,u),n.domNode.appendChild(f),ot(f)},et=function(n,i,r,u){var e=n.domNode.ownerDocument,f;return e.createAttributeNS?(f=e.createAttributeNS(r,i),f.value=u,n.domNode.setAttributeNodeNS(f)):(f=e.createNode(2,i,r||t),f.value=u,n.domNode.setAttributeNode(f)),ot(f)},si=function(n,t){return t?t+":"+n:n},er=function(n,t){var i=ul(n),r=d(vu(i),t);return ot(i,r)},io=function(n){var t=n.domNode.ownerDocument;return ro(t)},rl=function(n){var r=n.childNodes,t,u=r.length,i;if(u===0)return"";for(i=n.ownerDocument.createDocumentFragment(),t=0;t<u;t++)i.appendChild(r[t].cloneNode(!0));return ro(i)},ro=function(i){var r=i.xml,u;if(r!==t)return r;if(n.XMLSerializer)return u=new n.XMLSerializer,u.serializeToString(i);throw{message:"XML serialization unsupported"};},or=function(n,t,i){if(n.getAttributeNS)return n.getAttributeNS(i||null,t);var r=n.attributes.getQualifiedItem(t,i);return r?r.value:null},vu=function(n){return or(n,"base",ur)},ul=function(n){var t=ye();if(t.parseFromString)t=t.parseFromString(n,"text/xml"),nl(t.documentElement,n);else if(t.loadXML(n),t.parseError.errorCode!==0)throw{message:t.parseError.reason,errorXmlText:n,srcText:t.parseError.srcText};return t.documentElement},ot=function(n,t){var i=n.namespaceURI,r=n.nodeName;return i||(i=n.nodeType===2&&(r==="xmlns"||r.indexOf("xmlns:",0)===0)?ti:null),{baseURI:t,domNode:n,localName:ge(n),nsURI:i}},fl=function(n){if(n.nsURI===ut)switch(n.localName){case"links":return el(n);case"uri":return uo(n)}return t},el=function(n){var t=[];return a(n,function(n){if(n.localName==="uri"&&n.nsURI===ut){var i=uo(n);t.push(i)}}),{results:t}},uo=function(n){return{uri:v(n.domNode)}},ol=function(n){if(yt(n)===wi&&!n.__metadata&&n.hasOwnProperty("uri"))return sl(n)},sl=function(n){var t=hl(null,"uri",ut);return n.uri&&au(t.domNode,n.uri),t},hl=function(n,t,i){return n?c(n,t,i):no(t,i)},cl=function(n,t){if(t){var i=er(t);if(i)return fl(i)}},ll=function(n,i,r){var f=r.contentType=r.contentType||it(tr),e=t,u;return f&&f.mediaType===tr&&(u=ol(i),u&&(e=io(u))),e};i.xmlHandler=rt(cl,ll,tr,g);var yu=["application/atom+xml","application/atomsvc+xml","application/xml"],fo=yu[0],al=si("inline","m"),vl=si("properties","m"),yl=si("type","m"),pl=si("null","m"),wl=[e,oi,ur,ti],bl={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},sr=function(n){return!yf(wl,n)},hi=function(n){return n},kl=function(n){return n==="true"},dl=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(.*)$/,eo=function(n,t){var i=dl.exec(n),s=i?kf(i[8]):null,h,u,o,c,l,e;if(!i||!t&&s!=="Z")throw{message:"Invalid date/time value"};if(h=r(i[1]),h<=0&&h++,u=i[7],o=0,u){if(u.length>7)throw{message:"Cannot parse date/time value to given precision."};o=f(u.substring(3),4,!0),u=f(u.substring(0,3),3,!0),u=r(u),o=r(o)}else u=0;var a=r(i[4]),v=r(i[5]),y=r(i[6]);if(s!=="Z"&&(c=te(s),l=-c.d,a+=c.h*l,v+=c.m*l),e=new Date,e.setUTCFullYear(h,r(i[2])-1,r(i[3])),e.setUTCHours(a,v,y,u),isNaN(e.valueOf()))throw{message:"Invalid date/time value"};return t&&(e.__edmType="Edm.DateTimeOffset",e.__offset=s),o&&(e.__ns=o),e},gl=function(n){return eo(n,!0)},na=function(n){return eo(n,!0)},oo={"Edm.Boolean":kl,"Edm.Binary":hi,"Edm.DateTime":gl,"Edm.DateTimeOffset":na,"Edm.Time":ne,"Edm.Decimal":hi,"Edm.Guid":hi,"Edm.String":hi,"Edm.Byte":r,"Edm.Double":parseFloat,"Edm.Single":parseFloat,"Edm.Int16":r,"Edm.Int32":r,"Edm.Int64":hi,"Edm.SByte":r},y=function(n){return n.toString()},ta={"Edm.Binary":y,"Edm.Boolean":y,"Edm.Byte":y,"Edm.DateTime":nu,"Edm.DateTimeOffset":nu,"Edm.Decimal":y,"Edm.Double":y,"Edm.Guid":y,"Edm.Int16":y,"Edm.Int32":y,"Edm.Int64":y,"Edm.SByte":y,"Edm.Single":y,"Edm.String":y,"Edm.Time":bf},pu=function(n){return n&&oo[n]!==t},so=function(n,t){if(n!==null&&t){var i=oo[t];i&&(n=i(n))}return n},ho=function(n,t){if(n!==null&&t){df(n)&&(t=pf(n)?"Edm.DateTimeOffset":"Edm.DateTime");var i=ta[t];i&&(n=i(n))}return n},co=function(n,t){if(n.nsURI===e)switch(n.localName){case"feed":return ia(n,t);case"entry":return wo(n,t)}if(n.nsURI===oi&&n.localName==="service")return wa(n)},ia=function(n,t){var i={},u={results:[],__metadata:i};return i.feed_extensions=li(n),a(n,function(n){var f,o;switch(n.nsURI){case e:switch(n.localName){case"id":i.uri=d(v(n.domNode),n.baseURI),i.uri_extensions=li(n);break;case"title":i.title=v(n.domNode),i.title_extensions=li(n);break;case"entry":f=wo(n,t),u.results.push(f);break;case"link":ra(n,u)}return;case s:if(n.localName==="count"){u.__count=r(v(n.domNode));return}}o=ci(n),i.feed_extensions.push(o)}),u},ra=function(n,t){var i=lo(n),r=t.__metadata;switch(i.rel){case"next":t.__next=i.href,r.next_extensions=i.extensions;break;case"self":r.self=i.href,r.self_extensions=i.extensions}},lo=function(n){var t={extensions:[]},i;if(ii(n,function(r){if(!r.nsURI)switch(r.localName){case"href":t.href=d(r.domNode.nodeValue,n.baseURI);return;case"type":case"rel":t[r.localName]=r.domNode.nodeValue;return}sr(r.nsURI)&&(i=ai(r),t.extensions.push(i))}),!t.href)throw{error:"href attribute missing on link element",element:n};return t},ci=function(n){var t={name:n.localName,namespaceURI:n.nsURI,attributes:li(n),children:[]},i;return a(n,function(n){var i=ci(n);t.children.push(i)}),t.children.length===0&&(i=v(n.domNode),i&&(t.value=i)),t},li=function(n){var t=[];return ii(n,function(n){if(sr(n.nsURI)){var i=ai(n);t.push(i)}}),t},ai=function(n){return{name:n.localName,namespaceURI:n.nsURI,value:n.domNode.nodeValue}},ao=function(n,i){if(n.indexOf("/")===-1)return i[n];for(var u=n.split("/"),r=0,f=u.length;r<f;r++){if(i===null)return t;if(i=i[u[r]],i===t)return i}return i},ua=function(n,i,r,u){var o,s,f,h,e;if(n.indexOf("/")===-1)i[n]=r,o=n;else{for(s=n.split("/"),f=0,h=s.length-1;f<h;f++){if(e=i[s[f]],e===t)e={},i[s[f]]=e;else if(e===null)return;i=e}o=s[f],i[o]=r}if(u){var c=i.__metadata=i.__metadata||{},l=c.properties=c.properties||{},a=l[o]=l[o]||{};a.type=u}},vo=function(n){return bl[n]||n},fa=function(n,i,r,u){for(var e=i.split("/"),f=0,o=e.length;f<o;f++){if(e[f].charAt(0)==="@")return or(r,e[f].substring(1),n);if(r=ft(r,n,e[f]),!r)return t}return u?rl(r):v(r)},ea=function(n,t,i,r,u,f){for(var e=r,h=i.split("/"),s,o=0,c=h.length;o<c;o++)h[o].charAt(0)==="@"?(s=tl(e,h[o].substring(1),n),s||(s=to(e,h[o].substring(1),n,t))):(s=ft(e,n,h[o]),s||(s=il(e,h[o],n,t))),e=s;e.nodeType===2?e.value=f:(u&&e.setAttribute("type",u),u==="xhtml"?kc(e,f):au(e,f))},oa=function(n){var r,u,t,i;if(n.childNodes.length)return!1;if(r=n.attributes,u=r.length,u===0)return!0;for(t=0;t<u;t++)if(i=r[t].nodeName,i!=="xmlns"&&i.indexOf("xmlns:")!==0&&i!=="m:type")return!1;return!0},sa=function(n,t){var u=ft(n.domNode,s,"properties"),h,i,o,f,a,c,r,l;if(u||(h=ft(n.domNode,e,"content"),h&&(u=ft(h,s,"properties"))),u){for(i=u,o=t.split("/"),f=0,a=o.length-1;f<a;f++)if(i=ft(i,ut,o[f]),!i)return;for(c=ft(i,ut,o[f]),c&&i.removeChild(c),r=i;r!==u&&oa(r);)l=r.parentNode,l.removeChild(r),r=l}},yo=function(n,t,i,r,u,f,o){var h=n["FC_TargetPath"+f],c=vo(h),l=h!==c?e:n["FC_NsUri"+f],a=n["FC_KeepInContent"+f]==="true"?!0:!1,v=n["FC_ContentKind"+f],y=n["FC_NsPrefix"+f]||null,s=ao(t,r);b(s)&&(a||(o.dataServiceVersion="2.0",sa(i,t)),s=ho(s,u),ea(l,y,c,i.domNode,v,s))},po=function(n,i,r,u,f,o){if(n["FC_KeepInContent"+o]!=="true"&&ao(i,u)!==null){var h=n["FC_TargetPath"+o],c=vo(h),l=h!==c?e:n["FC_NsUri"+o],a=n["FC_ContentKind"+o]==="xhtml",s=fa(l,c,r.domNode,a);s!==t&&(s=so(s,f),ua(i,u,s,f))}},wu=function(n,t,i){for(var s=i.split("/"),u,h,f,e,o,r;t;){for(f=t,u=0,h=s.length;u<h;u++){if(e=f.property,!e)break;if(o=tu(e,s[u]),!o)break;if(r=o.type,!r||pu(r))return r||null;if(f=iu(r,n),!f)return null}t=gt(t.baseType,n)}return null},ha=function(n,t,i){var o,r,f,u,s,h,a,l;if(i&&i.length!==0)for(o=t.__metadata.type;o;){if(r=gt(o,i),!r)return;if(u=r.FC_SourcePath,u&&(f=wu(i,r,u),po(r,u,n,t,f,"")),s=r.property,s)for(h=0,a=s.length;h<a;h++)for(var e=s[h],v=0,c="";e["FC_TargetPath"+c];)u=e.name,f=e.type,l=e["FC_SourcePath"+c],l&&(u+="/"+l,f=wu(i,r,u)),po(e,u,n,t,f,c),v++,c="_"+v;o=r.baseType}},wo=function(n,t){var i={},r={__metadata:i},u=ri(n,"etag",s);return u&&(i.etag=u),a(n,function(n){if(n.nsURI===e)switch(n.localName){case"id":i.uri=d(v(n.domNode),n.baseURI),i.uri_extensions=li(n);break;case"category":ca(n,r,i);break;case"content":la(n,r);break;case"link":va(n,r,t)}n.nsURI===s&&n.localName==="properties"&&bu(n,r,i)}),ha(n,r,t),r},ca=function(n,t,i){var u=ri(n,"scheme"),f=ri(n,"term"),r;if(u===ve){if(t.__metadata.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:n};i.type=f,i.type_extensions=[],ii(n,function(n){n.nsURI?sr(n.nsURI)&&(r=ai(n),i.type_extensions.push(r)):n.localName!=="scheme"&&n.localName!=="term"&&(r=ai(n),i.type_extensions.push(r))})}},la=function(n,t){var i=ri(n,"src"),u=ri(n,"type"),r=t.__metadata;if(i){if(!u)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:n};r.media_src=d(i,n.baseURI),r.content_type=u}a(n,function(u){if(i)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:n};u.nsURI===s&&u.localName==="properties"&&bu(u,t,r)})},aa=function(n,t,i){i.edit_media=n.href,i.edit_media_extensions=[];for(var r=0,u=n.extensions.length;r<u;r++)n.extensions[r].namespaceURI===s&&n.extensions[r].name==="etag"?i.media_etag=n.extensions[r].value:i.edit_media_extensions.push(n.extensions[r])},va=function(n,t,i){var r=lo(n),u=t.__metadata;switch(r.rel){case"self":u.self=r.href,u.self_link_extensions=r.extensions;break;case"edit":u.edit=r.href,u.edit_link_extensions=r.extensions;break;case"edit-media":aa(r,t,u);break;default:r.rel.indexOf(lu)===0&&ya(n,r,t,i)}},ya=function(n,i,r,u){var e=i.rel.substring(lu.length),f=t;a(n,function(n){if(n.nsURI===s&&n.localName==="inline"){var t=de(n);f=t?co(t,u):null}}),f===t&&(f={__deferred:{uri:i.href}}),r[e]=f,r.__metadata.properties=r.__metadata.properties||{},r.__metadata.properties[e]={extensions:i.extensions}},bu=function(n,t,i){a(n,function(n){n.nsURI===ut&&(i.properties=i.properties||{},pa(n,t,i.properties))})},pa=function(n,t,i){var e=null,u="Edm.String",o=[],r,f;ii(n,function(n){if(n.nsURI===s)switch(n.localName){case"null":e=n.domNode.nodeValue;return;case"type":u=n.domNode.nodeValue;return}if(sr(n.nsURI)){var t=ai(n);o.push(t)}}),r=null,f={type:u,extensions:o},e!=="true"&&(r=v(n.domNode),pu(u)?r=so(r,u):de(n)&&(r={__metadata:{type:u}},bu(n,r,f))),t[n.localName]=r,i[n.localName]=f},wa=function(n){var t={workspaces:[],extensions:[]};if(a(n,function(i){var r,u;i.nsURI===oi&&i.localName==="workspace"?(r=ba(i),t.workspaces.push(r)):(u=ci(n),t.extensions.push(u))}),t.workspaces.length===0)throw{message:"Invalid AtomPub service document: No workspace element found.",element:n};return t},ba=function(n){var t={collections:[],extensions:[]};return a(n,function(i){var r,u;if(i.nsURI===e){if(i.localName==="title"){if(n.title)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:i};t.title=v(i.domNode)}}else i.nsURI===oi?i.localName==="collection"&&(r=ka(i,t),t.collections.push(r)):(u=ci(n),t.extensions.push(u))}),t.title=t.title||"",t},ka=function(n){var t={href:ri(n,"href"),extensions:[]};if(!t.href)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:n};if(t.href=d(t.href,n.baseURI),a(n,function(i){if(i.nsURI===e){if(i.localName==="title"){if(t.title)throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:i};t.title=v(i.domNode)}}else if(i.nsURI!==oi){var r=ci(n);t.extensions.push(r)}}),!t.title)throw{message:"Invalid AtomPub service document: collection has no title element",element:n};return t},da=function(n,t){var i,r=yt(n);switch(r){case bi:i=ko(null,n,t);break;case ei:case wi:i=ku(null,n,t)}return i},bo=function(n,t){if(n)return c(n,t,e);var i=no(t,e);return ke(i.domNode,"xmlns:d",ut),ke(i.domNode,"xmlns:m",s),i},ko=function(n,t,i){var f=bo(n,"feed"),u=k(t)?t:t.results,r,e;if(u)for(r=0,e=u.length;r<e;r++)ku(f,u[r],i);return f},ku=function(n,t,i){var r=bo(n,"entry"),h=c(r,"author",e),u,f,o;return c(h,"name",e),c(r,"title",e),u=c(r,"content",e),et(u,"type",null,"application/xml"),f=c(u,vl,s),o=t.__metadata?t.__metadata.properties:null,nv(r,t.__metadata),go(r,f,t,o,i),ga(r,t,i),r},ga=function(n,t,i){var o,r,c,u,s,h,l;if(t.__metadata)for(o=i.metadata,r=gt(t.__metadata.type,o);r;){if(u=r.FC_SourcePath,u&&(c=wu(o,r,u),yo(r,u,n,t,c,"",i)),s=r.property,s)for(h=0,l=s.length;h<l;h++)for(var f=s[h],a=0,e="";f["FC_TargetPath"+e];)u=f.name,f["FC_SourcePath"+e]&&(u+="/"+f["FC_SourcePath"+e]),yo(f,u,n,t,f.type,e,i),a++,e="_"+a;r=gt(r.baseType,o)}},nv=function(n,t){if(t&&(t.etag&&et(n,"etag",s,t.etag),t.uri&&c(n,"id",e,t.uri),t.type)){var i=c(n,"category",e);et(i,"term",null,t.type),et(i,"scheme",null,ve)}},tv=function(n,t,i){var r=c(n,"link",e);return et(r,"rel",null,i),et(r,"href",null,t),r},go=function(n,i,r,u,f){var s,c,o,e,l=f.metadata,h;for(s in r)s!=="__metadata"&&(c=r[s],o=wh(c),e=u?u[s]:null,e||(h===t&&r.__metadata&&(h=gt(r.__metadata.type,l)),h&&(e=tu(h.property,s),e||(e=tu(h.navigationProperty,s)))),o===vf&&(o=dr,e&&!pu(e.type)&&(e.relationship?o=kr:iu(e.type,f.metadata)&&(o=ki))),o===dr||o===ki?iv(i,s,o,c,e,f):rv(n,o,s,c,f))},iv=function(n,t,i,r,u,f){var h=si(t,"d"),o=u&&u.type,e,l;i===ki?(e=c(n,h,ut),u&&(l=u.properties),r===null&&(f.dataServiceVersion="2.0"),go(null,e,r,l,f)):e=c(n,h,ut,ho(r,o||"Edm.String")),r===null&&et(e,pl,s,"true"),o&&et(e,yl,s,o)},rv=function(n,t,i,r,u){var o,e,f,l=t===kr,a,h,v;if(l){o=r&&r.__metadata?r.__metadata.uri:"",f=yt(r);switch(f){case ei:e=ku;break;case bi:f="feed",e=ko;break;case af:f=ei,e=null;break;default:throw{message:"Invalid payload for inline navigation property: "+f};}}else o=r.__deferred.uri;a=d(i,lu),h=tv(n,o,a),l&&(v=c(h,al,s),et(h,"type",null,"application/atom+xml;type="+f),e&&e(v,r,u))},ns=function(n,t,i){if(t){var r=er(t);if(r)return co(r,i.metadata)}},uv=function(n,i,r){var u=r.contentType=r.contentType||it(fo),f=t,e;return u&&u.mediaType===fo&&(e=da(i,r),f=io(e)),f};i.atomHandler=rt(ns,uv,yu.join(","),g),l={elements:{Association:{attributes:["Name"],elements:["End*","ReferentialConstraint"]},AssociationSet:{attributes:["Name","Association"],elements:["End*"]},CollectionType:{attributes:["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation"]},ComplexType:{attributes:["Name","BaseType","Abstract"],elements:["Property*"]},DefiningExpression:{text:!0},Dependent:{attributes:["Role"],elements:["PropertyRef*"]},Documentation:{text:!0},End:{attributes:["Type","Role","Multiplicity","EntitySet"],elements:["OnDelete"]},EntityContainer:{attributes:["Name","Extends"],elements:["EntitySet*","AssociationSet*","FunctionImport*"]},EntitySet:{attributes:["Name","EntityType"]},EntityType:{attributes:["Name","BaseType","Abstract","OpenType"],elements:["Key","Property*","NavigationProperty*"]},Function:{attributes:["Name","ReturnType"],elements:["Parameter*","DefiningExpression","ReturnType"]},FunctionImport:{attributes:["Name","ReturnType","EntitySet"],elements:["Parameter*"]},Key:{elements:["PropertyRef*"]},NavigationProperty:{attributes:["Name","Relationship","ToRole","FromRole"]},OnDelete:{attributes:["Action"]},Parameter:{attributes:["Name","Type","Mode","MaxLength","Precision","Scale"]},Principal:{attributes:["Role"],elements:["PropertyRef*"]},Property:{attributes:["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode"]},PropertyRef:{attributes:["Name"]},ReferenceType:{attributes:["Type"]},ReferentialConstraint:{elements:["Principal","Dependent"]},ReturnType:{attributes:["ReturnType"],elements:["CollectionType","ReferenceType","RowType"]},RowType:{elements:["Property*"]},Schema:{attributes:["Namespace","Alias"],elements:["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*"]},TypeRef:{attributes:["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation"]},Using:{attributes:["Namespace","Alias"]}}},du=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"],l.elements.Property.attributes=l.elements.Property.attributes.concat(du),l.elements.EntityType.attributes=l.elements.EntityType.attributes.concat(du),l.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:ae},l.elements.DataServices={elements:["Schema*"],ns:ae},l.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer"),l.elements.Property.attributes.push("m:MimeType"),l.elements.FunctionImport.attributes.push("m:HttpMethod"),l.elements.EntityType.attributes.push("m:HasStream"),l.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var ts=function(n){if(!n)return n;if(n.length>1){var t=n.substr(0,2);return t===t.toUpperCase()?n:n.charAt(0).toLowerCase()+n.substr(1)}return n.charAt(0).toLowerCase()},fv=function(n,t){var r,u,e,i,f,o;if(t==="Documentation")return{isArray:!0,propertyName:"documentation"};if(r=n.elements,!r)return null;for(u=0,e=r.length;u<e;u++)if(i=r[u],f=!1,i.charAt(i.length-1)==="*"&&(f=!0,i=i.substr(0,i.length-1)),t===i)return o=ts(i),{isArray:f,propertyName:o};return null},ev=/^(m:FC_.*)_[0-9]+$/,is=function(n){return n===vc||n===yc||n===pc||n===wc},gu=function(n){var u,t;if(n.domNode||(n=ot(n,"")),u=n.localName,t=l.elements[u],!t)return null;if(t.ns){if(n.nsURI!==t.ns)return null}else if(!is(n.nsURI))return null;var i={},r=[],f=t.attributes||[];return ii(n,function(n){var c=n.domNode,h=n.localName,u=n.nsURI,l=c.value,t,e,o;u!==ti&&(t=null,e=!1,is(u)||u===null?t="":u===s&&(t="m:"),t!==null&&(t+=h,o=ev.exec(t),o&&(t=o[1]),yf(f,t)&&(e=!0,i[ts(h)]=l)),e||r.push(pe(n)))}),a(n,function(n){var u=fv(t,n.localName),f;u?u.isArray?(f=i[u.propertyName],f||(f=[],i[u.propertyName]=f),f.push(gu(n))):i[u.propertyName]=gu(n):r.push(we(n))}),t.text&&(i.text=v(n)),r.length&&(i.extensions=r),i},ov=function(n,i){var r=er(i);return gu(r)||t};i.metadataHandler=rt(ov,null,tr,g);var hr=["application/json","application/json;odata=verbose"],sv=it(hr[0]),hv=it(hr[1]),cv=function(n,t){for(var u={collections:[]},r,e,i=0,f=n.EntitySets.length;i<f;i++)r=n.EntitySets[i],e={title:r,href:d(r,t)},u.collections.push(e);return{workspaces:[u]}},lv=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,av=function(n){var t,i;return n<0?(t="-",n=-n):t="+",i=Math.floor(n/60),n=n-60*i,t+f(i,2)+":"+f(n,2)},rs=function(n){var i=n&&lv.exec(n),t,u,f;if(i&&(t=new Date(r(i[1])),i[2]&&(u=r(i[3]),i[2]==="-"&&(u=-u),f=t.getUTCMinutes(),t.setUTCMinutes(f-u),t.__edmType="Edm.DateTimeOffset",t.__offset=av(u)),!isNaN(t.valueOf())))return t},us=function(n,i){var r,f,u;if(n&&typeof n=="object")for(r in n)f=n[r],u=us(f,i),u=i(r,u),u!==f&&(f===t?delete n[r]:n[r]=u);return n},vv=function(n,t){return t("",us(n,t))},yv=function(i,r,u){var e=u.metadata,o=st(u.context?u.context.recognizeDates:t,i.recognizeDates),f=typeof r=="string"?n.JSON.parse(r):r;return f=vv(f,function(n,t){var s,h,r,u,a,l;if(t&&typeof t=="object")if(s=t.__metadata&&t.__metadata.type,h=gt(s,e)||iu(s,e),h){if(r=h.property,r)for(u=0,a=r.length;u<a;u++){var f=r[u],c=f.name,i=t[c];if(f.type==="Edm.DateTime"||f.type==="Edm.DateTimeOffset"){if(i){if(i=rs(i),!i)throw{message:"Invalid date/time value"};t[c]=i}}else f.type==="Edm.Time"&&(t[c]=ne(i))}}else if(o)for(l in t)i=t[l],typeof i=="string"&&(t[l]=rs(i)||i);return t}).d,f=bv(f,u.dataServiceVersion),wv(f,u.response.requestUri)},fs=function(i,r,u){var f=t,e=u.contentType=u.contentType||hv,o,s;if(e&&e.mediaType===sv.mediaType){o=r,s=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return nu(this)},f=n.JSON.stringify(o,pv)}finally{Date.prototype.toJSON=s}}return f},pv=function(n,t){return t&&t.__edmType==="Edm.Time"?bf(t):t},wv=function(n,t){return yt(n)===lf?cv(n,t):n},bv=function(n,t){return t&&t.lastIndexOf(";")===t.length-1&&(t=t.substr(0,t.length-1)),t||k(n)&&(t="1.0"),t==="1.0"&&k(n)&&(n={results:n}),n};i.jsonHandler=rt(yv,fs,hr.join(","),g),i.jsonHandler.recognizeDates=!1;var nt="multipart/mixed",kv=/^HTTP\/1\.\d (\d{3}) (.*)$/i,dv=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,nf=function(){return Math.floor((1+Math.random())*65536).toString(16).substr(1)},cr=function(n){return n+nf()+"-"+nf()+"-"+nf()},es=function(n){return n.handler.partHandler},lr=function(n){var t=n.boundaries;return t[t.length-1]},gv=function(n,t,i){var r=i.contentType.properties.boundary;return{__batchResponses:os(t,{boundaries:[r],handlerContext:i})}},ny=function(n,t,i){var r=i.contentType=i.contentType||it(nt);if(r.mediaType===nt)return ty(t,i)},os=function(n,t){var f="--"+lr(t),u,s,h,r,e,i;for(pt(n,t,f),p(n,t),u=[];s!=="--"&&t.position<n.length;){if(h=ar(n,t),r=it(h["Content-Type"]),r&&r.mediaType===nt){t.boundaries.push(r.properties.boundary);try{e=os(n,t)}catch(o){o.response=ss(n,t,f),e=[o]}u.push({__changeResponses:e}),t.boundaries.pop(),pt(n,t,"--"+lr(t))}else{if(!r||r.mediaType!=="application/http")throw{message:"invalid MIME part type "};p(n,t),i=ss(n,t,f);try{i.statusCode>=200&&i.statusCode<=299?es(t.handlerContext).read(i,t.handlerContext):i={message:"HTTP request failed",response:i}}catch(o){i=o}u.push(i)}s=n.substr(t.position,2),p(n,t)}return u},ar=function(n,t){var r={},i,u,f;do f=t.position,u=p(n,t),i=dv.exec(u),i!==null?r[i[1]]=i[2]:t.position=f;while(u&&i);return di(r),r},ss=function(n,t,i){var o=t.position,r=kv.exec(p(n,t)),u,f,e;return r?(u=r[1],f=r[2],e=ar(n,t),p(n,t)):t.position=o,{statusCode:u,statusText:f,headers:e,body:pt(n,t,"\r\n"+i)}},p=function(n,t){return pt(n,t,"\r\n")},pt=function(n,t,i){var u=t.position||0,r=n.length;if(i){if(r=n.indexOf(i,u),r===-1)return null;t.position=r+i.length}else t.position=r;return n.substring(u,r)},ty=function(n,t){var f=yt(n),s;if(f!==wr)throw{message:'Serialization of batches of type "'+f+'" is not supported'};for(var r=cr("batch_"),e=n.__batchRequests,u="",i=0,o=e.length;i<o;i++)u+=ht(r,!1)+hs(e[i],t);return u+=ht(r,!0),s=t.contentType.properties,s.boundary=r,u},ht=function(n,t){var i="\r\n--"+n;return t&&(i+="--"),i+"\r\n"},hs=function(n,t,i){var e=n.__changeRequests,r,u,f,o;if(k(e)){if(i)throw{message:"Not Supported: change set nested in other change set"};for(u=cr("changeset_"),r="Content-Type: "+nt+"; boundary="+u+"\r\n",f=0,o=e.length;f<o;f++)r+=ht(u,!1)+hs(e[f],t,!0);r+=ht(u,!0)}else r="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n",ie(n,es(t),{metadata:t.metadata}),r+=iy(n);return r},iy=function(n){var t=(n.method?n.method:"GET")+" "+n.requestUri+" HTTP/1.1\r\n",i;for(i in n.headers)n.headers[i]&&(t=t+i+": "+n.headers[i]+"\r\n");return t+="\r\n",n.body&&(t+=n.body),t};i.batchHandler=rt(gv,ny,nt,g),tf=[i.jsonHandler,i.atomHandler,i.xmlHandler,i.textHandler],rf=function(n,t,i){for(var r=0,u=tf.length;r<u&&!tf[r][n](t,i);r++);if(r===u)throw{message:"no handler for data"};},i.defaultSuccess=function(t){n.alert(n.JSON.stringify(t))},i.defaultError=gi,i.defaultHandler={read:function(n,t){n&&b(n.body)&&n.headers["Content-Type"]&&rf("read",n,t)},write:function(n,t){rf("write",n,t)},maxDataServiceVersion:g,accept:"application/atomsvc+xml;q=0.8, application/json;odata=verbose;q=0.5, */*;q=0.1"},i.defaultMetadata=[],i.read=function(n,t,r,u,f,e){var o;return o=n instanceof String||typeof n=="string"?{requestUri:n}:n,i.request(o,t,r,u,f,e)},i.request=function(n,t,r,u,f,e){t||(t=i.defaultSuccess),r||(r=i.defaultError),u||(u=i.defaultHandler),f||(f=i.defaultHttpClient),e||(e=i.defaultMetadata),n.recognizeDates=st(n.recognizeDates,i.jsonHandler.recognizeDates),n.callbackParameterName=st(n.callbackParameterName,i.defaultHttpClient.callbackParameterName),n.formatQueryString=st(n.formatQueryString,i.defaultHttpClient.formatQueryString),n.enableJsonpCallback=st(n.enableJsonpCallback,i.defaultHttpClient.enableJsonpCallback);var o={metadata:e,recognizeDates:n.recognizeDates,callbackParameterName:n.callbackParameterName,formatQueryString:n.formatQueryString,enableJsonpCallback:n.enableJsonpCallback};try{return ie(n,u,o),lh(n,t,r,u,f,o)}catch(s){r(s)}},i.batchHandler.partHandler=i.defaultHandler;var w=n.localStorage,ry=function(){var t={v:this.valueOf(),t:"[object Date]"},n;for(n in this)t[n]=this[n];return t},uy=function(n,t){var r,i;if(t&&t.t==="[object Date]"){r=new Date(t.v);for(i in t)i!=="t"&&i!=="v"&&(r[i]=t[i]);t=r}return t},vr=function(n,t){return n.name+"#!#"+t},cs=function(n,t){return t.replace(n.name+"#!#","")},o=function(n){this.name=n};o.create=function(n){if(o.isSupported())return new o(n);throw{message:"Web Storage not supported by the browser"};},o.isSupported=function(){return!!w},o.prototype.add=function(n,t,i,r){r=r||this.defaultError;var f=this;this.contains(n,function(e){e?u(r,{message:"key already exists",key:n}):f.addOrUpdate(n,t,i,r)},r)},o.prototype.addOrUpdate=function(i,r,f,e){var h,c,o;if(e=e||this.defaultError,i instanceof Array)e({message:"Array of keys not supported"});else{h=vr(this,i),c=Date.prototype.toJSON;try{o=r,o!==t&&(Date.prototype.toJSON=ry,o=n.JSON.stringify(r)),w.setItem(h,o),u(f,i,r)}catch(s){s.code===22||s.number===2147942414?u(e,{name:"QUOTA_EXCEEDED_ERR",error:s}):u(e,s)}finally{Date.prototype.toJSON=c}}},o.prototype.clear=function(n,t){var i,r,f,e;t=t||this.defaultError;try{for(i=0,r=w.length;r>0&&i<r;)f=w.key(i),e=cs(this,f),f!==e?(w.removeItem(f),r=w.length):i++;u(n)}catch(o){u(t,o)}},o.prototype.close=function(){},o.prototype.contains=function(n,t,i){i=i||this.defaultError;try{var r=vr(this,n),f=w.getItem(r);u(t,f!==null)}catch(e){u(i,e)}},o.prototype.defaultError=gi,o.prototype.getAllKeys=function(n,t){var r,i,o,f,e;t=t||this.defaultError,r=[];try{for(i=0,o=w.length;i<o;i++)f=w.key(i),e=cs(this,f),f!==e&&r.push(e);u(n,r)}catch(s){u(t,s)}},o.prototype.mechanism="dom",o.prototype.read=function(i,r,f){if(f=f||this.defaultError,i instanceof Array)f({message:"Array of keys not supported"});else try{var o=vr(this,i),e=w.getItem(o);e=e!==null&&e!=="undefined"?n.JSON.parse(e,uy):t,u(r,i,e)}catch(s){u(f,s)}},o.prototype.remove=function(n,t,i){if(i=i||this.defaultError,n instanceof Array)i({message:"Batches not supported"});else try{var r=vr(this,n);w.removeItem(r),u(t)}catch(f){u(i,f)}},o.prototype.update=function(n,t,i,r){r=r||this.defaultError;var f=this;this.contains(n,function(e){e?f.addOrUpdate(n,t,i,r):u(r,{message:"key not found",key:n})},r)};var ls=n.mozIndexedDB,ct=n.IDBTransaction,as=n.IDBKeyRange,tt=function(n,t){return function(i){i.code===11&&(i={name:"QUOTA_EXCEEDED_ERR",error:i}),n?n(i):t&&t(i)}},lt=function(n,t,i,r){var f=n.name,u=n.db,o=tt(r,n.defaultError),e;u?i(u.transaction(f,t)):(e=ls.open("_datajs_"+f),e.onsuccess=function(r){if(u=n.db=r.target.result,u.objectStoreNames.contains(f))i(u.transaction(f,t));else{var e=u.setVersion("1.0");e.onsuccess=function(){u.createObjectStore(f,null,!1),i(u.transaction(f,t))},e.onerror=o,e.onblocked=o}},e.onerror=tt(r,this.defaultError))},h=function(n){this.name=n};h.create=function(n){if(h.isSupported())return new h(n);throw{message:"IndexedDB is not supported on this browser"};},h.isSupported=function(){return!!ls},h.prototype.add=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),lt(this,ct.READ_WRITE,function(s){s.onabort=tt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)};for(var h=0;h<u.length&&h<f.length;h++)s.objectStore(e).add(f[h],u[h])},r)},h.prototype.addOrUpdate=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),lt(this,ct.READ_WRITE,function(s){s.onabort=tt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)};for(var h=0;h<u.length&&h<f.length;h++)s.objectStore(e).put(f[h],u[h])},r)},h.prototype.clear=function(n,t){var i=this.name,r=this.defaultError;lt(this,ct.READ_WRITE,function(u){u.onerror=tt(t,r),u.oncomplete=function(){n()},u.objectStore(i).clear()},t)},h.prototype.close=function(){this.db&&(this.db.close(),this.db=null)},h.prototype.contains=function(n,i,r){var u=this.name,f=this.defaultError;lt(this,ct.READ_ONLY,function(e){var o=e.objectStore(u).openCursor(as.only(n));e.oncomplete=function(){i(o.result!==t)},e.onerror=tt(r,f)},r)},h.prototype.defaultError=gi,h.prototype.getAllKeys=function(n,t){var i=this.name,r=this.defaultError;lt(this,ct.READ_ONLY,function(u){var e=[],f;u.oncomplete=function(){n(e)},f=u.objectStore(i).openCursor(),f.onerror=tt(t,r),f.onsuccess=function(n){var t=n.target.result;t&&(e.push(t.key),t["continue"].call(t))}},t)},h.prototype.mechanism="indexeddb",h.prototype.read=function(n,t,i){var u=this.name,f=this.defaultError,r=n instanceof Array?n:[n];lt(this,ct.READ_WRITE,function(e){var s=[],o,h,c;for(e.onerror=tt(i,f),e.oncomplete=function(){n instanceof Array?t(r,s):t(r[0],s[0])},o=0;o<r.length;o++)h=e.objectStore(u),c=h.get.call(h,r[o]),c.onsuccess=function(n){s.push(n.target.result)}},i)},h.prototype.remove=function(n,t,i){var u=this.name,f=this.defaultError,r=n instanceof Array?n:[n];lt(this,ct.READ_WRITE,function(n){var e,o;for(n.onerror=tt(i,f),n.oncomplete=function(){t()},e=0;e<r.length;e++)o=n.objectStore(u),o["delete"].call(o,r[e])},i)},h.prototype.update=function(n,t,i,r){var e=this.name,o=this.defaultError,u=[],f=[];n instanceof Array?(u=n,f=t):(u=[n],f=[t]),lt(this,ct.READ_WRITE,function(s){var h,c;for(s.onabort=tt(r,o),s.oncomplete=function(){n instanceof Array?i(u,f):i(n,t)},h=0;h<u.length&&h<f.length;h++)c=s.objectStore(e).openCursor(as.only(u[h])),c.pair={key:u[h],value:f[h]},c.onsuccess=function(n){var t=n.target.result;t?t.update(n.target.pair.value):s.abort()}},r)},at=function(n){var o=[],r=[],i={},f,e;this.name=n,f=function(n){return n||this.defaultError},e=function(n,i){var r;return(n instanceof Array&&(r="Array of keys not supported"),(n===t||n===null)&&(r="Invalid key"),r)?(u(i,{message:r}),!1):!0},this.add=function(n,t,r,u){u=f(u),e(n,u)&&(i.hasOwnProperty(n)?u({message:"key already exists",key:n}):this.addOrUpdate(n,t,r,u))},this.addOrUpdate=function(n,s,h,c){if(c=f(c),e(n,c)){var l=i[n];l===t&&(l=o.length>0?o.splice(0,1):r.length),r[l]=s,i[n]=l,u(h,n,s)}},this.clear=function(n){r=[],i={},o=[],u(n)},this.contains=function(n,t){var r=i.hasOwnProperty(n);u(t,r)},this.getAllKeys=function(n){var t=[],r;for(r in i)t.push(r);u(n,t)},this.read=function(n,t,o){if(o=f(o),e(n,o)){var s=i[n];u(t,n,r[s])}},this.remove=function(n,s,h){if(h=f(h),e(n,h)){var c=i[n];c!==t&&(c===r.length-1?r.pop():(r[c]=t,o.push(c)),delete i[n],r.length===0&&(o=[])),u(s)}},this.update=function(n,t,r,u){u=f(u),e(n,u)&&(i.hasOwnProperty(n)?this.addOrUpdate(n,t,r,u):u({message:"key not found",key:n}))}},at.create=function(n){return new at(n)},at.isSupported=function(){return!0},at.prototype.close=function(){},at.prototype.defaultError=gi,at.prototype.mechanism="memory",vs={indexeddb:h,dom:o,memory:at},fi.defaultStoreMechanism="best",fi.createStore=function(n,t){t||(t=fi.defaultStoreMechanism),t==="best"&&(t=o.isSupported()?"dom":"memory");var i=vs[t];if(i)return i.create(n);throw{message:"Failed to create store",name:n,mechanism:t};},ys=function(n,t,i){return function(){return n[t].apply(n,arguments),i}},wt=function(){this._arguments=t,this._done=t,this._fail=t,this._resolved=!1,this._rejected=!1},wt.prototype={then:function(n,t){return n&&(this._done?this._done.push(n):this._done=[n]),t&&(this._fail?this._fail.push(t):this._fail=[t]),this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments),this},resolve:function(){if(this._done){for(var n=0,i=this._done.length;n<i;n++)this._done[n].apply(null,arguments);this._done=t,this._resolved=!1,this._arguments=t}else this._resolved=!0,this._arguments=arguments},reject:function(){if(this._fail){for(var n=0,i=this._fail.length;n<i;n++)this._fail[n].apply(null,arguments);this._fail=t,this._rejected=!1,this._arguments=t}else this._rejected=!0,this._arguments=arguments},promise:function(){var n={};return n.then=ys(this,"then",n),n}};var yr=function(){return n.jQuery&&n.jQuery.Deferred?new n.jQuery.Deferred:new wt},fy=function(n,t){var i=n.indexOf("?")>=0?"&":"?";return n+i+t},ey=function(n,t){var i=n.indexOf("?"),r="";return i>=0&&(r=n.substr(i),n=n.substr(0,i)),n[n.length-1]!=="/"&&(n+="/"),n+t+r},ps=function(n,t){return{method:"GET",requestUri:n,user:t.user,password:t.password,enableJsonpCallback:t.enableJsonpCallback,callbackParameterName:t.callbackParameterName,formatQueryString:t.formatQueryString}},np=function(n,t){var u=-1,r=n.indexOf("?"),i;return r!==-1&&(i=n.indexOf("?"+t+"=",r),i===-1&&(i=n.indexOf("&"+t+"=",r)),i!==-1&&(u=i+t.length+2)),u},oy=function(n,t,i,r){return ws(n,t,[],i,r)},ws=function(n,r,u,f,e){var s=ps(n,r),o=i.request(s,function(n){var t=n.__next,i=n.results;u=u.concat(i),t?o=ws(t,r,u,f,e):f(u)},e,t,r.httpClient,r.metadata);return{abort:function(){o.abort()}}},sy=function(n){var u=this,f=n.source;return u.identifier=gh(encodeURI(decodeURI(f))),u.options=n,u.count=function(n,e){var o=u.options;return i.request(ps(ey(f,"$count"),o),function(t){var i=r(t.toString());isNaN(i)?e({message:"Count is NaN",count:i}):n(i)},e,t,o.httpClient,o.metadata)},u.read=function(n,t,i,r){var e="$skip="+n+"&$top="+t;return oy(fy(f,e),u.options,i,r)},u},hy=function(n,t){var r=cy(n,t),i,u;r&&(i=r.i-t.i,u=i+(n.c-n.d.length),n.d=n.d.concat(t.d.slice(i,u)))},cy=function(n,t){var r=n.i+n.c,u=t.i+t.c,i=n.i>t.i?n.i:t.i,f=r<u?r:u,e;return f>=i&&(e={i:i,c:f-i}),e},bs=function(n,i){if(n===t||typeof n!="number")throw{message:"'"+i+"' must be a number."};if(isNaN(n)||n<0||!isFinite(n))throw{message:"'"+i+"' must be greater than or equal to zero."};},ly=function(n,i){if(n!==t){if(typeof n!="number")throw{message:"'"+i+"' must be a number."};if(isNaN(n)||n<=0||!isFinite(n))throw{message:"'"+i+"' must be greater than zero."};}},ks=function(n,i){if(n!==t&&(typeof n!="number"||isNaN(n)||!isFinite(n)))throw{message:"'"+i+"' must be a number."};},uf=function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return n.splice(i,1),!0;return!1},bt=function(n,t){for(var i in t)n[i]=t[i];return n},ds=function(n){var t=0,r=typeof n,i;if(r==="object"&&n)for(i in n)t+=i.length*2+ds(n[i]);else t=r==="string"?n.length*2:8;return t},gs=function(n,t,i){return n=Math.floor(n/i)*i,t=Math.ceil((t+1)/i)*i,{i:n,c:t-n}},pr="destroy",kt="idle",nh="init",ff="read",ef="prefetch",of="write",vi="cancel",vt="end",sf="error",dt="start",th="wait",ih="clear",yi="done",pi="local",rh="save",uh="source",ui=function(n,t,i,r,u,f,e){var h,c,o=this,l,s;return o.p=t,o.i=r,o.c=u,o.d=f,o.s=dt,o.canceled=!1,o.pending=e,o.oncomplete=null,o.cancel=function(){if(i){var n=o.s;n!==sf&&n!==vt&&n!==vi&&(o.canceled=!0,s(vi,h))}},o.complete=function(){s(vt,h)},o.error=function(n){o.canceled||s(sf,n)},o.run=function(n){c=n,o.transition(o.s,h)},o.wait=function(n){s(th,n)},l=function(t,i,r){switch(t){case dt:i!==nh&&n(o,t,i,r);break;case th:n(o,t,i,r);break;case vi:n(o,t,i,r),o.fireCanceled(),s(vt);break;case sf:n(o,t,i,r),o.canceled=!0,o.fireRejected(r),s(vt);break;case vt:if(o.oncomplete)o.oncomplete(o);o.canceled||o.fireResolved(),n(o,t,i,r);break;default:n(o,t,i,r)}},s=function(n,t){o.s=n,h=t,l(n,c,t)},o.transition=s,o};ui.prototype.fireResolved=function(){var n=this.p;n&&(this.p=null,n.resolve(this.d))},ui.prototype.fireRejected=function(n){var t=this.p;t&&(this.p=null,t.reject(n))},ui.prototype.fireCanceled=function(){this.fireRejected({canceled:!0,message:"Operation canceled"})},fh=function(i){var it=nh,y={counts:0,netReads:0,prefetches:0,cacheReads:0},c=[],k=[],p=[],nt=0,l=!1,d=ru(i.cacheSize,1048576),a=0,h=0,g=0,tt=d===0,f=ru(i.pageSize,50),ut=ru(i.prefetchSize,f),st="1.0",o,ft=0,w=i.source,v,e;typeof w=="string"&&(w=new sy(i)),w.options=i,v=fi.createStore(i.name,i.mechanism),e=this,e.onidle=i.idle,e.stats=y,e.count=function(){var n,i,t;if(o)throw o;return(n=yr(),i=!1,l)?(u(function(){n.resolve(a)}),n.promise()):(t=w.count(function(i){t=null,y.counts++,n.resolve(i)},function(r){t=null,n.reject(bt(r,{canceled:i}))}),bt(n.promise(),{cancel:function(){t&&(i=!0,t.abort(),t=null)}}))},e.clear=function(){if(o)throw o;if(c.length===0){var n=yr(),t=new ui(oi,n,!1);return et(t,c),n.promise()}return c[0].p},e.filterForward=function(n,t,i){return ct(n,t,i,!1)},e.filterBack=function(n,t,i){return ct(n,t,i,!0)},e.readRange=function(n,t){if(bs(n,"index"),bs(t,"count"),o)throw o;var i=yr(),r=new ui(hi,i,!0,n,t,[],0);return et(r,k),bt(i.promise(),{cancel:function(){r.cancel()}})},e.ToObservable=e.toObservable=function(){if(!n.Rx||!n.Rx.Observable)throw{message:"Rx library not available - include rx.js"};if(o)throw o;return n.Rx.Observable.CreateWithDisposable(function(n){var t=!1,i=0,r=function(i){t||n.OnError(i)},u=function(o){if(!t){for(var s=0,h=o.length;s<h;s++)n.OnNext(o[s]);o.length<f?n.OnCompleted():(i+=f,e.readRange(i,f).then(u,r))}};return e.readRange(i,f).then(u,r),{Dispose:function(){t=!0}}})};var rt=function(n){return function(t){o={message:n,error:t};for(var i=0,r=k.length;i<r;i++)k[i].fireRejected(o);for(i=0,r=c.length;i<r;i++)c[i].fireRejected(o);k=c=null}},s=function(n){if(n!==it){it=n;for(var i=c.concat(k,p),t=0,r=i.length;t<r;t++)i[t].run(it)}},ht=function(){var n=new wt;return v.clear(function(){nt=0,l=!1,a=0,h=0,g=0,tt=d===0,y={counts:0,netReads:0,prefetches:0,cacheReads:0},e.stats=y,v.close(),n.resolve()},function(t){n.reject(t)}),n},ni=function(n){var t=uf(c,n);t||(t=uf(k,n),t||uf(p,n)),ft--,s(kt)},ti=function(n){var t=new wt,r=!1,i=w.read(n,f,function(i){var r={i:n,c:i.length,d:i};t.resolve(r)},function(n){t.reject(n)});return bt(t,{cancel:function(){i&&(i.abort(),r=!0,i=null)}})},ct=function(n,t,i,u){if(n=r(n),t=r(t),isNaN(n))throw{message:"'index' must be a valid number.",index:n};if(isNaN(t))throw{message:"'count' must be a valid number.",count:t};if(o)throw o;n=Math.max(n,0);var h=yr(),s=[],a=!1,l=null,v=function(n,r){a||(t>=0&&s.length>=t?h.resolve(s):l=e.readRange(n,r).then(function(e){for(var l,a,y,p,o=0,c=e.length;o<c&&(t<0||s.length<t);o++)l=u?c-o-1:o,a=e[l],i(a)&&(y={index:n+l,item:a},u?s.unshift(y):s.push(y));!u&&e.length<r||u&&n<=0?h.resolve(s):(p=u?Math.max(n-f,0):n+r,v(p,f))},function(n){h.reject(n)}))},c=gs(n,n,f),y=u?c.i:n,p=u?n-c.i+1:c.i+c.c-n;return v(y,p),bt(h.promise(),{cancel:function(){l&&l.cancel(),a=!0}})},lt=function(){e.onidle&&ft===0&&e.onidle()},ii=function(n){if(!l&&ut!==0&&!tt&&(p.length===0||p[0]&&p[0].c!==-1)){var t=new ui(si,null,!0,n,ut,null,ut);et(t,p)}},et=function(n,t){n.oncomplete=ni,t.push(n),ft++,n.run(it)},ri=function(n){var r=!1,i=bt(new wt,{cancel:function(){r=!0}}),u=at(i,"Read page from store failure");return v.contains(n,function(f){if(!r){if(f){v.read(n,function(n,u){r||i.resolve(u!==t,u)},u);return}i.resolve(!1)}},u),i},ei=function(n,t){var e=!1,i=bt(new wt,{cancel:function(){e=!0}}),r=at(i,"Save page to store failure"),u=function(){i.resolve(!0)},f;return t.c>0?(f=ds(t),tt=d>=0&&d<nt+f,tt?u():v.addOrUpdate(n,t,function(){yt(t,f),ot(u,r)},r)):(yt(t,0),ot(u,r)),i},ot=function(n,t){var i={actualCacheSize:nt,allDataLocal:l,cacheSize:d,collectionCount:a,highestSavedPage:h,highestSavedPageSize:g,pageSize:f,sourceId:w.identifier,version:st};v.addOrUpdate("__settings",i,n,t)},at=function(n){return function(){n.resolve(!1)}},yt=function(n,t){var i=n.c,r=n.i;i===0?h===r-f&&(a=h+g):(h=Math.max(h,r),h===r&&(g=i),nt+=t,i<f&&!a&&(a=r+i)),l||a!==h+g||(l=!0)},pt=function(n,t,i,r){var u=n.canceled&&t!==vt;return u&&t===vi&&r&&r.cancel&&r.cancel(),u},oi=function(n,t,i){var r=n.transition;if(i!==pr)return s(pr),!0;switch(t){case dt:r(ih);break;case vt:lt();break;case ih:ht().then(function(){n.complete()}),n.wait();break;default:return!1}return!0},si=function(n,t,i,r){var e,u;if(!pt(n,t,i,r)){if(e=n.transition,i!==ef)return i===pr?t!==vi&&n.cancel():i===kt&&s(ef),!0;switch(t){case dt:p[0]===n&&e(pi,n.i);break;case yi:u=n.pending,u>0&&(u-=Math.min(u,r.c)),l||u===0||r.c<f||tt?n.complete():(n.pending=u,e(pi,r.i+f));break;default:return gt(n,t,i,r,!0)}}return!0},hi=function(n,t,i,r){var u,e,o;if(!pt(n,t,i,r)){if(u=n.transition,i!==ff&&t!==dt)return i===pr?t!==dt&&n.cancel():i!==of&&s(ff),!0;switch(t){case dt:(i===kt||i===ef)&&(s(ff),n.c>0?(e=gs(n.i,n.c,f),u(pi,e.i)):u(yi,n));break;case yi:hy(n,r),o=n.d.length,n.c===o||r.c<f?(y.cacheReads++,ii(r.i+r.c),n.complete()):u(pi,r.i+f);break;default:return gt(n,t,i,r,!1)}}return!0},gt=function(n,t,i,r,u){var o=n.error,e=n.transition,h=n.wait,f;switch(t){case vt:lt();break;case pi:f=ri(r).then(function(t,i){n.canceled||(t?e(yi,i):e(uh,r))});break;case uh:f=ti(r).then(function(t){n.canceled||(u?y.prefetches++:y.netReads++,e(rh,t))},o);break;case rh:i!==of&&(s(of),f=ei(r.i,r).then(function(t){n.canceled||(!t&&u&&(n.pending=0),e(yi,r)),s(kt)}));break;default:return!1}return f&&(n.canceled?f.cancel():n.s===t&&h(f)),!0};return v.read("__settings",function(n,t){if(b(t)){var i=t.version;if(!i||i.indexOf("1.")!==0){rt("Unsupported cache store version "+i)();return}f!==t.pageSize||w.identifier!==t.sourceId?ht().then(function(){s(kt)},rt("Unable to clear store during initialization")):(nt=t.actualCacheSize,l=t.allDataLocal,d=t.cacheSize,a=t.collectionCount,h=t.highestSavedPage,g=t.highestSavedPageSize,st=i,s(kt))}else ot(function(){s(kt)},rt("Unable to write settings during initialization."))},rt("Unable to read settings from store.")),e},fi.createDataCache=function(n){if(ly(n.pageSize,"pageSize"),ks(n.cacheSize,"cacheSize"),ks(n.prefetchSize,"prefetchSize"),!b(n.name))throw{message:"Undefined or null name",options:n};if(!b(n.source))throw{message:"Undefined source",options:n};return new fh(n)};var ay=function(n,t){return typeof n.dataValidator=="function"?n.dataValidator(t):!0},eh=function(n,t){var i,u,r;if(Array.isArray(n.handler.partHandler)){for(i=n.handler.partHandler,u=hu(t),r=0;r<i.length;r++)if(cu(i[r],u)&&ay(t))return i[r];return i[i.length-1]}return n.handler.partHandler},vy=function(n,t,i){var r=i.contentType.properties.boundary;return{__batchRequests:hf(t,{boundaries:[r],handlerContext:i})}},hf=function(n,t){var f="--"+lr(t),u,o,s,i,h,r;for(pt(n,t,f),p(n,t),u=[];o!=="--"&&t.position<n.length;){if(s=ar(n,t),i=it(s["Content-Type"]),i&&i.mediaType===nt){t.boundaries.push(i.properties.boundary);try{h=hf(n,t)}catch(e){e.response=hf(n,t,f),changeResponses=[e]}u.push({__changeRequests:h}),t.boundaries.pop(),pt(n,t,"--"+lr(t))}else{if(!i||i.mediaType!=="application/http")throw{message:"invalid MIME part type "};p(n,t),r=py(n,t,f);try{eh(t.handlerContext,r).read(r,t.handlerContext)}catch(e){r=e}u.push(r)}o=n.substr(t.position,2),p(n,t)}return u},yy=/^(\w*) (.*) HTTP\/1\.\d$/i,py=function(n,t,i){var o=t.position,s=p(n,t),r=yy.exec(s),u,f,e;return r?(u=r[1],f=r[2],e=ar(n,t),p(n,t)):t.position=o,{method:u,urlPart:f,headers:e,body:pt(n,t,"\r\n"+i)}},wy=function(n,t,i){var r=i.contentType=i.contentType||it(nt);if(r.mediaType===nt)return ky(t,i)},by=function(n,i,r){n.headers?di(n.headers):n.headers={},b(n.data)&&n.body===t&&i.write(n,r)},ky=function(n,t){var e=yt(n),i,f,r,u,o,s;if(e!==wr)throw{message:'Serialization of batches of type "'+e+'" is not supported'};for(i=cr("batchresponse_"),t.request.batchBoundary=i,f=n.__batchRequests,r="",u=0,o=f.length;u<o;u++)r+=ht(i,!1)+oh(f[u],t);return r+=ht(i,!0),s=t.contentType.properties,s.boundary=i,r},oh=function(n,t,i){var e=n.__changeRequests,r,u,f,o;if(k(e)){if(i)throw{message:"Not Supported: change set nested in other change set"};for(u=cr("changesetresponse_"),r="Content-Type: "+nt+"; boundary="+u+"\r\n",f=0,o=e.length;f<o;f++)r+=ht(u,!1)+oh(e[f],t,!0);r+=ht(u,!0)}else r="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n",by(n,eh(t,n),{metadata:t.metadata}),r+=dy(n);return r},dy=function(n){var t="HTTP/1.1 "+n.statusCode+" "+n.statusName+"\r\n",i;for(i in n.headers)n.headers[i]&&(t=t+i+": "+n.headers[i]+"\r\n");return t+="\r\n",n.body&&(t+=n.body),t};i.batchServerHandler=rt(vy,wy,nt,g),sh=function(i,r){return r?n.JSON.parse(r):t},i.serverJsonHandler=rt(sh,fs,hr.join(","),g),cf=rt(ns,ce,yu.join(","),g),cf.dataValidator=function(n){return typeof n.data=="string"},i.batchServerHandler.partHandler=[i.serverJsonHandler,cf,i.atomHandler,i.defaultHandler]})(window);
//@ sourceMappingURL=datajs-1.0.3-patched.min.js.map